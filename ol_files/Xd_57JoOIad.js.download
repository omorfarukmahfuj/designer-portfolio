;/*FB_PKG_DELIM*/

__d("ACTSanitizerApiLazyLoader",["ACTSanitizerApiTypes","FBLogger","JSResourceForInteraction","MAWParseXMAProtocol","Promise","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null,j={isMessageTextValid:function(){c("FBLogger")("armadillo_act").mustfix("Function not implemented yet. Assuming the message text is invalid");return d("ACTSanitizerApiTypes").ACTSanitizerValidationResult.MessageTextFailure},isXMAValid:function(a){a=d("MAWParseXMAProtocol").isXMAContentValid(a);return a?d("ACTSanitizerApiTypes").ACTSanitizerValidationResult.Valid:d("ACTSanitizerApiTypes").ACTSanitizerValidationResult.UrlFailure}};function a(){var a=c("gkx")("2243");if(!a)return(h||(h=b("Promise"))).resolve(j);i==null&&(i=new(h||(h=b("Promise")))(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield c("JSResourceForInteraction")("ACTSanitizerApiWasm").__setRef("ACTSanitizerApiLazyLoader").load());a(b.ACTSanitizerWasm())});return function(b){return a.apply(this,arguments)}}()));return i}g.fallbackACTSanitizerApi=j;g.loadACTSanitizerApi=a}),98);
__d("ArmadilloTaskHandlers",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";b={add:(a=c("JSResourceForInteraction"))("AddTaskHandler").__setRef("ArmadilloTaskHandlers"),get_messenger_db_dump_attachments_for_bug_reporting:a("GetMessengerDBDumpAttachments").__setRef("ArmadilloTaskHandlers"),maw_get_devices:a("MAWGetDevicesTaskHandler").__setRef("ArmadilloTaskHandlers"),preload_messenger_db_dump_attachments_for_bug_reporting:a("PreloadDBDumpAttachments").__setRef("ArmadilloTaskHandlers"),test:a("TestNativeTaskHandler").__setRef("ArmadilloTaskHandlers"),zenon_send_chatd_mws_message:a("MAWZenonSendMultiwayMsgChatdTaskHandler").__setRef("ArmadilloTaskHandlers")};g.TASK_HANDLERS_RESOURCES=b}),98);
__d("BroadcastChannelClientServerHandshake",["FBLogger","Promise","Random","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a.addEventListener("message",function(b){var c;((c=b.data)==null?void 0:c.type)==="BroadcastChannelHandshake-syn"&&a.postMessage({nonce:b.data.nonce,type:"BroadcastChannelHandshake-syn-ack"})})}function e(a,e){var f=d("Random").random(),g=0;return new(h||(h=b("Promise")))(function(b,d){var h=!1,i=function b(){if(g===6){h=!0;a.removeEventListener("message",j);try{throw c("FBLogger")("ls_web_init").mustfixThrow("BC handshake failed, failing, likely worker failure%s",e!=null?" for"+e:"")}catch(a){d(a)}return}if(h)return;a.postMessage({nonce:f,type:"BroadcastChannelHandshake-syn"});c("setTimeout")(b,100*Math.pow(2,g++))},j=function c(d){var e;((e=d.data)==null?void 0:e.type)==="BroadcastChannelHandshake-syn-ack"&&((e=d.data)==null?void 0:e.nonce)===f&&(b(),h=!0,a.removeEventListener("message",c))};a.addEventListener("message",j);i()})}g.listen=a;g.checkAlive=e}),98);
__d("CometTaskFrameworkTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["UNKNOWN","BACKGROUND","CURRENT_THREAD","LS_WORKER","MAW_WORKER","TEST"]);c="comet_task_framework";f.ExecutionContext=a;f.TASK_FRAMEWORK_PREFIX=c}),66);
__d("InstamadilloCoreTypeAdminMessage.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={DEVICE_ADMIN_MESSAGE_TYPE_NONE:0,DEVICE_ADMIN_MESSAGE_TYPE_LOCAL_USER_CHANGED_IDENTITY_KEY_NAMED_DEVICE:1,DEVICE_ADMIN_MESSAGE_TYPE_SECURITY_ALERT_PARTICIPANT_KEY_CHANGE:2,DEVICE_ADMIN_MESSAGE_TYPE_SECURITY_ALERT_PARTICIPANT_NEW_LOGIN:3};b={};c={};b.internalSpec={deviceAdminMessage:[1,d("WAProtoConst").TYPES.MESSAGE,c],__oneofs__:{adminMessageSubtype:["deviceAdminMessage"]}};c.internalSpec={deviceAdminMessageType:[1,d("WAProtoConst").TYPES.ENUM,a],deviceName:[2,d("WAProtoConst").TYPES.STRING]};g.DEVICE_ADMIN_MESSAGE_TYPE=a;g.AdminMessageSpec=b;g.DeviceAdminMessageSpec=c}),98);
__d("InstamadilloCoreTypeMedia.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={RAVEN_VIEW_MODEL_UNSPECIFIED:0,RAVEN_VIEW_MODEL_ONCE:1,RAVEN_VIEW_MODEL_REPLAYABLE:2,RAVEN_VIEW_MODEL_PERMANENT:3};b={UNSET:0,NONE:1,NUDE:2};c={};e={};f={};var h={},i={},j={},k={},l={},m={},n={},o={};c.internalSpec={staticPhoto:[1,(d=d("WAProtoConst")).TYPES.MESSAGE,e],voice:[2,d.TYPES.MESSAGE,f],video:[3,d.TYPES.MESSAGE,h],raven:[4,d.TYPES.MESSAGE,k],gif:[5,d.TYPES.MESSAGE,i],avatarSticker:[6,d.TYPES.MESSAGE,j],__oneofs__:{media:["staticPhoto","voice","video","raven","gif","avatarSticker"]}};e.internalSpec={mediaTransport:[1,d.TYPES.MESSAGE,n],height:[2,d.TYPES.INT32],width:[3,d.TYPES.INT32],scanLengths:[4,d.FLAGS.REPEATED|d.FLAGS.PACKED|d.TYPES.INT32],thumbnail:[5,d.TYPES.MESSAGE,m]};f.internalSpec={mediaTransport:[1,d.TYPES.MESSAGE,n],duration:[2,d.TYPES.INT32],waveforms:[3,d.FLAGS.REPEATED|d.FLAGS.PACKED|d.TYPES.FLOAT],waveformSamplingFrequencyHz:[4,d.TYPES.INT32]};h.internalSpec={mediaTransport:[1,d.TYPES.MESSAGE,n],height:[2,d.TYPES.INT32],width:[3,d.TYPES.INT32],thumbnail:[4,d.TYPES.MESSAGE,m],videoExtraMetadata:[5,d.TYPES.MESSAGE,o]};i.internalSpec={mediaTransport:[1,d.TYPES.MESSAGE,n],height:[2,d.TYPES.INT32],width:[3,d.TYPES.INT32],isSticker:[4,d.TYPES.BOOL],stickerId:[5,d.TYPES.STRING],gifUrl:[6,d.TYPES.STRING],gifSize:[7,d.TYPES.INT32],isRandom:[8,d.TYPES.BOOL]};j.internalSpec={mediaTransport:[1,d.TYPES.MESSAGE,n],isAnimated:[2,d.TYPES.BOOL],stickerId:[3,d.TYPES.STRING],stickerTemplate:[4,d.TYPES.STRING],nuxType:[5,d.TYPES.INT32]};k.internalSpec={viewMode:[1,d.TYPES.ENUM,a],content:[2,d.TYPES.MESSAGE,l]};l.internalSpec={staticPhoto:[1,d.TYPES.MESSAGE,e],video:[2,d.TYPES.MESSAGE,h],__oneofs__:{ravenContent:["staticPhoto","video"]}};m.internalSpec={mediaTransport:[1,d.TYPES.MESSAGE,n],height:[2,d.TYPES.INT32],width:[3,d.TYPES.INT32]};n.internalSpec={mediaId:[1,d.TYPES.STRING],fileSha256:[2,d.TYPES.STRING],mediaKey:[3,d.TYPES.STRING],fileEncSha256:[4,d.TYPES.STRING],directPath:[5,d.TYPES.STRING],mediaKeyTimestamp:[6,d.TYPES.STRING],sidecar:[7,d.TYPES.STRING],fileLength:[8,d.TYPES.INT32],mimetype:[9,d.TYPES.STRING],objectId:[10,d.TYPES.STRING]};o.internalSpec={uploadMosClientScore:[1,d.TYPES.FLOAT]};g.RAVEN_VIEW_MODE=a;g.MEDIA_INTERVENTION_TYPE=b;g.MediaSpec=c;g.StaticPhotoSpec=e;g.VoiceSpec=f;g.VideoSpec=h;g.GifSpec=i;g.AvatarStickerSpec=j;g.RavenSpec=k;g.RavenContentSpec=l;g.ThumbnailSpec=m;g.CommonMediaTransportSpec=n;g.VideoExtraMetadataSpec=o}),98);
__d("InstamadilloCoreTypeCollection.pb",["InstamadilloCoreTypeMedia.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={name:[1,d("WAProtoConst").TYPES.STRING],media:[2,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,d("InstamadilloCoreTypeMedia.pb").MediaSpec]};g.CollectionSpec=a}),98);
__d("InstamadilloCoreTypeLink.pb",["InstamadilloCoreTypeMedia.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};a.internalSpec={text:[1,(e=d("WAProtoConst")).TYPES.STRING],linkContext:[2,e.TYPES.MESSAGE,b]};b.internalSpec={linkImageUrl:[1,e.TYPES.MESSAGE,c],linkPreviewTitle:[2,e.TYPES.STRING],linkUrl:[3,e.TYPES.STRING],linkSummary:[4,e.TYPES.STRING],linkMusicPreviewUrl:[5,e.TYPES.STRING],linkMusicPreviewCountriesAllowed:[6,e.FLAGS.REPEATED|e.TYPES.STRING],linkPreviewThumbnail:[7,e.TYPES.MESSAGE,d("InstamadilloCoreTypeMedia.pb").ThumbnailSpec],linkPreviewBody:[8,e.TYPES.STRING]};c.internalSpec={url:[1,e.TYPES.STRING],width:[2,e.TYPES.INT32],height:[3,e.TYPES.INT32]};g.LinkSpec=a;g.LinkContextSpec=b;g.ImageUrlSpec=c}),98);
__d("InstamadilloCoreTypeText.pb",["InstamadilloCoreTypeMedia.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={TEXT_FORMAT_STYLE_UNSPECIFIED:0,TEXT_FORMAT_STYLE_BOLD:1,TEXT_FORMAT_STYLE_ITALIC:2,TEXT_FORMAT_STYLE_STRIKETHROUGH:3,TEXT_FORMAT_STYLE_UNDERLINE:4,TEXT_FORMAT_STYLE_INVALID:5};b={};c={};e={};f={};var i={};b.internalSpec={text:[1,(h=d("WAProtoConst")).TYPES.STRING],isSuggestedReply:[2,h.TYPES.BOOL],postbackPayload:[3,h.TYPES.STRING],powerUpData:[4,h.TYPES.MESSAGE,c],commands:[5,h.FLAGS.REPEATED|h.TYPES.MESSAGE,e],animatedEmojiCharacterRanges:[6,h.FLAGS.REPEATED|h.TYPES.MESSAGE,i]};c.internalSpec={style:[1,h.TYPES.INT32],mediaAttachment:[2,h.TYPES.MESSAGE,d("InstamadilloCoreTypeMedia.pb").CommonMediaTransportSpec]};e.internalSpec={offset:[1,h.TYPES.INT32],length:[2,h.TYPES.INT32],type:[3,h.TYPES.INT32],fbid:[4,h.TYPES.STRING],userOrThreadFbid:[5,h.TYPES.STRING]};f.internalSpec={offset:[1,h.TYPES.INT32],length:[2,h.TYPES.INT32],style:[3,h.TYPES.ENUM,a]};i.internalSpec={offset:[1,h.TYPES.INT32],length:[2,h.TYPES.INT32]};g.TEXT_FORMAT_STYLE=a;g.TextSpec=b;g.PowerUpsDataSpec=c;g.CommandRangeDataSpec=e;g.FormattedTextSpec=f;g.AnimatedEmojiCharacterRangeSpec=i}),98);
__d("InstamadilloAddMessage.pb",["InstamadilloCoreTypeAdminMessage.pb","InstamadilloCoreTypeCollection.pb","InstamadilloCoreTypeLink.pb","InstamadilloCoreTypeMedia.pb","InstamadilloCoreTypeText.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={PLACEHOLDER_TYPE_NONE:0,PLACEHOLDER_TYPE_DECRYPTION_FAILURE:1,PLACEHOLDER_TYPE_NOT_SUPPORTED_NEED_UPDATE:2,PLACEHOLDER_TYPE_DEVICE_UNAVAILABLE:3,PLACEHOLDER_TYPE_NOT_SUPPORTED_NOT_RECOVERABLE:4};b={};c={};e={};f={};var i={},j={},k={},l={},m={},n={};b.internalSpec={content:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,c],metadata:[2,h.TYPES.MESSAGE,e]};c.internalSpec={text:[1,h.TYPES.MESSAGE,d("InstamadilloCoreTypeText.pb").TextSpec],like:[2,h.TYPES.MESSAGE,l],link:[3,h.TYPES.MESSAGE,d("InstamadilloCoreTypeLink.pb").LinkSpec],receiverFetchXma:[4,h.TYPES.MESSAGE,m],media:[5,h.TYPES.MESSAGE,d("InstamadilloCoreTypeMedia.pb").MediaSpec],placeholder:[6,h.TYPES.MESSAGE,n],collection:[7,h.TYPES.MESSAGE,d("InstamadilloCoreTypeCollection.pb").CollectionSpec],adminMessage:[8,h.TYPES.MESSAGE,d("InstamadilloCoreTypeAdminMessage.pb").AdminMessageSpec],__oneofs__:{addMessageContent:["text","like","link","receiverFetchXma","media","placeholder","collection","adminMessage"]}};e.internalSpec={sendSilently:[1,h.TYPES.BOOL],privateReplyInfo:[2,h.TYPES.MESSAGE,i],repliedToMessage:[3,h.TYPES.MESSAGE,f],forwardingParams:[4,h.TYPES.MESSAGE,j],ephemeralityParams:[5,h.TYPES.MESSAGE,k]};f.internalSpec={repliedToMessageOtid:[1,h.TYPES.STRING],repliedToMessageWaServerTimeSec:[2,h.TYPES.STRING],repliedToMessageCollectionItemId:[3,h.TYPES.STRING]};i.internalSpec={commentId:[1,h.TYPES.STRING],postLink:[2,h.TYPES.STRING]};j.internalSpec={forwardedThreadId:[1,h.TYPES.STRING]};k.internalSpec={ephemeralDurationSec:[1,h.TYPES.INT64]};l.internalSpec={};m.internalSpec={contentRef:[1,h.TYPES.STRING],text:[2,h.TYPES.STRING],media:[3,h.TYPES.MESSAGE,d("InstamadilloCoreTypeMedia.pb").MediaSpec]};n.internalSpec={placeholderType:[1,h.TYPES.ENUM,a]};g.PLACEHOLDER_TYPE=a;g.AddMessagePayloadSpec=b;g.AddMessageContentSpec=c;g.AddMessageMetadataSpec=e;g.RepliedToMessageSpec=f;g.PrivateReplyInfoSpec=i;g.ForwardingParamsSpec=j;g.EphemeralityParamsSpec=k;g.LikeSpec=l;g.ReceiverFetchXmaSpec=m;g.PlaceholderSpec=n}),98);
__d("InstamadilloDeleteMessage.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={messageOtid:[1,d("WAProtoConst").TYPES.STRING]};g.DeleteMessagePayloadSpec=a}),98);
__d("InstamadilloMessageIdUtils",["FBLogger","I64","MAWUnsafeCoerce","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){var c;(h||(h=d("I64"))).isI64(a)?c=(h||(h=d("I64"))).to_string(a):c=a;return c+":"+b}function a(a){a=a.split(":");if(a.length!==2)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("Invalid instamadillo message id format. Format is <threadKey>:<stanzaId>.");return{stanzaId:a[1],threadKey:a[0]}}function b(a){a=a.split(":");if(a.length!==2){c("FBLogger")("igd_web_on_msgr").warn("Invalid instamadillo message id format. Format is <threadKey>:<stanzaId>.");return null}return{stanzaId:a[1],threadKey:a[0]}}function e(a){a=a.message.decrypted.id;return j(a)}function j(a){var b=a.externalId;a=d("WAJids").threadIdForChatJid(a.chat);return i(a,b)}function f(a,b,c){return{author:d("WAJids").toMsgrUserJid(c),chat:d("WAJids").toMsgrUserJid((h||(h=d("I64"))).to_string(a)),externalId:d("MAWUnsafeCoerce").unsafeCoerce(b)}}g.toInstamadilloMessageId=i;g.fromInstamadilloMessageId=a;g.maybeFromInstamadilloMessageId=b;g.getInstamadilloMessageIdFromStanza=e;g.getInstamadilloMessageIdFromProtocolMsgId=j;g.toProtocolMsgId=f}),98);
__d("InstamadilloSupplementMessage.pb",["InstamadilloCoreTypeMedia.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={};b={};c={};e={};f={};var i={},j={},k={};a.internalSpec={targetMessageOtid:[1,(h=d("WAProtoConst")).TYPES.STRING],uniquingKeyForSupplementalData:[2,h.TYPES.STRING],content:[3,h.TYPES.MESSAGE,b],targetMessageWaServerTimeSec:[4,h.TYPES.STRING],targetWaThreadId:[5,h.TYPES.STRING]};b.internalSpec={reaction:[1,h.TYPES.MESSAGE,e],contentView:[2,h.TYPES.MESSAGE,f],editText:[3,h.TYPES.MESSAGE,i],mediaReaction:[4,h.TYPES.MESSAGE,c],originalTransportPayload:[5,h.TYPES.MESSAGE,j],mediaInterventions:[6,h.TYPES.MESSAGE,k],__oneofs__:{supplementMessageContent:["reaction","contentView","editText","mediaReaction","originalTransportPayload","mediaInterventions"]}};c.internalSpec={mediaId:[1,h.TYPES.STRING],reaction:[2,h.TYPES.MESSAGE,e]};e.internalSpec={reactionType:[1,h.TYPES.STRING],reactionStatus:[2,h.TYPES.STRING],emoji:[3,h.TYPES.STRING],superReactType:[4,h.TYPES.STRING]};f.internalSpec={seen:[1,h.TYPES.BOOL],screenshotted:[2,h.TYPES.BOOL],replayed:[3,h.TYPES.BOOL],mimetype:[4,h.TYPES.STRING],objectId:[5,h.TYPES.STRING]};i.internalSpec={newContent:[1,h.TYPES.STRING],editCount:[2,h.TYPES.INT32]};j.internalSpec={originalTransportPayload:[1,h.TYPES.BYTES]};k.internalSpec={mediaId:[1,h.TYPES.STRING],interventionType:[2,h.TYPES.ENUM,d("InstamadilloCoreTypeMedia.pb").MEDIA_INTERVENTION_TYPE]};g.SupplementMessagePayloadSpec=a;g.SupplementMessageContentSpec=b;g.MediaReactionSpec=c;g.ReactionSpec=e;g.ContentViewSpec=f;g.EditTextSpec=i;g.OriginalTransportPayloadSpec=j;g.MediaInterventionsSpec=k}),98);
__d("InstamadilloTransportPayload.pb",["InstamadilloAddMessage.pb","InstamadilloDeleteMessage.pb","InstamadilloSupplementMessage.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.internalSpec={add:[1,(c=d("WAProtoConst")).TYPES.MESSAGE,d("InstamadilloAddMessage.pb").AddMessagePayloadSpec],"delete":[2,c.TYPES.MESSAGE,d("InstamadilloDeleteMessage.pb").DeleteMessagePayloadSpec],supplement:[3,c.TYPES.MESSAGE,d("InstamadilloSupplementMessage.pb").SupplementMessagePayloadSpec],franking:[4,c.TYPES.MESSAGE,b],openEb:[5,c.TYPES.BOOL],isE2EeAttributed:[6,c.TYPES.BOOL],__oneofs__:{transportPayload:["add","delete","supplement"]}};b.internalSpec={frankingKey:[1,c.TYPES.BYTES],frankingVersion:[2,c.TYPES.INT32]};g.TransportPayloadSpec=a;g.FrankingSpec=b}),98);
__d("MAWGetGroupInviteApi",["MAWDbGroupInviteTxns","MAWDexieTable","MAWIndexedDb","MAWLowLevelApiTypes","MAWTransactionMode","WAJids","WALogger","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getGroupInvite returned an expired group invite from ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getGroupInvite did not find the group invite from ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["getGroupInvite failed to interpret "," as a group jid"]);j=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({groupInvites:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getGroupInvite",function(a){return function(b,c,e){var f=d("WAJids").interpretAsGroupJid(b);if(f==null){d("WALogger").DEV(j(),b);return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError(d("MAWLowLevelApiTypes").GET_GROUP_INVITE_ERROR.MISSING_GROUP))}return d("MAWDbGroupInviteTxns").maybeGetGroupInvite(a,f,e).then(function(a){if(a==null){d("WALogger").DEV(i(),c);return d("WAResultOrError").makeError(d("MAWLowLevelApiTypes").GET_GROUP_INVITE_ERROR.MISSING_GROUP_INVITE)}if(!d("WATimeUtils").isInFuture(a.inviteExpirationTs)){d("WALogger").DEV(h(),c);return d("WAResultOrError").makeError(d("MAWLowLevelApiTypes").GET_GROUP_INVITE_ERROR.EXPIRED_GROUP_INVITE)}return d("WAResultOrError").makeResult({groupInvite:a,groupJid:f})})}});g.getGroupInvite=a}),98);
__d("MAWRemoveGroupInvitesApi",["MAWDbGroupInviteTxns","MAWIndexedDb","MAWTransactionMode","WALogger","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeGroupInvites deleted "," record(s) from "," for ",""]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({groupInvites:d("MAWTransactionMode").READWRITE},"removeGroupInvites",function(a){return function(b,e){return d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant(a,b,e).then(function(a){d("WALogger").DEV(h(),a,b,e),c("justknobx")._("1162")&&d("MAWIndexedDb").afterTransaction({tag:"DeleteGroupInvite",value:{threadJid:b}})}).then(function(){c("justknobx")._("1162")&&d("MAWIndexedDb").afterTransaction({tag:"GroupInviteLoaded",value:{actorId:e,threadJid:b}})})}});g.removeGroupInvites=a}),98);
__d("MAWAcceptGroupInvite",["MAWGetGroupInviteApi","MAWJids","MAWJobManager","MAWRemoveGroupInvitesApi","WADeprecatedSendIq","WADeprecatedWapParser","WAJids","WALogger","WAPersistedJobManager","WATimeUtils","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["acceptGroupInvite failed to get group invite info ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["acceptGroupInvite failed to get group jid for ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["acceptGroupInvite called"]);j=function(){return a};return a}var k=new(c("WADeprecatedWapParser"))("getAcceptGroupInviteResponse",function(a){a.assertTag("iq"),a.assertAttr("type","result")});a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(j());var b=a.chatJid,c=a.inviteCode,e=a.invitedParticipantUserId,f=a.inviteExpirationTs;a=a.inviterUserId;a=d("MAWJids").toUserJid(a);e=d("MAWJids").toUserJid(e);var g;if(c!=null&&f!=null){g=d("WAJids").interpretAsGroupJid(b);if(g==null){d("WALogger").DEV(i(),b);return!1}c=c;f=f}else{var l=(yield d("MAWGetGroupInviteApi").getGroupInvite(b,a,e));if(!l.success){d("WALogger").DEV(h(),l.error);return!1}g=l.value.groupJid;c=l.value.groupInvite.inviteCode;f=l.value.groupInvite.inviteExpirationTs}l=d("WAWap").wap("iq",{id:d("WAWap").generateId(),to:d("WAWap").GROUP_JID(g),type:"set",xmlns:"w:g2"},d("WAWap").wap("accept",{admin:d("WAWap").USER_JID(a),code:d("WAWap").CUSTOM_STRING(c),expiration:d("WAWap").LONG_INT(f)}));g=(yield d("WADeprecatedSendIq").deprecatedSendIq(l,k));if(!g.success){a=g.errorCode.toString().startsWith("5");if(a)throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{first:d("WATimeUtils").HOUR_MILLISECONDS/60,type:"exponential"},jitter:.1});return!1}b!=null&&(yield d("MAWRemoveGroupInvitesApi").removeGroupInvites(b,e));return!0});return function(b){return a.apply(this,arguments)}}()).end();g.acceptGroupInvite=a}),98);
__d("MAWAdminMsgHelpers",["MAWCreateParticipantAdminMsg","MAWExternalId","MAWRemoveParticipantAdminMsg","WAAckLevel","WAGlobals","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h="Facebook User";function a(a){return a==null||a===""?h:a}function b(a){return a!=null?d("WAJids").userIdFromJid(a):h}function c(a,b,c){return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:d("MAWCreateParticipantAdminMsg").createParticipantAdminMessage(c==="@me"?d("WAGlobals").getMyUserJid():c,b),ts:d("WATimeUtils").unixTime(),type:"Admin"}}function e(a,b,c){return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:d("MAWRemoveParticipantAdminMsg").removeParticipantAdminMessage(c==="@me"?d("WAGlobals").getMyUserJid():c,b),ts:d("WATimeUtils").unixTime(),type:"Admin"}}function f(a,b,c){var e,f=d("WAGlobals").getMyUserJid();c=c==="@me"?f:c;if(c===f)e={adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"currentUserPromotedParticipant"};else if(c==null)e=b===f?{adminMsgContent:[],adminType:"currentUserGotPromoted"}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"participantGotPromoted"};else{c=d("WAJids").userIdFromJid(c);e=b===f?{adminMsgContent:[c],adminType:"participantPromotedYou"}:{adminMsgContent:[c,d("WAJids").userIdFromJid(b)],adminType:"participantPromotedParticipant"}}return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:e,ts:d("WATimeUtils").unixTime(),type:"Admin"}}function i(a,b,c){var e,f=d("WAGlobals").getMyUserJid();c=c==="@me"?f:c;if(c===f)e=b===f?{adminMsgContent:[],adminType:"currentUserSelfDemoted"}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"currentUserDemotedParticipant"};else if(c==null)e=b===f?{adminMsgContent:[],adminType:"currentUserGotDemoted"}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"participantGotDemoted"};else{var g=d("WAJids").userIdFromJid(c);e=b===f?{adminMsgContent:[g],adminType:"participantDemotedYou"}:{adminMsgContent:[g,d("WAJids").userIdFromJid(b)],adminType:c===b?"participantSelfDemoted":"participantDemotedParticipant"}}return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:e,ts:d("WATimeUtils").unixTime(),type:"Admin"}}function j(a,b,c){var e=[],f=b.subject.content;if(f==null)return;b.subject.user===d("WAGlobals").getMyUserJid()?(b="currentUserNamedGroup",e.push(f)):c==null?(b="unkonwnUserNamedGroup",e.push(f)):(b="participantNamedGroup",e.push(c,f));return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:{adminMsgContent:e,adminType:b},ts:d("WATimeUtils").unixTime(),type:"Admin"}}function k(a,b,c){var e,f=[];if(c===d("WAGlobals").getMyUserJid())switch(b){case"all_member_add":e="currentUserSetAddModeAllMembers";break;case"admin_add":e="currentUserSetAddModeAdminOnly";break}else if(c!=null){f.push(d("WAJids").userIdFromJid(c));switch(b){case"all_member_add":e="participantSetAddModeAllMembers";break;case"admin_add":e="participantSetAddModeAdminOnly";break}}else switch(b){case"all_member_add":e="serverSetAddModeAllMembers";break;case"admin_add":e="serverSetAddModeAdminOnly";break}if(e==null)return;return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:{adminMsgContent:f,adminType:e},ts:d("WATimeUtils").unixTime(),type:"Admin"}}g.UNKNOWN_USER=h;g.maybeUnknownParticipantName=a;g.createAdminMsgContactId=b;g.createParticipantAddAdminMessage=c;g.createParticipantRemoveAdminMsg=e;g.createParticipantPromoteAdminMsg=f;g.createParticipantDemoteAdminMsg=i;g.createGroupNameChangeAdminMsg=j;g.createMemberAddModeChangeAdminMsg=k}),98);
__d("MAWCreateParticipantAdminMsg",["MAWAdminMsgHelpers","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"participantAddedYou"};case 2:return{adminMsgContent:[b,c],adminType:"participantAddedYouAndOneUser"};default:return{adminMsgContent:[b,a.toString()],adminType:"participantAddedYouAndMoreThanOneUsers"}}}function i(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"currentUserAddedOneParticipant"};case 2:return{adminMsgContent:[b,c],adminType:"currentUserAddedTwoParticipant"};default:return{adminMsgContent:[b,a.toString()],adminType:"currentUserAddedMoreThanTwoParticipant"}}}function j(a,b,c,d){switch(a){case 1:return{adminMsgContent:[b,c],adminType:"participantAddedOneUser"};case 2:return{adminMsgContent:[b,c,d],adminType:"participantAddedTwoUser"}}return{adminMsgContent:[b,c,a.toString()],adminType:"participantAddedMoreThanTwoUser"}}function a(a,b,c,e){e=e==null?b.map(d("MAWAdminMsgHelpers").createAdminMsgContactId):e;var f=e[0];e=e[1];c=c==null?d("MAWAdminMsgHelpers").createAdminMsgContactId(a):d("MAWAdminMsgHelpers").maybeUnknownParticipantName(c);if(a===d("WAGlobals").getMyUserJid())return i(b.length,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(f),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(e));return b.includes(d("WAGlobals").getMyUserJid())?h(b.length,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(c),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(b[0]===d("WAGlobals").getMyUserJid()?e:f)):j(b.length,c,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(f),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(e))}g.createParticipantAdminMessage=a}),98);
__d("MAWRemoveParticipantAdminMsg",["MAWAdminMsgHelpers","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"participantRemovedYou"};case 2:return{adminMsgContent:[b,c],adminType:"participantRemovedYouAndOneUser"};default:return{adminMsgContent:[b,a.toString()],adminType:"participantRemovedYouAndMoreThanOneUsers"}}}function i(a,b,c,d){switch(a){case 1:return d?{adminMsgContent:[],adminType:"currentUserLeftGroup"}:{adminMsgContent:[b],adminType:"currentUserRemovedOneParticipant"};case 2:return{adminMsgContent:[b,c],adminType:"currentUserRemovedTwoParticipant"};default:return{adminMsgContent:[b,a.toString()],adminType:"currentUserRemovedMoreThanTwoParticipant"}}}function j(a,b,c,d,e){switch(a){case 1:return e?{adminMsgContent:[b],adminType:"participantLeftGroup"}:{adminMsgContent:[b,c],adminType:"participantRemovedOneUser"};case 2:return{adminMsgContent:[b,c,d],adminType:"participantRemovedTwoUser"}}return{adminMsgContent:[b,c,a.toString()],adminType:"participantRemovedMoreThanTwoUser"}}function a(a,b,c,e){e=e==null?b.map(d("MAWAdminMsgHelpers").createAdminMsgContactId):e;var f=e[0];e=e[1];c=c==null?d("MAWAdminMsgHelpers").createAdminMsgContactId(a):d("MAWAdminMsgHelpers").maybeUnknownParticipantName(c);if(a===d("WAGlobals").getMyUserJid())return i(b.length,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(f),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(e),b[0]===d("WAGlobals").getMyUserJid());return b.includes(d("WAGlobals").getMyUserJid())?h(b.length,c,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(b[0]===d("WAGlobals").getMyUserJid()?e:f)):j(b.length,c,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(f),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(e),b[0]===a)}g.removeParticipantAdminMessage=a}),98);
__d("MAWGroupInfoStore",["MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieCastToPromise","MAWDexieTable","MAWFolderTypes","MAWGetOrCreateThreadTxns","MAWIndexedDb","MAWLoadMsgsTxns","MAWLoadThreadsTxns","MAWThreadManagementTxns","MAWTransactionMode","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a!=null&&typeof a==="object"&&a.groupStatus!=null&&typeof a.groupStatus==="string"?a.groupStatus:void 0}function i(a){return a!=null&&typeof a==="object"&&a.clientThreadKey!=null&&typeof a.clientThreadKey==="string"?a.clientThreadKey:void 0}function j(a){return a!=null&&typeof a==="object"&&a.folder!=null&&typeof a.folder==="number"?a.folder:void 0}function k(a){return a!=null&&typeof a==="object"&&a.updateParticipantMedatadata!=null&&typeof a.updateParticipantMedatadata==="boolean"?a.updateParticipantMedatadata:void 0}function l(a){return a===null?{}:a}a=function(){function a(a){var b=this;this.get=function(a,c){c=j(c);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWThreadManagementTxns").getGroupThread(b.db,a,c).then(function(a){return a!=null?a:null}).then(function(a){return a==null?d("WAResultOrError").makeError("missing_group"):d("MAWLoadThreadsTxns").loadContentsForThreads(b.db,[a.thread],1,null,"getGroupInfoStore").then(function(){return a.groupInfo}).then(function(a){return d("WAResultOrError").makeResult(m(a))})}))};this.create=function(a,c){var e=h(c)==="added"?d("WATimeUtils").millisTime():d("WATimeUtils").castUnixTimeToMillisTime(a.creationTs);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWGetOrCreateThreadTxns").getOrCreateThread(b.db,{clientThreadKey:i(c),createTs:e,description:"MAWGroupInfoStore-create",folder:d("MAWFolderTypes").FOLDER_ID.INBOX,jid:a.jid}).then(function(c){var e=c.created,f=c.thread,g=n(a);return d("MAWDexieTable").dexieAll([b.db.groupInfo.put(g),d("MAWDbMsgTxns").getThreadNewestMessageId(b.db,f.jid)]).then(function(a){a[0];a=a[1];d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(g)});a!=null?d("MAWLoadMsgsTxns").loadMsgsAndMediaFromOffset(b.db,f.jid,a,10,!0):d("MAWDexieTable").dexieResolve()}).then(function(){return f.archived===!0?d("MAWDbThreadTxns").unarchiveThreads(b.db,[f.jid]):d("MAWDexieTable").dexieResolve()}).then(function(){return e?d("WAResultOrError").makeResult(g.groupJid):d("WAResultOrError").makeError("existing")})}))};this["delete"]=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([b.db.threads.get({jid:a}),b.db.groupInfo["delete"](a)]).then(function(a){a=a[0];return a==null?d("WAResultOrError").makeError("missing_group"):d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").deleteThreadRow(b.db,a.jid),b.db.participants.where("threadJid").equals(a.jid)["delete"]()]).then(function(){return d("WAResultOrError").makeResult()})}))};this.update=function(a,c,e){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.threads.get({jid:a}).then(function(f){return f==null?d("WAResultOrError").makeError("missing_group"):b.db.groupInfo.get(a).then(function(a){if(a==null)return d("WAResultOrError").makeError("missing_group");a=m(a);a=c(a);var g=n(a);return b.db.groupInfo.put(g).then(function(){d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(g)});k(e)===!0&&d("MAWIndexedDb").afterTransaction({tag:"UpdateE2EEMetadataParticipants",value:d("MAWBridgeTypesCreators").createBridgeUpdateE2EEMetadataParticipants(f.jid)});return d("WAResultOrError").makeResult()})})}))};this.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.groupInfo.clear())};this.db=a}var b=a.prototype;b.has=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.groupInfo.get(a).then(function(a){return a!=null?!0:!1}))};return a}();a.tableLocks={chunk:(b=d("MAWTransactionMode")).READONLY,editMsgHistory:b.READONLY,groupInfo:b.READWRITE,groupInvites:b.READONLY,media:b.READONLY,messages:b.READWRITE,participants:b.READWRITE,reactions:b.READONLY,receiverFetchInfo:b.READONLY,threads:b.READWRITE,xma:b.READONLY};function m(a){return babelHelpers["extends"]({jid:a.groupJid},l(a.creator!=null?{creator:a.creator}:null),{creationTs:a.creationTs},l(a.participantVersion!=null?{participantVersion:a.participantVersion}:null),{inviter:a.inviter,memberAddMode:a.memberAddMode,subject:babelHelpers["extends"]({content:a.name},l(a.nameOwner!=null?{user:a.nameOwner}:null),l(a.nameTs!=null?{ts:a.nameTs}:null))})}function n(a){var b=a.subject.content;b!=null&&b.length===0&&(b=void 0);return{creationTs:a.creationTs,creator:a.creator,groupJid:a.jid,inviter:a.inviter,memberAddMode:a.memberAddMode,name:b,nameOwner:a.subject.user,nameTs:a.subject.ts,participantVersion:a.participantVersion}}g.MAWGroupInfoStore=a}),98);
__d("MAWGetExpiredMsgs",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("WATimeUtils").unixTime();return a.messages.where("messageDeleteTs").belowOrEqual(b).toArray().then(function(a){return a.map(function(a){var b=a.author,c=a.externalId;a=a.threadJid;return a==null?null:{author:b,chat:a,externalId:c}}).filter(Boolean)})}g.getExpiredMsgs=a}),98);
__d("MAWMessageStore",["I64","MAWAckLevel","MAWAuthor","MAWBridgeMsg","MAWDbMsg","MAWDbMsgTxns","MAWDbThread","MAWDexieCastToPromise","MAWDexieTable","MAWFolderTypes","MAWGetExpiredMsgs","MAWIndexedDb","MAWLocalizationUtils","MAWMsgType","MAWThreadFetchAndEmitTxns","MAWTransactionMode","MAWWriteMsgTxns","WAJids","WALogger","WAResultOrError","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," reactions rows."]);i=function(){return a};return a}function j(a){if(a!=null&&typeof a==="object"&&a.optimisticMsg!=null){a=a.optimisticMsg;if(typeof a.msgId==="string"&&typeof a.ts==="number")return{msgId:a.msgId,ts:a.ts}}return void 0}function k(a){return a!=null&&typeof a==="object"&&a.openMessageOtid!=null&&typeof a.openMessageOtid==="string"?a.openMessageOtid:void 0}function l(a){if(a!=null&&typeof a==="object"&&a.folder!=null&&typeof a.folder==="number")if(a.folder===d("MAWFolderTypes").FOLDER_ID.INBOX)return d("MAWFolderTypes").FOLDER_ID.INBOX;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.PENDING)return d("MAWFolderTypes").FOLDER_ID.PENDING;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.OTHER)return d("MAWFolderTypes").FOLDER_ID.OTHER;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.ARCHIVED)return d("MAWFolderTypes").FOLDER_ID.ARCHIVED;return null}a=function(){function a(a){this.db=a}var b=a.prototype;b.create=function(a,b){var e=this,f=j(b),g=k(b);b=l(b);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWThreadFetchAndEmitTxns").fetchAndEmitThread(this.db,a.id.chat,b,void 0,"MAWMessageStore_DEPRECATED-create").then(function(b){if(b==null)return d("WAResultOrError").makeError({type:"missing_thread"});var i=b.thread;if(a.type===d("MAWMsgType").MSG_TYPE.TEXT){b=void 0;a.ephemeralSetting!=null&&(b={ephemeralExpirationInSec:a.ephemeralSetting.expirationTs,ephemeralLastUpdatedOrSetTimestamp:a.ephemeralSetting.updatedTs});b={ack:a.ack,altIndex:void 0,author:a.id.author,ephemeralSetting:b,externalId:a.id.externalId,forwardingScore:a.forwardingScore,isForwarded:a.forwardingScore>0,msgContent:{content:((b=a.msgContent)==null?void 0:b.content)||""},threadJid:i.jid,ts:a.ts,type:d("MAWMsgType").MSG_TYPE.TEXT};return d("MAWWriteMsgTxns").writeMsg(e.db,b,i,{openMessageOtid:g,optimisticMsg:f}).then(function(){return d("WAResultOrError").makeResult()})}else if(a.type===d("MAWMsgType").MSG_TYPE.ICDC_ALERT){b={ack:a.ack,altIndex:void 0,author:a.id.author,externalId:a.id.externalId,msgContent:{adminType:a.msgContent.adminType,authorName:a.msgContent.authorName},threadJid:i.jid,ts:a.ts,type:d("MAWMsgType").MSG_TYPE.ICDC_ALERT};return d("MAWWriteMsgTxns").writeMsg(e.db,b,i,{openMessageOtid:g,optimisticMsg:f}).then(function(){a.hasUnknownName&&!d("WAJids").isAuthorMe(a.id.author)&&!d("WAJids").isAuthorSystem(a.id.author)&&(d("MAWIndexedDb").afterTransaction({tag:"SyncContacts",value:[d("WAJids").userIdFromJid(a.id.author)]}),d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedServer",value:{description:"MAWMessageStore_DEPRECATED-create",isCurrentDeviceSendingMsg:!1,lastActivityTs:d("WATimeUtils").castUnixTimeToMillisTime(a.ts),lastMsgExternalId:(h||(h=d("I64"))).of_string_opt(a.id.externalId),threadJid:i.jid}}));return d("WAResultOrError").makeResult()})}else if(a.type===d("MAWMsgType").MSG_TYPE.ADMIN){b={ack:a.ack,altIndex:void 0,author:d("WAJids").AUTHOR_SYSTEM,externalId:a.id.externalId,msgContent:babelHelpers["extends"]({},a.msgContent,{version:d("MAWLocalizationUtils").isAdminMsgNormalized(a.msgContent.adminType)?1:0}),threadJid:i.jid,ts:a.ts,type:a.type};return d("MAWWriteMsgTxns").writeMsg(e.db,b,i).then(function(){return d("WAResultOrError").makeResult()})}throw c("err")("non renderable store not implemented yet")}))};b.get=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([this.db.threads.get({jid:a.chat}),this.db.messages.where("externalId").equals(a.externalId).toArray()]).then(function(b){var c,e=b[0];b=b[1];if(e==null)return d("MAWDexieTable").dexieResolve(null);b=b.find(function(b){return b.threadJid===e.jid&&b.author===a.author});return b==null||b.type!=="Text"?d("MAWDexieTable").dexieResolve(null):d("MAWDexieTable").dexieResolve({ack:b.ack,forwardingScore:(c=b.forwardingScore)!=null?c:0,id:a,msgContent:{content:b.msgContent.content},ts:b.ts,type:b.type})}))};b.update=function(a){var b=this;return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([this.db.threads.get({jid:a.id.chat}),this.db.messages.where("externalId").equals(a.id.externalId).toArray()]).then(function(c){var e=c[0];c=c[1];if(e==null)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing"));var f=c.find(function(b){return b.threadJid===e.jid&&b.author===a.id.author});if(f==null||f.type!=="Text")return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing"));c=f.ack<d("MAWAckLevel").ACK.sent;f.ack=a.ack;f.ts=a.ts;f.serverTs=a.sentTs;var g=void 0;a.ephemeralSetting!=null&&(g={ephemeralExpirationInSec:a.ephemeralSetting.expirationTs,ephemeralLastUpdatedOrSetTimestamp:a.ephemeralSetting.updatedTs});f.ephemeralSetting=g;g=a.sentTs;var i=g==null?g:d("WATimeUtils").castUnixTimeToMillisTime(g);g=i!=null&&c?b.db.threads.put(babelHelpers["extends"]({},e,{newestMsgTs:i,threadOrder:d("MAWDbThread").craftThreadOrder(i,e.jid)})).then(function(){f.altIndex!==d("MAWDbMsg").SPAM_ALT_INDEX&&f.altIndex!==d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedServer",value:{description:"MAWMessageStore_DEPRECATED-update",isCurrentDeviceSendingMsg:!1,lastActivityTs:i,lastMsgExternalId:(h||(h=d("I64"))).of_string_opt(a.id.externalId),threadJid:e.jid}})}):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([b.db.messages.put(f),g]).then(function(){var a=null;d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(f,void 0,a)});return d("WAResultOrError").makeResult()})}))};b.deleteReactionsForMsg=function(a){var b=this;return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.reactions.where("reactToExternalId").equals(a.externalId).filter(function(b){return d("MAWAuthor").getAuthorUserJid(b.reactToAuthor)===d("MAWAuthor").getAuthorUserJid(a.author)&&b.threadJid===a.chat}).toArray().then(function(a){return b.db.reactions.bulkDelete(a.map(function(a){return a.rowId}))}))};b.bulkGetExpiredMsgIds=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWGetExpiredMsgs").getExpiredMsgs(this.db))};b.bulkDelete=function(a){var b=this,c=d("MAWDexieTable").dexieAll(a.map(function(a){var c=a.author,e=a.chat;a=a.externalId;var f=d("MAWAuthor").getAuthorUserJid(c);return b.db.reactions.where("reactToExternalId").equals(a).filter(function(a){return d("MAWAuthor").getAuthorUserJid(a.reactToAuthor)===f&&a.threadJid===e}).toArray()})).then(function(a){return a.flat()}).then(function(a){d("WALogger").LOG(i(),a.length);return b.db.reactions.bulkDelete(a.map(function(a){return a.rowId}))});return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbMsgTxns").getMsgsByProtocolMsgId(this.db,a).then(function(a){var e=a.map(function(a){return a.rowId});return d("MAWDexieTable").dexieAll([b.db.messages.bulkDelete(e),c]).then(function(){return e.length})}))};b.bulkGetInGroup=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.messages.where("threadJid").equals(a).toArray()).then(function(b){return b==null||b.length===0?[]:b.map(function(b){return{author:b.author,chat:a,externalId:b.externalId}})})};return a}();a.tableLocks={chunk:(b=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:b.READWRITE,groupInfo:b.READWRITE,groupInvites:b.READONLY,media:b.READONLY,messages:b.READWRITE,participants:b.READWRITE,reactions:b.READWRITE,receiverFetchInfo:b.READONLY,threads:b.READWRITE,xma:b.READONLY};g.MAWMessageStore_DEPRECATED_DO_NOT_USE=a}),98);
__d("WAResultOrErrorUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=[];a.forEach(function(a){a.success&&b.push(a.value)});return b}function b(a){var b=[];a.forEach(function(a){a.success||b.push(a.error)});return b}f.unpackValues=a;f.unpackErrors=b}),66);
__d("MAWParticipantsStore",["MAWBridgeParticipants","MAWBridgeTypesCreators","MAWDbParticipant","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieCastToPromise","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WAArrayGroupBy","WAArrayZip","WAGlobals","WAResultOrError","WAResultOrErrorUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){var b=this;this.bulkGetInGroup=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.threads.get({jid:a}).then(function(a){return a!=null?d("MAWDbParticipantTxns").getParticipantsInThread(b.db,a.jid).then(function(b){return d("WAResultOrError").makeResult(b.map(function(b){return h(b,a.jid)}))}):d("WAResultOrError").makeError("missing_group")}))};this.bulkPut=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(k(b.db,a.map(function(a){a=a.chatJid;return a})).then(function(b){return d("WAResultOrErrorUtils").unpackValues(a.map(function(a){return!b.has(a.chatJid)?d("WAResultOrError").makeError():d("WAResultOrError").makeResult({participantId:d("MAWDbParticipant").craftParticipantId(a.chatJid,a.user),waParticipant:a})}))}).then(function(a){return b.db.participants.bulkGet(a.map(function(a){a=a.participantId;return a})).then(function(b){return d("WAArrayZip").zip(a,b).map(function(a){var b=a[0].waParticipant;a=a[1];return{chatJid:b.chatJid,dbParticipantToPut:babelHelpers["extends"]({deliveredWatermarkTs:d("WATimeUtils").castToUnixTime(0),lastReadWatermarkTs:d("WATimeUtils").castToUnixTime(0)},a,i(b)),existed:a!=null,participant:b}})})}).then(function(a){var c=a.map(function(a){a=a.dbParticipantToPut;return babelHelpers["extends"]({},a)});c.forEach(function(a){return d("MAWDbParticipantTxns").logIfIllegalParticipant(a,"MAWParticipantsStore::bulkPut")});return b.db.participants.bulkPut(c).then(function(){return l(b.db,a)})}))};this.bulkDelete=function(a,c){c=c||{};var e=c.remover,f=d("WAArrayGroupBy").groupBy(a.map(function(a,b){return{index:b,key:a}}),function(a){a=a.key;return a.groupJid});c=f.map(function(a){a=a[0];return a});return d("MAWDexieCastToPromise").dexieCastToPromise(k(b.db,c).then(function(a){return f.flatMap(function(b){var c=b[0];b=b[1];return b.map(function(b){var e=b.index;b=b.key;return!a.has(c)?d("WAResultOrError").makeError({index:e,message:"missing_group"}):d("WAResultOrError").makeResult({groupJid:c,index:e,participantId:d("MAWDbParticipant").craftParticipantId(c,b.userJid),participantKey:[c,b.userJid],userJid:b.userJid})})})}).then(function(a){var c=d("WAResultOrErrorUtils").unpackValues(a),e=d("WAResultOrErrorUtils").unpackErrors(a).map(function(a){return d("WAResultOrError").makeError(a)});a=c.map(function(a){a=a.participantId;return a});return b.db.participants.bulkGet(a).then(function(a){return d("WAArrayZip").zip(c,a).map(function(a){var b=a[0];a=a[1];return a==null?d("WAResultOrError").makeError({index:b.index,message:"missing_participant"}):d("WAResultOrError").makeResult(b)}).concat(e)})}).then(function(a){var c=d("WAResultOrErrorUtils").unpackValues(a),f=c.map(function(a){a=a.participantKey;return a}),g=c.map(function(a){var b=a.groupJid;a=a.userJid;return{groupJid:b,userJid:a}});return d("MAWDbParticipantTxns").bulkDeleteParticipants(b.db,f).then(function(){return m(b.db,g,e)}).then(function(){return a})}).then(function(a){return a.map(function(a){return a.success?{index:a.value.index,result:d("WAResultOrError").makeResult()}:{index:a.error.index,result:d("WAResultOrError").makeError(a.error.message)}}).sort(function(a,b){a=a.index;b=b.index;return a-b}).map(function(a){a=a.result;return a})}))};this.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.participants.clear())};this.db=a};a.tableLocks={participants:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE};function h(a,b){var c=a.addressable!=null?{addressable:a.addressable}:null;return babelHelpers["extends"]({chatJid:b,type:a.type,user:a.userJid},c)}function i(a){return{addressable:a.addressable,id:d("MAWDbParticipant").craftParticipantId(a.chatJid,a.user),threadJid:a.chatJid,type:a.type,userJid:a.user}}function j(a){return a.map(function(a){return a.user}).filter(function(a){return a===d("WAGlobals").getMyUserJid()||a==="@me"}).length>0}function k(a,b){a=a.threads;return a.where("jid").anyOf(b).toArray().then(function(a){return new Set(a.map(function(a){a=a.jid;return a}))})}function l(a,b){var c=b.filter(function(a){a=a.existed;return!a}).map(function(a){var b=a.chatJid;a=a.participant;return{chatJid:b,participant:a}});c=d("WAArrayGroupBy").groupBy(c,function(a){a=a.chatJid;return a}).map(function(a){var b=a[0];a=a[1];return[b,a.map(function(a){a=a.participant;return a})]});b.forEach(function(a){a=a.dbParticipantToPut;d("MAWIndexedDb").afterTransaction({tag:"ParticipantUpdated",value:d("MAWBridgeParticipants").createBridgeParticipant(a)})});b=c.filter(function(a){a[0];a=a[1];return j(a)}).map(function(a){a=a[0];return a});return d("MAWDbThreadTxns").subscribeToThreads(a,b)}function m(a,b,c){b=Array.from(b);b.forEach(function(a){a=a.groupJid;return d("MAWIndexedDb").afterTransaction({tag:"UpdateE2EEMetadataParticipants",value:d("MAWBridgeTypesCreators").createBridgeUpdateE2EEMetadataParticipants(a)})});var e=new Set(b.filter(function(a){return a.userJid===d("WAGlobals").getMyUserJid()&&(c===d("WAGlobals").getMyUserJid()||c==="@me")}).map(function(a){return a.groupJid}));b=new Set(b.filter(function(a){a=a.userJid;return a!==c&&(a===d("WAGlobals").getMyUserJid()||a==="@me")}).filter(function(a){a=a.groupJid;return!e.has(a)}).map(function(a){a=a.groupJid;return a}));return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").archiveThreads(a,Array.from(e),!0),d("MAWDbThreadTxns").unsubscribeFromThreads(a,Array.from(b))])}g.MAWParticipantsStore=a}),98);
__d("MAWRunInTransaction",["MAWGroupInfoStore","MAWIndexedDb","MAWMessageStore","MAWParticipantsStore","MAWTransactionMode","dexie_maw"],(function(a,b,c,d,e,f,g){"use strict";var h={GroupInfoStore:d("MAWGroupInfoStore").MAWGroupInfoStore.tableLocks,MessagesStore:d("MAWMessageStore").MAWMessageStore_DEPRECATED_DO_NOT_USE.tableLocks,ParticipantsStore:d("MAWParticipantsStore").MAWParticipantsStore.tableLocks};a=function(a,b,e){var f=[];for(var g in a)a[g]===!0&&f.push(g);g=f.flatMap(function(a){return Object.entries(h[a])}).reduce(function(a,b){var c=b[0];b=b[1];if(a[c]===d("MAWTransactionMode").READWRITE)return a;c=c;return babelHelpers["extends"]({},a,(a={},a[""+c]=b,a))},{});g=d("MAWIndexedDb").makeMsgrTransactor(g,(f=e)!=null?f:"runInTransaction",function(e){return function(){var f={CollectionVersionStore:null,GroupInfoStore:a.GroupInfoStore===!0?new(d("MAWGroupInfoStore").MAWGroupInfoStore)(e):null,MessagesStore:a.MessagesStore===!0?new(d("MAWMessageStore").MAWMessageStore_DEPRECATED_DO_NOT_USE)(e):null,MissingKeyStore:null,ParticipantsStore:a.ParticipantsStore===!0?new(d("MAWParticipantsStore").MAWParticipantsStore)(e):null,PendingMutationStore:null,SyncActionStore:null,SyncKeyStore:null};return new(c("dexie_maw").Promise)(function(a){a(b(f))})}});return g()};g.runInTransaction=a}),98);
__d("MAWAddGroupParticipantsApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"addGroupParticipants")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){h=a.GroupInfoStore;var i=a.MessagesStore;a=a.ParticipantsStore;var j=(yield h.get(c));if(!j.success)return d("WAResultOrError").makeError("missing_group");j=j.value;if(b!=null&&b.previous!=null&&j.participantVersion!==b.previous)return d("WAResultOrError").makeError("mismatch");j=f.map(function(a){return{addressable:a.addressable,chatJid:c,type:a.type,user:a.user}});yield a.bulkPut(j);if(b!=null){f=d("MAWAdminMsgHelpers").createParticipantAddAdminMessage(c,j.map(function(a){return a.user}),e);yield i.create(f);yield h.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:b.current})},{updateParticipantMedatadata:g})}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g,h){return a.apply(this,arguments)}}();g.addGroupParticipants=a;g.addGroupParticipantsTransactor=h}),98);
__d("MAWCreateGroupInvitesStep",["MAWAddGroupParticipantsApi","MAWJobDefinitions","MAWJobManager","WAAPI","WAJids","asyncToGeneratorRuntime","isGroupInvitesEnabled"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,d){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){f===void 0&&(f=!0);if(!c("isGroupInvitesEnabled")()||e.length===0)return[];var g=e.map(function(a){return a.user}),h=e.map(function(a){return{addressable:!0,type:"invitedParticipant",user:a.user}});yield c("WAAPI").getDevices({ignoreDhash:!1,reason:"create-group-invite",users:new Set(g)});f||(yield d("MAWAddGroupParticipantsApi").addGroupParticipants(null,a,d("WAJids").AUTHOR_ME,h,!0));e.forEach(function(c){var e=c.user,f=c.inviteCode;c=c.expiration;d("MAWJobManager").getJobManager().fireAndForget(d("MAWJobDefinitions").jobSerializers.sendGroupInviteMsg({expiration:c,groupJid:a,inviteCode:f,invitedParticipantUserJid:e,inviterUserJid:b}))});return h});return h.apply(this,arguments)}g.createGroupInvitesStep=a}),98);
__d("WASmaxInGroupsAddParticipantCountRateLimitMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"rate_limit");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"participant_limit",1,19999);return!b.success?b:d("WAResultOrError").makeResult({participantLimit:b.value})}g.parseAddParticipantCountRateLimitMixin=a}),98);
__d("WASmaxInGroupsEnums",["WAJids"],(function(a,b,c,d,e,f,g){a={304:"304",419:"419"};b={403:"403",404:"404",406:"406",419:"419"};c={404:"404",406:"406"};e={404:"404",419:"419"};f={406:"406",500:"500"};var h={accept:"accept",auto_add:"auto_add",default_sub_group_admin_add:"default_sub_group_admin_add",general_chat_auto_add:"general_chat_auto_add",invite:"invite",invite_auto_add:"invite_auto_add",linked_group_join:"linked_group_join",sub_group_suggestion_approved:"sub_group_suggestion_approved"},i={accept:"accept",default_sub_group_promote:"default_sub_group_promote",invite:"invite",invite_auto_add:"invite_auto_add",linked_group_join:"linked_group_join"},j={admin:"admin",creator:"creator"},k={admin:"admin",superadmin:"superadmin"},l={approved:"approved",cancelled:"cancelled",rejected:"rejected"},m={deactivate_general_chat:"deactivate_general_chat",delete_capi:"delete_capi",delete_parent:"delete_parent",integrity_delete_parent:"integrity_delete_parent"},n={deactivate_group:"deactivate_group",delete_parent:"delete_parent",integrity_delete_parent:"integrity_delete_parent",unlink_group:"unlink_group"},o={e2ee_migration:"e2ee_migration",regular:"regular",rtc:"rtc"},p={"false":"false","true":"true"},q={group:"group",user:"user"},r={image:"image",preview:"preview"},s={invite_link:"invite_link",linked_group_join:"linked_group_join",non_admin_add:"non_admin_add"},t={lid:"lid",pn:"pn"},u={parent_group:"parent_group",sibling_group:"sibling_group",sub_group:"sub_group"};d={validators:[d("WAJids").validateDomainJid,d("WAJids").validateGroupJid],typeName:"DomainJid|GroupJid"};g.ENUM_304_419=a;g.ENUM_403_404_406_419=b;g.ENUM_404_406=c;g.ENUM_404_419=e;g.ENUM_406_500=f;g.ENUM_ACCEPT_AUTOADD_DEFAULTSUBGROUPADMINADD_GENERALCHATAUTOADD_INVITE_INVITEAUTOADD_LINKEDGROUPJOIN_SUBGROUPSUGGESTIONAPPROVED=h;g.ENUM_ACCEPT_DEFAULTSUBGROUPPROMOTE_INVITE_INVITEAUTOADD_LINKEDGROUPJOIN=i;g.ENUM_ADMIN_CREATOR=j;g.ENUM_ADMIN_SUPERADMIN=k;g.ENUM_APPROVED_CANCELLED_REJECTED=l;g.ENUM_DEACTIVATEGENERALCHAT_DELETECAPI_DELETEPARENT_INTEGRITYDELETEPARENT=m;g.ENUM_DEACTIVATEGROUP_DELETEPARENT_INTEGRITYDELETEPARENT_UNLINKGROUP=n;g.ENUM_E2EEMIGRATION_REGULAR_RTC=o;g.ENUM_FALSE_TRUE=p;g.ENUM_GROUP_USER=q;g.ENUM_IMAGE_PREVIEW=r;g.ENUM_INVITELINK_LINKEDGROUPJOIN_NONADMINADD=s;g.ENUM_LID_PN=t;g.ENUM_PARENTGROUP_SIBLINGGROUP_SUBGROUP=u;g.DOMAINJID_GROUPJID=d}),98);
__d("WASmaxInGroupsAddParticipantTimeRateLimitMixin",["WAResultOrError","WASmaxInGroupsEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"rate_limit");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"backoff",0,void 0);if(!b.success)return b;a=d("WASmaxParseUtils").attrStringEnum(a,"type",d("WASmaxInGroupsEnums").ENUM_GROUP_USER);return!a.success?a:d("WAResultOrError").makeResult({backoff:b.value,type:a.value})}g.parseAddParticipantTimeRateLimitMixin=a}),98);
__d("WASmaxInGroupsAddParticipantTimeOrCountRateLimitMixinGroup",["WAResultOrError","WASmaxInGroupsAddParticipantCountRateLimitMixin","WASmaxInGroupsAddParticipantTimeRateLimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsAddParticipantTimeRateLimitMixin").parseAddParticipantTimeRateLimitMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"AddParticipantTimeRateLimit",value:b.value});var c=d("WASmaxInGroupsAddParticipantCountRateLimitMixin").parseAddParticipantCountRateLimitMixin(a);return c.success?d("WAResultOrError").makeResult({name:"AddParticipantCountRateLimit",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["AddParticipantTimeRateLimit","AddParticipantCountRateLimit"],[b,c])}g.parseAddParticipantTimeOrCountRateLimitMixinGroup=a}),98);
__d("WASmaxInGroupsCreateOrAddGroupRateLimitErrorMixin",["WAResultOrError","WASmaxInGroupsAddParticipantTimeOrCountRateLimitMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"rate_limit");if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","rate-overlimit");if(!c.success)return c;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",429);if(!a.success)return a;b=d("WASmaxInGroupsAddParticipantTimeOrCountRateLimitMixinGroup").parseAddParticipantTimeOrCountRateLimitMixinGroup(b.value);return!b.success?b:d("WAResultOrError").makeResult({text:c.value,code:a.value,rateLimitAddParticipantTimeOrCountRateLimitMixinGroup:b.value})}g.parseCreateOrAddGroupRateLimitErrorMixin=a}),98);
__d("WASmaxInGroupsIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInGroupsIQErrorFallbackClientMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",400,499);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackClientMixin=a}),98);
__d("WASmaxInGroupsIQErrorForbiddenMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","forbidden");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",403);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorForbiddenMixin=a}),98);
__d("WASmaxInGroupsIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","item-not-found");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",404);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorItemNotFoundMixin=a}),98);
__d("WASmaxInGroupsIQErrorLockedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","locked");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",423);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorLockedMixin=a}),98);
__d("WASmaxInGroupsIQErrorNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-allowed");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",405);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNotAllowedMixin=a}),98);
__d("WASmaxInGroupsIQErrorNotAuthorizedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-authorized");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",401);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNotAuthorizedMixin=a}),98);
__d("WASmaxInGroupsIQErrorRateOverlimitMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","rate-overlimit");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",429);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorRateOverlimitMixin=a}),98);
__d("WASmaxInGroupsAddParticipantsClientErrors",["WAResultOrError","WASmaxInGroupsCreateOrAddGroupRateLimitErrorMixin","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxInGroupsIQErrorForbiddenMixin","WASmaxInGroupsIQErrorItemNotFoundMixin","WASmaxInGroupsIQErrorLockedMixin","WASmaxInGroupsIQErrorNotAllowedMixin","WASmaxInGroupsIQErrorNotAuthorizedMixin","WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInGroupsIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:c.value});var e=d("WASmaxInGroupsIQErrorNotAuthorizedMixin").parseIQErrorNotAuthorizedMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAuthorized",value:e.value});var f=d("WASmaxInGroupsIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:f.value});var g=d("WASmaxInGroupsCreateOrAddGroupRateLimitErrorMixin").parseCreateOrAddGroupRateLimitErrorMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"CreateOrAddGroupRateLimitError",value:g.value});var h=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:h.value});var i=d("WASmaxInGroupsIQErrorNotAllowedMixin").parseIQErrorNotAllowedMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAllowed",value:i.value});var j=d("WASmaxInGroupsIQErrorLockedMixin").parseIQErrorLockedMixin(a);if(j.success)return d("WAResultOrError").makeResult({name:"IQErrorLocked",value:j.value});var k=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return k.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:k.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorItemNotFound","IQErrorNotAuthorized","IQErrorForbidden","CreateOrAddGroupRateLimitError","IQErrorRateOverlimit","IQErrorNotAllowed","IQErrorLocked","IQErrorFallbackClient"],[b,c,e,f,g,h,i,j,k])}g.parseAddParticipantsClientErrors=a}),98);
__d("WASmaxInGroupsIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInGroupsAddParticipantsResponseClientError",["WAResultOrError","WASmaxInGroupsAddParticipantsClientErrors","WASmaxInGroupsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsAddParticipantsClientErrors").parseAddParticipantsClientErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorAddParticipantsClientErrors:b.value}))}g.parseAddParticipantsResponseClientError=a}),98);
__d("WASmaxInGroupsIQErrorFallbackServerMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",500,599);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackServerMixin=a}),98);
__d("WASmaxInGroupsIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInGroupsIQErrorPartialServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","partial-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",530);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorPartialServerErrorMixin=a}),98);
__d("WASmaxInGroupsIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",503);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInGroupsServerErrors",["WAResultOrError","WASmaxInGroupsIQErrorFallbackServerMixin","WASmaxInGroupsIQErrorInternalServerErrorMixin","WASmaxInGroupsIQErrorPartialServerErrorMixin","WASmaxInGroupsIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:b.value});var c=d("WASmaxInGroupsIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:c.value});var e=d("WASmaxInGroupsIQErrorPartialServerErrorMixin").parseIQErrorPartialServerErrorMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorPartialServerError",value:e.value});var f=d("WASmaxInGroupsIQErrorFallbackServerMixin").parseIQErrorFallbackServerMixin(a);return f.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackServer",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorInternalServerError","IQErrorServiceUnavailable","IQErrorPartialServerError","IQErrorFallbackServer"],[b,c,e,f])}g.parseServerErrors=a}),98);
__d("WASmaxInGroupsBaseServerErrorMixin",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseBaseServerErrorMixin=a}),98);
__d("WASmaxInGroupsAddParticipantsResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseAddParticipantsResponseServerError=a}),98);
__d("WASmaxInGroupsParticipantConflictMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","409");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantConflictMixin=a}),98);
__d("WASmaxInGroupsParticipantGroupJoinRequestMixin",["WAResultOrError","WASmaxInGroupsEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"membership_approval_request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","421");if(!a.success)return a;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,b.value,"error",d("WASmaxInGroupsEnums").ENUM_304_419);return!b.success?b:d("WAResultOrError").makeResult({error:a.value,membershipApprovalRequestError:b.value})}g.parseParticipantGroupJoinRequestMixin=a}),98);
__d("WASmaxInGroupsParticipantHasInvalidPNMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","404");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantHasInvalidPNMixin=a}),98);
__d("WASmaxInGroupsParticipantInBanListMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","402");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantInBanListMixin=a}),98);
__d("WASmaxInGroupsParticipantNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","406");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantNotAcceptableMixin=a}),98);
__d("WASmaxInGroupsParticipantNotAddressableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"addressable","false");return!b.success?b:d("WAResultOrError").makeResult({addressable:b.value})}g.parseParticipantNotAddressableMixin=a}),98);
__d("WASmaxInGroupsParticipantNotAuthorizedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","401");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantNotAuthorizedMixin=a}),98);
__d("WASmaxInGroupsParticipantRequestCodeCanBeSentMixin",["WAResultOrError","WASmaxInGroupsParticipantNotAddressableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"add_request");if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","403");if(!c.success)return c;var e=d("WASmaxParseUtils").attrString(b.value,"code");if(!e.success)return e;b=d("WASmaxParseUtils").attrIntRange(b.value,"expiration",0,void 0);if(!b.success)return b;a=d("WASmaxInGroupsParticipantNotAddressableMixin").parseParticipantNotAddressableMixin(a);return d("WAResultOrError").makeResult({error:c.value,addRequestCode:e.value,addRequestExpiration:b.value,participantNotAddressableMixin:a.success?a.value:null})}g.parseParticipantRequestCodeCanBeSentMixin=a}),98);
__d("WASmaxInGroupsParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","451");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin=a}),98);
__d("WASmaxInGroupsParticipantResourceConstraintMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","500");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantResourceConstraintMixin=a}),98);
__d("WASmaxInGroupsParticipantResourceLimitMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","419");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantResourceLimitMixin=a}),98);
__d("WASmaxInGroupsParticipantTemporarilyBlockedFromDefaultSubGroupMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","417");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantTemporarilyBlockedFromDefaultSubGroupMixin=a}),98);
__d("WASmaxInGroupsParticipantTemporarilyBlockedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","408");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantTemporarilyBlockedMixin=a}),98);
__d("WASmaxInGroupsAddParticipantsParticipantMixins",["WAResultOrError","WASmaxInGroupsParticipantConflictMixin","WASmaxInGroupsParticipantGroupJoinRequestMixin","WASmaxInGroupsParticipantHasInvalidPNMixin","WASmaxInGroupsParticipantInBanListMixin","WASmaxInGroupsParticipantNotAcceptableMixin","WASmaxInGroupsParticipantNotAddressableMixin","WASmaxInGroupsParticipantNotAuthorizedMixin","WASmaxInGroupsParticipantRequestCodeCanBeSentMixin","WASmaxInGroupsParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin","WASmaxInGroupsParticipantResourceConstraintMixin","WASmaxInGroupsParticipantResourceLimitMixin","WASmaxInGroupsParticipantTemporarilyBlockedFromDefaultSubGroupMixin","WASmaxInGroupsParticipantTemporarilyBlockedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsParticipantGroupJoinRequestMixin").parseParticipantGroupJoinRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ParticipantGroupJoinRequest",value:b.value});var c=d("WASmaxInGroupsParticipantNotAuthorizedMixin").parseParticipantNotAuthorizedMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"ParticipantNotAuthorized",value:c.value});var e=d("WASmaxInGroupsParticipantInBanListMixin").parseParticipantInBanListMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"ParticipantInBanList",value:e.value});var f=d("WASmaxInGroupsParticipantRequestCodeCanBeSentMixin").parseParticipantRequestCodeCanBeSentMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"ParticipantRequestCodeCanBeSent",value:f.value});var g=d("WASmaxInGroupsParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin").parseParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"ParticipantRequestCodeCannotBeCreatedForLegalConcerns",value:g.value});var h=d("WASmaxInGroupsParticipantHasInvalidPNMixin").parseParticipantHasInvalidPNMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"ParticipantHasInvalidPN",value:h.value});var i=d("WASmaxInGroupsParticipantTemporarilyBlockedMixin").parseParticipantTemporarilyBlockedMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"ParticipantTemporarilyBlocked",value:i.value});var j=d("WASmaxInGroupsParticipantConflictMixin").parseParticipantConflictMixin(a);if(j.success)return d("WAResultOrError").makeResult({name:"ParticipantConflict",value:j.value});var k=d("WASmaxInGroupsParticipantResourceLimitMixin").parseParticipantResourceLimitMixin(a);if(k.success)return d("WAResultOrError").makeResult({name:"ParticipantResourceLimit",value:k.value});var l=d("WASmaxInGroupsParticipantResourceConstraintMixin").parseParticipantResourceConstraintMixin(a);if(l.success)return d("WAResultOrError").makeResult({name:"ParticipantResourceConstraint",value:l.value});var m=d("WASmaxInGroupsParticipantNotAcceptableMixin").parseParticipantNotAcceptableMixin(a);if(m.success)return d("WAResultOrError").makeResult({name:"ParticipantNotAcceptable",value:m.value});var n=d("WASmaxInGroupsParticipantNotAddressableMixin").parseParticipantNotAddressableMixin(a);if(n.success)return d("WAResultOrError").makeResult({name:"ParticipantNotAddressable",value:n.value});var o=d("WASmaxInGroupsParticipantTemporarilyBlockedFromDefaultSubGroupMixin").parseParticipantTemporarilyBlockedFromDefaultSubGroupMixin(a);return o.success?d("WAResultOrError").makeResult({name:"ParticipantTemporarilyBlockedFromDefaultSubGroup",value:o.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ParticipantGroupJoinRequest","ParticipantNotAuthorized","ParticipantInBanList","ParticipantRequestCodeCanBeSent","ParticipantRequestCodeCannotBeCreatedForLegalConcerns","ParticipantHasInvalidPN","ParticipantTemporarilyBlocked","ParticipantConflict","ParticipantResourceLimit","ParticipantResourceConstraint","ParticipantNotAcceptable","ParticipantNotAddressable","ParticipantTemporarilyBlockedFromDefaultSubGroup"],[b,c,e,f,g,h,i,j,k,l,m,n,o])}g.parseAddParticipantsParticipantMixins=a}),98);
__d("WASmaxInGroupsPhoneNumberMixin",["WAResultOrError","WASmaxParseJid"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseJid").attrUserJid(a,"phone_number");return!a.success?a:d("WAResultOrError").makeResult({phoneNumber:a.value})}g.parsePhoneNumberMixin=a}),98);
__d("WASmaxInGroupsAddParticipantsParticipantAddedResponseMixin",["WAResultOrError","WASmaxInGroupsAddParticipantsParticipantMixins","WASmaxInGroupsPhoneNumberMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;var c=d("WASmaxInGroupsPhoneNumberMixin").parsePhoneNumberMixin(a);a=d("WASmaxInGroupsAddParticipantsParticipantMixins").parseAddParticipantsParticipantMixins(a);return d("WAResultOrError").makeResult({jid:b.value,phoneNumberMixin:c.success?c.value:null,addParticipantsParticipantMixins:a.success?a.value:null})}g.parseAddParticipantsParticipantAddedResponseMixin=a}),98);
__d("WASmaxInGroupsParticipantRequestCodeCanBeSentOrRequestCodeCannotBeCreatedForLegalConcernsOrHasInvalidPNMixinGroup",["WAResultOrError","WASmaxInGroupsParticipantHasInvalidPNMixin","WASmaxInGroupsParticipantRequestCodeCanBeSentMixin","WASmaxInGroupsParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsParticipantRequestCodeCanBeSentMixin").parseParticipantRequestCodeCanBeSentMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ParticipantRequestCodeCanBeSent",value:b.value});var c=d("WASmaxInGroupsParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin").parseParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"ParticipantRequestCodeCannotBeCreatedForLegalConcerns",value:c.value});var e=d("WASmaxInGroupsParticipantHasInvalidPNMixin").parseParticipantHasInvalidPNMixin(a);return e.success?d("WAResultOrError").makeResult({name:"ParticipantHasInvalidPN",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ParticipantRequestCodeCanBeSent","ParticipantRequestCodeCannotBeCreatedForLegalConcerns","ParticipantHasInvalidPN"],[b,c,e])}g.parseParticipantRequestCodeCanBeSentOrRequestCodeCannotBeCreatedForLegalConcernsOrHasInvalidPNMixinGroup=a}),98);
__d("WASmaxInGroupsNonRegisteredWaUserParticipantErrorLidResponseMixin",["WAResultOrError","WASmaxInGroupsParticipantRequestCodeCanBeSentOrRequestCodeCannotBeCreatedForLegalConcernsOrHasInvalidPNMixinGroup","WASmaxInGroupsPhoneNumberMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxInGroupsPhoneNumberMixin").parsePhoneNumberMixin(a);if(!b.success)return b;a=d("WASmaxInGroupsParticipantRequestCodeCanBeSentOrRequestCodeCannotBeCreatedForLegalConcernsOrHasInvalidPNMixinGroup").parseParticipantRequestCodeCanBeSentOrRequestCodeCannotBeCreatedForLegalConcernsOrHasInvalidPNMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{participantRequestCodeCanBeSentOrRequestCodeCannotBeCreatedForLegalConcernsOrHasInvalidPNMixinGroup:a.value}))}g.parseNonRegisteredWaUserParticipantErrorLidResponseMixin=a}),98);
__d("WASmaxInGroupsAddParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup",["WAResultOrError","WASmaxInGroupsAddParticipantsParticipantAddedResponseMixin","WASmaxInGroupsNonRegisteredWaUserParticipantErrorLidResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsAddParticipantsParticipantAddedResponseMixin").parseAddParticipantsParticipantAddedResponseMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"AddParticipantsParticipantAddedResponse",value:b.value});var c=d("WASmaxInGroupsNonRegisteredWaUserParticipantErrorLidResponseMixin").parseNonRegisteredWaUserParticipantErrorLidResponseMixin(a);return c.success?d("WAResultOrError").makeResult({name:"NonRegisteredWaUserParticipantErrorLidResponse",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ParticipantAddedResponse","NonRegisteredWaUserParticipantErrorLidResponse"],[b,c])}g.parseAddParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup=a}),98);
__d("WASmaxInGroupsGroupAddressingModeMixin",["WAResultOrError","WASmaxInGroupsEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrStringEnum(a,"addressing_mode",d("WASmaxInGroupsEnums").ENUM_LID_PN);return!a.success?a:d("WAResultOrError").makeResult({addressingMode:a.value})}g.parseGroupAddressingModeMixin=a}),98);
__d("WASmaxInGroupsAddParticipantsResponseSuccess",["WAResultOrError","WASmaxInGroupsAddParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup","WASmaxInGroupsGroupAddressingModeMixin","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxInGroupsAddParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup").parseAddParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({addParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup:b.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"add");if(!c.success)return c;var e=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",e.value);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!e.success)return e;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!b.success)return b;b=d("WASmaxInGroupsGroupAddressingModeMixin").parseGroupAddressingModeMixin(a);a=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"participant",1,19999,h);return!a.success?a:d("WAResultOrError").makeResult({type:e.value,groupAddressingModeMixin:b.success?b.value:null,addParticipant:a.value})}g.parseAddParticipantsResponseSuccessAddParticipant=h;g.parseAddParticipantsResponseSuccess=a}),98);
__d("WASmaxOutGroupsBaseIQSetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"set"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQSetRequestMixin=a}),98);
__d("WASmaxOutGroupsBaseSetGroupMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutGroupsBaseIQSetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.iqTo;a=d("WASmaxOutGroupsBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").GROUP_JID(a),xmlns:"w:g2"}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseSetGroupMixin=a}),98);
__d("WASmaxOutGroupsAddParticipantsRequest",["WASmaxChildren","WASmaxJsx","WASmaxOutGroupsBaseSetGroupMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.participantJid;a=d("WASmaxJsx").smax("participant",{jid:d("WAWap").USER_JID(a)});return a}function a(a){var b=a.participantArgs;b=d("WASmaxOutGroupsBaseSetGroupMixin").mergeBaseSetGroupMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("add",null,d("WASmaxChildren").REPEATED_CHILD(h,b,1,1024))),a);return b}g.makeAddParticipantsRequestAddParticipant=h;g.makeAddParticipantsRequest=a}),98);
__d("WASmaxGroupsAddParticipantsRPC",["WAComms","WASmaxInGroupsAddParticipantsResponseClientError","WASmaxInGroupsAddParticipantsResponseServerError","WASmaxInGroupsAddParticipantsResponseSuccess","WASmaxOutGroupsAddParticipantsRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsAddParticipantsRequest").makeAddParticipantsRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsAddParticipantsResponseSuccess").parseAddParticipantsResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"AddParticipantsResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsAddParticipantsResponseClientError").parseAddParticipantsResponseClientError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"AddParticipantsResponseClientError",value:h.value});case 10:i=d("WASmaxInGroupsAddParticipantsResponseServerError").parseAddParticipantsResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"AddParticipantsResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("AddParticipants",{Success:g,ClientError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendAddParticipantsRPC=a}),98);
__d("MAWAddGroupParticipants",["MAWAddGroupParticipantsApi","MAWCreateGroupInvitesStep","MAWJobManager","MAWODSProxy","WAGlobals","WAGroupInviteUtils","WAJids","WALogger","WAOdsEnums","WAResultOrError","WASmaxGroupsAddParticipantsRPC","WATimeUtils","asyncToGeneratorRuntime","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add participant: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add participant: ",""]);i=function(){return a};return a}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("addGroupParticipants",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.group;a=a.users;a=a.map(function(a){return d("WAJids").toMsgrUserJid(a)});if(a.length===0)return d("WAResultOrError").makeResult({groupJid:b,participants:[]});a=(yield d("WASmaxGroupsAddParticipantsRPC").sendAddParticipantsRPC({iqTo:b,participantArgs:a.map(function(a){return{participantJid:a}})}));d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_ADD_PARTICIPANT,key:a.name==="AddParticipantsResponseSuccess"?"success":"fail"});if(a.name==="AddParticipantsResponseClientError"){var e=a.value.errorAddParticipantsClientErrors.name;d("WALogger").ERROR(i(),e);return d("WAResultOrError").makeError(e)}if(a.name==="AddParticipantsResponseServerError"){e=a.value.errorServerErrors.name;d("WALogger").ERROR(h(),e);return d("WAResultOrError").makeError(e)}a.name;e=a.value.addParticipant.filter(function(a){a=a.addParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup;a=a.value.addParticipantsParticipantMixins;return(a==null?void 0:a.value.error)==null}).map(function(a){a=a.addParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup;a=a.value;var b=a.addParticipantsParticipantMixins;a=a.jid;a=c("nullthrows")(a);return{addressable:(b==null?void 0:b.name)!=="ParticipantNotAddressable",type:"participant",user:a}});yield d("MAWAddGroupParticipantsApi").addGroupParticipants(null,b,d("WAJids").AUTHOR_ME,e,!0);a=(yield d("MAWCreateGroupInvitesStep").createGroupInvitesStep(b,d("WAGlobals").getMyUserJid(),a.value.addParticipant.map(function(a){a=a.addParticipantsParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup;a=a.value;var b=a.addParticipantsParticipantMixins;a=a.jid;a=c("nullthrows")(a);return(b==null?void 0:b.name)==="ParticipantRequestCodeCanBeSent"?{expiration:d("WATimeUtils").castToUnixTime(b.value.addRequestExpiration),inviteCode:d("WAGroupInviteUtils").toInviteCode(b.value.addRequestCode),user:a}:void 0}).filter(Boolean),!1));e=[].concat(e,a);return d("WAResultOrError").makeResult({groupJid:b,participants:e})});return function(b){return a.apply(this,arguments)}}()).end();g.addGroupParticipants=a}),98);
__d("MAWAsArmadilloApplication",["MAWMsgType","MAWXMAEncodeUtils","WAArmadilloApplication.pb","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(a.type){case d("MAWMsgType").MSG_TYPE.XMA:if((b==null?void 0:b.xma)==null)throw c("err")("XMA content should have XMA payload");return d("MAWXMAEncodeUtils").encodeXMA(a,b);case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:return h(a);default:throw c("err")(a.type+" should not be handled as ArmadilloApplication")}}function h(a){var b=a.ravenActionToMsgExternalId;if(b==null)throw c("err")("msg ravenActionToMsgExternalId is null in encodeRavenActionMessage");var e=Number(a.actionType),f;if(e===0)f=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_RAVEN_ACTION_NOTIF_MESSAGE_ACTION_TYPE.PLAYED;else if(e===1)f=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_RAVEN_ACTION_NOTIF_MESSAGE_ACTION_TYPE.SCREENSHOT;else if(e===2)f=d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_RAVEN_ACTION_NOTIF_MESSAGE_ACTION_TYPE.FORCE_DISABLE;else throw c("err")("msg actionType is not in enum in encodeRavenActionMessage");e=a.actionTimestamp;e==null&&(e=d("WATimeUtils").castMilliSecondsToUnixTime(Date.now()));a={actionTimestamp:e,actionType:f,key:{id:b}};return{payload:{content:{ravenActionNotifMessage:a}}}}g.asArmadilloApplication=a}),98);
__d("MAWAsMessageApplication",["I64","LSIntEnum","LSMessageReplySourceTypeV2","MAWAsArmadilloApplication","MAWAsConsumerApplication","MAWJids","MAWMsgType","WAArmadilloApplication.pb","WAConsumerApplication.pb","WAFranking","WAGlobals","WAJids","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c,e){var f,g;switch(a.type){case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:f=d("MAWAsArmadilloApplication").asArmadilloApplication(a);break;case d("MAWMsgType").MSG_TYPE.XMA:f=d("MAWAsArmadilloApplication").asArmadilloApplication(a,e);break;default:g=d("MAWAsConsumerApplication").asConsumerApplication(a,b,c)}var h,i;e=a.forwardingScore!=null?a.forwardingScore:0;b=a.isForwarded!=null?a.isForwarded:!1;if(a.quote!=null){c=a.quote;h={participant:c.content.author===d("WAJids").AUTHOR_ME?d("WAGlobals").getMyDeviceJid():c.content.author,stanzaId:c.content.externalId}}if(a.ephemeralSetting){c=a.ephemeralSetting;a.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE?i={ephemeralExpiration:c.ephemeralExpirationInSec,isEphemeralSettingReset:a.isEphemeralSettingReset}:i={ephemeralExpiration:c.ephemeralExpirationInSec,ephemeralSettingTimestamp:c.ephemeralLastUpdatedOrSetTimestamp*1e3}}c={metadata:{chatEphemeralSetting:i,forwardingScore:e,frankingKey:k(a.reportingMeta),frankingVersion:d("WAFranking").getFrankingVersion(),groupId:a.groupId,groupIndex:a.groupIndex,groupSize:a.groupSize,isForwarded:b,quotedMessage:h}};if(g!=null){e=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,g);c.payload={subProtocol:{consumerMessage:{payload:e.readBuffer(),version:1}}}}else if(f!=null){a=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloApplication.pb").ArmadilloSpec,f);c.payload={subProtocol:{armadillo:{payload:a.readBuffer(),version:1}}}}return c}function b(a){var b=d("MAWAsConsumerApplication").asConsumerApplicationLSDb(a),e,f,g=a.isForwarded!=null?a.isForwarded:!1,j=g?1:0;a.replySourceTypeV2&&!(h||(h=d("I64"))).equal(a.replySourceTypeV2,(i||(i=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceTypeV2").NONE))&&a.replyToUserId!=null&&(e={participant:a.replyToUserId===d("WAJids").AUTHOR_ME?d("WAGlobals").getMyDeviceJid():d("MAWJids").toUserJid((h||(h=d("I64"))).to_string(a.replyToUserId)),stanzaId:a.messageId});j={metadata:{chatEphemeralSetting:f,forwardingScore:j,frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion(),groupId:(j=a==null?void 0:a.groupId)!=null?j:void 0,groupIndex:a.groupIndex!=null?(h||(h=d("I64"))).to_float(a.groupIndex):void 0,groupSize:a.groupSize!=null?(h||(h=d("I64"))).to_float(a.groupSize):void 0,isForwarded:g,quotedMessage:e}};if(b!=null){a=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);j.payload={subProtocol:{consumerMessage:{payload:a.readBuffer(),version:1}}}}return j}function e(a){a=d("MAWAsConsumerApplication").encodeReactionMessage(a);a=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,a);return{metadata:{frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion()},payload:{subProtocol:{consumerMessage:{payload:a.readBuffer(),version:1}}}}}function f(a){a=d("MAWAsConsumerApplication").encodeEditMessage(a);a=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,a);return{metadata:{frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion()},payload:{subProtocol:{consumerMessage:{payload:a.readBuffer(),version:1}}}}}function j(a,b){var c;b=d("MAWAsConsumerApplication").deletedMsgAsConsumerApplicationForSpamReporting(a,b);if(b==null)return null;b=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);return{metadata:{frankingKey:k(a.reportingMeta),frankingVersion:((c=a.reportingMeta)==null?void 0:c.frankingVersion)!=null?(c=a.reportingMeta)==null?void 0:c.frankingVersion:d("WAFranking").getFrankingVersion()},payload:{subProtocol:{consumerMessage:{payload:b.readBuffer(),version:1}}}}}function k(a){if((a==null?void 0:a.frankingKey)!=null)return a.frankingKey;else return d("WAFranking").createFrankingKey()}g.asMessageApplication=a;g.asMessageApplicationLSDb=b;g.asReactionMessageApplication=e;g.asEditMessageApplication=f;g.deletedMsgAsMessageApplicationForSpamReporting=j}),98);
__d("MAWXMAEncodeUtils",["MAWAsConsumerApplication","MAWAsMessageApplication","MAWMsgType","MAWParseSubprotocolVersionConsts","MAWVault","WALogger","WAMsgApplication.pb","encodeProtobuf","validateMAWMediaAndComposeEntryForProtoMsg"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Non-text associated message for the XMA content is not supported"]);h=function(){return a};return a}function i(a,b,e){a=c("validateMAWMediaAndComposeEntryForProtoMsg")(a,b);b=a[0];a=a[1];return{payload:d("MAWAsConsumerApplication").encodeValidatedMediaToImageTransport(b,a),version:e}}function a(a,b){var c,e,f=b.associatedMessage,g=b.favicon,j=b.header,k=b.previews;b=b.xma;var l=null;if(f!=null)if(f.type!==d("MAWMsgType").MSG_TYPE.TEXT)d("WALogger").ERROR(h());else{f=d("MAWAsMessageApplication").asMessageApplication(f);f=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,f);l={payload:f.readBuffer(),version:d("MAWParseSubprotocolVersionConsts").ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION}}f=j!=null?i(a.msgId,j,d("MAWParseSubprotocolVersionConsts").XMA_HEADER_SUBPROTOCOL_VERSION):null;j=g!=null?i(a.msgId,g,d("MAWParseSubprotocolVersionConsts").XMA_FAVICON_SUBPROTOCOL_VERSION):null;g=k!=null?k.map(function(b){return i(a.msgId,b,d("MAWParseSubprotocolVersionConsts").XMA_PREVIEW_SUBPROTOCOL_VERSION)}):null;k=b.defaultCTA==null?void 0:[b.defaultCTA].concat(b.ctas).filter(Boolean);c=(c=a.msgContent)==null?void 0:c.content;return{payload:{content:{extendedContentMessage:{associatedMessage:(e=l)!=null?e:void 0,ctas:k,favicon:(e=j)!=null?e:void 0,headerImage:(k=f)!=null?k:void 0,headerTitle:b.headerTitle,maxSubtitleNumOfLines:b.maxSubtitleNumOfLines,maxTitleNumOfLines:b.maxTitleNumOfLines,messageText:c==null?void 0:d("MAWVault").unvault(c),overlayDescription:b.overlayDescription,overlayIconGlyph:b.overlayIconGlyph,overlayTitle:b.overlayTitle,previews:(j=g)!=null?j:[],sentWithMessageId:l?a.externalId:void 0,subtitleText:b.subtitleText,targetExpiringAtSec:b.targetExpiringAtSec,targetId:b.targetId,targetType:b.targetType,targetUsername:b.targetUsername,titleText:b.titleText,xmaLayoutType:b.xmaLayoutType}}}}}g.encodeXMA=a}),98);
__d("MAWBuildNewMsgPayload",["MAWAuthor","MAWDbMsg","MAWMsgType","WAArmadilloXMA.pb","WAAssertUnreachable","WAJids","WALogger","WAStanzaUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["msgToQuotedMsg: Unsupported message type ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["BumpExistingMessage does not have quote content when replying"]);i=function(){return a};return a}function a(a,b,e,f){if(d("MAWDbMsg").isUnrenderedMsgType(a))throw c("err")("getNewMsg called for wrong message type "+a);var g,h;if(e.quote!=null&&(f==null?void 0:f.content)!=null){var i;h=f==null?void 0:(i=f.content)==null?void 0:i.externalId;g={content:f==null?void 0:f.content,remoteJid:(i=f==null?void 0:f.remoteJid)!=null?i:void 0}}f=babelHelpers["extends"]({},b,{quote:g,quoteExternalId:h});i=e.mediaGroupMetadata;switch(a){case"Text":return babelHelpers["extends"]({},f,{msgContent:{content:e.content!=null?e.content:"",mentionedJids:e.mentionedJids},type:d("MAWMsgType").MSG_TYPE.TEXT});case"Image":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.IMAGE},i);case"Video":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.VIDEO});case"Ptt":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.PTT});case"Gif":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.GIF});case"Sticker":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.STICKER});case"DocumentFile":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case"XMA":if(e.xmaMessageType==null)throw c("err")("XMA Message Missing xmaMessageType");b=e.content!=null&&e.xmaMessageType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE?e.content:"";return babelHelpers["extends"]({},f,{msgContent:{content:b},type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:e.xmaMessageType});case"EditAction":throw c("err")("EditAction is not supported yet");case"BumpExistingMessage":throw c("err")("BumpExistingMessage is not supported yet");case"ReceiverFetch":throw c("err")("ReceiverFetch is not supported yet");case"Revoked":case"DeleteForMe":case"Ciphertext":case"Futureproof":case"Unavailable":case"Admin":case"ExpiredEphemeral":case"EphemeralSettingAdmin":case"EphemeralScreenshotAction":case"AlertICDC":case"GroupInvite":case"Reaction":case"Raven":case"RavenAction":throw c("err")("Should not be writing ciphertext, futureproof, unsent, admin,\n        ephemeral setting messages, ephemeral screenshot action, group invite messages");default:throw c("WAAssertUnreachable")(a)}}function b(a,b,e,f){if(!d("MAWDbMsg").isUnrenderedMsgType(a))throw c("err")("getNewUnrenderedMsg called for wrong message type "+a);switch(a){case"EphemeralSyncResponse":if(e.ephemeralSetting==null)throw c("err")("Ephemeral Sync Response without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE});case"EphemeralSettingChangeFromCurrentDevice":var g;if(e.ephemeralSetting==null)throw c("err")("Ephemeral Setting Change without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,isEphemeralSettingReset:(g=e.isEphemeralSettingReset)!=null?g:!1,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE});case"GroupInvite":g=d("WAJids").interpretAsGroupJid(b.threadJid);if(g==null)throw c("err")("Group Invite without valid group jid");if(e.invitedParticipantUserJid==null)throw c("err")("Group Invite without invited user jid");return babelHelpers["extends"]({},b,{groupName:e.groupName==null?void 0:e.groupName,invitedParticipantUserJid:e.invitedParticipantUserJid,type:d("MAWMsgType").MSG_TYPE.GROUP_INVITE});case"SenderKeyDistribution":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION});case"RavenAction":if(f==null)throw c("err")("Raven Action without Raven Message External Id");if(e.actionType==null)throw c("err")("Raven Action without Action Type");return babelHelpers["extends"]({},b,{actionType:e.actionType,ravenActionToMsgExternalId:d("WAStanzaUtils").toStanzaId(f),type:d("MAWMsgType").MSG_TYPE.RAVEN_ACTION});case"EditAction":throw c("err")("Edit action not implemented yet");default:throw c("WAAssertUnreachable")(a)}}function e(a){var b,e={author:d("MAWAuthor").getAuthorUserJid(a.author)||d("WAJids").AUTHOR_ME,externalId:a.externalId,mediaId:a.mediaId,msgId:a.msgId,plaintextHash:a.plaintextHash,specialTextSize:a.specialTextSize,ts:a.ts,xmaMessageType:a.xmaMessageType};switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.IMAGE});case d("MAWMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.VIDEO});case d("MAWMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.PTT});case d("MAWMsgType").MSG_TYPE.TEXT:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.TEXT});case d("MAWMsgType").MSG_TYPE.STICKER:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.STICKER});case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case d("MAWMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.GIF});case d("MAWMsgType").MSG_TYPE.XMA:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:a.xmaMessageType});case d("MAWMsgType").MSG_TYPE.REVOKED:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.UNAVAILABLE});case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:if(((b=a.quote)==null?void 0:b.content)==null){d("WALogger").ERROR(i());return null}return babelHelpers["extends"]({},a.quote.content,{author:d("MAWAuthor").getAuthorUserJid(a.quote.content.author)||d("WAJids").AUTHOR_ME});case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH});case d("MAWMsgType").MSG_TYPE.RAVEN:return babelHelpers["extends"]({},e,{ravenEphemeralMediaState:a.ravenEphemeralMediaState,ravenEphemeralType:a.ravenEphemeralType,ravenMediaType:a.ravenMediaType,type:d("MAWMsgType").MSG_TYPE.RAVEN});default:d("WALogger").ERROR(h(),a.type);throw c("err")("Trying to reply to a message type that does not support replies")}}g.buildNewMsg=a;g.getNewUnrenderedMsg=b;g.msgToQuotedMsg=e}),98);
__d("WAPersistedQueueApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";function a(){return{ack:k,clear:m,"delete":l,index:i,keys:n,read:h,write:j}}function h(a,b){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.toCollection();(b==null?void 0:b.order)==="desc"&&(a=a.reverse());(b==null?void 0:b.filter)!=null&&(a=a.filter(b.filter));(b==null?void 0:b.limit)!=null&&(a=a.limit(b.limit));return a.toArray()},"read")}function i(a,b){return{equals:function(c){return{read:function(e){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.where(b).equals(c.length===1?c[0]:c);(e==null?void 0:e.order)==="desc"&&(a=a.reverse());(e==null?void 0:e.filter)!=null&&(a=a.filter(e.filter));(e==null?void 0:e.limit)!=null&&(a=a.limit(e.limit));return a.toArray()},"index-equal")}}},keys:function(){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.orderBy(b);return a.uniqueKeys()},"index-keys")},read:function(c){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.orderBy(b);(c==null?void 0:c.order)==="desc"&&(a=a.reverse());(c==null?void 0:c.filter)!=null&&(a=a.filter(c.filter));(c==null?void 0:c.limit)!=null&&(a=a.limit(c.limit));return a.toArray()},"index-read")}}}function j(a,b){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READWRITE,function(a){return a.bulkAdd(b).then(function(){})},"write")}function k(a,b){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READWRITE,function(a){return a.bulkDelete(b)},"ack")}function l(a,b){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READWRITE,function(a){return a.bulkDelete(b)},"delete")}function m(a){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READWRITE,function(a){return a.clear().then(function(){})},"clear")}function n(a){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.toCollection();return a.primaryKeys()},"keys")}g.dexieApiForPersistedQueue=a;g.persistedQueueRead=h;g.persistedQueueIndex=i;g.persistedQueueWrite=j;g.persistedQueueAck=k;g.persistedQueueDelete=l;g.persistedQueueClear=m;g.persistedQueueKeys=n}),98);
__d("MAWDebugMsg",["MAWBridgeMsg","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWTransactionMode","MAWTransactor","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWTransactor").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READONLY,threads:a.READWRITE},"writeDebugMsg",function(a){return function(b,e,f){return!c("gkx")("23958")?d("MAWDexieTable").dexieResolve():d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success)return;var c=b.value;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getThreadNewestMessageBySortOrder(a,c.jid),d("MAWDbMsgTxns").getThreadNewestMessageTs(a,c),(f==null?void 0:f.decryptionError)==="errDuplicateMsg"?d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f.protocolMsgId).then(function(a){if(a==null)return", no existing message";return a.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?", existing ciphertext message":",  existing message"}):d("MAWDexieTable").dexieResolve(""),d("MAWDbMsgTxns").getNextMsgIdNumberForThread(a,c)]).then(function(a){var b=a[0],f=a[1],g=a[2];a=a[3];a=d("MAWDbMsg").craftDebugMsgId(c.chatId,a-1);f=d("WATimeUtils").castToMillisTime(((b=(b=b==null?void 0:b.sortOrderMs)!=null?b:f)!=null?b:0)+1);b=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:["[fb-only][DEBUG]: "+(e+g)],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG,version:0},c.jid);d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(babelHelpers["extends"]({},b,{msgId:a,sortOrderMs:f}))})})})}});g.writeDebugMsg=b}),98);
__d("MAWSharedEbUploadQueue",["MAWEBSwitch","MAWEBUploadTrackingUtils","MAWSharedEbUploadEntity","Promise","WAPersistedQueue","WAPersistedQueueApi","WATagsLogger","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to write to ebUploadQueue ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["EB Upload Queue is already initialized"]);j=function(){return a};return a}var k=d("WATagsLogger").TAGS(["EbUploadQueue"]),l=null;function m(){return l==null?n():l}function n(){l!=null&&k.ERROR(j());var a=d("WAPersistedQueue").initPersistedQueue("ebUploadQueue",d("WAPersistedQueueApi").dexieApiForPersistedQueue());l=a;return a}function a(a){if(a.length===0)return;a.forEach(function(a){a=a.msgId;d("MAWEBUploadTrackingUtils").checkUploadQueueStartedCache(a.externalId)&&d("MAWEBUploadTrackingUtils").addPointWorkerOnly(d("MAWEBUploadTrackingUtils").genInstanceKeyForUploadQueue(a),"build_queue_entity")});var e=a.map(function(a){var b=a.attachmentContext,c=a.backupDirective,e=a.isOpenEB,f=a.messageApplication,g=a.msgId,h=a.originalMsgProtocolId,i=a.reportingMeta,j=a.senderId,k=a.serverTs,l=a.sortOrderMs;a=a.tags;return d("MAWSharedEbUploadEntity").asEBUploadEntity({attachmentContext:b,backupDirective:c,isOpenEB:e,msgId:g,originalMsgProtocolId:h,protobuf:d("MAWSharedEbUploadEntity").encodeBackupMessage({messageApplication:f,msgId:g,reportingMeta:i,sortOrderMs:l}),senderId:j,serverTs:k,sortOrderMs:l,tags:a})});e.forEach(function(a){d("MAWEBUploadTrackingUtils").checkUploadQueueStartedCache(a.msgId.externalId)&&d("MAWEBUploadTrackingUtils").addPointWorkerOnly(d("MAWEBUploadTrackingUtils").genInstanceKeyForUploadQueue(a.msgId),"enqueue_start")});a=m();c("promiseDone")(a.addAndCommit(e)["catch"](function(a){e.forEach(function(b){d("MAWEBUploadTrackingUtils").checkUploadQueueStartedCache(b.msgId.externalId)&&d("MAWEBUploadTrackingUtils").endFailWorkerOnly(d("MAWEBUploadTrackingUtils").genInstanceKeyForUploadQueue(b.msgId),"enqueue_fail",{string:{reason:a.message}})});k.ERROR(i(),a);return(h||(h=b("Promise"))).reject(a)}).then(function(){e.forEach(function(a){d("MAWEBUploadTrackingUtils").checkUploadQueueStartedCache(a.msgId.externalId)&&d("MAWEBUploadTrackingUtils").addPointWorkerOnly(d("MAWEBUploadTrackingUtils").genInstanceKeyForUploadQueue(a.msgId),"enqueue_end",{bool:{enqueue_end_eb_switch:c("MAWEBSwitch").isEnabled()}})})},function(){}))}g.logger=k;g.ebUploadQueue=m;g.initEbUploadQueue=n;g.putMsgsToEbUpload=a}),98);
__d("MessageBackupDirectiveGenerator",["I64","MAWMsgType","MessageBackupSupplementalKeyGenerator","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){return{actionType:2,originalMsgProtocolId:a,supplementalKey:d("MessageBackupSupplementalKeyGenerator").createMessageSupplementalKey(d("MessageBackupSupplementalKeyGenerator").SupplementalKeyPrefix.REACTION,(h||(h=d("I64"))).to_string(b))}}function j(a,b){return{actionType:2,originalMsgProtocolId:a,supplementalKey:d("MessageBackupSupplementalKeyGenerator").createMessageSupplementalKey(d("MessageBackupSupplementalKeyGenerator").SupplementalKeyPrefix.EDIT,(h||(h=d("I64"))).to_string(b))}}function k(a){if(d("WAJids").isAuthorSystem(a.author))return null;if(a.reactToExternalId!=null)return{author:a.reactToAuthor,chat:a.threadJid,externalId:a.reactToExternalId};else if(a.originalMsgExternalId!=null)return{author:a.author,chat:a.threadJid,externalId:a.originalMsgExternalId};else if(a.revokedExternalId!=null)return{author:a.author,chat:a.threadJid,externalId:a.revokedExternalId};return a.externalId==null?null:{author:a.author,chat:a.threadJid,externalId:a.externalId}}function a(a){var b=(h||(h=d("I64"))).of_string(d("WAJids").authorToUserId(a.author,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()))),c=k(a);if(c==null)return null;if(a.originalMsgExternalId!=null)return j(c,b);return a.reactToExternalId!=null?i(c,b):l(c,b,a.type)}function l(a,b,c){switch(c){case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return{actionType:1,originalMsgProtocolId:a};case d("MAWMsgType").MSG_TYPE.REACTION:return i(a,b);case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:return j(a,b);case d("MAWMsgType").MSG_TYPE.REVOKED:return{actionType:4,originalMsgProtocolId:a};case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:return{actionType:3,originalMsgProtocolId:a};default:return{actionType:0,originalMsgProtocolId:a}}}g.createMessageBackupDirectiveFromDbMsg=a;g.createMessageBackupDirective=l}),98);
__d("MAWEbUploadFollowUp",["I64","MAWEBUploadMessageUtils","MAWEBUploadTrackingUtils","MAWMsgType","MAWSharedEbUploadQueue","MessageBackupDirectiveGenerator","WAAsMessageApplication","WAGlobals","WAJids","WALogger","WAMediaUtils","WAMsgApplication.pb","WATimeUtils","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] no result or failed for incoming stanza ",""]);i=function(){return a};return a}function j(a){var b,c=a.stanza.message.decrypted.id;if(((b=a.decodedMsg)==null?void 0:b.unstoredDbReaction)!=null)return{author:a.decodedMsg.unstoredDbReaction.reactToAuthor,chat:c.chat,externalId:a.decodedMsg.unstoredDbReaction.reactToExternalId};else if(((b=a.decodedMsg)==null?void 0:b.unstoredDbEditActionMsg)!=null)return{author:c.author,chat:c.chat,externalId:a.decodedMsg.unstoredDbEditActionMsg.originalMsgExternalId};return c}function a(a,b){a=a.map(function(a){var c,e=a.stanza.message.decrypted.id,f=b.get(a.stanza.message.decrypted.id),g=k(a.decodedMsg);if(f==null||!f.success||g==null){d("WALogger").EXPECTED_ERROR(i(),a.stanza.message.decrypted.id);return null}f=j(a);var m=a.stanza.message.decrypted.msg;if((m==null?void 0:m.version)!=="v3"||m.type!=="subprotocol")return null;m={metadata:m.metadata,payload:{subProtocol:(c={},c[m.subprotocolType]={payload:m.subprotocol.buffer,version:1},c)}};c={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,m).readByteArray()),version:"v3"};m=a.stanza.message.details.reportingMeta;var n=l(a);d("MAWEBUploadTrackingUtils").maybeStartTrackingForUploadQueue(e,"receive",g);a=a.stanza.message.details.ts;return{attachmentContext:n,backupDirective:d("MessageBackupDirectiveGenerator").createMessageBackupDirective(f,(h||(h=d("I64"))).of_string(d("WAJids").authorToUserId(e.author,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()))),g),messageApplication:c.bytes,msgId:e,originalMsgProtocolId:f,reportingMeta:m,senderId:h.of_string(d("WAJids").authorToUserId(e.author,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()))),serverTs:a,sortOrderMs:d("WATimeUtils").castToMillisTime(d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder({externalId:e.externalId,serverTs:a,ts:a}))}}).filter(Boolean);return d("MAWSharedEbUploadQueue").putMsgsToEbUpload(a)}function k(a){if(a==null)return null;var b;if(a.unstoredDbReaction!=null)return d("MAWMsgType").MSG_TYPE.REACTION;else if(a.unstoredDbEditActionMsg!=null)return d("MAWMsgType").MSG_TYPE.EDIT_ACTION;else if(a.unstoredDbMedia!=null)b=a.unstoredDbMedia.mediaType;else if(a.unstoredXMA!=null)b=d("MAWMsgType").MSG_TYPE.XMA;else if(a.unstoredDbMsg!=null)b=a.unstoredDbMsg.type;else return null;return d("MAWMsgType").isEBSupportedMsgType(b)?b:null}function l(a){var b;if(((b=a.decodedMsg)==null?void 0:b.unstoredDbMedia)!=null){a=(b=a.decodedMsg)==null?void 0:b.unstoredDbMedia;b=d("WAMediaUtils").decodeMediaEntryData(a.mediaEntry);if(b.objectId!=null&&a.mediaType!=null)return[{mediaObjectId:d("WAMediaUtils").stringToDeliveryObjectId(b.objectId),mediaType:a.mediaType}]}return void 0}g.putMessagesToEbUploadQueue=a}),98);
__d("WAParseV3Protocol",["WAAckLevel","WAAssertUnreachable","WAErr","WAGlobals","WAHex","WAMsgType","WAParseConsumerMessageProtocol"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return function(b,e,f,g,h,i){h={id:{chat:e,author:g,externalId:f},ts:h,serverTs:h,ack:d("WAAckLevel").ACK.RECEIVED,forwardingScore:b.type!=="futureProof"?(f=b==null?void 0:(g=b.metadata)==null?void 0:g.forwardingScore)!=null?f:0:0};g=b.type!=="futureProof"&&((g=b.metadata)==null?void 0:(f=g.chatEphemeralSetting)==null?void 0:f.ephemeralExpiration)!=null&&((g=b.metadata)==null?void 0:(f=g.chatEphemeralSetting)==null?void 0:f.ephemeralExpiration)>0;if(b.type==="futureProof"||g&&!d("WAGlobals").getConfig().isEphemeralMessagesEnabled())return{unstoredMsg:{type:d("WAMsgType").FUTUREPROOF,msgContent:{subtype:null,protobuf:d("WAHex").bytesToBuffer(b.protobuf)},id:h.id,ts:h.ts,sentTs:h.sentTs,serverTs:h.serverTs,ack:h.ack,reportingMeta:h.reportingMeta},unstoredMedia:null,unstoredQuotedMedia:null};else if(b.type==="subprotocol"){f=a==null?void 0:a.get(b.subprotocolType);if(f!=null)return f(e,b.subprotocol,h,b.protobuf,b.metadata);switch(b.subprotocolType){case"consumerMessage":return d("WAParseConsumerMessageProtocol").parseConsumerMessageProtocol(e,b.subprotocol,h,b.protobuf,b.metadata,i);case"businessMessage":throw c("WAErr")("unsupported subprotocolType: "+b.subprotocolType);case"paymentMessage":throw c("WAErr")("unsupported subprotocolType: "+b.subprotocolType);case"multiDevice":throw c("WAErr")("unsupported subprotocolType: "+b.subprotocolType);case"voip":throw c("WAErr")("unsupported subprotocolType: "+b.subprotocolType);default:throw c("WAErr")("Subprotocol parser for: "+b.subprotocolType+" was not found")}}else return c("WAAssertUnreachable")(b.type)}}g.createV3ProtocolParser=a}),98);
__d("MAWIncomingMsgUtils",["MAWEphemeralUtil","MAWParseArmadilloProtocol","MAWUnstoredContentToUnstoredDbContentUtils","WAParseV3Protocol","err"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function i(a){if(h==null){var b=function(b,c,e,f,g){return d("MAWParseArmadilloProtocol").parseArmadilloProtocol(b,c,e,f,a,g)};h=d("WAParseV3Protocol").createV3ProtocolParser(new Map([["armadillo",b]]))}return h}function a(a,b){var e=a.author,f=a.chat,g=a.ebTimestampMs,h=a.externalId,j=a.msg,k=a.reportingMeta;a=a.serverTs;if(j.version==="v2")throw c("err")("Armadillo does not support protobuf v2");if(j.type==="ephemeral"){var l=d("MAWEphemeralUtil").buildUnstoredDbEphemeralSettingMsgWithoutContentPlaceholder(a);k!=null&&l.unstoredDbMsg!=null&&(l.unstoredDbMsg.reportingMeta=k);return l}l=babelHelpers["extends"]({unstoredXMA:null},i(b)(j,f,h,e,a,g));k!=null&&l.unstoredMsg!=null&&(l.unstoredMsg.reportingMeta=k);return d("MAWUnstoredContentToUnstoredDbContentUtils").unstoredContentToUnstoredDbContent(l)}g.getDbMsg=a}),98);
__d("MAWProtocolQueueDecodeProto",["MAWIncomingMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){switch(a.type){case"IncomingMsg":var e=a.folder,f=a.id,g=a.msg,h=a.reportingMeta;a=a.ts;var i=f.author,j=f.chat;f=f.externalId;return d("MAWIncomingMsgUtils").getDbMsg({author:i,chat:j,ebTimestampMs:c,externalId:f,folder:e,msg:g,reportingMeta:h,serverTs:a},b);case"InvisibleMsg":case"IncomingCiphertextMsg":default:return}}g.decodeMsg=a}),98);
__d("WAQueryGroupInvite",["WADeprecatedSendIq","WAPREList","WAPREMetrics","WAQueryGroup","WAResultOrError","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,d){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f,g=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.QUERY_GROUP);a=(f=d("WAWap")).wap("iq",{id:f.generateId(),to:f.GROUP_JID(a),type:"get",xmlns:"w:g2"},f.wap("query",null,f.wap("add_request",{admin:f.USER_JID(e),code:f.CUSTOM_STRING(b),expiration:f.CUSTOM_STRING(c.toString(10))})));e=(yield d("WADeprecatedSendIq").deprecatedSendIq(a,d("WAQueryGroup").parseQueryGroupResponse));if(!e.success){g.endFail("query_group_for_invitee_fail");return d("WAResultOrError").makeError(e)}g.endSuccess();return d("WAResultOrError").makeResult(e.result.group)});return h.apply(this,arguments)}g.queryGroupInvite=a}),98);
__d("MAWCOPMessagesHandler",["ACTSanitizerApiLazyLoader","IGDInstamadilloUtils","MAWDbStaleQueue","MAWDebugMsg","MAWEbUploadFollowUp","MAWIsQuotaExceededError","MAWJobDefinitions","MAWJobManager","MAWLoggerUtils","MAWMsgType","MAWODSProxy","MAWProtocolQueueDecodeProto","MAWProtocolQueueMsg","MAWProtocolQueueUtils","MAWSharedCOPLogger","MAWSharedCOPLoop","Promise","WACreateGroup","WAGlobals","WAHashUtils","WAJids","WAOdsEnums","WAPREList","WAProtocolQueue","WAQueryGroup","WAQueryGroupInvite","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","err","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media: externalId="," - plaintextFollowUp - plaintextHash=",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot find db result for message"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing messages batch, see transactor error reports."]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot prepare msgs to put to EBUploadQueue: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Decode fails: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot load XMA Validation WASM module: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error creating groups: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error creating groups: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Scheduling job for ",", plaintextHash: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMsg: detected out-of-sync ephemeral setting for ",", sending EPHEMERAL_SYNC_RESPONSE"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["message consumer: ",""]);s=function(){return a};return a}function a(a,b){return t(a,b)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(s(),a);return[]})}function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a.length===0)return[];var e=new Set();z(a);var f;try{f=(yield d("ACTSanitizerApiLazyLoader").loadACTSanitizerApi())}catch(a){c("MAWSharedCOPLogger").TAGS(["ActSanitizerWasmApi"]).ERROR(n(),a),f=d("ACTSanitizerApiLazyLoader").fallbackACTSanitizerApi}var g=f.isXMAValid,h=new Map(a.map(function(a){a=A(a);a=d("WAProtocolQueue").mapProcolQueueMessageV2toV1(a);try{if(a.message.decrypted.type==="InstamadilloMsg")if(c("gkx")("3577")){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.IGDW_INSTAMADILLO_MESSAGE_ON_OLD_WORKER,key:"message"});e.add(a.stanzaQueueId);return null}else throw c("err")("InstamadilloMsg is not supported in MSGR. Should never happen "+d("IGDInstamadilloUtils").getE2EEGatingStateAsString());var b=d("MAWProtocolQueueDecodeProto").decodeMsg(a.message.decrypted,g,a.ebTimestampMs);a.incomingType==="ebrestore"&&(a.message.details.type=(b==null?void 0:b.unstoredDbReaction)!=null?"reaction":(b==null?void 0:b.unstoredXMA)!=null||(b==null?void 0:b.unstoredDbMedia)!=null?"media":"text");return[a.stanzaQueueId,d("MAWProtocolQueueUtils").addMetricToMessage({decodedMsg:b!=null?b:void 0,stanza:babelHelpers["extends"]({},a)},a.incomingType==="ebrestore"?d("WAPREList").PRE_METRIC.EB_RESTORE_WITH_HIM:d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE)]}catch(f){b=f instanceof Error?f:null;c("MAWSharedCOPLogger").ERROR(m(),f);c("promiseDone")(d("MAWDbStaleQueue").mawAddStaleStanza(a,"Decode issue: "+((b=b==null?void 0:b.message)!=null?b:"")));e.add(a.stanzaQueueId);return null}}).filter(Boolean)),o=(yield d("MAWProtocolQueueMsg").handleIncomingMessagesStanzas(Array.from(h.values())));o.toAck.forEach(function(a){return e.add(a)});f=a.map(function(a){var b=h.get(a.stanzaQueueId);if(b==null)return null;b=b;var c=o.followUpParams.incomingMsgResults.get(b.stanza.message.decrypted.id);return[b,e.has(a.stanzaQueueId),c]}).filter(Boolean);try{d("MAWEbUploadFollowUp").putMessagesToEbUploadQueue(Array.from(h.values()).filter(function(a){return a.stanza.incomingType==="wa"}),o.followUpParams.incomingMsgResults)}catch(a){c("MAWSharedCOPLogger").ERROR(l(),a)}e.size!==a.length&&c("MAWSharedCOPLogger").WARN(k());var p=new Map(),q=new Set();f.forEach(function(a){var e=a[0],f=a[1];a=a[2];e.receiveFlow.addPoint("consumer_handle_message_stanza_end",{bool:{dbSuccess:!!(a==null?void 0:a.success)}});if(f){e.receiveFlow.addPoint("ack_received");var g=e.stanza.message.decrypted.type;g==="UnavailableMsg"||g==="IncomingCiphertextMsg"?e.receiveFlow.endFail(g):(e.stanza.message.details.type==="media"&&e.receiveFlow.addPoint("message_with_media"),e.receiveFlow.endSuccess())}if(!a&&!f){c("MAWSharedCOPLogger").ERROR(j());e.receiveFlow.endFail("db_result_not_found");return}if(!a)return;if(a.success===!1){g=a.error;switch(g.type){case"group_invite":e.receiveFlow.endFail("end_with_db_error_group_invite");p.set(g.groupJid,{folder:g.folder,inviteCode:g.inviteCode,inviteExpireTs:g.inviteExpireTs,inviterJid:g.inviterJid});e.receiveFlow.endFail("need_group_invite");break;default:g.type;e.receiveFlow.endFail("invlid_args");break}return}a.success;if(a.value!=null){f=a.value;var h=f.msgType;g=f.outOfSyncEphemeralSetting;a=f.plaintextHashs;var k=f.protocolMsgId;f=f.unknownGroup;if(f){f=d("WAJids").interpretAsGroupJid(k.chat);f!=null&&q.add(f)}v(g,k,b);a==null?void 0:a.forEach(function(a){c("MAWSharedCOPLogger").LOG(i(),e.stanza.message.details.externalId,d("WAHashUtils").sanitisePlaintextHash(a)),w(k,a,h)})}});x(q,b);y(p,b);return Array.from(e)});return u.apply(this,arguments)}function v(a,b,e){a!=null&&(c("MAWSharedCOPLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.SettingSync]).LOG(r(),b==null?void 0:b.externalId),c("promiseDone")(e.awaitBackground(d("MAWSharedCOPLoop").makeCopGUID("ephemeral_sync_response"),function(){return d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.sendEphemeralSettingMsg(a.chatJid,{ephemeralSetting:{ephemeralExpirationInSec:a.correctEphemeralExpirationInSec,ephemeralLastUpdatedOrSetTimestamp:a.correctEphemeralLastUpdatedOrSetTimestamp},isEphemeralSettingReset:!1,isForSyncResponse:!0}))},d("MAWSharedCOPLoop").COPBehaviour.NON_BLOCKING)))}function w(a,b,e){a!=null&&b!=null&&e!==d("MAWMsgType").MSG_TYPE.RAVEN&&(c("MAWSharedCOPLogger").TAGS(["downloadAndHandleMedia"]).LOG(q(),a,d("WAHashUtils").sanitisePlaintextHash(b)),d("MAWJobManager").getJobManager().fireAndForget(d("MAWJobDefinitions").jobSerializers.downloadAndHandleMedia(a,b,"WAIncomingMsg",e,null)))}function x(a,e){if(a.size===0)return;c("promiseDone")(e.awaitBackground(d("MAWSharedCOPLoop").makeCopGUID("queryGroup"),function(){f()["catch"](function(a){c("MAWSharedCOPLogger").ERROR(p(),a)});return(h||(h=b("Promise"))).resolve()},d("MAWSharedCOPLoop").COPBehaviour.NON_BLOCKING));function f(){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var c=(yield (h||(h=b("Promise"))).all(Array.from(a).map(function(a){return d("WAQueryGroup").queryGroup(a,"interactive")["catch"](function(a){return d("WAResultOrError").makeError()})})));c=c.map(function(a){if(a.success===!0){a={extras:null,folder:null,groupStatus:"added",groupToCreate:a.value,key:null,serverTs:d("WATimeUtils").unixTime()};return a}return null}).filter(Boolean);yield d("WACreateGroup").createGroups(c)});return g.apply(this,arguments)}}function y(a,e){if(a.size===0)return;c("promiseDone")(e.awaitBackground(d("MAWSharedCOPLoop").makeCopGUID("queryGroupInvite"),function(){f()["catch"](function(a){c("MAWSharedCOPLogger").ERROR(o(),a)});return(h||(h=b("Promise"))).resolve()},d("MAWSharedCOPLoop").COPBehaviour.NON_BLOCKING));function f(){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var c=(yield (h||(h=b("Promise"))).all(Array.from(a.entries()).map(function(a){var b=a[0];a=a[1];var c=a.inviteCode,e=a.inviteExpireTs;a=a.inviterJid;return d("WAQueryGroupInvite").queryGroupInvite(b,c,e,a)["catch"](function(a){return d("WAResultOrError").makeError()})})));c=c.map(function(a){if(a.success===!0){a={extras:null,folder:null,groupStatus:"added",groupToCreate:a.value,key:null,serverTs:d("WATimeUtils").unixTime()};return a}return null}).filter(Boolean);yield d("WACreateGroup").createGroups(c)});return g.apply(this,arguments)}}function z(a){if(c("gkx")("23915"))for(a of a)a.subtype==="ciphertext"&&c("promiseDone")(d("MAWDebugMsg").writeDebugMsg(a.jid,"Message "+a.stanzaId+" has decryption error: "+a.decryptionError+" from user "+a.from,{decryptionError:a.decryptionError,protocolMsgId:{author:d("WAGlobals").getMyDeviceJid()===a.from?"@me":d("WAJids").extractUserJid(a.from),chat:a.jid,externalId:a.stanzaId}}))}function A(a){if(a.message==null)return a;if(a.message.type!=="ephemeral")return a;var b=a.serverTs;a.message.ephemeralLastUpdatedOrSetTimestamp=a.message.ephemeralLastUpdatedOrSetTimestamp===d("WATimeUtils").DEFAULT_UNIXTIME?b:a.message.ephemeralLastUpdatedOrSetTimestamp;return a}g["default"]=a}),98);
__d("MAWChangeGroupParticipantAdminStatusApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"changeGroupParticipantAdminStatus")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g){var h=a.GroupInfoStore,i=a.MessagesStore;a=a.ParticipantsStore;var j=(yield h.get(c));if(!j.success)return d("WAResultOrError").makeError("missing_group");j=j.value;if(b!=null&&b.previous!=null&&j.participantVersion!==b.previous)return d("WAResultOrError").makeError("mismatch");j=f.map(function(a){return{addressable:a.addressable,chatJid:c,type:g,user:a.user}});yield a.bulkPut(j);if(b!=null){yield h.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:b.current})});for(f=0;f<j.length;f++)g==="admin"?a=d("MAWAdminMsgHelpers").createParticipantPromoteAdminMsg(c,j[f].user,e):a=d("MAWAdminMsgHelpers").createParticipantDemoteAdminMsg(c,j[f].user,e),yield i.create(a)}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g){return a.apply(this,arguments)}}();g.changeGroupParticipantAdminStatus=a;g.changeGroupParticipantAdminStatusTransactor=h}),98);
__d("MAWConvertCreateGroupResultApi",["MAWDbGroupInfoTxns","MAWIndexedDb","MAWTransactionMode","err"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({groupInfo:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"convertCreateGroupResult",function(a){return function(b){return d("MAWDbGroupInfoTxns").getGroupInfo(a,b.jid).then(function(b){if(!b.success)throw c("err")("Tried to convert a createGroup result for a group that has not persisted in the DB");return a.threads.get({jid:b.value.groupJid}).then(function(a){if(a==null)throw c("err")("Tried to convert a createGroup result for a group but its thread is not in DB");return{chatJid:a.jid,type:"msgr"}})})}});g.convertCreateGroupResult=a}),98);
__d("MAWConvertFutureproofMsgTxns",["MAWBridgeMsg","MAWBridgeTypesCreators","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWFTSTxns","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWMediaManagementTxns","MAWMsgType","MAWThreadEvent","MAWThreadSnippetBuildTxns","WAArrayZip","WAJids","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){return a.type===d("MAWMsgType").MSG_TYPE.REVOKED?babelHelpers["extends"]({},a,{altIndex:"foobar",msgId:b.msgId,rowId:b.rowId,sortOrderMs:b.sortOrderMs,threadJid:c,ts:b.ts}):babelHelpers["extends"]({},a,{msgId:b.msgId,rowId:b.rowId,sortOrderMs:b.sortOrderMs,threadJid:c,ts:b.ts})}function a(a,b,e,f,g){var i=h(b,e,g.jid);return a.messages.put(i).then(function(){return d("MAWDbThreadTxns").needsRetroactiveReadReceiptInThread(a,i)}).then(function(b){if(b){i.altIndex=d("MAWDbMsg").craftToBeReadAltIndex(g.chatId);return a.messages.put(i)}}).then(function(){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,i)}).then(function(b){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(i,void 0,b)});d("MAWIndexedDb").afterTransactionThreadEvent({chatJid:g.jid,msgId:i.msgId},d("MAWThreadEvent").PLACEHOLDER_CONVERT_SUBSCRIPTION);return d("MAWDbMsgTxns").getThreadNewestMessageId(a,g.jid).then(function(b){b=i.msgId===b?d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,i).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:b,snippetSenderContactId:c,snippetType:a,threadJid:g.jid})})}):d("MAWDexieTable").dexieResolve();var e=f!=null?d("MAWMediaManagementTxns").handleUnstoredDbMedia(a,f,i).then(function(a){if(d("WAJids").isAuthorSystem(i.author))throw c("err")("This cannot happen");return{plaintextHash:a.plaintextHash,protocolMsgId:{author:i.author,chat:g.jid,externalId:i.externalId}}}):d("MAWDexieTable").dexieResolve(null);return d("MAWDexieTable").dexieAll([b,e,d("MAWFTSTxns").maybePutMessageToBacklog(a,i.externalId)]).then(function(a){a[0];a=a[1];return a})})})}function b(a,b){var e=[];b.forEach(function(a){e.push(h(a.unstoredDbMsg,a.dbMsg,a.thread.jid))});var f=d("MAWDbThreadTxns").bulkNeedsRetroactiveReadReceiptInThread(a,e).then(function(a){d("WAArrayZip").zip(e,a).forEach(function(a){var c,e=a[0];a=a[1];c=(c=b.get(e.msgId))==null?void 0:c.thread;a&&c!=null&&(e.altIndex=d("MAWDbMsg").craftToBeReadAltIndex(c.chatId))})});return f.then(function(){return a.messages.bulkPut(e).then(function(){return i(a,e,b).then(function(f){var g=[];e.forEach(function(e){var h=d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,e).then(function(g){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(e,void 0,g)});var h=(g=b.get(e.msgId))==null?void 0:g.thread;g=(g=b.get(e.msgId))==null?void 0:g.unstoredDbMedia;if(h==null)throw c("err")("MAWConvertFutureproofMsgTxns: thread is null cannot happen");d("MAWIndexedDb").afterTransactionThreadEvent({chatJid:h.jid,msgId:e.msgId},d("MAWThreadEvent").PLACEHOLDER_CONVERT_SUBSCRIPTION);var i=e.msgId===f.get(h.jid)?d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,e).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:b,snippetSenderContactId:c,snippetType:a,threadJid:h.jid})})}):d("MAWDexieTable").dexieResolve();g=g!=null?d("MAWMediaManagementTxns").handleUnstoredDbMedia(a,g,e).then(function(a){if(d("WAJids").isAuthorSystem(e.author))throw c("err")("This cannot happen");return{plaintextHash:a.plaintextHash,protocolMsgId:{author:e.author,chat:h.jid,externalId:e.externalId}}}):d("MAWDexieTable").dexieResolve(null);return d("MAWDexieTable").dexieAll([i,g]).then(function(a){a[0];a=a[1];return a})});g.push(h)});return d("MAWDexieTable").dexieAll(g).then(function(a){return a.map(function(a){return a})})})})})}function i(a,b,e){var f=c("gkx")("5737");if(!f){var g=new Map();e.forEach(function(a){g.set(a.thread.jid,a.thread.newestMsg)});return d("MAWDexieTable").dexieResolve(g)}f=b.map(function(a){return a.threadJid});return d("MAWDexieTable").dexieAll(Array.from(f.values()).map(function(b){return d("MAWDbMsgTxns").getThreadNewestMessageId(a,b).then(function(a){return{chatJid:b,newestMsgId:a}})})).then(function(b){var a=new Map();b.forEach(function(b){a.set(b.chatJid,b.newestMsgId)});return a})}g.convertFutureproofMsg=a;g.bulkConvertFutureproofMsgs=b}),98);
__d("MAWMessageSendScheduler",["WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){h==null&&(h=d("WorkerScheduler").makeScheduler("message-send",{concurrency:5,maxConcurrency:5,maxThrottleMs:500}));return h}g.messageSendScheduler=a}),98);
__d("MAWGetAllMediaIdsForXMAMsgApi",["MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({xma:d("MAWTransactionMode").READONLY},"getAllMediaIdsForXMAMsg",function(a){return function(b){var c=new Map();b=b.map(function(b){return d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,b).then(function(a){var d,e=(d=c.get(b))!=null?d:new Set();a!=null&&(a.faviconMediaId!=null&&e.add(a.faviconMediaId),a.headerMediaId!=null&&e.add(a.headerMediaId),a.previewMediaIds!=null&&a.previewMediaIds.forEach(function(a){return e.add(a)}));c.set(b,e)})});return d("MAWDexieTable").dexieAll(b).then(function(a){return c})}});g.getAllMediaIdsForXMAMsg=a}),98);
__d("MAWGetEditMsgForSending",["MAWAckLevel","MAWAsMessageApplication","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWTransactionMode","WAJids","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get originalMsg"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get thread (success:",")"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get originalMsgProtocolMsgId"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get edit history"]);k=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:(a=d("MAWTransactionMode")).READONLY,messages:a.READONLY,participants:a.READONLY,reactions:a.READONLY,threads:a.READONLY},"getEditMsgForSending",function(a){return function(b,e){return l(a,b,e).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var e=d("MAWAsMessageApplication").asEditMessageApplication(a);if(d("WAJids").isAuthorSystem(a.author))throw c("err")("This cannot happen because there are no system edit");return{dbMsg:a,editOriginalExternalId:a.originalMsgExternalId,messageApplication:e,messageType:{isRevoked:!1,type:"text"},protocolMsgId:b,type:"unsent"}})}});function l(a,b,c){return d("MAWDbEditMsgHistoryTxns").getEditHistoryMsgByEditedProtocolMsgId(a,b,c).then(function(b){if(b==null){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("missing_history")}else if(b.sendStatus!=null&&b.sendStatus>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var c=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.originalMsgExternalId);if(c==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_msg")}return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,b.threadJid),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)]).then(function(a){var c=a[0];a=a[1];if(!c.success){d("WALogger").ERROR(i(),c.success);return d("WAResultOrError").makeError("missing_thread")}if(a==null){d("WALogger").ERROR(h());return d("WAResultOrError").makeError("missing_msg")}return a.ack>d("MAWAckLevel").ACK.clock?d("WAResultOrError").makeError("sent"):d("WAResultOrError").makeResult({msg:b,thread:c.value})})})}g.getEditMsgForSending=b}),98);
__d("MAWMediaType",["WAServerMediaType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case"XMA":return"xma-image";case"EphemeralScreenshotAction":case"Raven":case"RavenAction":case"EditAction":case"BumpExistingMessage":return null;default:return d("WAServerMediaType").getMediaType(a)}}g.getMediaType=a}),98);
__d("MAWSendMsgUtil",["MAWMediaType","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";var h={};function i(a){var b=d("MAWMediaType").getMediaType(a),c=a===d("WAMsgType").MSG_TYPE.REVOKED;if(b!=null)return{mediaType:b,type:"media"};else if(a===d("WAMsgType").MSG_TYPE.SK_DISTRIBUTION)return{isInvisible:!0,isRevoked:!1,type:"text"};else return{isRevoked:c,type:"text"}}function a(a){var b=d("MAWMediaType").getMediaType(a);if(b!=null)return{mediaType:b,type:"media"};switch(a){case"XMA":case"Raven":case"RavenAction":case"EphemeralScreenshotAction":case"EditAction":case"BumpExistingMessage":return{isRevoked:!1,type:"text"};default:return i(a)}}function b(a){return h[a]}function c(a){h[a]=!0}function e(a){delete h[a]}g.waGetMessageTypeFromMsg=i;g.getMessageTypeFromMsg=a;g.checkS2SInstanceKeyExist=b;g.addS2SInstanceKey=c;g.removeS2SInstanceKey=e}),98);
__d("MAWGetMsgForSendingApi",["MAWAckLevel","MAWAsMessageApplication","MAWDbGroupInviteTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWSendMsgUtil","MAWTransactionMode","MAWXMAUtils","WAJids","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get XMA: isXma: ",", type: "," "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get thread (success:",")"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get message"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Done"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Unrecognized type ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Error: ",""]);m=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({groupInvites:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READONLY,participants:a.READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY,xma:a.READONLY},"getMsgForSending",function(a){return function(b){return n(a,b).then(function(a){if(!a.success){d("WALogger").LOG(m(),b,a.error);return{type:a.error}}a=a.value;var e=a.contactsInThread,f=a.groupInvite,g=a.isReplyMsg,h=a.media,i=a.msg,j=a.thread;a=a.xmaPayload;if(!d("MAWDbMsg").NO_CONTENT_MESSAGE_TYPES_ALLOWLIST.includes(i.type)&&!d("MAWDbMsg").isContentMsg(i)){d("WALogger").LOG(l(),b,i.type);throw c("err")("We do not support message sending with "+i.type+" type")}var n=d("MAWAsMessageApplication").asMessageApplication(i,h,f,a),o=null;i.type===d("MAWMsgType").MSG_TYPE.GROUP_INVITE&&f?o={invitedParticipantUserJid:f.inviteeJid,isRevoked:!1,type:"text"}:o=d("MAWSendMsgUtil").getMessageTypeFromMsg(i.type);if(d("WAJids").isAuthorSystem(i.author))throw c("err")("A system message cannot be sent");d("WALogger").LOG(k(),b);return{contactsInThread:e,dbMsg:i,isReplyMsg:g,isXMAMsg:a!=null,media:h,messageApplication:n,messageType:o,protocolMsgId:{author:i.author,chat:j.jid,externalId:a!=null&&a.associatedMessage!=null?a.associatedMessage.externalId:i.externalId},type:"unsent"}})}});function n(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(c){var e=c[0];c=c[1];var f=c.value,g=e||f;if(g==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_msg")}else if(g.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var k=d("MAWXMAUtils").maybeXMAMessage(e),l=g.quote!=null;return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,g.threadJid),e?d("MAWDbMediaTxns").getAndCheckMediaFromMsg(a,e):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()),c.success?d("MAWDbGroupInviteTxns").getAndCheckGroupInviteFromMsg(a,c.value):d("MAWDexieTable").dexieResolve(),k?d("MAWDbXMATxns").maybeGetXMAPayloadFromProtocolMsgId(a,b):null,d("MAWDbParticipantTxns").getParticipantsInThread(a,g.threadJid).then(function(a){return a.map(function(a){return a.userJid})})]).then(function(a){var b=a[0],c=a[1],e=a[2],f=a[3];a=a[4];if(!c.success)return c;if(!b.success){d("WALogger").ERROR(i(),b.success);return d("WAResultOrError").makeError("missing_thread")}if(f!=null&&!f.success){d("WALogger").ERROR(h(),k,g.type);return d("WAResultOrError").makeError("missing_xma")}c=c.value;b=b.value;return d("WAResultOrError").makeResult({contactsInThread:a,groupInvite:e,isReplyMsg:l,media:c,msg:g,thread:b,xmaPayload:f!=null?f.value:null})})})}g.getMsgForSending=b}),98);
__d("MAWGetReactionForSending",["MAWAckLevel","MAWAsMessageApplication","MAWDbReactionsTxns","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WAJids","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return d("MAWDbReactionsTxns").getReaction(a,b).then(function(b){if(b==null)return d("WAResultOrError").makeError("missing");else if(b.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");return d("MAWDbThreadTxns").getThread(a,b.threadJid).then(function(a){return!a.success?d("WAResultOrError").makeError(a.error):d("WAResultOrError").makeResult({msg:b})})})}a=d("MAWIndexedDb").makeMsgrTransactor({reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getReactionForSending",function(a){return function(b){return h(a,b).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var b=d("MAWAsMessageApplication").asReactionMessageApplication(a);if(d("WAJids").isAuthorSystem(a.author))throw c("err")("This cannot happen because there are no system reactions");return{chat:a.threadJid,dbMsg:a,externalId:a.externalId,messageApplication:b,messageType:{isInvisible:!0,type:"reaction"},protocolMsgId:{author:a.author,chat:a.threadJid,externalId:a.externalId},type:"unsent"}})}});g.getReactionForSending=a}),98);
__d("MAWLoadThreadParticipantsApi",["MAWDbParticipantTxns","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWLoadThreadParticipantsApi -- loadThreadParticipants -- there is no thread in db"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"loadThreadParticipants",function(a){return function(b){return a.threads.get({jid:b}).then(function(b){if(b==null){d("WALogger").ERROR(h());return[]}return d("MAWDbParticipantTxns").getParticipantsInThread(a,b.jid).then(function(a){return a.map(function(a){return a.userJid})})})}});g.loadThreadParticipants=a}),98);
__d("MAWMarkEditMsgDroppedApi",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWBridgeTypesCreators","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWThreadSnippetForTextMsg","MAWTransactionMode","WAGlobals","WAJids","WALogger","WAMsgType","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] editMsgHistory updated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalMsg is not a text message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] thread is null"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] newestEditedMsg is not the newest edit"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] previousEditedMsg is null"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] newestEditedMsg is null"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalMsg is null"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalProtocolMsgId is null"]);o=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"markEditMsgDropped",function(a){return function(b,e){var f=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.chat,e);if(f==null){d("WALogger").ERROR(o());return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing_original_protocol_msg_id"))}return d("MAWDexieTable").dexieAll([a.threads.get({jid:b.chat}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f),d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,f)]).then(function(f){var g=f[0],o=f[1],p=f[2];f=p.sort(function(a,b){return b.editTs-a.editTs});var q=p.find(function(a){return a.editExternalId===b.externalId}),r=f[1];if(o==null){d("WALogger").ERROR(n());return d("WAResultOrError").makeError("missing_original_msg")}if(q==null){d("WALogger").ERROR(m());return d("WAResultOrError").makeError("missing_newest_edited_msg")}if(r==null){d("WALogger").ERROR(l());return d("WAResultOrError").makeError("missing_previous_edited_msg")}if(q.editExternalId!==f[0].editExternalId){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("invalid_newest_edited_msg")}if(g==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_thread")}if(o.type!==d("WAMsgType").MSG_TYPE.TEXT){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("invalid_original_msg")}return d("MAWDexieTable").dexieAll([a.messages.where("quoteExternalId").equals(e).toArray(),d("MAWDbMsgTxns").getThreadNewestMessageId(a,g.jid)]).then(function(e){var f=e[0],i=e[1],j=babelHelpers["extends"]({},o,{ack:d("MAWAckLevel").ACK.sent,editCount:((e=o.editCount)!=null?e:0)-1,msgContent:r.msgContent}),k=d("WAGlobals").getMyUserJid(),l=[];e=f.find(function(a){var c;return(((c=a.quote)==null?void 0:c.content.author)===d("WAJids").AUTHOR_ME||((c=a.quote)==null?void 0:c.content.author)===k)&&a.threadJid===b.chat});if(e!=null){f=e.quote;var m=e.quoteExternalId;if(f==null)c("FBLogger")("messenger_e2ee_web").warn("[markEditMsgDropped] Failed to get the quoted content for a msg that has been quoted.",m);else{m=babelHelpers["extends"]({},e,{quote:babelHelpers["extends"]({},f,{content:babelHelpers["extends"]({},f.content,{msgContent:babelHelpers["extends"]({},j.msgContent)})})});l.push(m)}}e=[];o.editCount===1&&p.length===2&&e.push(r.editMsgHistoryId);e.push(q.editMsgHistoryId);return d("MAWDexieTable").dexieAll([a.messages.put(j),a.editMsgHistory.bulkDelete(e)]).then(function(){d("WALogger").LOG(h());d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(j)});l.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})});if(i===o.msgId){var a=d("WAJids").userIdFromJid(d("WAGlobals").getMyUserJid()),b=c("MAWThreadSnippetForTextMsg")(j,a,d("WAJids").interpretAsGroupJid(g.jid)!=null),e=b.snippetParams;b=b.snippetType;d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:e,snippetSenderContactId:a,snippetType:b,threadJid:g.jid})})}return d("WAResultOrError").makeResult()})})})}});g.markEditMsgDropped=a}),98);
__d("MAWMarkEditMsgSentApi",["ArmadilloDataTraceType","MAWAckLevel","MAWBridgeMsg","MAWBridgeTrace","MAWBridgeTraceEvent","MAWDbEditMsgHistory","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWFTSTxns","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWTransactionMode","WAJids","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editMsgHistory updated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] on incoming message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editMsgHistory has already been sent"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editedMsg?.editExternalId is null"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalMsgHistory is null"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalMsg is null"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalProtocolMsgId is null"]);n=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READWRITE,ftsBackloggedMessages:a.READWRITE,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,xma:a.READONLY},"markMsgSent",function(a){return function(b,e,f,g){var o=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.chat,e);if(o==null){d("WALogger").ERROR(n());return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing_original_protocol_msg_id"))}return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,o),d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,o),d("MAWFTSTxns").maybePutMessageToBacklog(a,e)]).then(function(n){var o=n[0];n=n[1];var p=n.find(function(a){return a.editExternalId===e}),q=n.find(function(a){return a.editExternalId===b.externalId});if(o==null){d("WALogger").ERROR(m());return d("WAResultOrError").makeError("missing_original_msg")}if(p==null){d("WALogger").ERROR(l());return d("WAResultOrError").makeError("missing_original_msg_edit_history")}if((q==null?void 0:q.editExternalId)==null){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("missing_edit_external_id")}if(q.sendStatus!=null&&q.sendStatus>d("MAWAckLevel").ACK.clock&&o.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(j());return d("WAResultOrError").makeError("already_sent")}if(q.author!==d("WAJids").AUTHOR_ME){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("not_author")}d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([q.editExternalId],c("MAWBridgeTraceEvent").ReceivedSent,d("ArmadilloDataTraceType").armadilloMessageSend)});var r=[];if(n.length===2&&o.editCount===1){n=babelHelpers["extends"]({},p,{sendStatus:d("MAWAckLevel").ACK.sent});r.push(n)}p=babelHelpers["extends"]({},q,{editTs:f,sendStatus:d("MAWAckLevel").ACK.sent});r.push(p);var s=r.map(function(a){return babelHelpers["extends"]({},a,{editMsgHistoryId:d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(a.editMsgHistoryId),originalMsgId:o.msgId})}),t=babelHelpers["extends"]({},o,{ack:d("MAWAckLevel").ACK.sent});g!=null&&(t.reportingMeta=g);return d("MAWDexieTable").dexieAll([a.editMsgHistory.bulkPut(r),a.messages.put(t),d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,t)]).then(function(a){a[0];a=a[2];d("WALogger").LOG(h());d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(t,void 0,a)});d("MAWIndexedDb").afterTransaction({tag:"EditMsgHistoryAdded",value:s});return d("WAResultOrError").makeResult()})})}});g.markEditMsgSent=b}),98);
__d("MAWMarkMsgDroppedApi",["MAWAckLevel","MAWDbMsgTxns","MAWDbReactionsTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READWRITE,reactions:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"markMsgDropped",function(a){return function(b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b)]).then(function(b){var c=b[0];b=b[1];if(c!=null)return d("MAWDbMsgTxns").updateSystemAck(a,c.msgId,d("MAWAckLevel").ACK.expired).then(function(a){return a==null?"missing":a.ack<=d("MAWAckLevel").ACK.clock?"dropped":"sent"});return b!=null?d("MAWDbReactionsTxns").deleteReaction(a,b).then(function(){return"dropped"}):"missing"})}});g.markMsgDropped=b}),98);
__d("MAWMarkMsgSentApi",["ArmadilloDataTraceType","I64","MAWAckLevel","MAWBridgeTrace","MAWBridgeTraceEvent","MAWBridgeTypesCreators","MAWCalculateBumpTimestampMs","MAWDbMessageHandler","MAWDbMsg","MAWDbMsgTxns","MAWDbThread","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWEphemeralMsgTxns","MAWEphemeralSettingsTxns","MAWIndexedDb","MAWMsgType","MAWThreadSnippetBuildTxns","MAWTransactionMode","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Thread missing from DB"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Found both regular and unrendered message with the same protocol msg ID"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Msg missing from DB"]);k=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"markMsgSent",function(a){return function(b,e,f,g){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(l){var m=l[0];l=l[1];if(m==null&&!l.success){d("WALogger").LOG(k());return}else if(m!=null){d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([m.externalId],c("MAWBridgeTraceEvent").ReceivedSent,d("ArmadilloDataTraceType").armadilloMessageSend)});l.success&&d("WALogger").ERROR(j());var n=m.ack<d("MAWAckLevel").ACK.sent;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").updateSystemAck(a,m.msgId,d("MAWAckLevel").ACK.sent,e,f,g),d("MAWDbThreadTxns").getThread(a,m.threadJid)]).then(function(b){var c=b[0];b=b[1];if(!b.success){d("WALogger").ERROR(i());return}var f=b.value,g=d("WATimeUtils").castUnixTimeToMillisTime(e);b=babelHelpers["extends"]({},f,{lastReadMsgTs:g,newestMsgTs:g,threadOrder:d("MAWDbThread").craftThreadOrder(g,f.jid)});b=n?d("MAWDbThreadTxns").updateThread(a,b):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([d("MAWEphemeralMsgTxns").markEphemeralMessageAsSent(a,c),b]).then(function(){if(m.altIndex!==d("MAWDbMsg").SPAM_ALT_INDEX&&m.altIndex!==d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX&&!d("MAWDbMessageHandler").isThreadUpdateEnabledViaMiddlewareForMsgType(m.type)&&n)return d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,m).then(function(a){var b=a.snippetParams,c=a.snippetSenderContactId;a=a.snippetType;if(m.type===d("MAWMsgType").MSG_TYPE.REVOKED)d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({snippetParams:b,snippetSenderContactId:c,snippetType:a,threadJid:f.jid})});else if(!d("MAWDbMessageHandler").isThreadUpdateEnabledViaMiddlewareForMsgType(m.type)){var e=m.externalId!==void 0?(h||(h=d("I64"))).of_string_opt(m.externalId):void 0;e=d("MAWCalculateBumpTimestampMs").calculateBumpTimestampMs(g,e);d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedV2",value:d("MAWBridgeTypesCreators").createBridgeBumpedThreadV2({bumpTimestampMs:e,description:"markMsgSent",isMessageAuthorMe:!0,snippetData:{params:b,senderContactId:c,type:a},threadJid:f.jid})})}})})})}else if(l.success){var o=l.value;return d("MAWDbUnrenderedMsgTxns").updateSystemAckForUnrenderedMsg(a,o.msgId,d("MAWAckLevel").ACK.sent).then(function(){if(o.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE)return d("MAWEphemeralSettingsTxns").updateContactWhenEphemeralSettingChangeMarkedSent(a,b.chat,e)})}}).then(function(){})}});g.markMsgSent=b}),98);
__d("MAWSendWrittenMsg",["FBLogger","I64","MAWBridge","MAWDbMediaTxns","MAWDebugMsg","MAWEBUploadMessageUtils","MAWEBUploadTrackingUtils","MAWGetAllMediaIdsForXMAMsgApi","MAWGetEditMsgForSending","MAWGetMsgForSendingApi","MAWGetReactionForSending","MAWIndexedDb","MAWJobManager","MAWLoadThreadParticipantsApi","MAWMarkEditMsgDroppedApi","MAWMarkEditMsgSentApi","MAWMarkMsgDroppedApi","MAWMarkMsgSentApi","MAWMsgType","MAWSendMsgUtil","MAWSharedEbUploadQueue","MAWTransactionMode","MessageBackupDirectiveGenerator","WAAPI","WAAsMessageApplication","WAFrankingTypes","WAGenReportingMeta","WAGlobals","WAJids","WALogger","WAMsgApplication.pb","WAPREList","WAPREMetrics","WAPersistedJobManager","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","encodeProtobuf","err","gkx","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg adding message "," attachments to EB upload queue"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg END ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg END ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg not sending message: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg(","): drop result: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg(","): too old, dropping"]);o=function(){return a};return a}e=24*60*60;var p=10001;function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e;d("WALogger").LOG(m(),a.protocolMsgId);var f=null;b.addPoint("get_msg_for_sending",{string:{type:a.type}});if(a.type==="message"||a.type==="revoke")f=(yield d("MAWGetMsgForSendingApi").getMsgForSending(a.protocolMsgId));else if(a.type==="reaction")f=(yield d("MAWGetReactionForSending").getReactionForSending(a.protocolMsgId));else if(a.type==="edit")f=(yield d("MAWGetEditMsgForSending").getEditMsgForSending(a.protocolMsgId,a.referencedOriginalExternalId));else{a.type;throw c("err")("This cannot happen because type has `message` as default argument but flow does not know that")}if(f.type!=="unsent"){d("WALogger").LOG(l(),f.type);b.endFail(f.type);return d("WAResultOrError").makeError({type:"unknown-error"})}a=f;f=a.dbMsg;var g=a.editOriginalExternalId,n=a.isReplyMsg,o=a.isXMAMsg,q=a.media,r=a.messageApplication,s=a.messageType;a=a.protocolMsgId;b.addPoint("message-fetched-from-db",{bool:{isEditMsg:g!=null,isReplyMsg:n,isXMAMsg:o},string:{msgType:s.type}});n={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,r).readByteArray()),version:"v3"};e=(yield c("WAAPI").sendChatMessage({loadThreadParticipants:d("MAWLoadThreadParticipantsApi").loadThreadParticipants,messagePayload:{frankingKey:((e=r.metadata)==null?void 0:e.frankingKey)?d("WAFrankingTypes").castToFrankingKey(new Uint8Array((e=r.metadata)==null?void 0:e.frankingKey)):null,frankingVersion:(e=r.metadata)==null?void 0:e.frankingVersion,messageBytes:n,messageType:s,protocolMsgId:a}},b));e.success===!1&&(b==null?void 0:b.addPoint("send-msg-v2-failed",{string:{errorType:e.error.type,msgType:f.type}}));if(e.success===!1)b.endFail(e.error.type),g!=null?yield d("MAWMarkEditMsgDroppedApi").markEditMsgDropped(a,g):yield d("MAWMarkMsgDroppedApi").markMsgDropped(a),d("WALogger").ERROR(k(),e.error);else{e.success;((s=e.value.meta)==null?void 0:s.pOrDhashMismatch)&&c("promiseDone")(d("MAWDebugMsg").writeDebugMsg(a.chat,"Outgoing msg "+a.externalId+" got a phash mismatch"));g!=null?yield x({editOriginalExternalId:g,protocolMsgId:a,reportingMeta:e.value.reportingMeta,serverTs:e.value.serverTs},b):yield y({protocolMsgId:a,reportingMeta:e.value.reportingMeta,serverTs:e.value.serverTs},b);c("justknobx")._("1837")&&(b.endSuccess(),d("WALogger").LOG(j(),e.success));try{if(f!=null&&!d("WAJids").isAuthorSystem(f.author)){s=v(f);if(s!=null){g=r==null?void 0:r.metadata;b=d("MessageBackupDirectiveGenerator").createMessageBackupDirectiveFromDbMsg(f);if(b!=null){if(o===!0){r=(yield t(a));o=r.filter(Boolean)}else o=q!=null&&q.objectId!=null&&q.mediaType!=null?[{mediaObjectId:q.objectId,mediaType:q.mediaType}]:void 0;d("WALogger").LOG(i(),(r=o)==null?void 0:r.length);d("MAWEBUploadTrackingUtils").maybeStartTrackingForUploadQueue(a,"send",s);q=e.value.serverTs;yield d("MAWSharedEbUploadQueue").putMsgsToEbUpload([{attachmentContext:o,backupDirective:b,messageApplication:n.bytes,msgId:a,originalMsgProtocolId:b.originalMsgProtocolId.externalId!==a.externalId?b.originalMsgProtocolId:a,reportingMeta:yield d("WAGenReportingMeta").genReportingMeta(n.bytes,(g==null?void 0:g.frankingKey)?d("WAFrankingTypes").castToFrankingKey(new Uint8Array(g==null?void 0:g.frankingKey)):null,g==null?void 0:g.frankingVersion),senderId:(h||(h=d("I64"))).of_string(d("WAJids").authorToUserId(a.author,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()))),serverTs:q,sortOrderMs:d("WATimeUtils").castToMillisTime(d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder({externalId:a.externalId,serverTs:q,ts:q}))}])}}}}catch(a){c("FBLogger")("labyrinth_web").mustfix("Failed to decode message application and add to EB upload queue")}}r=c("gkx")("794");if(e.success===!1)switch(e.error.type){case"non-retryable-error":if(r&&e.error.applicationErrorCode!=null&&e.error.applicationErrorCode===p)try{d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"RefreshContact",value:(h||(h=d("I64"))).of_string(d("WAJids").threadIdForChatJid(f.threadJid))}]})}catch(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("Failed to call bridge handler RefreshContact for JID %s and mediaType %s",f.threadJid,f.type)}throw new(d("WAPersistedJobManager").NonRetryableError)();case"retryable-error":if(e.error.backoff!=null)throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{delay:e.error.backoff,type:"constant"}});throw c("err")("sendWrittenMsg error");default:throw c("err")("sendWrittenMsg error")}return e});return r.apply(this,arguments)}var s=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY},"bulkGetRetroactiveMedia",function(a){return function(){for(var b=arguments.length,c=new Array(b),e=0;e<b;e++)c[e]=arguments[e];return d("MAWDbMediaTxns").bulkGetMedias.apply(void 0,[a].concat(c))}});function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("MAWGetAllMediaIdsForXMAMsgApi").getAllMediaIdsForXMAMsg([a]).then(function(b){b=b.get(a);return b!=null?s(Array.from(b)):[]}));return b.filter(Boolean).map(function(a){return a.objectId!=null&&a.mediaType!=null?{mediaObjectId:a.objectId,mediaType:a.mediaType}:void 0})});return u.apply(this,arguments)}function v(a){if(a.reactToExternalId!=null)return d("MAWMsgType").MSG_TYPE.REACTION;else if(a.editMsgHistoryId!=null)return d("MAWMsgType").MSG_TYPE.EDIT_ACTION;else if(a.type==null)return null;else return d("MAWMsgType").isEBSupportedMsgType(a.type)?a.type:null}function w(a,b){b===void 0&&(b=!1);a.s2sInstanceKey!=null&&d("MAWSendMsgUtil").addS2SInstanceKey(a.s2sInstanceKey);b=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.SEND_MESSAGE,{bool:{afterCrash:b,isSenderKeyPredistriubtionEnabled:d("WAGlobals").getConfig().isSenderKeyPredistributionEnabled()},string:{jid:a.protocolMsgId.chat}},a.s2sInstanceKey);b.addAnnotations({bool:{is_secure:!0}});return q(a,b)}f=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("encryptAndSend",{code:function(a,b,c){return w(a,c.afterCrash)},stopRetryIf:{onStopRetry:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.protocolMsgId;d("WALogger").LOG(o(),a);var b=(yield d("MAWMarkMsgDroppedApi").markMsgDropped(a));d("WALogger").LOG(n(),a,b);return d("WAResultOrError").makeError({type:"too-many-retries"})});function c(b){return a.apply(this,arguments)}return c}(),timePassedSeconds:e}}).end();function a(a){if(a.reactToExternalId!=null)return a.reactToExternalId;if(a.originalMsgExternalId!=null)return a.originalMsgExternalId;switch(a.type){case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:return a.originalMsgExternalId;case d("MAWMsgType").MSG_TYPE.REACTION:return a.reactToExternalId;default:return null}}function x(a,b){var c=a.editOriginalExternalId,e=a.protocolMsgId,f=a.reportingMeta;a=a.serverTs;return d("MAWMarkEditMsgSentApi").markEditMsgSent(e,c,a,f).then(function(){b==null?void 0:b.addPoint("mark_edit_msg_sent")})}function y(a,b){var c=a.protocolMsgId,e=a.reportingMeta;a=a.serverTs;return d("MAWMarkMsgSentApi").markMsgSent(c,a,e,b).then(function(){b==null?void 0:b.addPoint("mark_msg_sent")})}g.sendWrittenMsgExternal=w;g.sendWrittenMsg=f;g.getTopLevelOfflineThreadingId=a}),98);
__d("MAWWriteOutgoingMsgApi",["MAWAckLevel","MAWBuildNewMsgPayload","MAWDbMsg","MAWDbMsgTxns","MAWDbRavenActionTxns","MAWDexieTable","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWMsgType","MAWQplProxy","MAWTransactionMode","MAWVault","MAWWriteMsgTxns","WAJids","WALogger","WATimeUtils","nullthrows","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeOutgoingMsg: "," is not identical for partial optimistic upsert: "," vs ",""]);h=function(){return a};return a}var i=function(a,b,e){b!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),a,{annotations:e,instanceKey:b})};function j(a,b,c){if(b===c)return;d("WALogger").WARN(h(),a,b,c)}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"writeOutgoingMsg",function(a){return function(b,e,f,g,h){g.content!=null&&(g.content=d("MAWVault").vault(g.content));i("write_outgoing_msg_start",g.s2sInstanceKey);return d("MAWDexieTable").dexieAll([a.threads.get({jid:e}),a.messages.where("externalId").equals(b).toArray(),k(a,g.quote,e),d("MAWDbRavenActionTxns").maybeGetRavenMsgQueryByProtocolMsgId(a,g.ravenProtocolMsgId,h)]).then(function(e){var k=e[0],m=e[1],n=e[2];e=e[3];i("write_outgoing_msg_data_fetched",g.s2sInstanceKey,{bool:{isUnrenderedMsgType:d("MAWDbMsg").isUnrenderedMsgType(h)}});if(k==null)return{type:"missing_thread"};var o=m.find(function(a){return a.threadJid===k.jid&&a.author===d("WAJids").AUTHOR_ME});if(o!=null&&o.ack!==d("MAWAckLevel").ACK.partialOptimistic)return o.ack>=d("MAWAckLevel").ACK.sent?{msgId:o.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:k.jid,externalId:o.externalId},type:"already_sent"}:{msgId:o.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:k.jid,externalId:o.externalId},type:"not_sent"};else{var p=o==null?void 0:o.rowId;o&&(j("ts",o.ts,f),j("threadJid",o.threadJid,k.jid));if(!d("MAWDbMsg").isUnrenderedMsgType(h)){m={ack:d("MAWAckLevel").ACK.clock,altIndex:void 0,author:d("WAJids").AUTHOR_ME,ephemeralSetting:g.ephemeralSetting,externalId:b,isForwarded:g.isForwarded,specialTextSize:g.specialTextSize,threadJid:k.jid,ts:f};var q=d("MAWBuildNewMsgPayload").buildNewMsg(h,m,g,n),r=g.isFirstMsg,s=g.openMessageOtid,t=g.openMessageParticipantCount,u=g.optimisticMsg,v=g.participantCount;m=d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,q).then(function(b){return d("MAWWriteMsgTxns").writeMsg(a,q,k,{isCurrentDeviceSendingMsg:!0,isFirstMsg:r,isOutgoing:!0,openMessageOtid:s,openMessageParticipantCount:t,optimisticMsg:u,participantCount:v,quotedReplyAttachmentMeta:b,upsertRowData:p!=null?{msgId:c("nullthrows")(o==null?void 0:o.msgId),rowId:p}:void 0})})}else{n={ack:d("MAWAckLevel").ACK.clock,author:d("WAJids").AUTHOR_ME,externalId:b,threadJid:k.jid,ts:f};n=d("MAWBuildNewMsgPayload").getNewUnrenderedMsg(h,n,g,e==null?void 0:e.externalId);m=d("MAWWriteMsgTxns").writeUnrenderedMsg(a,n,k)}return m.then(function(c){i("write_outgoing_msg_promise_resolved",g.s2sInstanceKey);return l(a,h,k.jid,f).then(function(){return{msgId:c.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:k.jid,externalId:b},type:"not_sent"}})})}})}});function k(a,b,c){return b==null?d("MAWDexieTable").dexieResolve(null):d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(b){return b==null?null:a.threads.get({jid:b.threadJid}).then(function(a){var e=d("MAWBuildNewMsgPayload").msgToQuotedMsg(b);if(e==null)return null;b.messageExpirationTs!=null&&b.messageExpirationTs<d("WATimeUtils").unixTime()&&(e=babelHelpers["extends"]({},e,{mediaId:void 0,msgContent:void 0,type:d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL,xmaMessageType:void 0}));if(a==null||a.jid===c)return{content:e,remoteJid:null};a=d("WAJids").interpretAndValidateJid(a.jid);a=a.jidType==="group"?a.groupJid:null;return{content:e,remoteJid:a}})})}function l(a,b,c,e){if(b===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE)return d("WAJids").switchOnMsgrChatJidType(c,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return a.ephemeralSettings.get({userJid:b}).then(function(b){var c;if(b==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo={syncResponseRetries:((c=(c=b.ephemeralSyncResponseBackoffInfo)==null?void 0:c.syncResponseRetries)!=null?c:0)+1,syncResponseSentTs:e};return a.ephemeralSettings.put(b)}).then(function(){})}});return b===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE?d("WAJids").switchOnMsgrChatJidType(c,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return a.ephemeralSettings.get({userJid:b}).then(function(b){if(b==null||b.ephemeralSyncResponseBackoffInfo==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo=void 0;return a.ephemeralSettings.put(b).then(function(){})})}}):d("MAWDexieTable").dexieResolve()}g.writeOutgoingMsg=b;g.getQuoteInfo=k}),98);
__d("MAWSendSenderKeyDistributionMsg",["MAWDebugMsg","MAWExternalId","MAWJobDefinitions","MAWJobManager","MAWMessageSendScheduler","MAWMsgType","MAWSendWrittenMsg","MAWWriteOutgoingMsgApi","Promise","WAAPI","WAJobOrchestratorTypes","WAResultOrError","WATimeUtils","WorkerScheduler","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Set();function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){if(i.has(a))return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult());yield d("MAWDebugMsg").writeDebugMsg(a,"Sending key distribution msg");e=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(e,a,d("WATimeUtils").unixTime(),{},d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION));if(e.type==="already_sent")return d("WAResultOrError").makeError("already_sent");else if(e.type==="missing_thread")return d("WAResultOrError").makeError("missing_thread");c("gkx")("5800")?yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:e.protocolMsgId,type:"message"},!1):yield d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:e.protocolMsgId,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"}));i.add(a);return d("WAResultOrError").makeResult()});return k.apply(this,arguments)}var l=10,m=new Set();function a(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){if(c("gkx")("5801")){if(m.has(a))return(h||(h=b("Promise"))).resolve();if(e.length<l)return(h||(h=b("Promise"))).resolve();m.add(a);return d("MAWMessageSendScheduler").messageSendScheduler().run({fn:function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield c("WAAPI").preEstablishSession({groupJid:a,userJids:e}),yield j(a,d("MAWExternalId").generateExternalId())});function g(){return f.apply(this,arguments)}return g}(),name:"sks",priority:d("WorkerScheduler").BACKGROUND_PRIORITY}).promise["finally"](function(){m["delete"](a)})}else{if(e.length<l)return(h||(h=b("Promise"))).resolve();yield c("WAAPI").preEstablishSession({groupJid:a,userJids:e});yield j(a,d("MAWExternalId").generateExternalId())}});return n.apply(this,arguments)}g.sendSenderKeyDistributionMsg=j;g.maybePreEstablishSessionsAndSendSenderKeyDistributionMsg=a}),98);
__d("WASmaxInGroupsIQErrorNotAcceptableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"field");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"name");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"reason");return!a.success?a:d("WAResultOrError").makeResult({name:b.value,reason:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"field",h);if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-acceptable");if(!c.success)return c;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",406);return!a.success?a:d("WAResultOrError").makeResult({text:c.value,code:a.value,field:b.value})}g.parseIQErrorNotAcceptableField=h;g.parseIQErrorNotAcceptableMixin=a}),98);
__d("WASmaxInGroupsIQErrorParentLinkedGroupsParticipantsResourceLimitMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","linked-groups-participants-resource-limit");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",412);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorParentLinkedGroupsParticipantsResourceLimitMixin=a}),98);
__d("WASmaxInGroupsIQErrorResourceConstraintMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","resource-constraint");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorResourceConstraintMixin=a}),98);
__d("WASmaxInGroupsIQErrorResourceLimitMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","resource-limit");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",419);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorResourceLimitMixin=a}),98);
__d("WASmaxInGroupsCreateClientErrors",["WAResultOrError","WASmaxInGroupsCreateOrAddGroupRateLimitErrorMixin","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxInGroupsIQErrorForbiddenMixin","WASmaxInGroupsIQErrorItemNotFoundMixin","WASmaxInGroupsIQErrorNotAcceptableMixin","WASmaxInGroupsIQErrorNotAllowedMixin","WASmaxInGroupsIQErrorParentLinkedGroupsParticipantsResourceLimitMixin","WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxInGroupsIQErrorResourceConstraintMixin","WASmaxInGroupsIQErrorResourceLimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:b.value});var c=d("WASmaxInGroupsIQErrorResourceConstraintMixin").parseIQErrorResourceConstraintMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorResourceConstraint",value:c.value});var e=d("WASmaxInGroupsIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:e.value});var f=d("WASmaxInGroupsIQErrorResourceLimitMixin").parseIQErrorResourceLimitMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorResourceLimit",value:f.value});var g=d("WASmaxInGroupsIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:g.value});var h=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:h.value});var i=d("WASmaxInGroupsCreateOrAddGroupRateLimitErrorMixin").parseCreateOrAddGroupRateLimitErrorMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"CreateOrAddGroupRateLimitError",value:i.value});var j=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(a);if(j.success)return d("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:j.value});var k=d("WASmaxInGroupsIQErrorNotAllowedMixin").parseIQErrorNotAllowedMixin(a);if(k.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAllowed",value:k.value});var l=d("WASmaxInGroupsIQErrorParentLinkedGroupsParticipantsResourceLimitMixin").parseIQErrorParentLinkedGroupsParticipantsResourceLimitMixin(a);if(l.success)return d("WAResultOrError").makeResult({name:"IQErrorParentLinkedGroupsParticipantsResourceLimit",value:l.value});var m=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return m.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:m.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorForbidden","IQErrorResourceConstraint","IQErrorItemNotFound","IQErrorResourceLimit","IQErrorNotAcceptable","IQErrorBadRequest","CreateOrAddGroupRateLimitError","IQErrorRateOverlimit","IQErrorNotAllowed","IQErrorParentLinkedGroupsParticipantsResourceLimit","IQErrorFallbackClient"],[b,c,e,f,g,h,i,j,k,l,m])}g.parseCreateClientErrors=a}),98);
__d("WASmaxInGroupsCreateResponseClientError",["WAResultOrError","WASmaxInGroupsCreateClientErrors","WASmaxInGroupsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsCreateClientErrors").parseCreateClientErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorCreateClientErrors:b.value}))}g.parseCreateResponseClientError=a}),98);
__d("WASmaxInGroupsCreateResponseGroupAlreadyExists",["WAResultOrError","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"group");if(!c.success)return c;var e=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","g.us");if(!e.success)return e;var f=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!f.success)return f;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!a.success)return a;b=d("WASmaxParseJid").attrGroupJid(c.value,"jid");return!b.success?b:d("WAResultOrError").makeResult({from:e.value,type:f.value,groupJid:b.value})}g.parseCreateResponseGroupAlreadyExists=a}),98);
__d("WASmaxInGroupsCreateResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseCreateResponseServerError=a}),98);
__d("WASmaxInGroupsCreateParticipantAddedMixin",["WAResultOrError","WASmaxInGroupsEnums","WASmaxInGroupsParticipantNotAddressableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,a,"type",d("WASmaxInGroupsEnums").ENUM_ADMIN_SUPERADMIN);if(!b.success)return b;a=d("WASmaxInGroupsParticipantNotAddressableMixin").parseParticipantNotAddressableMixin(a);return d("WAResultOrError").makeResult({type:b.value,participantNotAddressableMixin:a.success?a.value:null})}g.parseCreateParticipantAddedMixin=a}),98);
__d("WASmaxInGroupsCreateParticipantMixins",["WAResultOrError","WASmaxInGroupsCreateParticipantAddedMixin","WASmaxInGroupsParticipantHasInvalidPNMixin","WASmaxInGroupsParticipantNotAcceptableMixin","WASmaxInGroupsParticipantNotAuthorizedMixin","WASmaxInGroupsParticipantRequestCodeCanBeSentMixin","WASmaxInGroupsParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin","WASmaxInGroupsParticipantResourceConstraintMixin","WASmaxInGroupsParticipantResourceLimitMixin","WASmaxInGroupsParticipantTemporarilyBlockedFromDefaultSubGroupMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsParticipantTemporarilyBlockedFromDefaultSubGroupMixin").parseParticipantTemporarilyBlockedFromDefaultSubGroupMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ParticipantTemporarilyBlockedFromDefaultSubGroup",value:b.value});var c=d("WASmaxInGroupsParticipantNotAuthorizedMixin").parseParticipantNotAuthorizedMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"ParticipantNotAuthorized",value:c.value});var e=d("WASmaxInGroupsParticipantRequestCodeCanBeSentMixin").parseParticipantRequestCodeCanBeSentMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"ParticipantRequestCodeCanBeSent",value:e.value});var f=d("WASmaxInGroupsParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin").parseParticipantRequestCodeCannotBeCreatedForLegalConcernsMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"ParticipantRequestCodeCannotBeCreatedForLegalConcerns",value:f.value});var g=d("WASmaxInGroupsParticipantHasInvalidPNMixin").parseParticipantHasInvalidPNMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"ParticipantHasInvalidPN",value:g.value});var h=d("WASmaxInGroupsParticipantResourceConstraintMixin").parseParticipantResourceConstraintMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"ParticipantResourceConstraint",value:h.value});var i=d("WASmaxInGroupsParticipantNotAcceptableMixin").parseParticipantNotAcceptableMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"ParticipantNotAcceptable",value:i.value});var j=d("WASmaxInGroupsParticipantResourceLimitMixin").parseParticipantResourceLimitMixin(a);if(j.success)return d("WAResultOrError").makeResult({name:"ParticipantResourceLimit",value:j.value});var k=d("WASmaxInGroupsCreateParticipantAddedMixin").parseCreateParticipantAddedMixin(a);return k.success?d("WAResultOrError").makeResult({name:"CreateParticipantAdded",value:k.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ParticipantTemporarilyBlockedFromDefaultSubGroup","ParticipantNotAuthorized","ParticipantRequestCodeCanBeSent","ParticipantRequestCodeCannotBeCreatedForLegalConcerns","ParticipantHasInvalidPN","ParticipantResourceConstraint","ParticipantNotAcceptable","ParticipantResourceLimit","ParticipantAdded"],[b,c,e,f,g,h,i,j,k])}g.parseCreateParticipantMixins=a}),98);
__d("WASmaxInGroupsCreateParticipantAddedResponseMixin",["WAResultOrError","WASmaxInGroupsCreateParticipantMixins","WASmaxInGroupsPhoneNumberMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;var c=d("WASmaxInGroupsPhoneNumberMixin").parsePhoneNumberMixin(a);a=d("WASmaxInGroupsCreateParticipantMixins").parseCreateParticipantMixins(a);return!a.success?a:d("WAResultOrError").makeResult({jid:b.value,phoneNumberMixin:c.success?c.value:null,createParticipantMixins:a.value})}g.parseCreateParticipantAddedResponseMixin=a}),98);
__d("WASmaxInGroupsCreateParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup",["WAResultOrError","WASmaxInGroupsCreateParticipantAddedResponseMixin","WASmaxInGroupsNonRegisteredWaUserParticipantErrorLidResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsCreateParticipantAddedResponseMixin").parseCreateParticipantAddedResponseMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"CreateParticipantAddedResponse",value:b.value});var c=d("WASmaxInGroupsNonRegisteredWaUserParticipantErrorLidResponseMixin").parseNonRegisteredWaUserParticipantErrorLidResponseMixin(a);return c.success?d("WAResultOrError").makeResult({name:"NonRegisteredWaUserParticipantErrorLidResponse",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ParticipantAddedResponse","NonRegisteredWaUserParticipantErrorLidResponse"],[b,c])}g.parseCreateParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup=a}),98);
__d("WASmaxInGroupsDedupAttrsMixin",["WAResultOrError","WASmaxInGroupsEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").attrString(a,"key");if(!b.success)return b;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,a,"create_ctx",d("WASmaxInGroupsEnums").ENUM_E2EEMIGRATION_REGULAR_RTC);return!a.success?a:d("WAResultOrError").makeResult({key:b.value,createCtx:a.value})}g.parseDedupAttrsMixin=a}),98);
__d("WASmaxInGroupsAdminAddModeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"member_add_mode");if(!b.success)return b;b=d("WASmaxParseUtils").literalContent(d("WASmaxParseUtils").contentString,a,"admin_add");return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parseAdminAddModeMixin=a}),98);
__d("WASmaxInGroupsAllMembersAddModeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"member_add_mode");if(!b.success)return b;b=d("WASmaxParseUtils").literalContent(d("WASmaxParseUtils").contentString,a,"all_member_add");return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parseAllMembersAddModeMixin=a}),98);
__d("WASmaxInGroupsUnknownAddModeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"member_add_mode");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parseUnknownAddModeMixin=a}),98);
__d("WASmaxInGroupsAdminOrAllMembersOrUnknownAddModeMixinGroup",["WAResultOrError","WASmaxInGroupsAdminAddModeMixin","WASmaxInGroupsAllMembersAddModeMixin","WASmaxInGroupsUnknownAddModeMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsAdminAddModeMixin").parseAdminAddModeMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"AdminAddMode",value:b.value});var c=d("WASmaxInGroupsAllMembersAddModeMixin").parseAllMembersAddModeMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"AllMembersAddMode",value:c.value});var e=d("WASmaxInGroupsUnknownAddModeMixin").parseUnknownAddModeMixin(a);return e.success?d("WAResultOrError").makeResult({name:"UnknownAddMode",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["AdminAddMode","AllMembersAddMode","UnknownAddMode"],[b,c,e])}g.parseAdminOrAllMembersOrUnknownAddModeMixinGroup=a}),98);
__d("WASmaxInGroupsGroupMemberAddModeMixin",["WAResultOrError","WASmaxInGroupsAdminOrAllMembersOrUnknownAddModeMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"member_add_mode");if(!a.success)return a;a=d("WASmaxInGroupsAdminOrAllMembersOrUnknownAddModeMixinGroup").parseAdminOrAllMembersOrUnknownAddModeMixinGroup(a.value);return!a.success?a:d("WAResultOrError").makeResult({memberAddModeAdminOrAllMembersOrUnknownAddModeMixinGroup:a.value})}g.parseGroupMemberAddModeMixin=a}),98);
__d("WASmaxInGroupsGroupJoinMembershipApprovalModeEnabledMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"group_join");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"state","on");return!b.success?b:d("WAResultOrError").makeResult({state:b.value})}g.parseGroupJoinMembershipApprovalModeEnabledMixin=a}),98);
__d("WASmaxInGroupsMembershipApprovalGroupJoinModeEnabledMixin",["WASmaxInGroupsGroupJoinMembershipApprovalModeEnabledMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"membership_approval_mode");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"group_join");if(!b.success)return b;a=d("WASmaxInGroupsGroupJoinMembershipApprovalModeEnabledMixin").parseGroupJoinMembershipApprovalModeEnabledMixin(b.value);return!a.success?a:a}g.parseMembershipApprovalGroupJoinModeEnabledMixin=a}),98);
__d("WASmaxInGroupsNamedSubjectMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrString(a,"subject");return!a.success?a:d("WAResultOrError").makeResult({subject:a.value})}g.parseNamedSubjectMixin=a}),98);
__d("WASmaxInGroupsUnnamedSubjectFallbackMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"subject");return!a.success?a:d("WAResultOrError").makeResult({subject:a.value})}g.parseUnnamedSubjectFallbackMixin=a}),98);
__d("WASmaxInGroupsNamedSubjectOrUnnamedSubjectFallbackMixinGroup",["WAResultOrError","WASmaxInGroupsNamedSubjectMixin","WASmaxInGroupsUnnamedSubjectFallbackMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsNamedSubjectMixin").parseNamedSubjectMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"NamedSubject",value:b.value});var c=d("WASmaxInGroupsUnnamedSubjectFallbackMixin").parseUnnamedSubjectFallbackMixin(a);return c.success?d("WAResultOrError").makeResult({name:"UnnamedSubjectFallback",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["NamedSubject","UnnamedSubjectFallback"],[b,c])}g.parseNamedSubjectOrUnnamedSubjectFallbackMixinGroup=a}),98);
__d("WASmaxInGroupsParentGroupDefaultMembershipApprovalModeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"parent");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"default_membership_approval_mode","request_required");return!b.success?b:d("WAResultOrError").makeResult({defaultMembershipApprovalMode:b.value})}g.parseParentGroupDefaultMembershipApprovalModeMixin=a}),98);
__d("WASmaxInGroupsCreateResponseSuccess",["WAResultOrError","WASmaxInGroupsCreateParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup","WASmaxInGroupsDedupAttrsMixin","WASmaxInGroupsEnums","WASmaxInGroupsGroupAddressingModeMixin","WASmaxInGroupsGroupMemberAddModeMixin","WASmaxInGroupsMembershipApprovalGroupJoinModeEnabledMixin","WASmaxInGroupsNamedSubjectOrUnnamedSubjectFallbackMixinGroup","WASmaxInGroupsParentGroupDefaultMembershipApprovalModeMixin","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxInGroupsCreateParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup").parseCreateParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({createParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"description");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"id");if(!b.success)return b;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,a,"error",d("WASmaxInGroupsEnums").ENUM_406_500);return!a.success?a:d("WAResultOrError").makeResult({id:b.value,error:a.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"parent");if(!b.success)return b;b=d("WASmaxInGroupsParentGroupDefaultMembershipApprovalModeMixin").parseParentGroupDefaultMembershipApprovalModeMixin(a);return d("WAResultOrError").makeResult({parentGroupDefaultMembershipApprovalModeMixin:b.success?b.value:null})}function k(a){var b=d("WASmaxParseUtils").assertTag(a,"ephemeral");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"expiration",0,2147483647);if(!b.success)return b;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"trigger",0,20);return!a.success?a:d("WAResultOrError").makeResult({expiration:b.value,trigger:a.value})}function l(a){var b=d("WASmaxParseUtils").assertTag(a,"membership_approval_mode");if(!b.success)return b;b=d("WASmaxInGroupsMembershipApprovalGroupJoinModeEnabledMixin").parseMembershipApprovalGroupJoinModeEnabledMixin(a);return!b.success?b:b}function m(a){var b=d("WASmaxParseUtils").assertTag(a,"linked_parent");if(!b.success)return b;b=d("WASmaxParseJid").attrGroupJid(a,"jid");return!b.success?b:d("WAResultOrError").makeResult({jid:b.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"group");if(!c.success)return c;var e=d("WASmaxParseUtils").optionalChildWithTag(c.value,"description",i);if(!e.success)return e;var f=d("WASmaxParseUtils").optionalChild(c.value,"locked");if(!f.success)return f;var g=d("WASmaxParseUtils").optionalChild(c.value,"announcement");if(!g.success)return g;var n=d("WASmaxParseUtils").optionalChildWithTag(c.value,"parent",j);if(!n.success)return n;var o=d("WASmaxParseUtils").optionalChild(c.value,"no_frequently_forwarded");if(!o.success)return o;var p=d("WASmaxParseUtils").optionalChildWithTag(c.value,"ephemeral",k);if(!p.success)return p;var q=d("WASmaxParseUtils").optionalChildWithTag(c.value,"membership_approval_mode",l);if(!q.success)return q;var r=d("WASmaxParseUtils").optionalChild(c.value,"breakout");if(!r.success)return r;var s=d("WASmaxParseUtils").optionalChildWithTag(c.value,"linked_parent",m);if(!s.success)return s;var t=d("WASmaxParseUtils").optionalChild(c.value,"hidden_group");if(!t.success)return t;var u=d("WASmaxParseUtils").optionalChild(c.value,"allow_non_admin_sub_group_creation");if(!u.success)return u;var v=d("WASmaxParseUtils").optionalChild(c.value,"group_history");if(!v.success)return v;var w=d("WASmaxParseUtils").optionalChild(c.value,"capi");if(!w.success)return w;var x=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","g.us");if(!x.success)return x;var y=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!y.success)return y;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!a.success)return a;b=d("WASmaxParseUtils").attrString(c.value,"id");if(!b.success)return b;a=d("WASmaxParseJid").attrUserJid(c.value,"creator");if(!a.success)return a;var z=d("WASmaxParseUtils").attrIntRange(c.value,"creation",0,void 0);if(!z.success)return z;var A=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,c.value,"s_t",0,void 0);if(!A.success)return A;var B=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,c.value,"s_o");if(!B.success)return B;var C=d("WASmaxInGroupsDedupAttrsMixin").parseDedupAttrsMixin(c.value),D=d("WASmaxInGroupsGroupMemberAddModeMixin").parseGroupMemberAddModeMixin(c.value),E=d("WASmaxInGroupsGroupAddressingModeMixin").parseGroupAddressingModeMixin(c.value),F=d("WASmaxInGroupsNamedSubjectOrUnnamedSubjectFallbackMixinGroup").parseNamedSubjectOrUnnamedSubjectFallbackMixinGroup(c.value);if(!F.success)return F;c=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"participant",1,1024,h);return!c.success?c:d("WAResultOrError").makeResult({from:x.value,type:y.value,groupId:b.value,groupCreator:a.value,groupCreation:z.value,groupST:A.value,groupSO:B.value,groupDedupAttrsMixin:C.success?C.value:null,groupGroupMemberAddModeMixin:D.success?D.value:null,groupGroupAddressingModeMixin:E.success?E.value:null,groupNamedSubjectOrUnnamedSubjectFallbackMixinGroup:F.value,groupDescription:e.value,hasGroupLocked:f.value!=null,hasGroupAnnouncement:g.value!=null,groupParent:n.value,hasGroupNoFrequentlyForwarded:o.value!=null,groupEphemeral:p.value,groupMembershipApprovalMode:q.value,hasGroupBreakout:r.value!=null,groupLinkedParent:s.value,hasGroupHiddenGroup:t.value!=null,hasGroupAllowNonAdminSubGroupCreation:u.value!=null,hasGroupGroupHistory:v.value!=null,hasGroupCapi:w.value!=null,groupParticipant:c.value})}g.parseCreateResponseSuccessGroupParticipant=h;g.parseCreateResponseSuccessGroupDescription=i;g.parseCreateResponseSuccessGroupParent=j;g.parseCreateResponseSuccessGroupEphemeral=k;g.parseCreateResponseSuccessGroupMembershipApprovalMode=l;g.parseCreateResponseSuccessGroupLinkedParent=m;g.parseCreateResponseSuccess=a}),98);
__d("WASmaxOutGroupsBaseSetServerMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutGroupsBaseIQSetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxOutGroupsBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").G_US,xmlns:"w:g2"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseSetServerMixin=a}),98);
__d("WASmaxOutGroupsDedupAttrsMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.anyKey;a=a.anyCreateCtx;b=d("WASmaxJsx").smax("smax$any",{key:d("WAWap").CUSTOM_STRING(b),create_ctx:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeDedupAttrsMixin=a}),98);
__d("WASmaxOutGroupsAdminAddModeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("member_add_mode",null,"admin_add");return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAdminAddModeMixin=a}),98);
__d("WASmaxOutGroupsAllMembersAddModeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("member_add_mode",null,"all_member_add");return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAllMembersAddModeMixin=a}),98);
__d("WASmaxOutGroupsUnknownAddModeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.memberAddModeElementValue;a=d("WASmaxJsx").smax("member_add_mode",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeUnknownAddModeMixin=a}),98);
__d("WASmaxOutGroupsAdminOrAllMembersOrUnknownAddModeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutGroupsAdminAddModeMixin","WASmaxOutGroupsAllMembersAddModeMixin","WASmaxOutGroupsUnknownAddModeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isAdminAddMode)return d("WASmaxOutGroupsAdminAddModeMixin").mergeAdminAddModeMixin(a);if(b.isAllMembersAddMode)return d("WASmaxOutGroupsAllMembersAddModeMixin").mergeAllMembersAddModeMixin(a);if(b.unknownAddMode)return d("WASmaxOutGroupsUnknownAddModeMixin").mergeUnknownAddModeMixin(a,b.unknownAddMode);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeAdminOrAllMembersOrUnknownAddModeMixinGroup=a}),98);
__d("WASmaxOutGroupsGroupMemberAddModeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutGroupsAdminOrAllMembersOrUnknownAddModeMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.adminOrAllMembersOrUnknownAddModeMixinGroupArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutGroupsAdminOrAllMembersOrUnknownAddModeMixinGroup").mergeAdminOrAllMembersOrUnknownAddModeMixinGroup(d("WASmaxJsx").smax("member_add_mode",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeGroupMemberAddModeMixin=a}),98);
__d("WASmaxOutGroupsGroupJoinMembershipApprovalModeDisabledMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("group_join",{state:"off"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeGroupJoinMembershipApprovalModeDisabledMixin=a}),98);
__d("WASmaxOutGroupsGroupJoinMembershipApprovalModeEnabledMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("group_join",{state:"on"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeGroupJoinMembershipApprovalModeEnabledMixin=a}),98);
__d("WASmaxOutGroupsGroupJoinMembershipApprovalModeEnabledOrDisabledMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutGroupsGroupJoinMembershipApprovalModeDisabledMixin","WASmaxOutGroupsGroupJoinMembershipApprovalModeEnabledMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isGroupJoinMembershipApprovalModeEnabled)return d("WASmaxOutGroupsGroupJoinMembershipApprovalModeEnabledMixin").mergeGroupJoinMembershipApprovalModeEnabledMixin(a);if(b.isGroupJoinMembershipApprovalModeDisabled)return d("WASmaxOutGroupsGroupJoinMembershipApprovalModeDisabledMixin").mergeGroupJoinMembershipApprovalModeDisabledMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeGroupJoinMembershipApprovalModeEnabledOrDisabledMixinGroup=a}),98);
__d("WASmaxOutGroupsMembershipApprovalGroupJoinModeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutGroupsGroupJoinMembershipApprovalModeEnabledOrDisabledMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.groupJoinMembershipApprovalModeEnabledOrDisabledMixinGroupArgs;a=d("WASmaxJsx").smax("membership_approval_mode",null,d("WASmaxOutGroupsGroupJoinMembershipApprovalModeEnabledOrDisabledMixinGroup").mergeGroupJoinMembershipApprovalModeEnabledOrDisabledMixinGroup(d("WASmaxJsx").smax("group_join",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeMembershipApprovalGroupJoinModeMixin=a}),98);
__d("WASmaxOutGroupsNamedSubjectMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anySubject;a=d("WASmaxJsx").smax("smax$any",{subject:d("WAWap").CUSTOM_STRING(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNamedSubjectMixin=a}),98);
__d("WASmaxOutGroupsUnnamedSubjectFallbackMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anySubject;a=d("WASmaxJsx").smax("smax$any",{subject:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeUnnamedSubjectFallbackMixin=a}),98);
__d("WASmaxOutGroupsNamedSubjectOrUnnamedSubjectFallbackMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutGroupsNamedSubjectMixin","WASmaxOutGroupsUnnamedSubjectFallbackMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.namedSubject)return d("WASmaxOutGroupsNamedSubjectMixin").mergeNamedSubjectMixin(a,b.namedSubject);if(b.unnamedSubjectFallback)return d("WASmaxOutGroupsUnnamedSubjectFallbackMixin").mergeUnnamedSubjectFallbackMixin(a,b.unnamedSubjectFallback);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeNamedSubjectOrUnnamedSubjectFallbackMixinGroup=a}),98);
__d("WASmaxOutGroupsParentGroupDefaultMembershipApprovalModeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("parent",{default_membership_approval_mode:"request_required"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeParentGroupDefaultMembershipApprovalModeMixin=a}),98);
__d("WASmaxOutGroupsCreateRequest",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutGroupsBaseSetServerMixin","WASmaxOutGroupsDedupAttrsMixin","WASmaxOutGroupsGroupMemberAddModeMixin","WASmaxOutGroupsMembershipApprovalGroupJoinModeMixin","WASmaxOutGroupsNamedSubjectOrUnnamedSubjectFallbackMixinGroup","WASmaxOutGroupsParentGroupDefaultMembershipApprovalModeMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.participantJid;a=d("WASmaxJsx").smax("participant",{jid:d("WAWap").USER_JID(a)});return a}function i(a){var b=a.descriptionId;a=a.bodyElementValue;b=d("WASmaxJsx").smax("description",{id:d("WAWap").CUSTOM_STRING(b)},d("WASmaxJsx").smax("body",null,a));return b}function j(){var a=d("WASmaxJsx").smax("locked",null);return a}function k(){var a=d("WASmaxJsx").smax("announcement",null);return a}function l(a){a=a.hasParentGroupDefaultMembershipApprovalMode;a=d("WASmaxMixins").optionalMerge(d("WASmaxOutGroupsParentGroupDefaultMembershipApprovalModeMixin").mergeParentGroupDefaultMembershipApprovalModeMixin,d("WASmaxJsx").smax("parent",null),a);return a}function m(){var a=d("WASmaxJsx").smax("no_frequently_forwarded",null);return a}function n(a){var b=a.ephemeralExpiration;a=a.ephemeralTrigger;b=d("WASmaxJsx").smax("ephemeral",{expiration:d("WAWap").INT(b),trigger:d("WASmaxAttrs").OPTIONAL(d("WAWap").INT,a)});return b}function o(a){a=d("WASmaxOutGroupsMembershipApprovalGroupJoinModeMixin").mergeMembershipApprovalGroupJoinModeMixin(d("WASmaxJsx").smax("membership_approval_mode",null),a);return a}function p(){var a=d("WASmaxJsx").smax("breakout",null);return a}function q(){var a=d("WASmaxJsx").smax("created_as_lid",null);return a}function r(a){a=a.linkedParentJid;a=d("WASmaxJsx").smax("linked_parent",{jid:d("WAWap").GROUP_JID(a)});return a}function s(){var a=d("WASmaxJsx").smax("hidden_group",null);return a}function t(){var a=d("WASmaxJsx").smax("allow_non_admin_sub_group_creation",null);return a}function u(){var a=d("WASmaxJsx").smax("create_general_chat",null);return a}function v(){var a=d("WASmaxJsx").smax("capi",null);return a}function a(a){var b,c=a.participantArgs,e=a.descriptionArgs,f=a.hasLocked,g=a.hasAnnouncement,w=a.parentArgs,x=a.hasNoFrequentlyForwarded,y=a.ephemeralArgs,z=a.membershipApprovalModeArgs,A=a.hasBreakout,B=a.hasCreatedAsLid,C=a.linkedParentArgs,D=a.hasHiddenGroup,E=a.hasAllowNonAdminSubGroupCreation,F=a.hasCreateGeneralChat,G=a.hasCapi,H=a.dedupAttrsMixinArgs,I=a.groupMemberAddModeMixinArgs;a=a.namedSubjectOrUnnamedSubjectFallbackMixinGroupArgs;c=d("WASmaxOutGroupsBaseSetServerMixin").mergeBaseSetServerMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxOutGroupsNamedSubjectOrUnnamedSubjectFallbackMixinGroup").mergeNamedSubjectOrUnnamedSubjectFallbackMixinGroup(d("WASmaxMixins").optionalMerge(d("WASmaxOutGroupsGroupMemberAddModeMixin").mergeGroupMemberAddModeMixin,d("WASmaxMixins").optionalMerge(d("WASmaxOutGroupsDedupAttrsMixin").mergeDedupAttrsMixin,d("WASmaxJsx").smax("create",null,[].concat((b=d("WASmaxChildren")).REPEATED_CHILD(h,c,0,19999),[b.OPTIONAL_CHILD(i,e),b.HAS_OPTIONAL_CHILD(j,f),b.HAS_OPTIONAL_CHILD(k,g),b.OPTIONAL_CHILD(l,w),b.HAS_OPTIONAL_CHILD(m,x),b.OPTIONAL_CHILD(n,y),b.OPTIONAL_CHILD(o,z),b.HAS_OPTIONAL_CHILD(p,A),b.HAS_OPTIONAL_CHILD(q,B),b.OPTIONAL_CHILD(r,C),b.HAS_OPTIONAL_CHILD(s,D),b.HAS_OPTIONAL_CHILD(t,E),b.HAS_OPTIONAL_CHILD(u,F),b.HAS_OPTIONAL_CHILD(v,G)])),H),I),a)));return c}g.makeCreateRequestCreateParticipant=h;g.makeCreateRequestCreateDescription=i;g.makeCreateRequestCreateLocked=j;g.makeCreateRequestCreateAnnouncement=k;g.makeCreateRequestCreateParent=l;g.makeCreateRequestCreateNoFrequentlyForwarded=m;g.makeCreateRequestCreateEphemeral=n;g.makeCreateRequestCreateMembershipApprovalMode=o;g.makeCreateRequestCreateBreakout=p;g.makeCreateRequestCreateCreatedAsLid=q;g.makeCreateRequestCreateLinkedParent=r;g.makeCreateRequestCreateHiddenGroup=s;g.makeCreateRequestCreateAllowNonAdminSubGroupCreation=t;g.makeCreateRequestCreateCreateGeneralChat=u;g.makeCreateRequestCreateCapi=v;g.makeCreateRequest=a}),98);
__d("WASmaxGroupsCreateRPC",["WAComms","WASmaxInGroupsCreateResponseClientError","WASmaxInGroupsCreateResponseGroupAlreadyExists","WASmaxInGroupsCreateResponseServerError","WASmaxInGroupsCreateResponseSuccess","WASmaxOutGroupsCreateRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:e=d("WASmaxOutGroupsCreateRequest").makeCreateRequest(a);k.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=k.sent;g=d("WASmaxInGroupsCreateResponseSuccess").parseCreateResponseSuccess(f,e);if(!g.success){k.next=7;break}return k.abrupt("return",{name:"CreateResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsCreateResponseGroupAlreadyExists").parseCreateResponseGroupAlreadyExists(f,e);if(!h.success){k.next=10;break}return k.abrupt("return",{name:"CreateResponseGroupAlreadyExists",value:h.value});case 10:i=d("WASmaxInGroupsCreateResponseClientError").parseCreateResponseClientError(f,e);if(!i.success){k.next=13;break}return k.abrupt("return",{name:"CreateResponseClientError",value:i.value});case 13:j=d("WASmaxInGroupsCreateResponseServerError").parseCreateResponseServerError(f,e);if(!j.success){k.next=16;break}return k.abrupt("return",{name:"CreateResponseServerError",value:j.value});case 16:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Create",{Success:g,GroupAlreadyExists:h,ClientError:i,ServerError:j}));case 17:case"end":return k.stop()}},null,this)}g.sendCreateRPC=a}),98);
__d("MAWCreateGroupStep",["MAWConvertCreateGroupResultApi","MAWCreateGroupInvitesStep","MAWSendSenderKeyDistributionMsg","WAAPI","WACreateGroup","WAGlobals","WAGroupInviteUtils","WAJids","WALogger","WAPREList","WAPREMetrics","WAResultOrError","WASmaxGroupsCreateRPC","WATimeUtils","WAWaitForUserUnblocked","asyncToGeneratorRuntime","err","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Group] Received non-supported response from WA Serevr"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Group] Received non-supported response from WA Serevr"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to get devices for group creation: ",""]);j=function(){return a};return a}function a(a,b,c,d){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.CREATE_GROUP,{"int":{users:e.length}});e=e.map(function(a){return d("WAJids").toMsgrUserJid(a)});b=(yield l(a,b,e,g,f==null?void 0:f.deduplicationKey));g.addPoint("finish_send_create_group_stanza");if(!b.success)return b;var h=b.value.group;g.addPoint("start_create_group");yield d("WACreateGroup").createGroups([{extras:f,folder:null,groupStatus:"added",groupToCreate:h,key:a,serverTs:d("WATimeUtils").unixTime()}]);g.addPoint("finish_create_group");c("promiseDone")(d("WAWaitForUserUnblocked").waitForUserUnblocked().then(function(){return d("MAWSendSenderKeyDistributionMsg").maybePreEstablishSessionsAndSendSenderKeyDistributionMsg(h.jid,h.participants.map(function(a){return a.success?a.value.user:null}).filter(Boolean))}));e=h.participants.map(function(a){return a.success?a.value.user:void 0}).filter(Boolean);c("WAAPI").getDevices({ignoreDhash:!1,reason:"create-group",users:new Set(e)})["catch"](function(a){d("WALogger").ERROR(j(),a)});g.addPoint("persist_get_devices_create_group");yield d("MAWCreateGroupInvitesStep").createGroupInvitesStep(h.jid,(b=h.creator)!=null?b:d("WAGlobals").getMyUserJid(),h.participants.map(function(a){return!a.success&&a.error.errorCode===403?{expiration:a.error.expiration,inviteCode:a.error.code,user:a.error.user}:void 0}).filter(Boolean));g.addPoint("finish_create_group_invites_step");f=(yield d("MAWConvertCreateGroupResultApi").convertCreateGroupResult(h));g.endSuccess();return d("WAResultOrError").makeResult(f)});return k.apply(this,arguments)}function l(a,b,c,d,e){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){f.addPoint("smax_request_start");a={dedupAttrsMixinArgs:g!=null?{anyKey:g}:null,descriptionArgs:null,ephemeralArgs:null,groupMemberAddModeMixinArgs:{adminOrAllMembersOrUnknownAddModeMixinGroupArgs:{isAllMembersAddMode:!0}},hasAllowNonAdminSubGroupCreation:!1,hasAnnouncement:!1,hasBreakout:!1,hasCapi:!1,hasCreatedAsLid:!1,hasCreateGeneralChat:!1,hasHiddenGroup:!1,hasLocked:!1,hasNoFrequentlyForwarded:!1,membershipApprovalModeArgs:null,namedSubjectOrUnnamedSubjectFallbackMixinGroupArgs:b!=null?{namedSubject:{anySubject:b}}:{unnamedSubjectFallback:{anySubject:null}},parentArgs:null,participantArgs:e.map(function(a){return{participantJid:a}})};g=(yield d("WASmaxGroupsCreateRPC").sendCreateRPC(a));f.addPoint("smax_request_end");switch(g.name){case"CreateResponseSuccess":e=g.value;a=d("WAJids").validateGroupJid(e.groupId+"@"+e.from);if(a==null){d("WALogger").ERROR(i());throw c("err")("[Group] Received non-supported response from WA Serevr")}return d("WAResultOrError").makeResult({group:{creationTs:d("WATimeUtils").castToUnixTime(e.groupCreation),creator:e.groupCreator,jid:a,memberAddMode:((a=e.groupGroupMemberAddModeMixin)==null?void 0:a.memberAddModeAdminOrAllMembersOrUnknownAddModeMixinGroup.name)==="AllMembersAddMode"?"all_member_add":"admin_add",participants:e.groupParticipant.map(function(a){a=a.createParticipantAddedOrNonRegisteredWaUserParticipantErrorLidResponseMixinGroup;if(a.name!=="CreateParticipantAddedResponse"){d("WALogger").ERROR(h());throw c("err")("[Group] Received non-supported response from WA Serevr")}a.name;a=a.value;switch(a.createParticipantMixins.name){case"CreateParticipantAdded":var b;return d("WAResultOrError").makeResult({addressable:((b=a.createParticipantMixins.value.participantNotAddressableMixin)==null?void 0:b.addressable)==="false"?!1:!0,type:(b=a.createParticipantMixins.value.type)!=null?b:"participant",user:a.jid});case"ParticipantNotAuthorized":return d("WAResultOrError").makeError({errorCode:401,text:"not-authorized",user:a.jid});case"ParticipantRequestCodeCanBeSent":b=a.createParticipantMixins.value;return d("WAResultOrError").makeError({code:d("WAGroupInviteUtils").toInviteCode(b.addRequestCode),errorCode:403,expiration:d("WATimeUtils").castToUnixTime(b.addRequestExpiration),text:"request-code",user:a.jid});case"ParticipantHasInvalidPN":return d("WAResultOrError").makeError({errorCode:404,text:"not-found",user:a.jid});case"ParticipantResourceConstraint":return d("WAResultOrError").makeError({errorCode:500,text:"resource-constraint",user:a.jid});case"ParticipantNotAcceptable":return d("WAResultOrError").makeError({errorCode:406,text:"enterprise-not-allowed",user:a.jid});case"ParticipantResourceLimit":case"ParticipantTemporarilyBlockedFromDefaultSubGroup":case"ParticipantRequestCodeCannotBeCreatedForLegalConcerns":return d("WAResultOrError").makeError({errorCode:-1,text:"unknown",user:a.jid});default:a.createParticipantMixins.name;return d("WAResultOrError").makeError({errorCode:-1,text:"unknown",user:a.jid})}}),subject:{content:b,ts:d("WATimeUtils").castToUnixTime(e.groupCreation),user:e.groupCreator}},type:"default"});default:g.name;f.endFail("fail_send_create_group_stanza",{string:{reason:g.name}});return d("WAResultOrError").makeError(g.name)}});return m.apply(this,arguments)}g.createGroupStep=a}),98);
__d("MAWCreateGroup",["MAWCreateGroupStep","MAWJobManager"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("createGroup",function(a){var b=a.extras,c=a.key,e=a.subject;a=a.users;return d("MAWCreateGroupStep").createGroupStep(c,e,a,b)}).end();g.createGroup=a}),98);
__d("MAWDbAppDataTxns",["MAWAckLevel","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateAppDataSystemAck on sent appData"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateAppDataSystemAck on non existing appData"]);i=function(){return a};return a}function a(a,b,c){return a.appData.get({externalId:b}).then(function(b){if(!b){d("WALogger").LOG(i());return null}if(b.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(h());return b}var e=babelHelpers["extends"]({},b,{ack:c});return a.appData.put(e).then(function(){return e})})}function b(a,b){return a.appData.bulkGet(b)}g.updateAppDataSystemAck=a;g.bulkGetAppData=b}),98);
__d("MAWDeleteExpiredMsgsApi",["MAWDbMsg","MAWDbReactionsTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWTransactionMode","WAArmadilloXMA.pb","WALogger","WASortedLists","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," XMA rows"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," media rows, "," chunk rows."]);i=function(){return a};return a}function j(a,b){return a.media.bulkGet(b.map(function(a){return a[0]})).then(function(c){var e=[],f=[];c.forEach(function(a,c){if(a!=null){var g=b[c][1];a.msgIds=d("WASortedLists").filter(a.msgIds,function(a){return a!==g});a.mediaEntries["delete"](g);a.msgIds.length===0&&a.mediaEntries.size===0&&(a.hashedPlaintextHash!=null&&e.push(a.hashedPlaintextHash),f.push(a.mediaId))}});c=a.media.bulkDelete(f);var g=e.length>0?a.chunk.where("hashedPlaintextHash").anyOf(e)["delete"]():d("MAWDexieTable").dexieResolve(),h=f.length>0?a.mediaBackup.where("mediaId").anyOf(f)["delete"]():d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([c,g,h]).then(function(){d("WALogger").LOG(i(),f.length,e.length)})})}function k(a,b){var c=[],e=b.map(function(b){return d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,b[0])});return d("MAWDexieTable").dexieAll(e).then(function(e){e.forEach(function(a,d){if(a!=null){var e=b[d][1];a.faviconMediaId!=null&&c.push([a.faviconMediaId,e]);a.headerMediaId!=null&&c.push([a.headerMediaId,e]);if(a.previewMediaIds!=null){(d=a.previewMediaIds)==null?void 0:d.forEach(function(a){c.push([a,e])})}}});e=a.xma.bulkDelete(e.filter(Boolean).map(function(a){a=a.xmaId;return a}));var f=j(a,c);return d("MAWDexieTable").dexieAll([f,e]).then(function(){d("WALogger").LOG(h(),b.length)})})}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READWRITE,media:a.READWRITE,mediaBackup:a.READWRITE,messages:a.READWRITE,reactions:a.READWRITE,xma:a.READWRITE},"deleteExpiredMsgs",function(a){return function(){var b=d("WATimeUtils").unixTime();return a.messages.where("messageDeleteTs").belowOrEqual(b).toArray().then(function(b){var c=[],e=[],f=[],g=[],h=[],i=[];b.forEach(function(a){a.mediaId!=null&&c.push([a.mediaId,a.msgId]);if(d("MAWDbMsg").isXMAMsg(a)){var b=d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.externalId);b!=null&&i.push([b,a.msgId])}if(a.quote!=null&&a.quote.content.xmaMessageType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY){b=d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.quote.content.externalId);b!=null&&i.push([b,a.msgId])}e.push(a.msgId);f.push(d("MAWDbMsg").getWAMsgId(a));g.push({author:a.author,chatJid:a.threadJid,externalId:a.externalId});h.push(a.rowId)});b=a.messages.bulkDelete(h);var l=j(a,c),m=k(a,i),n=d("MAWDbReactionsTxns").deleteReactionsByUniqueMsgIdentifiers(a,g);return d("MAWDexieTable").dexieAll([b,n,l,m]).then(function(){return d("MAWDexieTable").dexieResolve(f)})})}});g.deleteOrUpdateMediaAndChunkForExpiredMsgs=j;g.deleteOrUpdateXMAForExpiredMsgs=k;g.deleteExpiredMsgs=b}),98);
__d("MAWDeleteMsgsForMe",["MAWJobDefinitions","MAWJobManager","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["deleteMsgsForMe: ",""]);h=function(){return a};return a}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(a){a=a.msgIds;d("WALogger").DEV(h(),a);a=a.map(function(a){return{protocolMsgId:a,type:"delete_for_me"}});a=a.map(function(a){return{messageAction:a}});a={actions:a,type:"meta_sync"};return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendAppData({contents:a})).then(function(){return void 0})}).end();g.deleteMsgsForMe=a}),98);
__d("MAWGetThreadInfoForDeletionApi",["MAWDbMsgTxns","MAWIndexedDb","MAWTransactionMode","WALogger","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getThreadInfoForDeletion",function(a){return function(b){return a.threads.get({jid:b}).then(function(b){if(b==null){var e="Thread was null when getting thread for deletion";d("WALogger").ERROR(h(),e);throw c("err")(e)}return d("MAWDbMsgTxns").getThreadNewestMessageTs(a,b).then(function(a){return{chatJid:b.jid,newestMsgTs:(a=d("WATimeUtils").castMillisTimeToUnixTime(a))!=null?a:void 0}})})}});g.getThreadInfoForDeletion=a}),98);
__d("MAWDeleteThread",["MAWGetThreadInfoForDeletionApi","MAWJobDefinitions","MAWJobManager","WALogger","WAPREList","WAPREMetrics","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Delete Secure thread Job failed ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Delete Secure thread Job Successful"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Starting Delete Secure thread Job"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["deleteThread job: ",""]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["deleteThread"]);a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.chatJid;d("WALogger").DEV(k(),a);l.LOG(j());var b=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.DELETE_THREAD,void 0);a=(yield d("MAWGetThreadInfoForDeletionApi").getThreadInfoForDeletion(a));var c=a.newestMsgTs!=null?d("WATimeUtils").futureUnixTime(1,a.newestMsgTs):void 0;a={chatJid:a.chatJid,messageRange:{lastMessageTimestamp:c,messages:[]},type:"chat_delete"};c={actions:[{chatAction:a}],type:"meta_sync"};return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendAppData({contents:c})).then(function(){l.LOG(i()),b.endSuccess()})["catch"](function(a){l.ERROR(h(),JSON.stringify(a)),b.endFail("delete_thread_failed")})});return function(b){return a.apply(this,arguments)}}()).end();g.deleteThread=a}),98);
__d("MAWDeletedMsgApi",["MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({deletedMessages:d("MAWTransactionMode").READONLY},"getDeletedMsgByProtocolIdApi",function(a){return function(b){return a.deletedMessages.get(babelHelpers["extends"]({},b))}});g.getDeletedMsgByProtocolIdApi=a}),98);
__d("WASmaxInGroupsIQErrorBlockedIntegrityEnforcementMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","blocked-integrity-enforcement");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",486);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBlockedIntegrityEnforcementMixin=a}),98);
__d("WASmaxInGroupsPromoteDemoteClientErrors",["WAResultOrError","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorBlockedIntegrityEnforcementMixin","WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxInGroupsIQErrorForbiddenMixin","WASmaxInGroupsIQErrorItemNotFoundMixin","WASmaxInGroupsIQErrorLockedMixin","WASmaxInGroupsIQErrorNotAuthorizedMixin","WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:b.value});var c=d("WASmaxInGroupsIQErrorBlockedIntegrityEnforcementMixin").parseIQErrorBlockedIntegrityEnforcementMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorBlockedIntegrityEnforcement",value:c.value});var e=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:e.value});var f=d("WASmaxInGroupsIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:f.value});var g=d("WASmaxInGroupsIQErrorNotAuthorizedMixin").parseIQErrorNotAuthorizedMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAuthorized",value:g.value});var h=d("WASmaxInGroupsIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:h.value});var i=d("WASmaxInGroupsIQErrorLockedMixin").parseIQErrorLockedMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"IQErrorLocked",value:i.value});var j=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return j.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:j.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorRateOverlimit","IQErrorBlockedIntegrityEnforcement","IQErrorBadRequest","IQErrorItemNotFound","IQErrorNotAuthorized","IQErrorForbidden","IQErrorLocked","IQErrorFallbackClient"],[b,c,e,f,g,h,i,j])}g.parsePromoteDemoteClientErrors=a}),98);
__d("WASmaxInGroupsPromoteDemoteResponseClientError",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsPromoteDemoteClientErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsPromoteDemoteClientErrors").parsePromoteDemoteClientErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorPromoteDemoteClientErrors:b.value}))}g.parsePromoteDemoteResponseClientError=a}),98);
__d("WASmaxInGroupsPromoteDemoteResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parsePromoteDemoteResponseServerError=a}),98);
__d("WASmaxInGroupsIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInGroupsPromoteDemoteResponseSuccessDemote",["WAResultOrError","WASmaxInGroupsEnums","WASmaxInGroupsGroupAddressingModeMixin","WASmaxInGroupsIQResultResponseMixin","WASmaxInGroupsPhoneNumberMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,a,"error",d("WASmaxInGroupsEnums").ENUM_404_406);if(!c.success)return c;a=d("WASmaxInGroupsPhoneNumberMixin").parsePhoneNumberMixin(a);return d("WAResultOrError").makeResult({jid:b.value,error:c.value,phoneNumberMixin:a.success?a.value:null})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"demote");if(!c.success)return c;b=d("WASmaxInGroupsIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!b.success)return b;a=d("WASmaxInGroupsGroupAddressingModeMixin").parseGroupAddressingModeMixin(a);c=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"participant",0,1024,h);return!c.success?c:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{groupAddressingModeMixin:a.success?a.value:null,demoteParticipant:c.value}))}g.parsePromoteDemoteResponseSuccessDemoteDemoteParticipant=h;g.parsePromoteDemoteResponseSuccessDemote=a}),98);
__d("WASmaxInGroupsPromoteDemoteResponseSuccessPromote",["WAResultOrError","WASmaxInGroupsEnums","WASmaxInGroupsGroupAddressingModeMixin","WASmaxInGroupsIQResultResponseMixin","WASmaxInGroupsPhoneNumberMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;var c=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,a,"type","admin");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,a,"error",d("WASmaxInGroupsEnums").ENUM_404_419);if(!e.success)return e;a=d("WASmaxInGroupsPhoneNumberMixin").parsePhoneNumberMixin(a);return d("WAResultOrError").makeResult({jid:b.value,type:c.value,error:e.value,phoneNumberMixin:a.success?a.value:null})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"promote");if(!c.success)return c;b=d("WASmaxInGroupsIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!b.success)return b;a=d("WASmaxInGroupsGroupAddressingModeMixin").parseGroupAddressingModeMixin(a);c=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"participant",0,1024,h);return!c.success?c:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{groupAddressingModeMixin:a.success?a.value:null,promoteParticipant:c.value}))}g.parsePromoteDemoteResponseSuccessPromotePromoteParticipant=h;g.parsePromoteDemoteResponseSuccessPromote=a}),98);
__d("WASmaxOutGroupsPromoteDemoteRequest",["WASmaxChildren","WASmaxJsx","WASmaxOutGroupsBaseSetGroupMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.participantJid;a=d("WASmaxJsx").smax("participant",{jid:d("WAWap").USER_JID(a)});return a}function i(a){a=a.participantArgs;a=d("WASmaxJsx").smax("promote",null,d("WASmaxChildren").REPEATED_CHILD(h,a,0,1024));return a}function j(a){a=a.participantJid;a=d("WASmaxJsx").smax("participant",{jid:d("WAWap").USER_JID(a)});return a}function k(a){a=a.participantArgs;a=d("WASmaxJsx").smax("demote",null,d("WASmaxChildren").REPEATED_CHILD(j,a,0,1024));return a}function a(a){var b=a.promoteArgs,c=a.demoteArgs;b=d("WASmaxOutGroupsBaseSetGroupMixin").mergeBaseSetGroupMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxChildren").OPTIONAL_CHILD(i,b),d("WASmaxChildren").OPTIONAL_CHILD(k,c)),a);return b}g.makePromoteDemoteRequestPromoteParticipant=h;g.makePromoteDemoteRequestPromote=i;g.makePromoteDemoteRequestDemoteParticipant=j;g.makePromoteDemoteRequestDemote=k;g.makePromoteDemoteRequest=a}),98);
__d("WASmaxGroupsPromoteDemoteRPC",["WAComms","WASmaxInGroupsPromoteDemoteResponseClientError","WASmaxInGroupsPromoteDemoteResponseServerError","WASmaxInGroupsPromoteDemoteResponseSuccessDemote","WASmaxInGroupsPromoteDemoteResponseSuccessPromote","WASmaxOutGroupsPromoteDemoteRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:e=d("WASmaxOutGroupsPromoteDemoteRequest").makePromoteDemoteRequest(a);k.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=k.sent;g=d("WASmaxInGroupsPromoteDemoteResponseSuccessPromote").parsePromoteDemoteResponseSuccessPromote(f,e);if(!g.success){k.next=7;break}return k.abrupt("return",{name:"PromoteDemoteResponseSuccessPromote",value:g.value});case 7:h=d("WASmaxInGroupsPromoteDemoteResponseSuccessDemote").parsePromoteDemoteResponseSuccessDemote(f,e);if(!h.success){k.next=10;break}return k.abrupt("return",{name:"PromoteDemoteResponseSuccessDemote",value:h.value});case 10:i=d("WASmaxInGroupsPromoteDemoteResponseClientError").parsePromoteDemoteResponseClientError(f,e);if(!i.success){k.next=13;break}return k.abrupt("return",{name:"PromoteDemoteResponseClientError",value:i.value});case 13:j=d("WASmaxInGroupsPromoteDemoteResponseServerError").parsePromoteDemoteResponseServerError(f,e);if(!j.success){k.next=16;break}return k.abrupt("return",{name:"PromoteDemoteResponseServerError",value:j.value});case 16:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("PromoteDemote",{SuccessPromote:g,SuccessDemote:h,ClientError:i,ServerError:j}));case 17:case"end":return k.stop()}},null,this)}g.sendPromoteDemoteRPC=a}),98);
__d("WAPromoteDemoteGroupParticipantProtocol",["WAErr","WALogger","WAResultOrError","WASmaxGroupsPromoteDemoteRPC","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["error sending promote group participants iq: ",", ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["error sending promote group participants iq: ",", ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Demoting participants, but got promotion response"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Promoting participants, but got demotion response"]);k=function(){return a};return a}function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.group;a=a.participants;b=(yield n({group:b,demoteArgs:null,promoteArgs:{participantArgs:a.map(function(a){return{participantJid:a}})}}));if(!b.success)return b;if(b.value.type==="promote")return d("WAResultOrError").makeResult(b.value);d("WALogger").ERROR(k());throw c("WAErr")("Promoting participants, but got demotion response")});return l.apply(this,arguments)}function e(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.group;a=a.participants;b=(yield n({group:b,promoteArgs:null,demoteArgs:{participantArgs:a.map(function(a){return{participantJid:a}})}}));if(!b.success)return b;if(b.value.type==="demote")return d("WAResultOrError").makeResult(b.value);d("WALogger").ERROR(j());throw c("WAErr")("Demoting participants, but got promotion response")});return m.apply(this,arguments)}function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.group,c=a.promoteArgs;a=a.demoteArgs;c=(yield d("WASmaxGroupsPromoteDemoteRPC").sendPromoteDemoteRPC({promoteArgs:c,demoteArgs:a,iqTo:b}));switch(c.name){case"PromoteDemoteResponseSuccessPromote":a=c.value.promoteParticipant.map(function(a){var b=a.error;return{user:a.jid,result:b==null?d("WAResultOrError").makeResult():d("WAResultOrError").makeError(b)}});return d("WAResultOrError").makeResult({type:"promote",participants:a});case"PromoteDemoteResponseSuccessDemote":b=c.value.demoteParticipant.map(function(a){var b=a.error;return{user:a.jid,result:b==null?d("WAResultOrError").makeResult():d("WAResultOrError").makeError(b)}});return d("WAResultOrError").makeResult({type:"demote",participants:b});case"PromoteDemoteResponseClientError":a=c.value.errorPromoteDemoteClientErrors.value;b=a.code;a=a.text;d("WALogger").WARN(i(),b,a);return d("WAResultOrError").makeError({type:"client-error",code:b});default:c.name;a=c.value.errorServerErrors.value;b=a.code;c=a.text;d("WALogger").WARN(h(),b,c);return d("WAResultOrError").makeError({type:"server-error",code:b})}});return o.apply(this,arguments)}g.promoteGroupParticipantsProtocol=a;g.demoteGroupParticipantsProtocol=e}),98);
__d("MAWDemoteGroupParticipants",["MAWChangeGroupParticipantAdminStatusApi","MAWJobManager","MAWODSProxy","WAJids","WAOdsEnums","WAPromoteDemoteGroupParticipantProtocol","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("demoteGroupParticipants",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.group;a=a.users;a=a.map(function(a){return d("WAJids").toMsgrUserJid(a)});if(a.length===0)return d("WAResultOrError").makeResult({groupJid:b,participants:[],type:"default"});a=(yield d("WAPromoteDemoteGroupParticipantProtocol").demoteGroupParticipantsProtocol({group:b,participants:a}));if(!a.success){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_DEMOTE_PARTICIPANT,key:"fail"});return d("WAResultOrError").makeError(a.error.type)}d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_DEMOTE_PARTICIPANT,key:"success"});a=a.value.participants.filter(function(a){a=a.result;return a.success}).map(function(a){a=a.user;return{addressable:!1,type:"participant",user:a}})||[];yield d("MAWChangeGroupParticipantAdminStatusApi").changeGroupParticipantAdminStatus(null,b,d("WAJids").AUTHOR_ME,a,"participant");return d("WAResultOrError").makeResult({groupJid:b,participants:a,type:"default"})});return function(b){return a.apply(this,arguments)}}()).end();g.demoteGroupParticipants=a}),98);
__d("MAWGetMostRescentDecodedMediaEntry",["MAWDbMediaTxns","MAWIndexedDb","MAWTransactionMode","WAHashUtils","WAMediaUtils","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["No media entry"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["No existing media entry found for plaintextHash ",". Returning new MsgMap."]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["getMostRecentDecodedMediaEntry"]),k=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY},"getMediaKnownEntries",function(a){return function(b){return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,b).then(function(a){if(!a){j.LOG(i(),d("WAHashUtils").sanitisePlaintextHash(b));return d("WAResultOrError").makeError("no-media-by-plaintext-hash")}return d("WAResultOrError").makeResult(a.mediaEntries)})}});function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield k(a));if(a.success===!1)return a;a=m(a.value);return a.success===!1?a:d("WAResultOrError").makeResult(a.value[1])});return l.apply(this,arguments)}function m(a){var b=null;for(a of a){var c,e=a[0],f=a[1];f=d("WAMediaUtils").decodeMediaEntryData(f);(((c=b)==null?void 0:c[1].mediaKeyTimestamp)==null||f.mediaKeyTimestamp!=null&&f.mediaKeyTimestamp>((c=b)==null?void 0:c[1].mediaKeyTimestamp))&&(b=[e,f])}if(b!=null)return d("WAResultOrError").makeResult(b);j.ERROR(h());return d("WAResultOrError").makeError("no-media-entry")}g.getMostRecentDecodedMediaEntry=a;g.findMostRecentMediaEntry=m}),98);
__d("MAWGetMsgByProtocolIdApi",["MAWDbMsgTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY},"getMsgsByProtocolMsgIdsTxn",function(a){return function(b){return d("MAWDbMsgTxns").getMsgsByProtocolMsgId(a,b)}});g.getMsgsByProtocolMsgIdsTxn=a}),98);
__d("MAWGetMsgIdByProtocolMsgId",["MAWDbMsgTxns","MAWDbReactionsTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWTransactionMode","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({messages:(a=d("MAWTransactionMode")).READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY},"getMsgIdByProtocolMsgId",function(a){return function(b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgResultByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(a){var b=a[0],c=a[1];a=a[2];if(b.success)return d("WAResultOrError").makeResult(b.value.msgId);else if(c!=null)return d("WAResultOrError").makeResult(c.reactionId);else if(a.success&&a.value.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return d("WAResultOrError").makeResult(a.value.msgId);var e="missing_msg_in_db";b=b.error;a=a.error;if(b==="missing_msg"&&c==null&&a==="missing_unrendered_msg")e="missing_all_db_msg";else if(b==="missing_thread_msg"&&a==="missing_thread_unrendered_msg")e="missing_all_thread";else if(b==="missing_thread_msg"||a==="missing_thread_unrendered_msg"){e=b+"__"+((c=a)!=null?c:"unrenderedMsgResultNoError")}return d("WAResultOrError").makeError(e)})}});g.getMsgIdByProtocolMsgId=b}),98);
__d("WAIsMp4",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a.length<8?!1:a[4]===102&&a[5]===116&&a[6]===121&&a[7]===112}f.isMp4=a}),66);
__d("WAIsWebP",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(a.length<12)return!1;if(a[0]!==82||a[1]!==73||a[2]!==70||a[3]!==70)return!1;return a[8]!==87||a[9]!==69||a[10]!==66||a[11]!==80?!1:!0}f.isWebP=a}),66);
__d("WAWasmModuleCache",["WAPromiseManagement","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=a.fetch,i=new Map();c=d("WAPromiseManagement").cacheWhilePending(function(a){return a},function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=i.get(a);if(b!=null)return b;b=(yield j(a));i.set(a,b);return b});return function(b){return a.apply(this,arguments)}}());function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=h(a);if(typeof WebAssembly.compileStreaming==="function")return WebAssembly.compileStreaming(a);a=(yield a);return WebAssembly.compile(yield a.arrayBuffer())});return k.apply(this,arguments)}g.loadWasmModule=c}),98);
__d("WAPreloadWamediaUtilsWasm",["WAWasmModuleCache","bx"],(function(a,b,c,d,e,f,g){"use strict";var h=c("bx").getURL(c("bx")("237"));a=function(){void d("WAWasmModuleCache").loadWasmModule(h)};g.preloadWamediaUtilsWasm=a}),98);
__d("WAPreloadWebpCheckWasm",["WAWasmModuleCache","bx"],(function(a,b,c,d,e,f,g){"use strict";var h=c("bx").getURL(c("bx")("6946"));a=function(){void d("WAWasmModuleCache").loadWasmModule(h)};g.preloadWebpCheckWasm=a}),98);
__d("WAPrewarmMediaValidate",["WALogger","WAPreloadWamediaUtilsWasm","WAPreloadWebpCheckWasm"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["prewarmMediaValidate: serverMediaType is null"]);h=function(){return a};return a}function a(a){if(a==null){d("WALogger").WARN(h());return}(a==="sticker"||a==="image")&&d("WAPreloadWebpCheckWasm").preloadWebpCheckWasm();(a==="video"||a==="audio")&&d("WAPreloadWamediaUtilsWasm").preloadWamediaUtilsWasm()}g.prewarmMediaValidate=a}),98);
__d("WASIContext",[],(function(a,b,c,d,e,f){"use strict";a=function(a){var b;this.fs=(b=a==null?void 0:a.fs)!=null?b:{};this.args=(b=a==null?void 0:a.args)!=null?b:[];this.env=(b=a==null?void 0:a.env)!=null?b:{};this.stdin=(b=a==null?void 0:a.stdin)!=null?b:function(){return null};this.stdout=(b=a==null?void 0:a.stdout)!=null?b:function(){};this.stderr=(b=a==null?void 0:a.stderr)!=null?b:function(){};this.debug=a==null?void 0:a.debug;this.isTTY=!!(a==null?void 0:a.isTTY)};f.WASIContext=a}),66);
__d("WASISnapshotPreview1",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({SUCCESS:0,E2BIG:1,EACCESS:2,EADDRINUSE:3,EADDRNOTAVAIL:4,EAFNOSUPPORT:5,EAGAIN:6,EALREADY:7,EBADF:8,EBADMSG:9,EBUSY:10,ECANCELED:11,ECHILD:12,ECONNABORTED:13,ECONNREFUSED:14,ECONNRESET:15,EDEADLK:16,EDESTADDRREQ:17,EDOM:18,EDQUOT:19,EEXIST:20,EFAULT:21,EFBIG:22,EHOSTUNREACH:23,EIDRM:24,EILSEQ:25,EINPROGRESS:26,EINTR:27,EINVAL:28,EIO:29,EISCONN:30,EISDIR:31,ELOOP:32,EMFILE:33,EMLINK:34,EMSGSIZE:35,EMULTIHOP:36,ENAMETOOLONG:37,ENETDOWN:38,ENETRESET:39,ENETUNREACH:40,ENFILE:41,ENOBUFS:42,ENODEV:43,ENOENT:44,ENOEXEC:45,ENOLCK:46,ENOLINK:47,ENOMEM:48,ENOMSG:49,ENOPROTOOPT:50,ENOSPC:51,ENOSYS:52,ENOTCONN:53,ENOTDIR:54,ENOTEMPTY:55,ENOTRECOVERABLE:56,ENOTSOCK:57,ENOTSUP:58,ENOTTY:59,ENXIO:60,EOVERFLOW:61,EOWNERDEAD:62,EPERM:63,EPIPE:64,EPROTO:65,EPROTONOSUPPORT:66,EPROTOTYPE:67,ERANGE:68,EROFS:69,ESPIPE:70,ESRCH:71,ESTALE:72,ETIMEDOUT:73,ETXTBSY:74,EXDEV:75,ENOTCAPABLE:76});d=(c=b("$InternalEnum"))({REALTIME:0,MONOTONIC:1,PROCESS_CPUTIME_ID:2,THREAD_CPUTIME_ID:3});e=c({SET:0,CUR:1,END:2});b=c({UNKNOWN:0,BLOCK_DEVICE:1,CHARACTER_DEVICE:2,DIRECTORY:3,REGULAR_FILE:4,SOCKET_DGRAM:5,SOCKET_STREAM:6,SYMBOLIC_LINK:7});var g=c({DIR:0});c=c({CLOCK:0,FD_READ:1,FD_WRITE:2});var h={SYMLINK_FOLLOW:1<<0},i={CREAT:1<<0,DIRECTORY:1<<1,EXCL:1<<2,TRUNC:1<<3},j={APPEND:1<<0,DSYNC:1<<1,NONBLOCK:1<<2,RSYNC:1<<3,SYNC:1<<4},k={FD_DATASYNC:BigInt(1)<<BigInt(0),FD_READ:BigInt(1)<<BigInt(1),FD_SEEK:BigInt(1)<<BigInt(2),FD_FDSTAT_SET_FLAGS:BigInt(1)<<BigInt(3),FD_SYNC:BigInt(1)<<BigInt(4),FD_TELL:BigInt(1)<<BigInt(5),FD_WRITE:BigInt(1)<<BigInt(6),FD_ADVISE:BigInt(1)<<BigInt(7),FD_ALLOCATE:BigInt(1)<<BigInt(8),PATH_CREATE_DIRECTORY:BigInt(1)<<BigInt(9),PATH_CREATE_FILE:BigInt(1)<<BigInt(10),PATH_LINK_SOURCE:BigInt(1)<<BigInt(11),PATH_LINK_TARGET:BigInt(1)<<BigInt(12),PATH_OPEN:BigInt(1)<<BigInt(13),FD_READDIR:BigInt(1)<<BigInt(14),PATH_READLINK:BigInt(1)<<BigInt(15),PATH_RENAME_SOURCE:BigInt(1)<<BigInt(16),PATH_RENAME_TARGET:BigInt(1)<<BigInt(17),PATH_FILESTAT_GET:BigInt(1)<<BigInt(18),PATH_FILESTAT_SET_SIZE:BigInt(1)<<BigInt(19),PATH_FILESTAT_SET_TIMES:BigInt(1)<<BigInt(20),FD_FILESTAT_GET:BigInt(1)<<BigInt(21),FD_FILESTAT_SET_SIZE:BigInt(1)<<BigInt(22),FD_FILESTAT_SET_TIMES:BigInt(1)<<BigInt(23),PATH_SYMLINK:BigInt(1)<<BigInt(24),PATH_REMOVE_DIRECTORY:BigInt(1)<<BigInt(25),PATH_UNLINK_FILE:BigInt(1)<<BigInt(26),POLL_FD_READWRITE:BigInt(1)<<BigInt(27),SOCK_SHUTDOWN:BigInt(1)<<BigInt(28),SOCK_ACCEPT:BigInt(1)<<BigInt(29)},l={ATIM:1<<0,ATIM_NOW:1<<1,MTIM:1<<2,MTIM_NOW:1<<3},m={SUBSCRIPTION_CLOCK_ABSTIME:1<<0},n={FD_READWRITE_HANGUP:1<<0},o=64,p=48,q=32;f.RESULT=a;f.Clock=d;f.Whence=e;f.FileType=b;f.PreopenType=g;f.EventType=c;f.LookupFlags=h;f.OpenFlags=i;f.FileDescriptorFlags=j;f.RightsFlags=k;f.FileStatTimestampFlags=l;f.SubscriptionClockFlags=m;f.EventReadWriteFlags=n;f.FILESTAT_SIZE=o;f.SUBSCRIPTION_SIZE=p;f.EVENT_SIZE=q}),66);
__d("WASIDrive",["WASISnapshotPreview1","WATextEncoding"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.nextFD=10,this.openMap=new Map(),this.fs=babelHelpers["extends"]({},a),this.openMap.set(3,new j(this.fs,"/"))}var b=a.prototype;b.$1=function(a,b,c){a=new h(a,c);b&&(a.buffer=new Uint8Array(new ArrayBuffer(1024),0,0));c=this.nextFD;this.openMap.set(c,a);this.nextFD++;return[d("WASISnapshotPreview1").RESULT.SUCCESS,c]};b.$2=function(a,b){a=new j(a,b);b=this.nextFD;this.openMap.set(b,a);this.nextFD++;return[d("WASISnapshotPreview1").RESULT.SUCCESS,b]};b.$3=function(a,b){return b==="."?!0:a.containsDirectory(b)};b.open=function(a,b,c,e){var f,g=!!(c&(f=d("WASISnapshotPreview1")).OpenFlags.CREAT),h=!!(c&f.OpenFlags.DIRECTORY),i=!!(c&f.OpenFlags.EXCL);c=!!(c&f.OpenFlags.TRUNC);f=this.openMap.get(a);if(!(f instanceof j))return[d("WASISnapshotPreview1").RESULT.EBADF];if(f.containsFile(b)){if(h)return[d("WASISnapshotPreview1").RESULT.ENOTDIR];if(i)return[d("WASISnapshotPreview1").RESULT.EEXIST];a=f.get(b);return this.$1(a,c,e)}else if(this.$3(f,b)){if(b===".")return this.$2(this.fs,"/");var k="/"+b+"/";h=Object.entries(this.fs).filter(function(a){a=a[0];return a.startsWith(k)});return this.$2(Object.fromEntries(h),k)}else{if(g){i=f.fullPath(b);this.fs[i]={path:i,mode:"binary",content:new Uint8Array(0),timestamps:{access:new Date(),modification:new Date(),change:new Date()}};return this.$1(this.fs[i],c,e)}return[d("WASISnapshotPreview1").RESULT.ENOTCAPABLE]}};b.close=function(a){if(!this.openMap.has(a))return d("WASISnapshotPreview1").RESULT.EBADF;var b=this.openMap.get(a);b instanceof h&&b.sync();this.openMap["delete"](a);return d("WASISnapshotPreview1").RESULT.SUCCESS};b.read=function(a,b){a=this.openMap.get(a);return!a||a instanceof j?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.read(b)]};b.pread=function(a,b,c){a=this.openMap.get(a);return!a||a instanceof j?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.pread(b,c)]};b.write=function(a,b){a=this.openMap.get(a);if(!a||a instanceof j)return d("WASISnapshotPreview1").RESULT.EBADF;a.write(b);return d("WASISnapshotPreview1").RESULT.SUCCESS};b.pwrite=function(a,b,c){a=this.openMap.get(a);if(!a||a instanceof j)return d("WASISnapshotPreview1").RESULT.EBADF;a.pwrite(b,c);return d("WASISnapshotPreview1").RESULT.SUCCESS};b.sync=function(a){a=this.openMap.get(a);if(!a||a instanceof j)return d("WASISnapshotPreview1").RESULT.EBADF;a.sync();return d("WASISnapshotPreview1").RESULT.SUCCESS};b.seek=function(a,b,c){a=this.openMap.get(a);return!a||a instanceof j?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.seek(b,c)]};b.tell=function(a){a=this.openMap.get(a);return!a||a instanceof j?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.tell()]};b.renumber=function(a,b){if(!this.exists(a)||!this.exists(b))return d("WASISnapshotPreview1").RESULT.EBADF;if(a===b)return d("WASISnapshotPreview1").RESULT.SUCCESS;this.close(b);a=this.openMap.get(a);this.openMap.set(b,a);return d("WASISnapshotPreview1").RESULT.SUCCESS};b.unlink=function(a,b){a=this.openMap.get(a);if(!(a instanceof j))return d("WASISnapshotPreview1").RESULT.EBADF;if(!a.contains(b))return d("WASISnapshotPreview1").RESULT.ENOENT;var c=Object.keys(this.fs);for(var e=0;e<c.length;e++){var f=c[e];(f===a.fullPath(b)||f.startsWith(a.fullPath(b)+"/"))&&delete this.fs[f]}return d("WASISnapshotPreview1").RESULT.SUCCESS};b.rename=function(a,b,c,e){a=this.openMap.get(a);c=this.openMap.get(c);if(!(a instanceof j)||!(c instanceof j))return d("WASISnapshotPreview1").RESULT.EBADF;if(!a.contains(b))return d("WASISnapshotPreview1").RESULT.ENOENT;if(c.contains(e))return d("WASISnapshotPreview1").RESULT.EEXIST;a=a.fullPath(b);b=c.fullPath(e);c=Object.keys(this.fs);for(e=0;e<c.length;e++){var f=c[e];if(f.startsWith(a)){var g=f.replace(a,b);this.fs[g]=this.fs[f];this.fs[g].path=g;delete this.fs[f]}}return d("WASISnapshotPreview1").RESULT.SUCCESS};b.list=function(a){a=this.openMap.get(a);return!(a instanceof j)?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.list()]};b.stat=function(a){a=this.openMap.get(a);return!(a instanceof h)?[d("WASISnapshotPreview1").RESULT.EBADF]:[d("WASISnapshotPreview1").RESULT.SUCCESS,a.stat()]};b.pathStat=function(a,b){a=this.openMap.get(a);if(!(a instanceof j))return[d("WASISnapshotPreview1").RESULT.EBADF];if(a.containsFile(b)){var c=a.fullPath(b);c=new h(this.fs[c],0).stat();return[d("WASISnapshotPreview1").RESULT.SUCCESS,c]}else if(this.$3(a,b)){if(b===".")return[d("WASISnapshotPreview1").RESULT.SUCCESS,new j(this.fs,"/").stat()];var e="/"+b+"/";c=Object.entries(this.fs).filter(function(a){a=a[0];return a.startsWith(e)});a=new j(Object.fromEntries(c),e).stat();return[d("WASISnapshotPreview1").RESULT.SUCCESS,a]}else return[d("WASISnapshotPreview1").RESULT.ENOTCAPABLE]};b.setFlags=function(a,b){a=this.openMap.get(a);if(a instanceof h){a.setFlags(b);return d("WASISnapshotPreview1").RESULT.SUCCESS}else return d("WASISnapshotPreview1").RESULT.EBADF};b.setSize=function(a,b){a=this.openMap.get(a);if(a instanceof h){a.setSize(Number(b));return d("WASISnapshotPreview1").RESULT.SUCCESS}else return d("WASISnapshotPreview1").RESULT.EBADF};b.setAccessTime=function(a,b){a=this.openMap.get(a);if(a instanceof h){a.setAccessTime(b);return d("WASISnapshotPreview1").RESULT.SUCCESS}else return d("WASISnapshotPreview1").RESULT.EBADF};b.setModificationTime=function(a,b){a=this.openMap.get(a);if(a instanceof h){a.setModificationTime(b);return d("WASISnapshotPreview1").RESULT.SUCCESS}else return d("WASISnapshotPreview1").RESULT.EBADF};b.pathSetAccessTime=function(a,b,c){a=this.openMap.get(a);if(!(a instanceof j))return d("WASISnapshotPreview1").RESULT.EBADF;a=a.get(b);if(a==null)return d("WASISnapshotPreview1").RESULT.ENOTCAPABLE;b=new h(a,0);b.setAccessTime(c);b.sync();return d("WASISnapshotPreview1").RESULT.SUCCESS};b.pathSetModificationTime=function(a,b,c){a=this.openMap.get(a);if(!(a instanceof j))return d("WASISnapshotPreview1").RESULT.EBADF;a=a.get(b);if(a==null)return d("WASISnapshotPreview1").RESULT.ENOTCAPABLE;b=new h(a,0);b.setModificationTime(c);b.sync();return d("WASISnapshotPreview1").RESULT.SUCCESS};b.pathCreateDir=function(a,b){a=this.openMap.get(a);if(!(a instanceof j))return d("WASISnapshotPreview1").RESULT.EBADF;if(a.contains(b))return d("WASISnapshotPreview1").RESULT.ENOTCAPABLE;a=a.fullPath(b)+"/.runno";this.fs[a]={path:a,timestamps:{access:new Date(),modification:new Date(),change:new Date()},mode:"string",content:""};return d("WASISnapshotPreview1").RESULT.SUCCESS};b.exists=function(a){return this.openMap.has(a)};b.fileType=function(a){a=this.openMap.get(a);if(!a)return d("WASISnapshotPreview1").FileType.UNKNOWN;else if(a instanceof h)return d("WASISnapshotPreview1").FileType.REGULAR_FILE;else return d("WASISnapshotPreview1").FileType.DIRECTORY};b.fileFdflags=function(a){a=this.openMap.get(a);if(a instanceof h)return a.fdflags;else return 0};return a}();var h=function(){var b=a.prototype;b.getOffset=function(){return Number(this.$1)};function a(a,b){this.$1=BigInt(0);this.isDirty=!1;this.file=a;if(this.file.mode==="string"){a=this.file.content;var c=d("WATextEncoding").newTextEncoder();this.buffer=c.encode(a)}else this.buffer=this.file.content;this.fdflags=b;this.flagAppend=!!(b&d("WASISnapshotPreview1").FileDescriptorFlags.APPEND);this.flagDSync=!!(b&d("WASISnapshotPreview1").FileDescriptorFlags.DSYNC);this.flagNonBlock=!!(b&d("WASISnapshotPreview1").FileDescriptorFlags.NONBLOCK);this.flagRSync=!!(b&d("WASISnapshotPreview1").FileDescriptorFlags.RSYNC);this.flagSync=!!(b&d("WASISnapshotPreview1").FileDescriptorFlags.SYNC)}b.read=function(a){a=this.buffer.subarray(this.getOffset(),this.getOffset()+a);this.$1+=BigInt(a.length);return a};b.pread=function(a,b){return this.buffer.subarray(b,b+a)};b.write=function(a){this.isDirty=!0;if(this.flagAppend){var b=this.buffer.length;this.$2(b+a.byteLength);this.buffer.set(a,b)}else{b=Math.max(this.getOffset()+a.byteLength,this.buffer.byteLength);this.$2(b);this.buffer.set(a,this.getOffset());this.$1+=BigInt(a.byteLength)}(this.flagDSync||this.flagSync)&&this.sync()};b.pwrite=function(a,b){this.isDirty=!0;if(this.flagAppend){var c=this.buffer.length;this.$2(c+a.byteLength);this.buffer.set(a,c)}else{c=Math.max(b+a.byteLength,this.buffer.byteLength);this.$2(c);this.buffer.set(a,b)}(this.flagDSync||this.flagSync)&&this.sync()};b.sync=function(){if(!this.isDirty)return;this.isDirty=!1;if(this.file.mode==="binary"){this.file.content=new Uint8Array(this.buffer);return}var a=d("WATextEncoding").newTextDecoder();this.file.content=a.decode(this.buffer);return};b.seek=function(a,b){switch(b){case d("WASISnapshotPreview1").Whence.SET:this.$1=a;break;case d("WASISnapshotPreview1").Whence.CUR:this.$1+=a;break;case d("WASISnapshotPreview1").Whence.END:this.$1=BigInt(this.buffer.length)+a;break}return this.$1};b.tell=function(){return this.$1};b.stat=function(){return{path:this.file.path,timestamps:this.file.timestamps,type:d("WASISnapshotPreview1").FileType.REGULAR_FILE,byteLength:this.buffer.length}};b.setFlags=function(a){this.fdflags=a};b.setSize=function(a){this.$2(a)};b.setAccessTime=function(a){this.file.timestamps.access=a};b.setModificationTime=function(a){this.file.timestamps.modification=a};b.$2=function(a){if(a<=this.buffer.buffer.byteLength){this.buffer=new Uint8Array(this.buffer.buffer,0,a);return}var b;this.buffer.buffer.byteLength===0?b=new ArrayBuffer(a<1024?1024:a*2):a>this.buffer.buffer.byteLength*2?b=new ArrayBuffer(a*2):b=new ArrayBuffer(this.buffer.buffer.byteLength*2);b=new Uint8Array(b,0,a);b.set(this.buffer);this.buffer=b};return a}();function i(a,b){b=b.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");b=new RegExp("^"+b);return a.replace(b,"")}var j=function(){function a(a,b){this.dir=a,this.prefix=b}var b=a.prototype;b.containsFile=function(a){var b=Object.keys(this.dir);for(var c=0;c<b.length;c++){var d=b[c];d=i(d,this.prefix);if(d===a)return!0}return!1};b.containsDirectory=function(a){var b=Object.keys(this.dir);for(var c=0;c<b.length;c++){var d=b[c];d=i(d,this.prefix);if(d.startsWith(a+"/"))return!0}return!1};b.contains=function(a){var b=Object.keys(this.dir);for(var c=0;c<b.length;c++){var d=b[c];d=i(d,this.prefix);if(d===a||d.startsWith(a+"/"))return!0}return!1};b.get=function(a){return this.dir[this.fullPath(a)]};b.fullPath=function(a){return""+this.prefix+a};b.list=function(){var a=[],b=new Set(),c=Object.keys(this.dir);for(var e=0;e<c.length;e++){var f=c[e];f=i(f,this.prefix);if(f.includes("/")){var g=f.split("/")[0];if(b.has(g))continue;b.add(g);a.push({name:g,type:d("WASISnapshotPreview1").FileType.DIRECTORY})}else a.push({name:f,type:d("WASISnapshotPreview1").FileType.REGULAR_FILE})}return a};b.stat=function(){return{path:this.prefix,timestamps:{access:new Date(),modification:new Date(),change:new Date()},type:d("WASISnapshotPreview1").FileType.DIRECTORY,byteLength:0}};return a}();g.WASIDrive=a}),98);
__d("WASI",["WACryptoDependencies","WAErr","WASIContext","WASIDrive","WASISnapshotPreview1","WATextEncoding"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,e=new(d("WASIContext").WASIContext)(a),f=new(d("WASIDrive").WASIDrive)(e.fs);function g(){return Object.entries(e.env).map(function(a){var b=a[0];a=a[1];return b+"="+a})}var n={args_get:function(a,c){a=a;c=c;var f=new DataView(b.buffer);for(var g=e.args,h=Array.isArray(g),i=0,g=h?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var j;if(h){if(i>=g.length)break;j=g[i++]}else{i=g.next();if(i.done)break;j=i.value}j=j;f.setUint32(a,c,!0);a+=4;j=d("WATextEncoding").newTextEncoder().encode(j+"\0");var k=new Uint8Array(b.buffer,c,j.byteLength);k.set(j);c+=j.byteLength}return d("WASISnapshotPreview1").RESULT.SUCCESS},args_sizes_get:function(a,c){var f=e.args,g=f.reduce(function(a,b){return a+d("WATextEncoding").newTextEncoder().encode(b+"\0").byteLength},0),h=new DataView(b.buffer);h.setUint32(a,f.length,!0);h.setUint32(c,g,!0);return d("WASISnapshotPreview1").RESULT.SUCCESS},clock_res_get:function(){throw c("WAErr")("clock_res_get is not implemented")},clock_time_get:function(a,c,e){c=d("WASISnapshotPreview1").Clock.cast(a);if(c==null)return d("WASISnapshotPreview1").RESULT.EINVAL;switch(c){case d("WASISnapshotPreview1").Clock.REALTIME:case d("WASISnapshotPreview1").Clock.MONOTONIC:case d("WASISnapshotPreview1").Clock.PROCESS_CPUTIME_ID:case d("WASISnapshotPreview1").Clock.THREAD_CPUTIME_ID:a=new DataView(b.buffer);a.setBigUint64(e,m(new Date()),!0);return d("WASISnapshotPreview1").RESULT.SUCCESS}},environ_get:function(a,c){a=a;c=c;var e=new DataView(b.buffer),f=g();for(var h=0;h<f.length;h++){var i=f[h];e.setUint32(a,c,!0);a+=4;i=d("WATextEncoding").newTextEncoder().encode(i+"\0");var j=new Uint8Array(b.buffer,c,i.byteLength);j.set(i);c+=i.byteLength}return d("WASISnapshotPreview1").RESULT.SUCCESS},environ_sizes_get:function(a,c){var e=g().reduce(function(a,b){return a+d("WATextEncoding").newTextEncoder().encode(b+"\0").byteLength},0),f=new DataView(b.buffer);f.setUint32(a,g().length,!0);f.setUint32(c,e,!0);return d("WASISnapshotPreview1").RESULT.SUCCESS},fd_advise:function(){throw c("WAErr")("fd_advise is not implemented")},fd_allocate:function(){throw c("WAErr")("fd_allocate is not implemented")},fd_close:function(a){return f.close(a)},fd_datasync:function(){throw c("WAErr")("fd_datasync is not implemented")},fd_fdstat_get:function(a,c){if(a<3){if(e.isTTY){var g=i^d("WASISnapshotPreview1").RightsFlags.FD_SEEK^d("WASISnapshotPreview1").RightsFlags.FD_TELL;g=k(d("WASISnapshotPreview1").FileType.CHARACTER_DEVICE,0,g)}else g=k(d("WASISnapshotPreview1").FileType.CHARACTER_DEVICE,0);var h=new Uint8Array(b.buffer,c,g.byteLength);h.set(g);return d("WASISnapshotPreview1").RESULT.SUCCESS}if(!f.exists(a))return d("WASISnapshotPreview1").RESULT.EBADF;h=f.fileType(a);g=f.fileFdflags(a);a=k(h,g);h=new Uint8Array(b.buffer,c,a.byteLength);h.set(a);return d("WASISnapshotPreview1").RESULT.SUCCESS},fd_fdstat_set_flags:function(a,b){return f.setFlags(a,b)},fd_fdstat_set_rights:function(){return d("WASISnapshotPreview1").RESULT.SUCCESS},fd_filestat_get:function(){throw c("WAErr")("fd_filestat_get is not implemented")},fd_filestat_set_size:function(){throw c("WAErr")("fd_filestat_set_size is not implemented")},fd_filestat_set_times:function(){throw c("WAErr")("fd_filestat_set_times is not implemented")},fd_pread:function(){throw c("WAErr")("fd_pread is not implemented")},fd_prestat_dir_name:function(a,c,e){if(a!==3)return d("WASISnapshotPreview1").RESULT.EBADF;a=d("WATextEncoding").newTextEncoder().encode("/");c=new Uint8Array(b.buffer,c,e);c.set(a.subarray(0,e));return d("WASISnapshotPreview1").RESULT.SUCCESS},fd_prestat_get:function(a,c){if(a!==3)return d("WASISnapshotPreview1").RESULT.EBADF;a=d("WATextEncoding").newTextEncoder().encode(".");c=new DataView(b.buffer,c);c.setUint8(0,d("WASISnapshotPreview1").PreopenType.DIR);c.setUint32(4,a.byteLength,!0);return d("WASISnapshotPreview1").RESULT.SUCCESS},fd_pwrite:function(){throw c("WAErr")("fd_pwrite is not implemented")},fd_read:function(a,c,g,h){if(a===1||a===2)return d("WASISnapshotPreview1").RESULT.ENOTSUP;var i=new DataView(b.buffer);c=j(i,c,g);g=d("WATextEncoding").newTextEncoder();var k=0,l=d("WASISnapshotPreview1").RESULT.SUCCESS;for(var m=0;m<c.length;m++){var n=c[m],o=void 0;if(a===0){var p=e.stdin(n.byteLength);if(p==null)break;o=g.encode(p)}else{p=f.read(a,n.byteLength);if(p.length===1){l=p[0];break}else o=p[1]}p=Math.min(n.byteLength,o.byteLength);n.set(o.subarray(0,p));k+=p}i.setUint32(h,k,!0);return l},fd_readdir:function(){throw c("WAErr")("fd_readdir is not implemented")},fd_renumber:function(){throw c("WAErr")("fd_renumber is not implemented")},fd_seek:function(a,e,g,h){g=d("WASISnapshotPreview1").Whence.cast(g);if(g==null)throw c("WAErr")("fd_seek: invalid whence");a=f.seek(a,e,g);if(a.length===1)return a[0];e=a[0];g=a[1];a=new DataView(b.buffer);a.setBigUint64(h,g,!0);return e},fd_sync:function(){throw c("WAErr")("fd_sync is not implemented")},fd_tell:function(){throw c("WAErr")("fd_tell is not implemented")},fd_write:function(a,c,g,h){if(a===0)return d("WASISnapshotPreview1").RESULT.ENOTSUP;var i=new DataView(b.buffer);c=j(i,c,g);g=d("WATextEncoding").newTextDecoder();var k=0,l=d("WASISnapshotPreview1").RESULT.SUCCESS;for(var m=0;m<c.length;m++){var n=c[m];if(n.byteLength===0)continue;if(a===1||a===2){var o=a===1?e.stdout:e.stderr,p=g.decode(n);o(p)}else{l=f.write(a,n);if(l!==d("WASISnapshotPreview1").RESULT.SUCCESS)break}k+=n.byteLength}i.setUint32(h,k,!0);return l},path_create_directory:function(){throw c("WAErr")("path_create_directory is not implemented")},path_filestat_get:function(){throw c("WAErr")("path_filestat_get is not implemented")},path_filestat_set_times:function(){throw c("WAErr")("path_filestat_set_times is not implemented")},path_link:function(){throw c("WAErr")("path_link is not implemented")},path_open:function(a,c,d,e,g,h,i,j,k){c=new DataView(b.buffer);h=l(b,d,e);i=f.open(a,h,g,j);if(i.length===1)return i[0];d=i[0];e=i[1];c.setUint32(k,e,!0);return d},path_readlink:function(){throw c("WAErr")("path_readlink is not implemented")},path_remove_directory:function(){throw c("WAErr")("path_remove_directory is not implemented")},path_rename:function(){throw c("WAErr")("path_rename is not implemented")},path_symlink:function(){throw c("WAErr")("path_symlink is not implemented")},path_unlink_file:function(){throw c("WAErr")("path_unlink_file is not implemented")},poll_oneoff:function(){throw c("WAErr")("poll_oneoff is not implemented")},proc_exit:function(a){throw new h(a)},proc_raise:function(){throw c("WAErr")("proc_raise is not implemented")},random_get:function(a,c){a=new Uint8Array(b.buffer,a,c);d("WACryptoDependencies").getCrypto().getRandomValues(a);return d("WASISnapshotPreview1").RESULT.SUCCESS},sched_yield:function(){throw c("WAErr")("sched_yield is not implemented")},sock_accept:function(){throw c("WAErr")("sock_accept is not implemented")},sock_recv:function(){throw c("WAErr")("sock_recv is not implemented")},sock_send:function(){throw c("WAErr")("sock_send is not implemented")},sock_shutdown:function(){throw c("WAErr")("sock_shutdown is not implemented")}};return{getImportObject:function(){return{wasi_snapshot_preview1:n}},start:function(a){var d=a.exports.memory;if(d instanceof WebAssembly.Memory)b=d;else throw c("WAErr")("Expected memory object");d=a.exports._start;try{d()}catch(a){if(a instanceof h)return{exitCode:a.code,fs:f.fs};else if(a instanceof WebAssembly.RuntimeError)return{exitCode:134,fs:f.fs};else throw a}return{exitCode:0,fs:f.fs}}}}var h=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this)||this;c.code=a;return c}return a}(babelHelpers.wrapNativeSuper(Error)),i=(b=d("WASISnapshotPreview1")).RightsFlags.FD_DATASYNC|b.RightsFlags.FD_READ|b.RightsFlags.FD_SEEK|b.RightsFlags.FD_FDSTAT_SET_FLAGS|b.RightsFlags.FD_SYNC|b.RightsFlags.FD_TELL|b.RightsFlags.FD_WRITE|b.RightsFlags.FD_ADVISE|b.RightsFlags.FD_ALLOCATE|b.RightsFlags.PATH_CREATE_DIRECTORY|b.RightsFlags.PATH_CREATE_FILE|b.RightsFlags.PATH_LINK_SOURCE|b.RightsFlags.PATH_LINK_TARGET|b.RightsFlags.PATH_OPEN|b.RightsFlags.FD_READDIR|b.RightsFlags.PATH_READLINK|b.RightsFlags.PATH_RENAME_SOURCE|b.RightsFlags.PATH_RENAME_TARGET|b.RightsFlags.PATH_FILESTAT_GET|b.RightsFlags.PATH_FILESTAT_SET_SIZE|b.RightsFlags.PATH_FILESTAT_SET_TIMES|b.RightsFlags.FD_FILESTAT_GET|b.RightsFlags.FD_FILESTAT_SET_SIZE|b.RightsFlags.FD_FILESTAT_SET_TIMES|b.RightsFlags.PATH_SYMLINK|b.RightsFlags.PATH_REMOVE_DIRECTORY|b.RightsFlags.PATH_UNLINK_FILE|b.RightsFlags.POLL_FD_READWRITE|b.RightsFlags.SOCK_SHUTDOWN|b.RightsFlags.SOCK_ACCEPT;function j(a,b,c){var d=new Array(c);b=b;for(var e=0;e<c;e++){var f=a.getUint32(b,!0);b+=4;var g=a.getUint32(b,!0);b+=4;d[e]=new Uint8Array(a.buffer,f,g)}return d}function k(a,b,c){var d;d=(d=c)!=null?d:i;c=(c=c)!=null?c:i;var e=new Uint8Array(24),f=new DataView(e.buffer,0,24);f.setUint8(0,a);f.setUint32(2,b,!0);f.setBigUint64(8,d,!0);f.setBigUint64(16,c,!0);return e}function l(a,b,c){return d("WATextEncoding").newTextDecoder().decode(new Uint8Array(a.buffer,b,c))}function m(a){return BigInt(a.getTime())*BigInt(1e6)}g.createWasi=a}),98);
__d("WAMp4Check",["WAResultOrError","WASI","WAWasmModuleCache","asyncToGeneratorRuntime","bx"],(function(a,b,c,d,e,f,g){"use strict";var h="input",i="/"+h;function j(a){var b,c=a.input,d=a.stdout;a=a.stderr;return{args:["wamediautil","mp4check","--error-tolerance=2",h],fs:(b={},b[i]={path:i,timestamps:{access:new Date(),change:new Date(),modification:new Date()},mode:"binary",content:new Uint8Array(c)},b),stdout:d,stderr:a}}function a(a){var c=a.getWasmModule,e=a.logError,f=a.logMessage;return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.input;a=d("WASI").createWasi(j({input:a,stderr:e,stdout:f}));var b=a.getImportObject;a=a.start;var g=(yield c());g=(yield WebAssembly.instantiate(g,b()));b=a(g);a=b.exitCode;if(a!==0){e("mp4Check failed with exit code "+a);return d("WAResultOrError").makeError("invalid-media")}return d("WAResultOrError").makeResult()});function g(b){return a.apply(this,arguments)}return g}()}var k=c("bx").getURL(c("bx")("237"));e=function(){return d("WAWasmModuleCache").loadWasmModule(k)};g.createMp4Check=a;g.getMp4CheckWasm=e}),98);
__d("WAWebPCheck",["WAResultOrError","WASI","WAWasmModuleCache","asyncToGeneratorRuntime","bx"],(function(a,b,c,d,e,f,g){"use strict";var h="input",i="/"+h;function j(a){var b,c=a.input,d=a.stdout;a=a.stderr;return{args:["webpcheck",h],fs:(b={},b[i]={path:i,timestamps:{access:new Date(),change:new Date(),modification:new Date()},mode:"binary",content:new Uint8Array(c)},b),stdout:d,stderr:a}}function a(a){var c=a.getWasmModule,e=a.logError,f=a.logMessage;return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.input;a=d("WASI").createWasi(j({input:a,stderr:e,stdout:f}));var b=a.getImportObject;a=a.start;var g=(yield c());g=(yield WebAssembly.instantiate(g,b()));b=a(g);a=b.exitCode;if(a!==0){e("WebPCheck failed with exit code "+a);return d("WAResultOrError").makeError("invalid-media")}return d("WAResultOrError").makeResult()});function g(b){return a.apply(this,arguments)}return g}()}var k=c("bx").getURL(c("bx")("6946"));e=function(){return d("WAWasmModuleCache").loadWasmModule(k)};g.createWebPCheck=a;g.getWebpCheckWasm=e}),98);
__d("WAValidateMedia",["Promise","WAIsMp4","WAIsWebP","WAMp4Check","WAResultOrError","WATagsLogger","WAWebPCheck","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["checkMp4 error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["checkWebP error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);l=function(){return a};return a}var m=d("WATagsLogger").TAGS(["WAValidateMedia"]);function a(a,c){c==null?void 0:c.addPoint("media_validation_start");var e=new Uint8Array(a);if(d("WAIsWebP").isWebP(e))return p(a);if(d("WAIsMp4").isMp4(e))return r(a);c==null?void 0:c.addPoint("media_validation_end");return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult({skipValidation:!0,validatedPlaintext:a}))}var n=function(a){m.ERROR(l(),a)},o=function(a){m.LOG(k(),a)};function p(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWebPCheck").createWebPCheck({getWasmModule:d("WAWebPCheck").getWebpCheckWasm,logError:n,logMessage:o});b=(yield b({input:a}));if(!b.success){m.ERROR(j(),b.error);return d("WAResultOrError").makeError("invalid-webp")}return d("WAResultOrError").makeResult({skipValidation:!1,mimeType:"image/webp",validatedPlaintext:a})});return q.apply(this,arguments)}function r(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAMp4Check").createMp4Check({getWasmModule:d("WAMp4Check").getMp4CheckWasm,logError:n,logMessage:o});b=(yield b({input:a}));if(!b.success){m.ERROR(i(),b.error);return d("WAResultOrError").makeError("invalid-mp4")}return d("WAResultOrError").makeResult({skipValidation:!1,mimeType:"video/mp4",validatedPlaintext:a})});return s.apply(this,arguments)}g.validateMedia=a}),98);
__d("MAWDownloadAndHandleMedia",["MAWAckLevel","MAWCastToMsgrServerMediaType","MAWConfig","MAWDbDeletedMessages","MAWDbMsgTxns","MAWDeletedMsgApi","MAWEBBackendQPLUtils","MAWEBSwitch","MAWGetMediaPlaintextApi","MAWGetMostRescentDecodedMediaEntry","MAWGetMsgByProtocolIdApi","MAWGetMsgIdByProtocolMsgId","MAWHandleEchoMediaMsgsRestoreV2","MAWHandleMediaDownloadApi","MAWHandleMediaPreviewBeforeDownloadApi","MAWHandleMediaPreviewDownloadApi","MAWIndexedDb","MAWJobDefinitions","MAWJobManager","MAWLoggerUtils","MAWMediaDownloadStatus","MAWMediaDownloadStatusForUI","MAWTraceUtils","MAWTransactionMode","MAWUpdateMediaEntryForMsgApi","WAAPI","WAGlobals","WAHashUtils","WAIsMediaExpiredError","WAIsMp4","WAIsWebP","WAJids","WAJobOrchestratorTypes","WAMediaUtils","WAPREList","WAPREMetrics","WAPrewarmMediaValidate","WAStartMediaDownloadQplFlow","WATagsLogger","WAValidateMedia","asyncToGeneratorRuntime","cr:10071","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["media validation was skipped: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to validate media: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to validate for msg ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media for msg ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["fail to resign cdn url. ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url sproc start. ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql error: ",". ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql success. ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql failed: ",". ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql start. ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["media key expired, resign cdn url for msgId: ","."]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadAndHandleMedia: Failed to get DecodedMediaEntry - reason: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadAndHandleMedia: Missing msgId in Db - reason: "," msgType: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["DownloadAndHandleMedia: "," hash with "," msgId"]);v=function(){return a};return a}var w=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.MediaDownload,d("MAWLoggerUtils").Tag.MessageReceive]);a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("downloadAndHandleMedia",function(a){var b=a.hash,c=a.msgType,e=a.protocolMsgId;a=a.qplEntryPoint;a=d("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:a,msgType:c,protocolMsgId:e});return x({hash:b,mediaDownloadFlow:a,msgType:c,protocolMsgId:e})}).end();function x(a){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.hash,f=a.mediaDownloadFlow,g=a.msgType,x=a.protocolMsgId;d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:c("MAWMediaDownloadStatus").DOWNLOADING,type:"main"});w.LOG(v(),d("WAHashUtils").sanitisePlaintextHash(e),x);f.addPoint("maw_pre_download_start");a=(yield d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId(x));if(!a.success){if(c("gkx")("23965")&&(yield z(x))){f.addPoint("media_deleted");f.endSuccess();d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE,type:"main"});return}f.addPoint("maw_pre_download_fail");f.endFail(a.error);w.ERROR(u(),a.error,g);d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE,type:"main"});return}var y=a.value;a=(yield d("MAWGetMostRescentDecodedMediaEntry").getMostRecentDecodedMediaEntry(e));if(!a.success){f.addPoint("maw_pre_download_fail");f.endFail(a.error);w.ERROR(t(),a.error);yield B(y);d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE,type:"main"});return}a=a.value;d("WAPrewarmMediaValidate").prewarmMediaValidate(a.serverMediaType);f.addPoint("maw_pre_download_end");var A=(yield c("WAAPI").downloadMedia({downloadMediaMetric:f,getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,handleMediaPreviewBeforeDownload:d("MAWHandleMediaPreviewBeforeDownloadApi").handleMediaPreviewBeforeDownload,handleMediaPreviewDownload:d("MAWHandleMediaPreviewDownloadApi").handleMediaPreviewDownload,hash:e,mediaEntry:a,onlyIfMediaTTLIsValid:d("WAGlobals").getConfig().skipExpiredDownload(),protocolMsgId:x,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg}));f.addPoint("maw_post_download_start");if(A.success===!1){var C=a.objectId,D=a.serverMediaType,E=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(D);d("WAGlobals").getConfig().uiLayoutTriggeredMediaDownload()&&c("MAWEBSwitch").isEnabled()&&d("WAIsMediaExpiredError").isMediaExpiredError(A.error)&&C!=null&&E!=null&&(w.LOG(s(),y),f.addPoint("resign_cdn_url_start"),void d("MAWGetMsgByProtocolIdApi").getMsgsByProtocolMsgIdsTxn([x]).then(function(a){a=a[0]||{};a=a.sortOrderMs;if(a==null){f.addPoint("resign_cdn_url_missing_sort_order");return}var c=d("WAMediaUtils").stringToDeliveryObjectId(C),g=d("MAWTraceUtils").createTraceId(),h=d("MAWEBBackendQPLUtils").startMediaRestoreQPLFlow({externalId:x.externalId,mediaType:E,objectId:c,restoreEntry:"downloadAndHandleMedia",restoreMethod:b("cr:10071")==null?"sproc":"gql",traceId:g}),i="hash: "+d("WAHashUtils").sanitisePlaintextHash(e)+". msgId: "+y+". traceId: "+g;if(b("cr:10071")!==null)w.LOG(r(),i),void b("cr:10071").eblsResignCdnUrlWithGraphQL({chatJid:x.chat,deliveryObjectId:c,externalId:x.externalId,mediaType:E,plaintextHash:e,sortOrderMs:a}).then(function(a){if(a.success===!1){w.LOG(q(),a.error,i);h.endFail(a.error);return}w.LOG(p(),i);a=d("MAWJobDefinitions").createStartJobInfo("downloadAndRestoreMedia",{deliveryObjectId:c,msgId:y,plaintextHash:e,restorationCdnUrl:a.value,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},traceId:g});return d("MAWJobManager").getJobManager().fireAndForget(a)})["catch"](function(a){w.ERROR(o(),a,i),h.endFail("runtime-error",{string:{restoreError:a.toString()}})});else{w.LOG(n(),i);a={attachmentObjectId:c,mediaType:E,messageId:x.externalId,messageTimeStamp:a,msgId:y,plaintextHash:e,productType:d("MAWConfig").getConfig().productTypeForEBAttachments,threadId:d("WAJids").threadIdForChatJid(x.chat),threadJid:x.chat};void d("MAWHandleEchoMediaMsgsRestoreV2").invokeRestoreAccessCheckSprocToDownloadAttachment(x.externalId,a,g)}}).then(function(){f.addPoint("resign_cdn_url_end")})["catch"](function(a){w.ERROR(m(),a),f.addPoint("resign_cdn_url_fail")}));f.endFail("maw_post_download_fail");w.LOG(l(),y);w.ERROR(k(),A.error);yield B(y);d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:d("MAWMediaDownloadStatusForUI").getStatusFromWAAPIDownloadMediaError(A.error),type:"main"});return}A.success;D=A.value;A=D.mimeType;D=D.plaintext;var F=d("WAIsWebP").isWebP(new Uint8Array(D))||d("WAIsMp4").isMp4(new Uint8Array(D));if(F){F=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_VALIDATE,{string:{downloadEntry:f.downloadEntry,mediaType:a.serverMediaType,msgType:g}},void 0,d("WAPREMetrics").QPL_DEFAULT_TIMEOUT_IN_MS);f.addPoint("validate_media_start");a=(yield d("WAValidateMedia").validateMedia(D,babelHelpers["extends"]({},F,{downloadEntry:f.downloadEntry})));if(a.success===!1){F.endFail(a.error);f.addPoint("validate_media_fail");f.endFail(a.error);w.LOG(j(),y);w.ERROR(i(),a.error);yield B(y);d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE,type:"main"});return}g=a.value;a=g.mimeType;var G=g.skipValidation;g.validatedPlaintext;w.LOG(h(),G);F.endSuccess({bool:{is_validation_skipped:G},string:{validated_mime_type:a}});f.addPoint("validate_media_end",{bool:{is_validation_skipped:G}})}g=D;f.addPoint("handle_media_download_start");F=(yield d("MAWHandleMediaDownloadApi").handleMediaDownload(e,A,g,x));F.success?(f.addPoint("handle_media_download_end"),d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:c("MAWMediaDownloadStatus").SUCCESS,type:"main"})):(f.addPoint("maw_post_download_fail"),f.endFail("handle_media_download_fail_"+F.error),d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:e,status:c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE,type:"main"}));f.addPoint("maw_post_download_end");f.endSuccess()});return y.apply(this,arguments)}function z(a){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("MAWDeletedMsgApi").getDeletedMsgByProtocolIdApi(a));return!a?!1:a.reason===d("MAWDbDeletedMessages").DbDeletedMsgReasonEnum.ChatDelete||a.reason===d("MAWDbDeletedMessages").DbDeletedMsgReasonEnum.Revoke});return A.apply(this,arguments)}function B(a){return C.apply(this,arguments)}function C(){C=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;yield d("MAWIndexedDb").makeMsgrTransactor({chunk:(b=d("MAWTransactionMode")).READONLY,media:b.READONLY,messages:b.READWRITE,receiverFetchInfo:b.READONLY,xma:b.READONLY},"downloadMedia",function(a){return function(b,c){return d("MAWDbMsgTxns").updateSystemAck(a,b,c)}})(a,d("MAWAckLevel").ACK.failed)});return C.apply(this,arguments)}g.downloadAndHandleMedia=a;g.downloadAndHandleMediaImpl=x}),98);
__d("MAWGetMediaByObjectId",["MAWDbMediaTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WAMediaUtils","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY,mediaBackup:d("MAWTransactionMode").READONLY},"getMediaByObjectId",function(a){return function(b){return d("MAWDbMediaTxns").maybeGetMediaFromObjectId(a,d("WAMediaUtils").stringToDeliveryObjectId(b)).then(function(a){return!a?d("WAResultOrError").makeError("media-not-found"):d("WAResultOrError").makeResult(a)})}});b=d("MAWIndexedDb").makeMsgrTransactor({mediaBackup:d("MAWTransactionMode").READONLY},"getMediaBackupByObjectId",function(a){return function(b){return d("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId(a,d("WAMediaUtils").stringToDeliveryObjectId(b)).then(function(a){return!a?d("WAResultOrError").makeError("mediaBackup-not-found"):d("WAResultOrError").makeResult(a)})}});c=function(a){return d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY},"getMediaByMessageId",function(b){return function(){return a==null?d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("media-not-found")):d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(b,a).then(function(a){return!a?d("WAResultOrError").makeError("media-not-found"):d("WAResultOrError").makeResult(a)})}})()};g.getMediaByObjectId=a;g.getMediaBackupByObjectId=b;g.getMediaByHash=c}),98);
__d("MAWHandleMediaDownloadAndRestoreApi",["MAWDbMediaTxns","MAWDbMsgTxns","MAWDexieTable","MAWEBBackendQPLUtils","MAWIndexedDb","MAWMediaManagementTxns","MAWTransactionMode","WAJids","WAMediaUtils","WATagsLogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media entry missing from the db"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message not found. isMsgIdNull: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][MAWHandleMediaDownloadAndRestoreApi] media entries missing from the db"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][MAWHandleMediaDownloadAndRestoreApi] media entry missing for msgId"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][MAWHandleMediaDownloadAndRestoreApi] thread jid or author is missing from the db"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][MAWHandleMediaDownloadAndRestoreApi] media backup row missing from the db"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][MAWHandleMediaDownloadAndRestoreApi] thread jid or author is missing from the db"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][MAWHandleMediaDownloadAndRestoreApi] media entry missing for msgId"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][MAWHandleMediaDownloadAndRestoreApi] media entries missing from the db"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message not found. isMsgIdNull: false"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] hash is null"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] msgId is null"]);s=function(){return a};return a}a=function(a,b,e,f){var g=d("WAMediaUtils").stringToDeliveryObjectId(a);return d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE},"writeCdnUrlAndBakeDownloadPayload",function(a){return function(){if(c("gkx")("4663"))if(e==null)d("WATagsLogger").TAGS(["labyrinth_web","mi_media_restore"]).ERROR(s());else if(f==null)d("WATagsLogger").TAGS(["labyrinth_web","mi_media_restore"]).ERROR(r());else return t(a,b,e,f);return u(a,g,b)}})()};function t(a,b,c,e,f){return d("MAWDbMsgTxns").maybeGetMsg(a,c).then(function(g){if(g==null){d("WATagsLogger").TAGS(["labyrinth_web","mi_media_restore"]).ERROR(q());var h=!1;d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLPoint(f,"no_message_for_media",{bool:{isMsgIdNull:h}});return d("MAWDexieTable").dexieResolve()}return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,e).then(function(e){var h=e==null?void 0:e.mediaEntries;if(e==null||h==null){d("WATagsLogger").TAGS(["labyrinth_web","mi_media_restore"]).ERROR(p());d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLPoint(f,"no_media_entries");return d("MAWDexieTable").dexieResolve()}h=h.get(c);if(h==null){d("WATagsLogger").TAGS(["labyrinth_web","mi_media_restore"]).ERROR(o());d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLPoint(f,"no_media_entry_for_msgId");return d("MAWDexieTable").dexieResolve()}var i=e.hashedPlaintextHash;return v(a,h,b,i,c).then(function(a){var c=g.author,h=g.threadJid;if(h!=null&&!d("WAJids").isAuthorSystem(c)){d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLPoint(f,"create_media_download_metadata");return w(e,e.mediaType,g.externalId,i,h,c,b,(h=a)!=null?h:void 0)}else d("WATagsLogger").TAGS(["labyrinth_web","mi_media_restore"]).ERROR(n()),d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLPoint(f,"no_thread_jid_or_author")})})})}function u(a,b,c,e){var f;b=d("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId(a,b).then(function(b){b==null&&(d("WATagsLogger").TAGS(["labyrinth_web","mi_media_restore"]).ERROR(m()),d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLPoint(e,"no_media_backup_row"));f=b;return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,(b=f)==null?void 0:b.mediaId)});return b.then(function(b){if(b!=null){var g,m=(g=f)==null?void 0:g.msgId;return d("MAWDbMsgTxns").maybeGetMsg(a,m).then(function(f){if(m!=null&&f!=null){var g=b==null?void 0:b.mediaEntries;if(g!=null){g=g.get(m);if(g!=null){var h=b.hashedPlaintextHash;return v(a,g,c,h,m).then(function(a){var g=f.threadJid,i=f.author,j=b.mediaType;if(g!=null&&!d("WAJids").isAuthorSystem(i)){d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLPoint(e,"create_media_download_metadata");return w(b,j,f.externalId,h,g,i,c,(j=a)!=null?j:void 0)}else d("WATagsLogger").TAGS(["labyrinth_web","mi_media_restore"]).ERROR(l()),d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLPoint(e,"no_thread_jid_or_author")})}else d("WATagsLogger").TAGS(["labyrinth_web","mi_media_restore"]).ERROR(k()),d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLPoint(e,"no_media_entry_for_msgId")}else d("WATagsLogger").TAGS(["labyrinth_web","mi_media_restore"]).ERROR(j()),d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLPoint(e,"no_media_entries")}else{g=m==null;d("WATagsLogger").TAGS(["labyrinth_web","mi_media_restore"]).ERROR(i(),g);d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLPoint(e,"no_message_for_media",{bool:{isMsgIdNull:g}})}})}else d("WATagsLogger").TAGS(["labyrinth_web","mi_media_restore"]).ERROR(h());return d("MAWDexieTable").dexieResolve()})}function v(a,b,c,e,f){b=d("WAMediaUtils").decodeMediaEntryData(b);var g=b.directPath;b=d("WAMediaUtils").encodeMediaEntryWithUpdatedPath(b,c);return d("MAWMediaManagementTxns").updateMediaWithEncodedMediaEntryData(a,e,f,b).then(function(){return g})}function w(a,b,c,d,e,f,g,h){var i=a.plaintextHash;if(b==="Video"){var j,k,l,m,n;j=(j=a.validatedVideoInfo)==null?void 0:j.width;k=(k=a.validatedVideoInfo)==null?void 0:k.height;l=(l=a.validatedVideoInfo)==null?void 0:l.jpegThumbnailWidth;m=(m=a.validatedVideoInfo)==null?void 0:m.jpegThumbnailHeight;n=(n=a.validatedVideoInfo)==null?void 0:n.duration;return{author:f,directPath:g,externalId:c,hashedPlaintextHash:d,height:k,mediaPlayableDuration:n,mediaType:b,oldDirectPath:h,plaintextHash:i,previewContentHeight:m,previewContentWidth:l,threadJId:e,width:j}}else if(b==="Image"||b==="Sticker"||b==="Gif"){n=(k=a.validatedImageInfo)==null?void 0:k.width;l=(m=a.validatedImageInfo)==null?void 0:m.height;k=(j=a.validatedImageInfo)==null?void 0:j.jpegThumbnailWidth;j=(m=a.validatedImageInfo)==null?void 0:m.jpegThumbnailHeight;return{author:f,directPath:g,externalId:c,hashedPlaintextHash:d,height:l,mediaType:b,oldDirectPath:h,plaintextHash:i,previewContentHeight:j,previewContentWidth:k,threadJId:e,width:n}}else if(b==="Ptt"){l=(m=a.validatedAudioInfo)==null?void 0:m.duration;return{author:f,directPath:g,externalId:c,hashedPlaintextHash:d,mediaPlayableDuration:l,mediaType:b,oldDirectPath:h,plaintextHash:i,threadJId:e}}}g.writeCdnUrlAndBakeDownloadPayload=a;g.writeCdnUrlAndBakeDownloadPayloadTxnV2=t;g.writeCdnUrlAndBakeDownloadPayloadTxn=u}),98);
__d("MAWDownloadAndRestoreMedia",["LSDataTraceCheckPoint","LSIntEnum","MAWEBBackendQPLUtils","MAWGetMediaByObjectId","MAWHandleEchoMediaMsgsRestoreV2","MAWHandleMediaDownloadAndRestoreApi","MAWJobManager","MAWTraceUtils","WALogger","WAMediaUtils","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] downloadAndRestoreMedia job completed. traceId: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] cdn url mismatch between media entry direct path and restoration cdn url. traceId: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media entry is missing for msgId: ",". traceId: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] media not found in the media table or message id missing. traceId: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] download metadata is missing. traceId: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] downloadAndRestoreMedia job started. traceId: ",""]);n=function(){return a};return a}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("downloadAndRestoreMedia",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.deliveryObjectId,e=a.msgId,f=a.plaintextHash,g=a.restorationCdnUrl;a=a.traceId;d("WALogger").LOG(n(),a);d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLPoint(a,"download_and_restore_media_start");var p=(yield d("MAWHandleMediaDownloadAndRestoreApi").writeCdnUrlAndBakeDownloadPayload(b,g,e,f));if(p==null){d("WALogger").ERROR(m(),a);d("MAWTraceUtils").recordFailureAndFlushForTraceId(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_RESTORE_FAILURE),[],"Download metadata is missing");d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLEndFailure(a,"media_entry_missing");return}f=c("gkx")("4663")&&f!=null?yield d("MAWGetMediaByObjectId").getMediaByHash(f):yield d("MAWGetMediaByObjectId").getMediaByObjectId(b);b=(yield o(e,b));var q=b.isQueryable;b=b.messageId;if(f.success===!1||!q||b==null){d("WALogger").ERROR(l(),a);d("MAWTraceUtils").recordFailureAndFlushForTraceId(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_RESTORE_FAILURE),[],"Media data missing for deliveryObjectId");d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLEndFailure(a,"media_not_found");return}q=f.value.mediaEntries.get(b);if(q==null){d("WALogger").ERROR(k(),e,a);d("MAWTraceUtils").recordFailureAndFlushForTraceId(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_RESTORE_FAILURE),[],"Media entry data missing for deliveryObjectId");d("MAWEBBackendQPLUtils").logMediaRestoreFromMIQPLEndFailure(a,"media_entry_missing");return}f=d("WAMediaUtils").decodeMediaEntryData(q);e=(b=f==null?void 0:f.directPath)!=null?b:void 0;e!==g&&d("WALogger").ERROR(j(),a);yield d("MAWHandleEchoMediaMsgsRestoreV2").handleDownloadMedia(p,a,void 0,g,f);d("WALogger").LOG(i(),a)});return function(b){return a.apply(this,arguments)}}()).end();function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(c("gkx")("4663"))return{isQueryable:a!=null,messageId:a};else{a=(yield d("MAWGetMediaByObjectId").getMediaBackupByObjectId(b));return{isQueryable:a.success,messageId:a.success?a.value.msgId:null}}});return p.apply(this,arguments)}g.downloadAndRestoreMedia=a}),98);
__d("MAWEBScheduler",["WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){h==null&&(h=d("WorkerScheduler").makeScheduler("eb",{concurrency:1,maxConcurrency:2,maxThrottleMs:400}));return h}g.ebScheduler=a}),98);
__d("MAWRestoreBridgeUtils",["MAWBridge","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(a==null)return;var c=d("WAResultOrError").makeResult({traceId:a});b!=null&&(c=d("WAResultOrError").makeError({message:b,traceId:a}));d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"FulfillRestorePromise",value:c}]})}g.issueFulfillRestorePromiseBridgeEvent=a}),98);
__d("MAWRestoreMessagesFromEchoDocuments",["MAWBridge","MAWEBRestoreTrackingUtils","MAWHandleEchoMsgsRestoreApiV2","MAWRestoreBridgeUtils","MAWUpdateClientRestoreStatusOperationType","Promise","WALogger","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Encountered unhandled exception while running job restoreMessagesFromEncryptedBackups: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Job restoreMessagesFromEncryptedBackups, thread: ",", messages count: ",""]);j=function(){return a};return a}function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.deanonApiPayload,e=a.hasMoreAfter,f=a.hasMoreBefore,g=a.instanceKey,k=a.isPointQuery,l=a.messages,m=a.minMsgId,n=a.optimisticMsgs,o=a.skipMediaDownload,p=a.startSortKey,q=a.taskSource,r=a.threadId,s=a.traceId;a=a.uploadedFromEBQueue;var t={messageIds:[],pendingRestoreSortKeys:[]};t=d("WAResultOrError").makeResult(t);try{d("WALogger").LOG(j(),r,l.length);l=(yield d("MAWHandleEchoMsgsRestoreApiV2").handleEchoMsgsBulkRestore(r,l,k,f,e,m,s,p,g,n,q,void 0,c,a,o));s!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"worker_end",traceId:s});d("MAWRestoreBridgeUtils").issueFulfillRestorePromiseBridgeEvent(s);return l}catch(a){d("WALogger").ERROR(i(),a),d("MAWRestoreBridgeUtils").issueFulfillRestorePromiseBridgeEvent(s,a.message)}finally{p==null&&d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"UpdateClientRestoreStatus",value:{action:d("MAWUpdateClientRestoreStatusOperationType").markCompleteClientRestoreStatus,ebPrefetch:!1,threadId:r}}]})}return(h||(h=b("Promise"))).resolve(t)});return k.apply(this,arguments)}g.restoreEchoMsgs=a}),98);
__d("MAWHandleEBProtobufRestoreWithCOP",["LSMEBTaskCreationSource","MAWCOPMessagesHandler","MAWHandleEchoMsgsRestoreApiUtils","MAWJids","MAWQplProxy","MAWSharedCOP","MessageBackupSupplementalKeyGenerator","WAArmadilloBackupMessage.pb","WAHashStringToNumber","WAJids","WALogger","WALongInt","WAMsgApplication.pb","WAProtocolQueue","WAStanzaUtils","WATimeUtils","asyncToGeneratorRuntime","decodeProtobuf","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Protobuf restore initiated for "," messages. isPointRestore: ",""]);h=function(){return a};return a}function i(a,b,c,e,f){var g,h,i;a=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloBackupMessage.pb").BackupMessageSpec,a);e=(e=e)!=null?e:(e=a.metadata)==null?void 0:e.messageId;g=(g=a.metadata)==null?void 0:g.timestampMs;f=f!=null?d("MessageBackupSupplementalKeyGenerator").getSupplementalSenderId(f):(f=a.metadata)==null?void 0:f.senderId;if(e==null||g==null||f==null)return;a=d("decodeProtobuf").decodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,a.payload);h=(h=a.payload)==null?void 0:(h=h.subProtocol)==null?void 0:h.consumerMessage;i=(i=a.payload)==null?void 0:(i=i.subProtocol)==null?void 0:i.armadillo;var j;if(h!=null){if(h.payload==null)return;j={payload:new Uint8Array(h.payload),subprotocolType:"consumerMessage",type:"success"}}else if(i!=null){if(i.payload==null)return;j={payload:new Uint8Array(i.payload),subprotocolType:"armadillo",type:"success"}}if(j==null)return null;i={icdc:null,metadata:(h=a.metadata)!=null?h:null,protobuf:new Uint8Array(0),subprotocol:j.payload,subprotocolType:j.subprotocolType,type:"subprotocol",version:"v3"};return{contentType:null,ebTimestampMs:b,fbFolderId:null,from:d("WAJids").defaultDeviceJidForUser(d("MAWJids").toUserJid(f)),incomingType:"ebrestore",jid:c,message:i,offline:null,priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow,recipient:null,remoteIdentity:null,reportingMeta:null,retryCount:0,serverTs:d("WATimeUtils").castMilliSecondsToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(g)),stanzaId:d("WAStanzaUtils").toStanzaId(e),subtype:"armadillo",type:"message"}}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.deanonApiPayload,e=a.decryptedMessagesProtobufs,f=a.isPointRestore,g=a.referenceTimestamp,j=a.requestId,k=a.taskSource;a=a.threadJidPrimaryId;d("WALogger").LOG(h(),e.length,f);k!=null&&k===c("LSMEBTaskCreationSource").MSGR_DYI;k=f?d("MAWHandleEchoMsgsRestoreApiUtils").MAWRestoreType.POINT_RESTORE:g!=null?d("MAWHandleEchoMsgsRestoreApiUtils").MAWRestoreType.PAGINATED_RESTORE:d("MAWHandleEchoMsgsRestoreApiUtils").MAWRestoreType.INITIAL_RESTORE;f=k;if(j!=null){d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(521476165,"2432"),"restore_protobuf_with_COP_start",{annotations:{"int":{deanon_count:(g=b==null?void 0:b.length)!=null?g:0,deanon_input_gap:((k=b==null?void 0:b.length)!=null?k:0)-e.length,input_count:e.length},string:{message_backup_type:"protobuf",restore_type:f}},instanceKey:d("WAHashStringToNumber").hashStringToNumber(j)},!1)}var l=[],m=d("MAWJids").toUserJid(a);j!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(521476165,"2432"),"restore_protobuf_cop_decode",{instanceKey:d("WAHashStringToNumber").hashStringToNumber(j)},!1);g=e.length;b=e.reduce(function(a,b){return a+b.supplementalProtobufs.size},0);e.forEach(function(a){var b=d("WAStanzaUtils").toStanzaId(a.otid);l.push(i(a.toplevelProtobuf.decryptedProtobuf,a.toplevelProtobuf.protobufTimestampMS,m,b,null));a.supplementalProtobufs.forEach(function(a,b){l.push(i(a.decryptedProtobuf,a.protobufTimestampMS,m,null,b))})});j!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(521476165,"2432"),"restore_protobuf_cop_enqueue",{annotations:{"int":{decoded_count:l.length,input_decode_gap:l.length-g-b}},instanceKey:d("WAHashStringToNumber").hashStringToNumber(j)},!1);var n=0;k=l.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{stanzaQueueId:d("WAProtocolQueue").numberToStanzaQueueId(n++)})});f=(yield c("MAWCOPMessagesHandler")(k,d("MAWSharedCOP").getCOP().queue));if(j!=null){var o=new Set(f),p=new Set(e.map(function(a){return d("WAStanzaUtils").toStanzaId(a.otid)}));d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(521476165,"2432"),"restore_with_COP_end",{annotations:{"int":{ack_top_level_gap:k.filter(function(a){return!o.has(a.stanzaQueueId)&&p.has(a.stanzaId)}).length,ack_total_gap:k.length-f.length}},instanceKey:d("WAHashStringToNumber").hashStringToNumber(j)},!1)}});return j.apply(this,arguments)}g.handleProtobufsRestore=a}),98);
__d("MAWRestoreMessagesFromProtobufs",["MAWBridge","MAWEBRestoreTrackingUtils","MAWHandleEBProtobufRestoreWithCOP","MAWHandleEchoProtobufsRestoreApi","MAWRestoreBridgeUtils","MAWUpdateClientRestoreStatusOperationType","Promise","WATagsLogger","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Encountered unhandled exception while running job restoreProtobufsFromEncryptedBackups: ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.requestId;try{var f=(yield c("gkx")("5029")?d("MAWHandleEBProtobufRestoreWithCOP").handleProtobufsRestore(a):d("MAWHandleEchoProtobufsRestoreApi").handleProtobufsRestore(a));e!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"worker_end",traceId:e});d("MAWRestoreBridgeUtils").issueFulfillRestorePromiseBridgeEvent(e);return f}catch(a){d("WATagsLogger").TAGS(["labyrinth_web","protobuf_restore",(f=e)!=null?f:"no_requestId"]).ERROR(i(),a);d("MAWRestoreBridgeUtils").issueFulfillRestorePromiseBridgeEvent(e,a.message)}finally{a.referenceTimestamp==null&&d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"UpdateClientRestoreStatus",value:{action:d("MAWUpdateClientRestoreStatusOperationType").markCompleteClientRestoreStatus,ebPrefetch:!1,threadId:a.threadJidPrimaryId}}]});return(h||(h=b("Promise"))).resolve()}});return j.apply(this,arguments)}g.restoreFromProtobufs=a}),98);
__d("MAWEbRestoreQueue",["MAWJobDefinitions","MAWRestoreMessagesFromEchoDocuments","MAWRestoreMessagesFromProtobufs","MWEBODSCategory","MWEBODSEntityName.enum","ODS","Promise","WAPersistedQueue","WAPersistedQueueApi","WAPromiseQueue","WATagsLogger","WAWaitForUserUnblocked","asyncToGeneratorRuntime","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["No protobuf or echo messages to restore for thread: "," startSortKey: "," isPointRestore: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Finished restoring EB echo messages for thread: "," traceId: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Restoring EB echo messages for thread: "," traceId: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Finished restoring EB protobuf messages for thread: "," traceId: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Restoring EB protobuf messages for thread: "," traceId: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing EB Restore Queue entries: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to flush ebRestoreQueue ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to write to ebRestoreQueue ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["EB Restore Queue is already initialized"]);r=function(){return a};return a}var s=d("WATagsLogger").TAGS(["labyrinth_web","EbRestoreQueue"]),t=new Set(),u=null;function v(){return u==null?w():u}function w(){u!=null&&s.ERROR(r());var a=d("WAPersistedQueue").initPersistedQueue("ebRestoreQueue",d("WAPersistedQueueApi").dexieApiForPersistedQueue());u=a;return a}function a(a){if(!c("gkx")("23935"))return(i||(i=b("Promise"))).resolve();(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MAW_EB_RESTORE_QUEUE,"add",a.length);var e=v();return e.addAndCommit(a)["catch"](function(a){s.ERROR(q(),a)})}var x=(i||(i=b("Promise"))).resolve();function e(){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!c("gkx")("23935"))return;var a=v();yield d("WAWaitForUserUnblocked").waitForUserUnblocked();yield A(!0);a.subscribe(function(a){a.type==="flush"&&(x=x.then(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWaitForUserUnblocked").waitForUserUnblocked();return A()}))["catch"](function(a){s.ERROR(p(),a);return(i||(i=b("Promise"))).resolve()}))})});return y.apply(this,arguments)}var z=new(d("WAPromiseQueue").PromiseQueue)();function A(a){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=v();e=(yield e.read({filter:function(a){return!t.has(a.queueId)},limit:c("justknobx")._("2368"),order:"asc"}));e.length!==0&&e.forEach(function(a){t.add(a.queueId)});if(e.length===0)return(i||(i=b("Promise"))).resolve();a===!0&&(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MAW_EB_RESTORE_QUEUE,"initial.flush");s.LOG(o(),e.length);e.forEach(function(a){void z.enqueue(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(a.protobufMsgs!=null){var b,e=D(a);(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MAW_EB_RESTORE_QUEUE,"flush.protobuf");s.LOG(n(),e.threadJidPrimaryId,(b=e.requestId)!=null?b:"no_trace_id");yield d("MAWRestoreMessagesFromProtobufs").restoreFromProtobufs(e);s.LOG(m(),e.threadJidPrimaryId,(b=e.requestId)!=null?b:"no_trace_id")}else if(a.echoMessages!=null){(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MAW_EB_RESTORE_QUEUE,"flush.echo");e=C(a);s.LOG(l(),e.threadId,(b=e.traceId)!=null?b:"no_trace_id");yield d("MAWRestoreMessagesFromEchoDocuments").restoreEchoMsgs(e);s.LOG(k(),e.threadId,(b=e.traceId)!=null?b:"no_trace_id")}else{(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MAW_EB_RESTORE_QUEUE,"flush.error");s.ERROR(j(),a.threadJidPrimaryId,(e=a.startSortKey)!=null?e:"null",a.isPointRestore)}yield v().ack([a.queueId])}))});return(i||(i=b("Promise"))).resolve()});return B.apply(this,arguments)}function C(a){a={deanonApiPayload:a.deanonApiPayload,hasMoreAfter:a.hasMoreAfter,hasMoreBefore:a.hasMoreBefore,instanceKey:a.instanceKey,isPointQuery:a.isPointRestore,messages:a.echoMessages!=null?a.echoMessages.map(function(a){return d("MAWJobDefinitions").toEncodedEchoMessage(a)}):[],minMsgId:a.minMsgId,optimisticMsgs:a.optimisticMsgs,skipMediaDownload:a.skipMediaDownload,startSortKey:a.startSortKey,taskSource:a.taskSource,threadId:a.threadJidPrimaryId,traceId:a.traceId,uploadedFromEBQueue:!0};return a}function D(a){var b;b={currentUserJid:a.currentUserJid,deanonApiPayload:a.deanonApiPayload,decryptedMessagesProtobufs:(b=a.protobufMsgs)!=null?b:[],echoMessages:a.echoMessages,hasMoreAfter:a.hasMoreAfter,hasMoreBefore:a.hasMoreBefore,instanceKey:a.instanceKey,isPointRestore:a.isPointRestore,minMsgId:a.minMsgId,referenceTimestamp:a.startSortKey,requestId:a.traceId,skipMediaDownload:a.skipMediaDownload,taskSource:a.taskSource,threadJidPrimaryId:a.threadJidPrimaryId,transportKey:"msgr",uploadedFromEbQueue:!0};return b}g.ebRestoreQueue=v;g.initEbRestoreQueue=w;g.putMsgsToEbRestore=a;g.listenForEbRestoreQueueFlush=e;g.restoreEBMsgs=A}),98);
__d("MAWSharedEBUtils",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return Date.now()-a>d("WATimeUtils").DAY_MILLISECONDS*30};g.entryOlderThan30Days=a}),98);
__d("MAWEbUploadQueue",["EBUploadMessages","MAWEBScheduler","MAWEBSwitch","MAWEBUploadTrackingUtils","MAWGetMsgByProtocolIdApi","MAWSharedEBUtils","MAWSharedEbUploadQueue","WAGlobals","WAJids","WAMsgMap","WAShiftTimer","WAWaitForUserUnblocked","WorkerScheduler","asyncToGeneratorRuntime","gkx","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot get message from db: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["upload queue uploading "," messages"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose([""," cannot process EB upload"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["upload queue - instanceKey not found from uploadTrackingInstanceKeyMap, in checkMsgExist msg found 2"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["upload queue - instanceKey not found from uploadTrackingInstanceKeyMap, in checkMsgExist msg not found 1"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["upload queue - instanceKey not found from uploadTrackingInstanceKeyMap, in checkMsgExist msg found"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose([""," cannot process EB upload"]);n=function(){return a};return a}var o=d("MAWSharedEbUploadQueue").logger.TAGS(["labyrinth-web"]),p=new Map(),q=new Map(),r=new(d("WAShiftTimer").ShiftTimer)(a),s=null;function t(){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWaitForUserUnblocked").waitForUserUnblocked();var a=!0;if(s!=null)return;s=d("MAWEBScheduler").ebScheduler().run({dedupe:!0,fn:function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(c("MAWEBSwitch").isEnabled()){var b=(yield x());b=b.isEmpty;a=!b}else d("MAWEBUploadTrackingUtils").getUploadQueueStartedCache().forEach(function(a,b){d("MAWEBUploadTrackingUtils").endSuccessWorkerOnly(a,"upload_queue_run_timer_eb_disabled"),d("MAWEBUploadTrackingUtils").removeExternalIdFromUploadQueueStartedCache(b)}),a=!1});function f(){return e.apply(this,arguments)}return f}(),name:"eb_upload",priority:d("WorkerScheduler").BACKGROUND_PRIORITY});s.promise["catch"](function(a){o.ERROR(j(),a),p.forEach(function(b,c,e){d("MAWEBUploadTrackingUtils").endFailWorkerOnly(c,"upload_eb_msgs_error",{string:{reason:a}})}),p.clear()})["finally"](function(){s=null,a&&void t()})});return u.apply(this,arguments)}function a(){c("MAWEBSwitch").isEnabled()?void x()["catch"](function(a){o.ERROR(n(),a),p.forEach(function(b,c,e){d("MAWEBUploadTrackingUtils").endFailWorkerOnly(c,"upload_eb_msgs_error",{string:{reason:a}})}),p.clear(),r.onOrAfter(c("justknobx")._("2366"))}):(d("MAWEBUploadTrackingUtils").getUploadQueueStartedCache().forEach(function(a,b){d("MAWEBUploadTrackingUtils").endSuccessWorkerOnly(a,"upload_queue_run_timer_eb_disabled"),d("MAWEBUploadTrackingUtils").removeExternalIdFromUploadQueueStartedCache(b)}),r.onOrAfter(c("justknobx")._("2366")))}function v(){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(c("gkx")("5625")){c("promiseDone")(t());return}yield d("WAWaitForUserUnblocked").waitForUserUnblocked();r.onOrBefore(c("justknobx")._("2367"))});return w.apply(this,arguments)}function e(){c("MAWEBSwitch").onSet(function(){c("MAWEBSwitch").isEnabled()&&c("promiseDone")(v())});c("promiseDone")(v());var a=d("MAWSharedEbUploadQueue").ebUploadQueue();a.subscribe(function(a){a.type==="flush"&&c("promiseDone")(v())})}function x(){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("MAWSharedEbUploadQueue").ebUploadQueue(),b=[],e=(yield a.read({filter:function(a){if(a.sortOrderMs==null||d("MAWSharedEBUtils").entryOlderThan30Days(a.sortOrderMs)){b.push(a.queueId);return!1}else return!p.has(d("MAWEBUploadTrackingUtils").genInstanceKeyForUploadQueue(a.msgId))},limit:c("justknobx")._("2368"),order:"desc"}));yield a["delete"](b);if(e.length===0)return{isEmpty:!0};o.LOG(i(),e.length);a=new(d("WAMsgMap").MsgMap)(e.map(function(a){d("MAWEBUploadTrackingUtils").checkUploadQueueStartedCache(a.msgId.externalId)&&d("MAWEBUploadTrackingUtils").addPointWorkerOnly(d("MAWEBUploadTrackingUtils").genInstanceKeyForUploadQueue(a.msgId),"upload_queue_processing");return[a.msgId,a]}));e=e.map(function(a){var b;return{backupActionType:a.backupActionType,msgId:a.msgId,originalMsgProtocolId:(b=a.backupDirective)==null?void 0:b.originalMsgProtocolId,protobuf:a.protobuf,senderId:a.senderId,serverTs:a.serverTs,sortOrderMs:a.sortOrderMs,supplementalKey:a.supplementalKey}});var f=new Map(),g=a.values().map(function(a){d("MAWEBUploadTrackingUtils").checkUploadQueueStartedCache(a.msgId.externalId)&&d("MAWEBUploadTrackingUtils").addPointWorkerOnly(d("MAWEBUploadTrackingUtils").genInstanceKeyForUploadQueue(a.msgId),"queue_get_original_msg_id_start",{bool:{is_author_null:a.originalMsgProtocolId.author==null}});if(a.originalMsgProtocolId.author!=null){var b=a.originalMsgProtocolId.author,e=a.originalMsgProtocolId.chat;b={author:d("WAGlobals").getMyUserJid()===a.originalMsgProtocolId.author?d("WAJids").AUTHOR_ME:b,chat:e,externalId:a.backupActionType===4?a.msgId.externalId:a.originalMsgProtocolId.externalId};e=d("MAWEBUploadTrackingUtils").genInstanceKeyForUploadQueue(a.msgId);p.set(e,a.queueId);var g=f.get(b.externalId);if(g!=null){d("MAWEBUploadTrackingUtils").removeExternalIdFromUploadQueueStartedCache(a.msgId.externalId)&&d("MAWEBUploadTrackingUtils").endSuccessWorkerOnly(e,"queue_original_id_duplicated");q.set(g,((g=q.get(g))!=null?g:new Set()).add(e));return null}else f.set(b.externalId,e);!d("MAWEBUploadTrackingUtils").removeExternalIdFromUploadQueueStartedCache(a.msgId.externalId)?d("MAWEBUploadTrackingUtils").startUploadTracking(b.externalId,null,"uploadqueue",e,!0):d("MAWEBUploadTrackingUtils").addPointWorkerOnly(e,"queue_non_retry_item");return b}else{d("MAWEBUploadTrackingUtils").endFailWorkerOnly(d("MAWEBUploadTrackingUtils").genInstanceKeyForUploadQueue(a.msgId),"queue_no_author_or_chat",{bool:{is_author_null:a.originalMsgProtocolId.author==null}});c("promiseDone")(d("MAWSharedEbUploadQueue").ebUploadQueue().ack([a.queueId]));return null}}).filter(Boolean);f.forEach(function(a,b){d("MAWEBUploadTrackingUtils").addPointWorkerOnly(a,"queue_get_original_msg_ids_done",{int_array:{supplemental_trace_ids:Array.from((b=q.get(a))!=null?b:[])}})});a=(yield d("MAWGetMsgByProtocolIdApi").getMsgsByProtocolMsgIdsTxn(g)["catch"](function(a){g.forEach(function(b){b=f.get(b.externalId);b!=null?d("MAWEBUploadTrackingUtils").endFailWorkerOnly(b,"get_db_msgs_error",{string:{reason:a}}):o.WARN(h(),a)});throw a}));f.forEach(function(a,b){d("MAWEBUploadTrackingUtils").addPointWorkerOnly(a,"queue_get_msgs_done")});A(f,g,a);yield d("EBUploadMessages").uploadMessageFromUploadQueue(a,f,e);c("gkx")("5625")||r.onOrBefore(c("justknobx")._("2366"));return{isEmpty:!1}});return y.apply(this,arguments)}function f(a,b){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b?d("MAWEBUploadTrackingUtils").endSuccessWorkerOnly(a,"upload_queue_ack_worker_success"):d("MAWEBUploadTrackingUtils").endFailWorkerOnly(a,"upload_queue_ack_worker_fail");b=p.get(a);if(b==null)return;yield d("MAWSharedEbUploadQueue").ebUploadQueue().ack([b]);p["delete"](a);c("promiseDone")(v())});return z.apply(this,arguments)}function A(a,c,e){if(c.length>e.length){var f=new Set(c.map(function(a){return a.externalId}));e.forEach(function(b){if(f.has(b.externalId)){f["delete"](b.externalId);var c=a.get(b.externalId);c!=null?d("MAWEBUploadTrackingUtils").addPointWorkerOnly(c,"msg_found",{string:{msgType:b.type}}):o.WARN(m())}});f.forEach(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=a.get(b);if(b!=null){d("MAWEBUploadTrackingUtils").endSuccessWorkerOnly(b,"upload_queue_msg_not_found");var c=p.get(b);p["delete"](b);if(c==null)return;yield d("MAWSharedEbUploadQueue").ebUploadQueue()["delete"]([c])}else o.WARN(l())});return function(a){return c.apply(this,arguments)}}())}else e.forEach(function(b){var c=a.get(b.externalId);c!=null?d("MAWEBUploadTrackingUtils").addPointWorkerOnly(c,"msg_found",{string:{msgType:b.type}}):o.WARN(k())})}g.scheduleNextRun=v;g.listenForEbUploadQueueFlush=e;g.uploadEBMsgs=x;g.ackWithInstanceKey=f}),98);
__d("MAWFetchAndEmitThreadApi",["MAWIndexedDb","MAWThreadFetchAndEmitTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READONLY,groupInfo:a.READWRITE,groupInvites:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READWRITE,reactions:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"fetchAndEmitThread",function(a){return function(b,c){c===void 0&&(c="fetchAndEmitThreadInTxn");return d("MAWThreadFetchAndEmitTxns").fetchAndEmitThread(a,b,void 0,void 0,c)}});g.fetchAndEmitThreadInTxn=b}),98);
__d("MAWGetDownloadableThumbnailForMediaApi",["MAWOptimisticUploadManager","WALogger","WAMediaUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["GetDownloadableThumbnail - previewEntry optimistedPromise rejected with ",""]);h=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("MAWOptimisticUploadManager").getOptimisticUploadManager().get(a);if(a==null)return null;a=a.previewPlaintextHash;if(a==null)return null;var b=d("MAWOptimisticUploadManager").getOptimisticUploadManager().get(a);if(b==null)return null;try{yield b.optimisticUploadPromise}catch(a){d("WALogger").ERROR(h(),a);return null}a=(b=d("MAWOptimisticUploadManager").getOptimisticUploadManager().get(a))==null?void 0:b.mediaEntry;if(a==null)return null;b=d("WAMediaUtils").decodeMediaEntryData(a);a=b.directPath;var c=b.fileEncSha256,e=b.fileSha256,f=b.mediaKey,g=b.mediaKeyTimestamp;b=b.objectId;return{directPath:a,fileEncSha256:c,fileSha256:e,mediaKey:f,mediaKeyTimestamp:g,objectId:b}});return function(b){return a.apply(this,arguments)}}();g.getDownloadableThumbnailForMedia=a}),98);
__d("MAWGetMediaKnownEntriesApi",["MAWDbMediaTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WAHashUtils","WAJids","WAMsgMap","WAResultOrError","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message missing in messages table for given msgId for plaintextHash ",". Skipping..."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["No existing media entry found for plaintextHash ",". Returning new MsgMap."]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["GetMediaKnownEntries"]);a=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY},"getMediaKnownEntries",function(a){return function(b){return k(a,b)}});function k(a,b){return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,b).then(function(c){if(!c){j.LOG(i(),d("WAHashUtils").sanitisePlaintextHash(b));return d("WAResultOrError").makeError("no-media-entry-by-plaintext-hash")}var e=Array.from(c.mediaEntries.keys());return d("MAWDexieTable").dexieAll(e.map(function(b){return d("MAWDbMsgTxns").maybeGetMsgListByMsgId_I_KNOW_WHAT_I_AM_DOING(a,b)})).then(function(a){a=a.map(function(a){return a.find(function(a){return(a==null?void 0:a.mediaId)===c.mediaId})});var f=[];a=a.reduce(function(a,g,i){if(!g){j.WARN(h(),d("WAHashUtils").sanitisePlaintextHash(b));f.push(e[i]);return a}i=c.mediaEntries.get(g.msgId);var k=g.author,l=g.threadJid;i&&!d("WAJids").isAuthorSystem(k)&&l!=null&&a.set({author:k,chat:l,externalId:g.externalId},i);return a},new(d("WAMsgMap").MsgMap)());return{missingMessages:f,msgMap:a,numEntries:e.length}}).then(d("WAResultOrError").makeResult)})}g.getMediaKnownEntries=a;g.getMediaKnownEntriesTxn=k}),98);
__d("MAWGetOrCreateMediaKnownEntriesApi",["MAWGetMediaKnownEntriesApi","MAWIndexedDb","MAWTransactionMode","WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY},"getMediaKnownEntries",function(a){return function(b){return d("MAWGetMediaKnownEntriesApi").getMediaKnownEntriesTxn(a,b).then(function(a){if(a.success===!1)return new(d("WAMsgMap").MsgMap)();else return a.value.msgMap})}});g.getOrCreateMediaKnownEntries=a}),98);
__d("MAWMsgUtil",["MAWDbMsgTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,xma:a.READONLY},"updateSystemAckWithTxn",function(a){return function(b,c){return d("MAWDbMsgTxns").updateSystemAck(a,b,c).then(function(){})}});g.updateSystemAckWithTxn=b}),98);
__d("MAWStartMediaUploadQplFlow",["WAGetStorageQplAnnotations","WAJids","WAMediaQplHelper","WAPREList","WAPREMetrics","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.chatJid,e=a.fileSize,f=a.serverMediaType;a=a.uploadEntry;var g=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_UPLOAD,{string:{chat_type:d("WAJids").switchOnMsgrChatJidType(b,{group:function(){return"group"},user:function(){return"user"}}),jid:b,media_size:d("WAMediaQplHelper").convertIntegerSizeToStringBucket(e),media_type:f,upload_entry:a}},void 0);c("promiseDone")(d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){g.addAnnotations(a)}));return g}g.startMediaUploadQplFlow=a}),98);
__d("MAWGetProtocolMsgIdByMsgId",["MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WAJids"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({messages:(a=d("MAWTransactionMode")).READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY},"getProtocolMsgByMsgId",function(a){return function(b){return d("MAWDexieTable").dexieAll([a.messages.get({msgId:b}),a.unrenderedMessages.get({msgId:b}),a.reactions.get({reactionId:b})]).then(function(b){var c=b[0],e=b[1];b=b[2];if(b!=null)if(d("WAJids").isAuthorSystem(b.author))return null;else return{author:b.author,chat:b.threadJid,externalId:b.externalId};var f=c||e;return f==null?null:a.threads.get({jid:f.threadJid}).then(function(a){if(a==null)return null;return d("WAJids").isAuthorSystem(f.author)?null:{author:f.author,chat:a.jid,externalId:f.externalId}})})}});g.getProtocolMsgIdByMsgId=b}),98);
__d("MAWUpdateMediaEntryForOptimisticUploadApi",["MAWGetProtocolMsgIdByMsgId","MAWOptimisticUploadManager","MAWUpdateMediaEntryForMsgApi","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),h=g.get(a),i=h==null?void 0:h.msgId,j=b();if(i!=null){i=(yield d("MAWGetProtocolMsgIdByMsgId").getProtocolMsgIdByMsgId(i));i&&(yield d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg(a,i,b,e,f))}else{if(!h)throw c("err")("Cannot update mediaEntry without both uploadEntry and msgId");g.set(a,babelHelpers["extends"]({},h,{mediaEntry:j}))}return});return function(b,c,d,e){return a.apply(this,arguments)}}();g.updateMediaEntryForOptimisticUpload=a}),98);
__d("MAWWriteForwardedMsgApi",["MAWAckLevel","MAWBridgeTypesCreators","MAWBridgeXMA","MAWConfig","MAWDbMsg","MAWDbMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWHandleXmaTransactionUtil","MAWIndexedDb","MAWJidUtils","MAWMediaAfterTxns","MAWMediaManagementTxns","MAWMsgType","MAWTransactionMode","MAWWriteMsgTxns","MAWXMAManagementTxns","MAWXMAUtils","WAJids","err","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READWRITE,mediaBackup:a.READWRITE,messages:a.READWRITE,participants:a.READONLY,threads:a.READWRITE,xma:a.READWRITE},"writeForwardedMsg",function(a){return function(b,e,f,g,k,l,m,n,o){l===void 0&&(l=!1);return d("MAWDexieTable").dexieAll([a.threads.get({jid:e}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f),a.messages.where("externalId").equals(b).toArray()]).then(function(e){var p=e[0],q=e[1];e=e[2];if(p==null)return{type:"missing_thread"};if(q==null)return{type:"missing_msg"};if(q.ephemeralSetting!=null&&q.ephemeralSetting.ephemeralExpirationInSec!==0)return{type:"forwarding_ephemeral_msg"};e=e.find(function(a){return a.threadJid===p.jid&&a.author===d("WAJids").AUTHOR_ME});if(e!=null)return e.ack>=d("MAWAckLevel").ACK.sent?{msgId:e.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:p.jid,externalId:e.externalId},type:"already_sent"}:{msgId:e.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:p.jid,externalId:e.externalId},type:"not_sent"};else{e={ack:d("MAWAckLevel").ACK.clock,altIndex:void 0,author:d("WAJids").AUTHOR_ME,ephemeralSetting:k!=null?k:void 0,externalId:b,forwardingScore:((e=q.forwardingScore)!=null?e:0)+1,groupId:m==null?void 0:m.groupId,groupIndex:m==null?void 0:m.groupIndex,groupSize:m==null?void 0:m.groupSize,isForwarded:q.author!==d("WAJids").AUTHOR_ME,mediaId:q.mediaId,msgContent:q.type==="Text"||q.type==="XMA"&&c("gkx")("3194")?q.msgContent:void 0,specialTextSize:q.specialTextSize,threadJid:p.jid,ts:g};var r=h(q.type,e,q.type==="Text"?q.msgContent:{content:""},q.xmaMessageType);return d("MAWWriteMsgTxns").writeMsg(a,r,p,{isFirstMsg:l,openMessageParticipantCount:n,participantCount:o}).then(function(b){return d("MAWDexieTable").dexieAll([j(a,f,b,q,p.jid),i(a,q.mediaId,b,q,p.jid)]).then(function(a){return{msgId:b.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:p.jid,externalId:r.externalId},type:"not_sent"}})})}})}});function h(a,b,e,f){switch(a){case"Text":return babelHelpers["extends"]({},b,{msgContent:e,type:d("MAWMsgType").MSG_TYPE.TEXT});case"Image":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.IMAGE});case"Video":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.VIDEO});case"Ptt":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.PTT});case"Gif":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.GIF});case"Sticker":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.STICKER});case"DocumentFile":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case"XMA":if(f==null)throw c("err")("XMA type is null in forward msg");return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:f});default:throw c("err")("Should not be forwarding a message of type: "+a)}}function i(a,b,e,f,g){b=b!=null?a.media.get({mediaId:b}):d("MAWDexieTable").dexieResolve(null);return b.then(function(b){if(b==null&&d("MAWDbMsg").isMediaMsg(e))throw c("err")("Could not find media of forwarded message");return b!=null?d("MAWMediaManagementTxns").linkMedia(a,e,b.plaintextHash,b.mediaType,b.size,d("MAWConfig").getConfig().encryptForwardedMedia()===!0?null:b.mediaEntries.get(f.msgId),{validatedAudioInfo:b.validatedAudioInfo,validatedDocumentFileInfo:b.validatedDocumentFileInfo,validatedImageInfo:b.validatedImageInfo,validatedVideoInfo:b.validatedVideoInfo},null,null,!1).then(function(e){if(e!=null)return a.messages.where("msgId").anyOf(c("gkx")("5672")?e.msgIds:b.msgIds).toArray().then(function(b){b=d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:g,filteredMsgIds:d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(b,g),hasMediaForUI:!0,media:e});c("gkx")("2616")===!0?d("MAWMediaAfterTxns").handleNewMediaAfterTxnWithBridgeMedia(a,b):d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:b})})}):d("MAWDexieTable").dexieResolve()})}function j(a,b,e,f,g){return!d("MAWXMAUtils").isXMAShare(f.xmaMessageType)?d("MAWDexieTable").dexieResolve():d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,b).then(function(b){if(b==null)return;var h=b.defaultPreviewMediaId,i=b.faviconMediaId,j=b.headerMediaId,k=Array.from(new Set([h,i,j].filter(Boolean)));k=k.map(function(b){return a.media.get(b).then(function(a){if(a==null)throw c("err")("Could not find media of forwarded xma message");return a})});return d("MAWDexieTable").dexieAll(k).then(function(k){k=k.map(function(b){return d("MAWMediaManagementTxns").linkMedia(a,e,b.plaintextHash,b.mediaType,b.size,b.mediaEntries.get(f.msgId),{validatedAudioInfo:b.validatedAudioInfo,validatedDocumentFileInfo:null,validatedImageInfo:b.validatedImageInfo,validatedVideoInfo:b.validatedVideoInfo},void 0,void 0,!0)});return d("MAWDexieTable").dexieAll(k).then(function(k){k=k.reduce(function(a,b){return a.set(b.mediaId,b)},new Map());var l=h==null?void 0:k.get(h);if(h==null&&!(d("MAWXMAUtils").isXMAExternalLinkShare(f.xmaMessageType)||d("MAWXMAUtils").isReceiverFetchXMA(f.xmaMessageType)))throw c("err")("Preview Media is missing");k=d("MAWJidUtils").maybeToProtocolMsgId(e.author,g,e.externalId);if(k==null)throw c("err")("ProtocolMsgId is null for forward XMA Share");return d("MAWXMAManagementTxns").saveXMA(a,h,j,i,b.targetType,e.msgId,void 0,k,{contentRef:b.contentRef,defaultCTA:b.defaultCTA,headerTitle:b.headerTitle,maxSubtitleNumOfLines:b.maxSubtitleNumOfLines,maxTitleNumOfLines:b.maxTitleNumOfLines,overlayDescription:b.overlayDescription,overlayIconGlyph:b.overlayIconGlyph,overlayTitle:b.overlayTitle,subtitleText:b.subtitleText,targetExpiringAtSec:b.targetExpiringAtSec,targetId:b.targetId,targetUsername:b.targetUsername,titleText:b.titleText,xmaLayoutType:b.xmaLayoutType}).then(function(b){c("gkx")("821")?c("promiseDone")(d("MAWHandleXmaTransactionUtil").checkMediaChunkAndHandleXmaAfterTransaction(l,b,a)):d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:d("MAWBridgeXMA").createBridgeXMA(l,b,!1)})})})})})}g.writeForwardedMsg=b}),98);
__d("MAWForwardMsg",["MAWAckLevel","MAWConfig","MAWDbMedia","MAWDbMediaTxns","MAWDbMsgTxns","MAWDbXMATxns","MAWGetDownloadableThumbnailForMediaApi","MAWGetMediaPlaintextApi","MAWGetOrCreateMediaKnownEntriesApi","MAWIndexedDb","MAWJobDefinitions","MAWJobManager","MAWMessageSendScheduler","MAWMsgUtil","MAWQplProxy","MAWSendWrittenMsg","MAWStartMediaUploadQplFlow","MAWTransactionMode","MAWUpdateMediaEntryForMsgApi","MAWUpdateMediaEntryForOptimisticUploadApi","MAWWriteForwardedMsgApi","WAAPI","WAJobOrchestratorTypes","WALogger","WAResultOrError","WorkerScheduler","asyncToGeneratorRuntime","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadMediaForForwardMsg: can't get serverMediaType. ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg: failed to upload media. ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg: media found for message, start media encrypt and upload"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg cannot forward an ephemeral message"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg cannot forward a non-existent message"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg cannot send to a non-existent thread"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg already sent message"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg: ",""]);o=function(){return a};return a}var p=function(a){return function(b){if(a==null)return;d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),b,{instanceKey:a})}};function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.args,f=a.chatJid,g=a.ephemeralSetting,h=a.externalId,q=a.protocolMsgId;d("WALogger").DEV(o(),f);a=p(e==null?void 0:e.s2sInstanceKey);yield c("WAAPI").getDevicesBeforeSend({chatJid:f,reason:"ForwadMsg"});h=(yield d("MAWWriteForwardedMsgApi").writeForwardedMsg(h,f,q,b.jobStartTime,g,void 0,e==null?void 0:e.mediaGroupMetadata));if(h.type==="already_sent"){d("WALogger").LOG(n());return}else if(h.type==="missing_thread"){d("WALogger").LOG(m());return}else if(h.type==="missing_msg"){d("WALogger").LOG(l());return}else if(h.type==="forwarding_ephemeral_msg"){d("WALogger").LOG(k());return}a("forwarded_message_written");if(d("MAWConfig").getConfig().encryptForwardedMedia()===!0){a=(yield d("MAWIndexedDb").makeMsgrTransactor({media:(g=d("MAWTransactionMode")).READONLY,messages:g.READONLY,threads:g.READONLY,xma:g.READONLY},"getMediaForForwardMsg",function(a){return function(){return d("MAWDbMsgTxns").maybeGetMsgResultByProtocolMsgId(a,q).then(function(b){if(!b.success)return b;var c=b.value;return b.value.type==="XMA"?d("MAWDbXMATxns").maybeGetXMAPayloadFromProtocolMsgId(a,q).then(function(a){if(a.success===!1)return d("WAResultOrError").makeError("missing-xma");return a.value==null||a.value.previews==null||a.value.previews.length===0?d("WAResultOrError").makeError("missing-xma-payload"):d("WAResultOrError").makeResult({media:a.value.previews[0],msg:c})}):d("MAWDbMediaTxns").getMediaFromMsgs(a,[c]).then(function(a){a=a[0];return a==null?d("WAResultOrError").makeError("missing-media"):d("WAResultOrError").makeResult({media:a,msg:c})})})}})());if(a.success){d("WALogger").LOG(j());g=a.value;a=g.media;g=g.msg;f=(yield s({forwardedMsg:{chatJid:f,protocolMsgId:h.protocolMsgId},originalMedia:a,originalMsg:g}));if(!f.success){d("WALogger").ERROR(i(),f.error);d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"failed_upload_media_to_backend",{instanceKey:e==null?void 0:e.s2sInstanceKey});return d("MAWMsgUtil").updateSystemAckWithTxn(h.msgId,d("MAWAckLevel").ACK.failed)}}}c("gkx")("5800")?yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:h.protocolMsgId,s2sInstanceKey:e==null?void 0:e.s2sInstanceKey,type:"message"},b.afterCrash):yield d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:h.protocolMsgId,s2sInstanceKey:e==null?void 0:e.s2sInstanceKey,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"}))});return r.apply(this,arguments)}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){c("gkx")("5801")?yield d("MAWMessageSendScheduler").messageSendScheduler().run({fn:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield q(a,f)});function d(){return c.apply(this,arguments)}return d}(),name:"forward",priority:d("WorkerScheduler").BLOCKING_PRIORITY}).promise:yield q(a,f)});return function(b,c,d){return a.apply(this,arguments)}}()).end();function s(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,e=a.forwardedMsg,f=a.originalMedia;a=a.originalMsg;var g=d("MAWDbMedia").getServerMediaType(f,a.msgId);if(g.success===!1){d("WALogger").ERROR(h(),g.error);return g}g=g.value;a=a.type==="XMA"&&g==="image"?"xma-image":g;g=d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:e.chatJid,fileSize:f.size,serverMediaType:a,uploadEntry:"forwardMediaMsg"});b=(yield c("WAAPI").uploadMedia({chatJid:e.chatJid,filename:(b=f.validatedDocumentFileInfo)==null?void 0:b.filename,getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("MAWGetOrCreateMediaKnownEntriesApi").getOrCreateMediaKnownEntries,getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,hash:f.plaintextHash,mediaTypeDetails:{mediaType:a,type:"regular"},protocolMsgId:e.protocolMsgId,size:f.size,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload,uploadMediaMetric:g}));return b});return t.apply(this,arguments)}g.forwardMsg=a}),98);
__d("MAWGetAppDataApi",["MAWAckLevel","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Trying to send appdata with no permitted identities"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE},"getAppData",function(a){return function(b){return a.appData.get({externalId:b}).then(function(b){if(b==null)return{type:"missing"};else if(b.permittedIdentitiesPerDevice.size===0){d("WALogger").ERROR(h());return a.appData["delete"](b.appDataId).then(function(){return{type:"missing"}})}else if(b.ack>=d("MAWAckLevel").ACK.sent)return{appData:b.contents,permittedIdentitiesPerDevice:b.permittedIdentitiesPerDevice,sendPartial:!0,type:"already_sent"};else return{appData:b.contents,permittedIdentitiesPerDevice:b.permittedIdentitiesPerDevice,sendPartial:b.sendPartial===!0,type:"not_sent"}})}});g.getAppData=a}),98);
__d("MAWGetAppDataForResendApi",["MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Trying to resend appdata with no permitted identities"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE},"getAppDataForResend",function(a){return function(b,c){return a.appData.get({externalId:b}).then(function(b){if(b==null)return{type:"missing"};for(var e=c.keys(),f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var i;if(f){if(g>=e.length)break;i=e[g++]}else{g=e.next();if(g.done)break;i=g.value}i=i;b.permittedIdentitiesPerDevice.has(i)&&c["delete"](i)}if(c.size===0)if(b.permittedIdentitiesPerDevice.size===0){d("WALogger").ERROR(h());return a.appData["delete"](b.appDataId).then(function(){return{type:"missing"}})}else return{appData:b.contents,permittedIdentitiesPerDevice:c,sendPartial:!0,type:"already_sent"};i=new Map([].concat(Array.from(b.permittedIdentitiesPerDevice),Array.from(c)));g=new Set([].concat(Array.from(b.recipientDevices),Array.from(i.keys())));return a.appData.update(b.appDataId,{permittedIdentitiesPerDevice:i,recipientDevices:g}).then(function(){return{appData:b.contents,permittedIdentitiesPerDevice:c,sendPartial:!0,type:"not_sent"}})})}});g.getAppDataForResend=a}),98);
__d("MAWGetGroupInfoApi",["MAWRunInTransaction","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0},function(b){b=b.GroupInfoStore;return h({GroupInfoStore:b},a)},"getGroupInfo")};function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=a.GroupInfoStore;a=(yield a.get(b));return a.success?a.value:null});return i.apply(this,arguments)}g.getGroupInfo=a;g.getGroupInfoTransactor=h}),98);
__d("MAWGetLastMsgsInChatForSpamReportApi",["MAWDbEditMsgHistoryTxns","MAWDbMediaTxns","MAWDbMsg","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWMsgType","MAWTransactionMode","err"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY},"getLastMsgsInChatForSpamReport",function(a){return function(b,e){return e===0?d("MAWDexieTable").dexieResolve([]):a.threads.get({jid:b}).then(function(b){if(b==null)throw c("err")("Missing thread");b=b.jid;var f=h(a,b,e);return a.messages.where("[threadJid+sortOrderMs]").between([b,Number.MIN_SAFE_INTEGER],[b,Number.MAX_SAFE_INTEGER],!1,!1).filter(function(a){return d("MAWDbMsg").isContentMsg(a)}).reverse().limit(e).toArray().then(function(a){return f.then(function(b){return b.concat(a)})}).then(function(a){return a.sort(function(a,b){return a.msgId<b.msgId?-1:a.msgId>b.msgId?1:0}).slice(0,e)}).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWDbMediaTxns").getAndCheckMediaFromMsg(a,b).then(function(a){return{mediaInfo:a.success?a.value:null,msg:b}}).then(function(b){var c=d("MAWJidUtils").toProtocolMsgId(b.msg);return c!==null?d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,c).then(function(a){a=a.sort(function(a,b){return b.editTs-a.editTs}).slice(1);return babelHelpers["extends"]({},b,{editHistory:a})}):b})}))})})}});function h(a,b,c){return a.unrenderedMessages.where("threadJid").equals(b).filter(function(a){return a.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME}).reverse().limit(c).toArray().then(function(a){var b=[];a.forEach(function(a){a.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME&&b.push(a)});return b})}g.getLastMsgsInChatForSpamReport=b}),98);
__d("MAWGetParticipantsInThreadApi",["MAWDbParticipantTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY},"getParticipantsInThread",function(a){return function(b){return d("MAWDbParticipantTxns").getParticipantsInThread(a,b)}});g.getParticipantsInThreadInTxn=a}),98);
__d("MAWGetSpams",["MAWJobManager","WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WAPersistedJobManager","WATimeUtils","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getSpams result: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getSpams called"]);i=function(){return a};return a}var j=new(c("WADeprecatedWapParser"))("getSpamsResponse",function(a){a.assertTag("iq"),a.assertFromServer(),a.assertAttr("type","result")});a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("getSpams",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;d("WALogger").LOG(i());a=(a=d("WAWap")).wap("iq",{id:a.generateId(),to:a.S_WHATSAPP_NET,type:"get",xmlns:"fbid:thread"},a.wap("spam_request",null));a=(yield d("WADeprecatedSendIq").deprecatedSendIq(a,j));d("WALogger").LOG(h(),a);if(!a.success){a=a.errorCode.toString().startsWith("5");if(a)throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{first:d("WATimeUtils").HOUR_MILLISECONDS/60,type:"exponential"},jitter:.1});return!1}return!0})).end();g.getSpams=a}),98);
__d("MAWGetSyncResponseBackoffInfoByJidApi",["MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({ephemeralSettings:d("MAWTransactionMode").READONLY},"getSyncResponseBackoffInfoByJid",function(a){return function(b){return a.ephemeralSettings.get({userJid:b}).then(function(a){return a==null?null:a.ephemeralSyncResponseBackoffInfo})}});g.getSyncResponseBackoffInfoByJid=a}),98);
__d("MAWGetUnreadMsgsApi",["FBLogger","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WAGlobals","WAJids","WAMsgType","qex"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getUnreadMsgs",function(a){return function(b,e,f){f===void 0&&(f=!1);return a.threads.get({jid:b}).then(function(g){if(g==null)return{type:"missing"};var k=c("qex")._("1354")?d("MAWDbParticipantTxns").getParticipantsInThread(a,b).then(function(a){if(a.length===0){c("FBLogger")("messenger_e2ee_web").warn("zero participants in thread");return null}return(a=a.find(function(a){return a.userJid===d("WAGlobals").getMyUserJid()}))==null?void 0:a.lastReadWatermarkTs}):d("MAWDbMsgTxns").maybeGetMsg(a,g.lastReadMsg).then(function(a){return a==null?null:d("MAWDbMsg").getSortOrderWithFallback(a)});return k.then(function(c){return c==null?{type:"none"}:d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getMsgsNeedingRetroactiveReadReceiptsUpTo(a,g.chatId,c,e),d("MAWDbMsgTxns").maybeGetMsg(a,g.lastReadMsgReceiptSent),d("MAWDbMsgTxns").getThreadOldestMessageBySortOrder(a,g.jid)]).then(function(g){var k=g[0],l=g[1];g=g[2];var m=e-k.length,n=m>0&&(l==null||c>d("MAWDbMsg").getSortOrderWithFallback(l)),o=h(k,b,f),p=l==null;l=(l=l)!=null?l:g;return l==null||!n?k.length===0?{type:"none"}:i(k,o,b,e,c):j(a,d("MAWDbMsg").getSortOrderWithFallback(l),c,p,m,b,f).then(function(a){return i([].concat(k,a.nextMsgs),[].concat(o,a.unreadNextMsgs),b,e,c)})})})})}});function h(a,b,c){var e=[];a.forEach(function(a){var f=a.author,g=a.externalId,h=a.type;a=((a=(a=a.ephemeralSetting)==null?void 0:a.ephemeralExpirationInSec)!=null?a:0)>0;h=h!==d("WAMsgType").MSG_TYPE.CIPHERTEXT&&h!==d("WAMsgType").MSG_TYPE.UNAVAILABLE&&h!==d("WAMsgType").MSG_TYPE.FUTUREPROOF;!d("WAJids").isAuthorMe(f)&&!d("WAJids").isAuthorSystem(f)&&h&&(!c||a)&&e.push({author:f,chat:b,externalId:g})});return e}function i(a,b,c,e,f){if(a.length===0||b.length===0)return{type:"none"};var g=d("MAWDbMsg").getSortOrderWithFallback(a[a.length-1]),h=b[b.length-1];return{loadedUpTo:{author:h.author,chat:c,externalId:h.externalId},maybeMore:g<f&&a.length===e,type:"found",unreadMsgs:b}}function j(a,b,c,d,e,f,g){return a.messages.where(["threadJid","sortOrderMs"]).between([f,b],[f,c],d,!0).limit(e).toArray().then(function(i){var j=h(i,f,g);return j.length===0?a.messages.where(["threadJid","sortOrderMs"]).between([f,b],[f,c],d,!0).toArray().then(function(a){return{nextMsgs:a.slice(0,e),unreadNextMsgs:h(a,f,g).slice(0,e)}}):{nextMsgs:i,unreadNextMsgs:j}})}g.getUnreadMsgs=a}),98);
__d("WAParseMessageTransport",["decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return{version:"v3",type:"error",error:a}}function i(a,b){return a!=null&&(b.dsm==null||b.dsm.destinationJid==null||b.dsm.destinationJid!==a)}function a(a,b){var c=a.payload;a=a.protocol;if(c==null&&a==null)return h("There is no payload and protocol in the message transport");else if(a==null)return h("There is no protocol part in the message transport");var e=a.integral;if(e==null)return h("There is no integral part in the message transport");else if(e.padding==null)return h("There is no padding in the message transport");else if(i(b,e))return h("The recipient does not match the device sent message recipient");else if(d("decodeProtobuf").getUnknownFields(e)!=null)return babelHelpers["extends"]({},h("There are unknown fields in the integral"),{futureProof:c==null?void 0:c.futureProof});if(c!=null){b=c.applicationPayload;return b==null?h("There is no applicationPayload payload in the message transport"):{type:"applicationPayload",applicationPayload:b,skdm:j(a.ancillary),icdc:k(a.ancillary)}}e=j(a.ancillary);return e!=null?{type:"skdm",skdm:e,icdc:k(a.ancillary)}:{type:"unknown"}}function j(a){return a==null?null:a.skdm}function k(a){return a==null?null:a.icdc}g.parseMessageTransport=a}),98);
__d("WADecodeIncomingMsg",["WALogger","WALongInt","WAMsgApplication.pb","WAMsgTransport.pb","WAParseMessageApplication","WAParseMessageTransport","WATimeUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["decodeIncomingMsg called with unexpected encoding version: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["instamadillo decodeIncomingMsg called with null applicationPayload"]);i=function(){return a};return a}function j(a,b){return a.futureProof?{version:"v3",type:"futureProof",futureProof:a.futureProof,protobuf:b,subtype:null}:{version:"v3",type:"error",error:a.error}}function a(a,b,c,e){if(b==="v2")return{version:"v2",encoded:a};else if(b==="v3"){var f=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgTransport.pb").MessageTransportSpec,a);f=d("WAParseMessageTransport").parseMessageTransport(f,c);if(f.type==="error")return j(f,a);if(f.type==="skdm")return k(f.skdm,f.icdc);else if(f.type==="applicationPayload"){if(e===!0){if(f.applicationPayload.payload==null){d("WALogger").DEV(i());return{version:"v3",type:"error",error:"instamadillo unhandled proto"}}return{version:"v3",type:"instamadillo",applicationPayload:new Uint8Array(f.applicationPayload.payload)}}c=l(f.applicationPayload,a,f.icdc);if(f.skdm!=null){e=k(f.skdm,f.icdc);return{version:"v3",type:"msgWithSKDM",msg:c,skdm:e}}return c}else{f.type;return{version:"v3",type:"error",error:"unhandled proto"}}}else{d("WALogger").DEV(h(),b);return{type:"error",version:"v3",error:"decodeIncomingMsg called with unexpected encoding version: "+b}}}function k(a,b){var c=a.axolotlSenderKeyDistributionMessage;a=a.groupId;if(c==null)return{type:"error",version:"v3",error:"parseSKDM called with null axolotlSenderKeyDistributionMessage"};else if(a==null)return{type:"error",version:"v3",error:"parseSKDM called with null groupId"};return{version:"v3",type:"skdm",msg:{senderKey:c,groupId:a},icdc:b}}function l(a,b,c){var e=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgApplication.pb").MessageApplicationSpec,a.payload);if(e.payload==null)return m(e.metadata);var f=d("WAParseMessageApplication").parseMessageApplication(e);return f.type==="error"?j(f,b):{version:"v3",type:"subprotocol",metadata:(e=e.metadata)!=null?e:null,subprotocolType:f.subprotocolType,subprotocol:f.payload,protobuf:b,frankingContent:a.payload,icdc:c}}function m(a){a=a==null?void 0:a.chatEphemeralSetting;if(a!=null){var b=a.ephemeralExpiration,c=a.ephemeralSettingTimestamp;if(b==null)return{version:"v3",type:"error",error:"Ephemeral setting without expiration"};try{c=c!=null?d("WATimeUtils").castToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(c)/1e3):d("WATimeUtils").DEFAULT_UNIXTIME;return{version:"v3",type:"ephemeral",ephemeralExpirationInSec:b,ephemeralLastUpdatedOrSetTimestamp:c,isEphemeralSettingReset:(c=a.isEphemeralSettingReset)!=null?c:!1}}catch(e){return{version:"v3",type:"ephemeral",ephemeralExpirationInSec:b,ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").DEFAULT_UNIXTIME,isEphemeralSettingReset:(c=a.isEphemeralSettingReset)!=null?c:!1}}}else return{version:"v3",type:"error",error:"MessageApplication has no payload and is not ephemeral"}}g.decodeIncomingMsg=a}),98);
__d("MAWProcessFutureproofMsgApi",["MAWConvertFutureproofMsgTxns","MAWDbMsgTxns","MAWDbMsgTypeVersionTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWTransactionMode","MAWUnstoredContentToUnstoredDbContentUtils","WAArrayZip","WADecodeIncomingMsg","WAJids","WALogger","WAParseV3Protocol"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs doesn't support system message for ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs called for instamadillo"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs called for ephemeral setting msg"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs called for skdm"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs tried to decode non plaintext v3 message ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs get a futureproof message for ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs got error for message ",", delete this message"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs thread for "," no longer exists"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs get a futureproof message for ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs got error for message ",", delete this message"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["processFutureProofMsgs thread for "," no longer exists"]);r=function(){return a};return a}var s=d("WAParseV3Protocol").createV3ProtocolParser();b=d("MAWIndexedDb").makeMsgrTransactor({appMeta:(a=d("MAWTransactionMode")).READWRITE,chunk:a.READONLY,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READWRITE,mediaBackup:a.READWRITE,messages:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"processFutureProofMsgs",function(a){return function(b){return d("MAWDbMsgTypeVersionTxns").getMsgTypeVersion(a).then(function(c){var e=[];if(c!=null&&c<b){d("MAWDbMsgTypeVersionTxns").updateMsgTypeVersion(a,b);return d("MAWDbMsgTxns").getFutureProofMsgs(a).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWDbThreadTxns").getThread(a,b.threadJid).then(function(c){if(!c.success){d("WALogger").WARN(r(),b.threadJid);return}c=c.value;var f=t(b,c.jid);if(!f||d("WAJids").isAuthorSystem(f.author))return;if(f.msg.type==="error"){d("WALogger").WARN(q(),b.msgId);return d("MAWDbMsgTxns").deleteDbMsg(a,b.rowId).then(function(){})}f=s(f.msg,c.jid,f.externalId,f.author,f.ts);f=d("MAWUnstoredContentToUnstoredDbContentUtils").unstoredContentToUnstoredDbContent(babelHelpers["extends"]({unstoredXMA:null},f));var g=f.unstoredDbMedia;f=f.unstoredDbMsg;if(!f)return;if(f.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF){d("WALogger").WARN(p(),b.msgId);return}return d("MAWConvertFutureproofMsgTxns").convertFutureproofMsg(a,f,b,g,c).then(function(a){a!=null&&e.push(a)})})}))}).then(function(){return e})}else if(c==null)return d("MAWDbMsgTypeVersionTxns").addMsgTypeVersion(a,1).then(function(){return e});return e})}});c=d("MAWIndexedDb").makeMsgrTransactor({appMeta:a.READWRITE,chunk:a.READONLY,deletedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READWRITE,mediaBackup:a.READWRITE,messages:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"bulkProcessFutureProofMsgs",function(a){return function(b){return d("MAWDbMsgTypeVersionTxns").getMsgTypeVersion(a).then(function(c){if(c!=null&&c<b){d("MAWDbMsgTypeVersionTxns").updateMsgTypeVersion(a,b);var e=[],f=new Map();return d("MAWDbMsgTxns").getFutureProofMsgs(a).then(function(b){return d("MAWDbThreadTxns").getThreads(a,b.map(function(a){return a.threadJid})).then(function(a){d("WAArrayZip").zip(b,a).forEach(function(a){var b=a[0];a=a[1];if(a==null){d("WALogger").WARN(o(),b.threadJid);return}var c=t(b,a.jid);if(!c||d("WAJids").isAuthorSystem(c.author))return;if(c.msg.type==="error")d("WALogger").WARN(n(),b.msgId),e.push(b);else{c=s(c.msg,a.jid,c.externalId,c.author,c.ts);c=d("MAWUnstoredContentToUnstoredDbContentUtils").unstoredContentToUnstoredDbContent(babelHelpers["extends"]({unstoredXMA:null},c));var g=c.unstoredDbMedia;c=c.unstoredDbMsg;if(!c)return;if(c.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF){d("WALogger").WARN(m(),b.msgId);return}f.set(b.msgId,{dbMsg:b,thread:a,unstoredDbMedia:g,unstoredDbMsg:c})}})}).then(function(){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").deleteMessages(a,e),d("MAWConvertFutureproofMsgTxns").bulkConvertFutureproofMsgs(a,f)]).then(function(a){a[0];a=a[1];return a.filter(Boolean)})})})}else if(c==null)return d("MAWDbMsgTypeVersionTxns").addMsgTypeVersion(a,1).then(function(){return[]});return[]})}});function t(a,b){var c=d("WADecodeIncomingMsg").decodeIncomingMsg(new Uint8Array(a.msgContent.protobuf),"v3",a.author===d("WAJids").AUTHOR_ME?b:null);if(c.version!=="v3"){d("WALogger").WARN(l(),a.msgId);return null}else if(c.type==="skdm"||c.type==="msgWithSKDM"){d("WALogger").WARN(k());return null}else if(c.type==="ephemeral"){d("WALogger").WARN(j());return null}else if(c.type==="instamadillo"){d("WALogger").WARN(i());return null}var e=a.author;if(d("WAJids").isAuthorSystem(e)){d("WALogger").WARN(h(),a.msgId);return null}return{author:e,chat:b,externalId:a.externalId,msg:c,ts:a.ts}}g.processFutureProofMsgs=b;g.bulkProcessFutureProofMsgs=c}),98);
__d("MAWHandleFutureProofMsg",["MAWConfig","MAWJobDefinitions","MAWJobManager","MAWProcessFutureproofMsgApi","Promise","asyncToGeneratorRuntime","promiseDone","qex"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=c("qex")._("401")?yield d("MAWProcessFutureproofMsgApi").bulkProcessFutureProofMsgs(d("MAWConfig").getConfig().supportedTypesVersion()):yield d("MAWProcessFutureproofMsgApi").processFutureProofMsgs(d("MAWConfig").getConfig().supportedTypesVersion()),e=[];a.forEach(function(a){e.push(d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.downloadAndHandleMedia(a.protocolMsgId,a.plaintextHash,"MAWHandleFutureproofMsg")))});c("promiseDone")((h||(h=b("Promise"))).all(e))});return function(){return a.apply(this,arguments)}}();e=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("checkMessageTypeUpdateAndHandleMsg",a).end();g.handleFutureproofMsg=e}),98);
__d("MAWWriteMetaSyncsTxns",["MAWDbDeletedMessages","MAWDbPendingStanza","MAWDbPendingStanzaTxns","MAWDbThreadTxns","MAWDexieTable","MAWFTSTxns","MAWThreadManagementTxns","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MAWWriteMetaSyncsTxns] Thread delete stanza was processed before thread insertion ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received chatDelete: ",""]);i=function(){return a};return a}var j=30*d("WATimeUtils").DAY_SECONDS;function a(a,b){d("WALogger").LOG(i(),b);var c=b.messageRange;c=c!=null?d("MAWDbPendingStanzaTxns").putPendingStanza(a,{content:{metaSyncMessageRange:c},type:d("MAWDbPendingStanza").PENDING_TYPE.DELETE_THREAD},j,b.chatJid,d("MAWDbPendingStanza").PENDING_TYPE.DELETE_THREAD):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,b.chatJid),c,d("MAWFTSTxns").maybePutThreadToPurgeBacklog(a,b.chatJid)]).then(function(c){c=c[0];if(c.success)return d("MAWThreadManagementTxns").metaSyncChatDeleteThread(a,c.value,b.messageRange,d("MAWDbDeletedMessages").DbDeletedMsgReasonEnum.cast(b.type));else{d("WALogger").LOG(h(),b.chatJid);return{deletedMessages:[]}}})}g.PENDING_DELETE_THREAD_EXPIRATION_IN_SEC=j;g.handleChatDelete=a}),98);
__d("WADeleteReceiptsApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return a.receipts.where("waMsgId").anyOf(b)["delete"]().then(function(){})}a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"deleteReceipts",function(a){return function(b){return h(a,b)}});g.deleteAllReceiptsForWAMsgIds=h;g.deleteReceipts=a}),98);
__d("MAWHandleMetaSyncAction",["MAWIndexedDb","MAWTransactionMode","MAWWriteDeleteMessageTxns","MAWWriteMetaSyncsTxns","Promise","WAAssertUnreachable","WADeleteReceiptsApi","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received action: ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){for(a of a.actions)a.chatAction?yield k(a.chatAction):a.messageAction&&(yield n(a.messageAction))});return j.apply(this,arguments)}function k(a){d("WALogger").LOG(i(),a);switch(a.type){case"chat_archive":return l(a);case"chat_delete":return o(a).then(function(a){a=a.deletedMessages;return d("WADeleteReceiptsApi").deleteReceipts(a)});default:a.type;return m(a)}}function l(a){return(h||(h=b("Promise"))).resolve()}function m(a){return(h||(h=b("Promise"))).resolve()}function n(a){switch(a.type){case"delete_for_me":return p(a).then(function(){});default:return c("WAAssertUnreachable")(a.type)}}var o=d("MAWIndexedDb").makeMsgrTransactor({chunk:(e=d("MAWTransactionMode")).READWRITE,deletedMessages:e.READWRITE,editMsgHistory:e.READWRITE,ftsPurgeThreadBacklog:e.READWRITE,groupInfo:e.READWRITE,groupInvites:e.READWRITE,media:e.READWRITE,messages:e.READWRITE,participants:e.READWRITE,pendingStanzas:e.READWRITE,reactions:e.READWRITE,threads:e.READWRITE,unrenderedMessages:e.READWRITE,xma:e.READWRITE},"writeOutgoingAppData",function(a){return function(b){return d("MAWWriteMetaSyncsTxns").handleChatDelete(a,b)}}),p=d("MAWIndexedDb").makeMsgrTransactor({chunk:e.READWRITE,editMsgHistory:e.READWRITE,ftsPurgeBacklog:e.READWRITE,groupInfo:e.READWRITE,groupInvites:e.READWRITE,media:e.READWRITE,messages:e.READWRITE,participants:e.READWRITE,pendingStanzas:e.READWRITE,reactions:e.READWRITE,threads:e.READWRITE,unrenderedMessages:e.READWRITE,xma:e.READWRITE},"writeOutgoingAppData",function(a){return function(b){return d("MAWWriteDeleteMessageTxns").handleDeleteForMe(a,b)}});g.handleMetaSyncActions=a}),98);
__d("MAWProcessSpamMsgApi",["ArmadilloDataTraceType","I64","MAWBridgeMsg","MAWBridgeTrace","MAWBridgeTypesCreators","MAWCalculateBumpTimestampMs","MAWDbMessageHandler","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWThreadSnippetBuildTxns","MAWTransactionMode","WALogger","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["processSpamMsgs: "," for thread ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["processSpamMsgs thread for "," no longer exists"]);j=function(){return a};return a}function k(a,b){return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success)return null;var c=b.value;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getThreadOldestMessageId(a,c.jid),d("MAWDbMsgTxns").getThreadNewestMessageTs(a,c,"use_cached_fields")]).then(function(a){var b=a[0];a=a[1];return{newestMsgTs:a,oldestMsgId:b,thread:c}})})}a=d("MAWIndexedDb").makeMsgrTransactor({groupInfo:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"processSpamMsgs",function(a){return function(){return d("MAWDbMsgTxns").getSpamMsgs(a).then(function(b){d("MAWDexieTable").dexieAll(b.map(function(b){var e=b.threadJid;return k(a,b.threadJid).then(function(c){if(c==null){d("WALogger").WARN(j(),e);return[void 0,c,void 0]}d("WALogger").DEV(i(),b.rowId,e);b.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF?b.altIndex=d("MAWDbMsg").FUTUREPROOF_ALT_INDEX:b.altIndex=void 0;return d("MAWDexieTable").dexieAll([a.messages.put(b),d("MAWDexieTable").dexieResolve(c),d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,b)])}).then(function(a){a[0];var f=a[1];a=a[2];if(f==null)return;var g=f.newestMsgTs,i=f.oldestMsgId;f=f.thread;f=f.jid;d("MAWIndexedDb").afterTransaction({tag:"StartTrace",value:d("MAWBridgeTrace").createBridgeStartTraceData(b,f,d("ArmadilloDataTraceType").armadilloMessageSend)});d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(b)});if(a!=null&&!d("MAWDbMessageHandler").isThreadUpdateEnabledViaMiddlewareForMsgType(b.type)){f=d("MAWCalculateBumpTimestampMs").calculateBumpTimestampMs(c("gkx")("4367")||g==null?d("WATimeUtils").castUnixTimeToMillisTime(b.ts):g,(h||(h=d("I64"))).of_string_opt(b.externalId));d("MAWIndexedDb").afterTransaction({tag:"ThreadBumpedV2",value:d("MAWBridgeTypesCreators").createBridgeBumpedThreadV2({bumpTimestampMs:f,description:"processSpamMsgs",isMessageAuthorMe:!1,skipServerThreadBump:!0,snippetData:{params:a.snippetParams,senderContactId:a.snippetSenderContactId,type:a.snippetType},threadJid:b.threadJid})})}i==null&&d("MAWIndexedDb").afterTransaction({tag:"MsgsLoaded",value:d("MAWBridgeTypesCreators").createBridgeMsgsLoadedInfo(e,[b],!0,!1,!1)})})}))})}});g.processSpamMsgs=a}),98);
__d("MAWHandleSpamMsg",["MAWJobManager","MAWProcessSpamMsgApi","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleSpamMsg processed spam msgs"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleSpamMsg starts processing spam msgs"]);i=function(){return a};return a}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("updateAndHandleMsg",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").DEV(i()),yield d("MAWProcessSpamMsgApi").processSpamMsgs(),d("WALogger").DEV(h())})).end();g.handleSpamMsg=a}),98);
__d("MAWLeaveGroupsApi",["MAWDbGroupInfoTxns","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({groupInfo:d("MAWTransactionMode").READONLY,participants:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"leaveGroups",function(a){return function(){for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];return h.apply(void 0,[a].concat(c))}});function h(a,b){var c=b.groupJids;return d("MAWDbGroupInfoTxns").getGroupInfos(a,c).then(function(b){b=b.filter(Boolean);b=b.map(function(a){return a.groupJid});var e=d("WAGlobals").getMyUserJid();return d("MAWDexieTable").dexieAll([d("MAWDbParticipantTxns").bulkDeleteParticipantAcrossThreads(a,c,e),d("MAWDbThreadTxns").archiveThreads(a,b,!0)]).then(function(){})})}g.leaveGroups=a}),98);
__d("WADeletePersonalSenderKeyStatusApi",["MAWTransactionMode","WADbPersonalSenderKeyStatusTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE},"deletePersonalSenderKeyStatus",function(a){return function(b){return d("WADbPersonalSenderKeyStatusTxns").bulkDeletePersonalSenderKeyStatus(a,b)}});g.deletePersonalSenderKeyStatus=a}),98);
__d("WASmaxInGroupsLeaveClientErrors",["WAResultOrError","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxInGroupsIQErrorForbiddenMixin","WASmaxInGroupsIQErrorItemNotFoundMixin","WASmaxInGroupsIQErrorLockedMixin","WASmaxInGroupsIQErrorNotAuthorizedMixin","WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:b.value});var c=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:c.value});var e=d("WASmaxInGroupsIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:e.value});var f=d("WASmaxInGroupsIQErrorNotAuthorizedMixin").parseIQErrorNotAuthorizedMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAuthorized",value:f.value});var g=d("WASmaxInGroupsIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:g.value});var h=d("WASmaxInGroupsIQErrorLockedMixin").parseIQErrorLockedMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"IQErrorLocked",value:h.value});var i=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return i.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:i.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorRateOverlimit","IQErrorBadRequest","IQErrorItemNotFound","IQErrorNotAuthorized","IQErrorForbidden","IQErrorLocked","IQErrorFallbackClient"],[b,c,e,f,g,h,i])}g.parseLeaveClientErrors=a}),98);
__d("WASmaxInGroupsLeaveResponseClientError",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsLeaveClientErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsLeaveClientErrors").parseLeaveClientErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorLeaveClientErrors:b.value}))}g.parseLeaveResponseClientError=a}),98);
__d("WASmaxInGroupsLeaveResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseLeaveResponseServerError=a}),98);
__d("WASmaxInGroupsLeaveGroupNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","405");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseLeaveGroupNotAllowedMixin=a}),98);
__d("WASmaxInGroupsLeaveGroupServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","500");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseLeaveGroupServerErrorMixin=a}),98);
__d("WASmaxInGroupsLeaveGroupNotAllowedOrServerErrorMixinGroup",["WAResultOrError","WASmaxInGroupsLeaveGroupNotAllowedMixin","WASmaxInGroupsLeaveGroupServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsLeaveGroupNotAllowedMixin").parseLeaveGroupNotAllowedMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"LeaveGroupNotAllowed",value:b.value});var c=d("WASmaxInGroupsLeaveGroupServerErrorMixin").parseLeaveGroupServerErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"LeaveGroupServerError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["LeaveGroupNotAllowed","LeaveGroupServerError"],[b,c])}g.parseLeaveGroupNotAllowedOrServerErrorMixinGroup=a}),98);
__d("WASmaxInGroupsLeaveLinkedGroupsBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"linked_groups");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","400");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseLeaveLinkedGroupsBadRequestMixin=a}),98);
__d("WASmaxInGroupsLeaveLinkedGroupsNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"linked_groups");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","405");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseLeaveLinkedGroupsNotAllowedMixin=a}),98);
__d("WASmaxInGroupsLeaveLinkedGroupsServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"linked_groups");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","500");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseLeaveLinkedGroupsServerErrorMixin=a}),98);
__d("WASmaxInGroupsLeaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup",["WAResultOrError","WASmaxInGroupsLeaveLinkedGroupsBadRequestMixin","WASmaxInGroupsLeaveLinkedGroupsNotAllowedMixin","WASmaxInGroupsLeaveLinkedGroupsServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsLeaveLinkedGroupsBadRequestMixin").parseLeaveLinkedGroupsBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"LeaveLinkedGroupsBadRequest",value:b.value});var c=d("WASmaxInGroupsLeaveLinkedGroupsNotAllowedMixin").parseLeaveLinkedGroupsNotAllowedMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"LeaveLinkedGroupsNotAllowed",value:c.value});var e=d("WASmaxInGroupsLeaveLinkedGroupsServerErrorMixin").parseLeaveLinkedGroupsServerErrorMixin(a);return e.success?d("WAResultOrError").makeResult({name:"LeaveLinkedGroupsServerError",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["LeaveLinkedGroupsBadRequest","LeaveLinkedGroupsNotAllowed","LeaveLinkedGroupsServerError"],[b,c,e])}g.parseLeaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup=a}),98);
__d("WASmaxInGroupsParentGroupMixin",["WAResultOrError","WASmaxParseJid"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseJid").attrGroupJid(a,"parent_group_jid");return!a.success?a:d("WAResultOrError").makeResult({parentGroupJid:a.value})}g.parseParentGroupMixin=a}),98);
__d("WASmaxInGroupsLeaveResponseSuccess",["WAResultOrError","WASmaxInGroupsIQResultResponseMixin","WASmaxInGroupsLeaveGroupNotAllowedOrServerErrorMixinGroup","WASmaxInGroupsLeaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup","WASmaxInGroupsParentGroupMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxParseJid").attrGroupJid(a,"id");if(!b.success)return b;a=d("WASmaxInGroupsLeaveGroupNotAllowedOrServerErrorMixinGroup").parseLeaveGroupNotAllowedOrServerErrorMixinGroup(a);return d("WAResultOrError").makeResult({id:b.value,leaveGroupNotAllowedOrServerErrorMixinGroup:a.success?a.value:null})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"linked_groups");if(!b.success)return b;b=d("WASmaxInGroupsParentGroupMixin").parseParentGroupMixin(a);if(!b.success)return b;a=d("WASmaxInGroupsLeaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup").parseLeaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{leaveLinkedGroupsBadRequestOrNotAllowedOrServerErrorMixinGroup:a.success?a.value:null}))}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"leave");if(!c.success)return c;a=d("WASmaxInGroupsIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"group",0,1024,h);if(!b.success)return b;c=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"linked_groups",0,1024,i);return!c.success?c:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{leaveGroup:b.value,leaveLinkedGroups:c.value}))}g.parseLeaveResponseSuccessLeaveGroup=h;g.parseLeaveResponseSuccessLeaveLinkedGroups=i;g.parseLeaveResponseSuccess=a}),98);
__d("WASmaxOutGroupsParentGroupMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyParentGroupJid;a=d("WASmaxJsx").smax("smax$any",{parent_group_jid:d("WAWap").GROUP_JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeParentGroupMixin=a}),98);
__d("WASmaxOutGroupsLeaveLeaveGroupsRequestMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutGroupsParentGroupMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.groupId;a=d("WASmaxJsx").smax("group",{id:d("WAWap").GROUP_JID(a)});return a}function i(a){a=d("WASmaxOutGroupsParentGroupMixin").mergeParentGroupMixin(d("WASmaxJsx").smax("linked_groups",null),a);return a}function j(a){var b=a.groupArgs;a=a.linkedGroupsArgs;b=d("WASmaxJsx").smax("leave",null,[].concat(d("WASmaxChildren").REPEATED_CHILD(h,b,1,1024),d("WASmaxChildren").REPEATED_CHILD(i,a,0,1024)));return b}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeLeaveLeaveGroupsRequestGroup=h;g.makeLeaveLeaveGroupsRequestLinkedGroups=i;g.mergeLeaveLeaveGroupsRequestMixin=a}),98);
__d("WASmaxOutGroupsLeaveLeaveLinkedGroupsRequestMixin",["WASmaxChildren","WASmaxJsx","WASmaxMixins","WASmaxOutGroupsParentGroupMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.groupId;a=d("WASmaxJsx").smax("group",{id:d("WAWap").GROUP_JID(a)});return a}function i(a){a=d("WASmaxOutGroupsParentGroupMixin").mergeParentGroupMixin(d("WASmaxJsx").smax("linked_groups",null),a);return a}function j(a){var b=a.groupArgs;a=a.linkedGroupsArgs;b=d("WASmaxJsx").smax("leave",null,[].concat(d("WASmaxChildren").REPEATED_CHILD(h,b,0,1024),d("WASmaxChildren").REPEATED_CHILD(i,a,1,1024)));return b}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeLeaveLeaveLinkedGroupsRequestGroup=h;g.makeLeaveLeaveLinkedGroupsRequestLinkedGroups=i;g.mergeLeaveLeaveLinkedGroupsRequestMixin=a}),98);
__d("WASmaxOutGroupsLeaveLeaveLinkedOrLeaveGroupsRequestMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutGroupsLeaveLeaveGroupsRequestMixin","WASmaxOutGroupsLeaveLeaveLinkedGroupsRequestMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.leaveLeaveLinkedGroupsRequest)return d("WASmaxOutGroupsLeaveLeaveLinkedGroupsRequestMixin").mergeLeaveLeaveLinkedGroupsRequestMixin(a,b.leaveLeaveLinkedGroupsRequest);if(b.leaveLeaveGroupsRequest)return d("WASmaxOutGroupsLeaveLeaveGroupsRequestMixin").mergeLeaveLeaveGroupsRequestMixin(a,b.leaveLeaveGroupsRequest);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeLeaveLeaveLinkedOrLeaveGroupsRequestMixinGroup=a}),98);
__d("WASmaxOutGroupsLeaveRequest",["WASmaxJsx","WASmaxOutGroupsBaseSetServerMixin","WASmaxOutGroupsLeaveLeaveLinkedOrLeaveGroupsRequestMixinGroup"],(function(a,b,c,d,e,f,g){function a(a){a=a.leaveLeaveLinkedOrLeaveGroupsRequestMixinGroupArgs;a=d("WASmaxOutGroupsBaseSetServerMixin").mergeBaseSetServerMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxOutGroupsLeaveLeaveLinkedOrLeaveGroupsRequestMixinGroup").mergeLeaveLeaveLinkedOrLeaveGroupsRequestMixinGroup(d("WASmaxJsx").smax("leave",null),a)));return a}g.makeLeaveRequest=a}),98);
__d("WASmaxGroupsLeaveRPC",["WAComms","WASmaxInGroupsLeaveResponseClientError","WASmaxInGroupsLeaveResponseServerError","WASmaxInGroupsLeaveResponseSuccess","WASmaxOutGroupsLeaveRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsLeaveRequest").makeLeaveRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsLeaveResponseSuccess").parseLeaveResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"LeaveResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsLeaveResponseServerError").parseLeaveResponseServerError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"LeaveResponseServerError",value:h.value});case 10:i=d("WASmaxInGroupsLeaveResponseClientError").parseLeaveResponseClientError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"LeaveResponseClientError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Leave",{Success:g,ServerError:h,ClientError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendLeaveRPC=a}),98);
__d("MAWLeaveGroups",["MAWJobManager","MAWLeaveGroupsApi","MAWODSProxy","WADeletePersonalSenderKeyStatusApi","WAOdsEnums","WASmaxGroupsLeaveRPC","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.groups;if(a.length===0)return;a=(yield d("WASmaxGroupsLeaveRPC").sendLeaveRPC({leaveLeaveLinkedOrLeaveGroupsRequestMixinGroupArgs:{leaveLeaveGroupsRequest:{groupArgs:a.map(function(a){return{groupId:a}})}}}));if(a.name!=="LeaveResponseSuccess"){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_LEAVE_PARTICIPANT,key:"fail"});throw c("err")("Failed to parse leaveGroups response")}d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_LEAVE_PARTICIPANT,key:"success"});a=a.value;a=a.leaveGroup.map(function(a){return a.id});yield d("MAWLeaveGroupsApi").leaveGroups({groupJids:a});yield d("WADeletePersonalSenderKeyStatusApi").deletePersonalSenderKeyStatus(a)});return i.apply(this,arguments)}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("leaveGroups",function(a){a=a.groups;return h({groups:a})}).end();g.leaveGroupsStep=h;g.leaveGroups=a}),98);
__d("MAWMarkAppDataDroppedApi",["MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE},"markAppDataDropped",function(a){return function(b){return a.appData.get({externalId:b}).then(function(b){if(b!=null)return a.appData["delete"](b.appDataId)})}});g.markAppDataDropped=a}),98);
__d("MAWMarkAppDataSendFailedApi",["MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE},"markAppDataSendFailed",function(a){return function(b){return a.appData.where("externalId").equals(b)["delete"]().then(function(){})}});g.markAppDataSendFailed=a}),98);
__d("MAWMarkAppDataSentApi",["MAWAckLevel","MAWDbAppDataTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE},"markAppDataSent",function(a){return function(b){return d("MAWDbAppDataTxns").updateAppDataSystemAck(a,b,d("MAWAckLevel").ACK.sent).then(function(){})}});g.markAppDataSent=a}),98);
__d("MAWMarkReadReceiptsSentUpToApi",["MAWDbMsg","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWODSProxy","MAWTransactionMode","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"markReadReceiptsSentUpTo",function(a){return function(b,c){i("success");return d("MAWDexieTable").dexieAll([a.threads.get({jid:b}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)]).then(function(b){var c=b[0],e=b[1];if(c==null){i("missingThread");return{type:"missing_thread"}}else if(e==null){i("invalidMsg");return{type:"invalid_msg"}}var f=d("MAWDbMsg").getSortOrderWithFallback(e);return d("MAWDbMsgTxns").clearRetroactiveReadReceiptStatusFromMsgsUpTo(a,c.chatId,f).then(function(){if(e.threadJid!==c.jid){i("invalidMsg");return{type:"invalid_msg"}}var b=c.lastReadMsgReceiptSent;return b!=null?a.messages.get({msgId:b}).then(function(b){if(b!=null&&f<d("MAWDbMsg").getSortOrderWithFallback(b)){i("unchanged");return{type:"unchanged"}}return h(a,c,e.msgId)}):h(a,c,e.msgId)})})}});function h(a,b,c){return a.threads.put(babelHelpers["extends"]({},b,{lastReadMsgReceiptSent:c})).then(function(){i("updateLastReadMsgReceiptSent");return{type:"success"}})}function i(a){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.SEND_READ_RECEIPTS,key:a})}g.markReadReceiptsSentUpTo=a}),98);
__d("MAWMarkThreadAsReadUpToApi",["MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWMarkThreadAsReadTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";var h={folder:null,isReadReceiptExpectedToBeSent:!1,type:"missing"};a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"markThreadAsReadUpTo",function(a){return function(b,c){return a.threads.get({jid:b}).then(function(b){return b==null?h:d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getThreadNewestMessageId(a,b.jid),d("MAWDbMsgTxns").getThreadNewestMessageTs(a,b)]).then(function(c){var e=c[0];c=c[1];if(e==null||c==null)return h;var f=!0;return d("MAWMarkThreadAsReadTxns").markThreadAsReadUpToMsgSortOrderMs(a,b.jid,e,c,f).then(function(a){return babelHelpers["extends"]({},a,{folder:b.folder})})})})}});g.markThreadAsReadUpTo=a}),98);
__d("MAWMarkThreadAsRead",["MAWGetUnreadMsgsApi","MAWJobManager","MAWMarkReadReceiptsSentUpToApi","MAWMarkThreadAsReadUpToApi","MAWMessageRequestUtils","Promise","WADeprecatedSendIq","WAJids","WALogger","WAPromiseQueue","WAWap","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsRead skips sending receipts for ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsRead skips sending receipts for ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsRead skips sending receipts for ",""]);k=function(){return a};return a}var l=256,m=new(d("WAPromiseQueue").PromiseQueueMap)();a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("markThreadAsRead",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=a.chatJid;e=a.isReadReceiptsDisabled;var h=e===void 0?!1:e;e=a.relationship;a=a.upTo;var o=f.interruptJob,p=f.jobStartTime;f=(yield d("MAWMarkThreadAsReadUpToApi").markThreadAsReadUpTo(g,a));if(e!=null&&d("MAWMessageRequestUtils").isInboxRequest(f.folder,e)){d("WALogger").DEV(k(),g);return o()}if(f.type==="missing"){d("WALogger").DEV(j(),g);return o()}if(!f.isReadReceiptExpectedToBeSent){d("WALogger").DEV(i(),g);return o()}f.type;return m.enqueue(String(g),b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=!0;while(a){var b=(yield d("MAWGetUnreadMsgsApi").getUnreadMsgs(g,l,h));if(b.type!=="found"){b.type;break}var e=b.loadedUpTo,f=b.unreadMsgs;c("gkx")("2855")===!1&&(yield n(f,p));yield d("MAWMarkReadReceiptsSentUpToApi").markReadReceiptsSentUpTo(g,e);a=b.maybeMore}}))});return function(b,c,d){return a.apply(this,arguments)}}()).end();function n(a,e){if(a.length===0)return(h||(h=b("Promise"))).resolve();var f=a[0].chat;return d("WAJids").switchOnChatJidType(f,{group:function(c){var g=d("WAWap").GROUP_JID(c),i=new Map();a.forEach(function(a){var b=a.author,c=i.get(b)||[];c.push(a.externalId);i.set(b,c)});var j=[];i.forEach(function(a,b){j.push(o(g,f,a,b,e))});return(h||(h=b("Promise"))).all(j)},interopUser:function(a){throw c("err")("InteropUserJid is not supported yet")},lidUser:function(a){throw c("err")("LidUserJid is not supported yet")},msgrUser:function(b){b=d("WAWap").USER_JID(b);var c=a.map(function(a){return a.externalId});return o(b,f,c,null,e)},phoneUser:function(a){throw c("err")("PhoneUserJid is not supported yet")}}).then(function(){})}function o(a,b,c,e,f){var g=null;c.length>1&&(g=d("WAWap").wap("list",null,c.slice(1).map(function(a){return d("WAWap").wap("item",{id:d("WAWap").CUSTOM_STRING(a)})})));c=c[0];f=d("WAWap").wap("receipt",{id:d("WAWap").CUSTOM_STRING(c),participant:e!=null?d("WAWap").USER_JID(e):d("WAWap").DROP_ATTR,t:d("WAWap").CUSTOM_STRING(String(f)),to:a,type:"read"},g);return d("WADeprecatedSendIq").deprecatedSendStanzaAndWaitForAck(f,{"class":"receipt",from:b,id:c,participant:e!=null?d("WAJids").defaultDeviceJidForUser(e):null,type:"read"})}g.markThreadAsRead=a}),98);
__d("MAWMediaTypeAttribute",["MAWMsgType","WAAssertUnreachable","WAWap"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==null)return d("WAWap").DROP_ATTR;switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:return"image";case d("MAWMsgType").MSG_TYPE.VIDEO:return"video";case d("MAWMsgType").MSG_TYPE.PTT:return"ptt";case d("MAWMsgType").MSG_TYPE.GIF:return"gif";case d("MAWMsgType").MSG_TYPE.STICKER:return"sticker";case d("MAWMsgType").MSG_TYPE.XMA:return"xma-image";case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return"document";case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return d("WAWap").DROP_ATTR;default:return c("WAAssertUnreachable")(a.type)}}g.getMediaTypeAttribute=a}),98);
__d("MAWModifyRavenMsgApi",["MAWDbRavenActionTxns","MAWIndexedDb","MAWTransactionMode","err"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE},"modifyRavenMsg",function(a){return function(b){if(b==null)throw c("err")("modifyRavenMsg called with invalid ravenProtocolMsgId");var e=b.chat;b=b.externalId;return a.messages.where("externalId").equals(b).filter(function(a){return a.threadJid===e}).first().then(function(b){return d("MAWDbRavenActionTxns").modifyRavenMsgWithActionMsg(a,b)}).then(function(){})}});g.modifyRavenMsg=a}),98);
__d("MAWPromoteGroupParticipants",["MAWChangeGroupParticipantAdminStatusApi","MAWJobManager","MAWODSProxy","WAJids","WAOdsEnums","WAPromoteDemoteGroupParticipantProtocol","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("promoteGroupParticipants",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.group;a=a.users;a=a.map(function(a){return d("WAJids").toMsgrUserJid(a)});if(a.length===0)return d("WAResultOrError").makeResult({groupJid:b,participants:[],type:"default"});a=(yield d("WAPromoteDemoteGroupParticipantProtocol").promoteGroupParticipantsProtocol({group:b,participants:a}));if(!a.success){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_PROMOTE_PARTICIPANT,key:"fail"});return d("WAResultOrError").makeError(a.error.type)}d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_PROMOTE_PARTICIPANT,key:"success"});a=a.value.participants.filter(function(a){a=a.result;return a.success}).map(function(a){a=a.user;return{addressable:!0,type:"participant",user:a}})||[];yield d("MAWChangeGroupParticipantAdminStatusApi").changeGroupParticipantAdminStatus(null,b,d("WAJids").AUTHOR_ME,a,"admin");return d("WAResultOrError").makeResult({groupJid:b,participants:a,type:"default"})});return function(b){return a.apply(this,arguments)}}()).end();g.promoteGroupParticipants=a}),98);
__d("MAWRemoveExpiredUnsendMsgsContent",["MAWDbEditMsgHistoryTxns","MAWDeleteExpiredMsgsApi","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWMsgType","MAWTransactionMode","MAWXMAUtils","WAArmadilloXMA.pb","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READWRITE,editMsgHistory:a.READWRITE,media:a.READWRITE,mediaBackup:a.READWRITE,messages:a.READWRITE,xma:a.READWRITE},"removeExpiredUnsendMsgsContent",function(a){return function(){return h(a)}});function h(a){var b=d("WATimeUtils").unixTime();return a.messages.where("unsendMsgContentDeleteTs").belowOrEqual(b).toArray().then(function(b){var c=b.map(function(a){if(a.mediaId!=null)return[a.mediaId,a.msgId]}).filter(Boolean),e=b.map(function(a){if(a.type===d("MAWMsgType").MSG_TYPE.REVOKED)return babelHelpers["extends"]({},a,{editCount:0,mediaId:void 0,msgContent:void 0,quote:void 0,reportingMeta:void 0,xmaMessageType:void 0})}).filter(Boolean),f=b.map(function(a){if(d("MAWXMAUtils").isXMAShare(a.xmaMessageType)&&a.revokedExternalId!=null){var b=d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.revokedExternalId);if(b!=null)return[b,a.msgId]}else if(a.quote!=null&&a.quote.content.xmaMessageType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY){b=d("MAWJidUtils").maybeToProtocolMsgId(a.quote.content.author,a.threadJid,a.quote.content.externalId);if(b!=null)return[b,a.msgId]}}).filter(Boolean),g=b.map(function(a){return[a.externalId,a.threadJid]});return d("MAWDexieTable").dexieAll([d("MAWDeleteExpiredMsgsApi").deleteOrUpdateXMAForExpiredMsgs(a,f),d("MAWDeleteExpiredMsgsApi").deleteOrUpdateMediaAndChunkForExpiredMsgs(a,c),d("MAWDbEditMsgHistoryTxns").deleteExpiredEditMsgHistory(a,g),a.messages.bulkPut(e)]).then(function(){return d("MAWDexieTable").dexieResolve(b.length)})})}g.removeExpiredUnsendMsgsContent=b;g.removeExpiredUnsendMsgsContentTxn=h}),98);
__d("MAWRemoveGroupParticipantsApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAAPI","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,e=new Array(a),f=0;f<a;f++)e[f]=arguments[f];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(e))},"removeGroupParticipants").then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a.success&&(yield c("WAAPI").setRotateSenderKeyToTrue([e[1]]));return a});return function(b){return a.apply(this,arguments)}}())};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){h=a.GroupInfoStore;var i=a.MessagesStore;a=a.ParticipantsStore;var j=(yield h.get(c));if(!j.success)return d("WAResultOrError").makeError("missing_group");j=j.value;if(b!=null&&b.previous!=null&&j.participantVersion!==b.previous)return d("WAResultOrError").makeError("mismatch");j=f.map(function(a){return a.user});f=j.map(function(a){return{groupJid:c,userJid:a}});yield a.bulkDelete(f,{remover:e});if(b!=null){a=d("MAWAdminMsgHelpers").createParticipantRemoveAdminMsg(c,j,e);yield i.create(a);yield h.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:b.current})},{updateParticipantMedatadata:g})}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g,h){return a.apply(this,arguments)}}();g.removeGroupParticipants=a;g.removeGroupParticipantsTransactor=h}),98);
__d("WASmaxInGroupsIQErrorPayloadTooLargeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","payload-too-large");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",413);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorPayloadTooLargeMixin=a}),98);
__d("WASmaxInGroupsRemoveParticipantsClientErrors",["WAResultOrError","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxInGroupsIQErrorForbiddenMixin","WASmaxInGroupsIQErrorItemNotFoundMixin","WASmaxInGroupsIQErrorLockedMixin","WASmaxInGroupsIQErrorNotAuthorizedMixin","WASmaxInGroupsIQErrorPayloadTooLargeMixin","WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:b.value});var c=d("WASmaxInGroupsIQErrorPayloadTooLargeMixin").parseIQErrorPayloadTooLargeMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorPayloadTooLarge",value:c.value});var e=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:e.value});var f=d("WASmaxInGroupsIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:f.value});var g=d("WASmaxInGroupsIQErrorNotAuthorizedMixin").parseIQErrorNotAuthorizedMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAuthorized",value:g.value});var h=d("WASmaxInGroupsIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:h.value});var i=d("WASmaxInGroupsIQErrorLockedMixin").parseIQErrorLockedMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"IQErrorLocked",value:i.value});var j=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return j.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:j.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorRateOverlimit","IQErrorPayloadTooLarge","IQErrorBadRequest","IQErrorItemNotFound","IQErrorNotAuthorized","IQErrorForbidden","IQErrorLocked","IQErrorFallbackClient"],[b,c,e,f,g,h,i,j])}g.parseRemoveParticipantsClientErrors=a}),98);
__d("WASmaxInGroupsRemoveParticipantsResponseClientError",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsRemoveParticipantsClientErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsRemoveParticipantsClientErrors").parseRemoveParticipantsClientErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRemoveParticipantsClientErrors:b.value}))}g.parseRemoveParticipantsResponseClientError=a}),98);
__d("WASmaxInGroupsRemoveParticipantsResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseRemoveParticipantsResponseServerError=a}),98);
__d("WASmaxInGroupsParticipantNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","405");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantNotAllowedMixin=a}),98);
__d("WASmaxInGroupsParticipantNotInGroupMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","404");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseParticipantNotInGroupMixin=a}),98);
__d("WASmaxInGroupsRemoveParticipantsLinkedGroupsServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","500");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}g.parseRemoveParticipantsLinkedGroupsServerErrorMixin=a}),98);
__d("WASmaxInGroupsParticipantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup",["WAResultOrError","WASmaxInGroupsParticipantNotAcceptableMixin","WASmaxInGroupsParticipantNotAllowedMixin","WASmaxInGroupsParticipantNotInGroupMixin","WASmaxInGroupsRemoveParticipantsLinkedGroupsServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsParticipantNotInGroupMixin").parseParticipantNotInGroupMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ParticipantNotInGroup",value:b.value});var c=d("WASmaxInGroupsParticipantNotAllowedMixin").parseParticipantNotAllowedMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"ParticipantNotAllowed",value:c.value});var e=d("WASmaxInGroupsParticipantNotAcceptableMixin").parseParticipantNotAcceptableMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"ParticipantNotAcceptable",value:e.value});var f=d("WASmaxInGroupsRemoveParticipantsLinkedGroupsServerErrorMixin").parseRemoveParticipantsLinkedGroupsServerErrorMixin(a);return f.success?d("WAResultOrError").makeResult({name:"RemoveParticipantsLinkedGroupsServerError",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ParticipantNotInGroup","ParticipantNotAllowed","ParticipantNotAcceptable","RemoveParticipantsLinkedGroupsServerError"],[b,c,e,f])}g.parseParticipantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup=a}),98);
__d("WASmaxInGroupsRemoveParticipantsResponseSuccess",["WAResultOrError","WASmaxInGroupsGroupAddressingModeMixin","WASmaxInGroupsParticipantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup","WASmaxInGroupsPhoneNumberMixin","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;var c=d("WASmaxInGroupsPhoneNumberMixin").parsePhoneNumberMixin(a);a=d("WASmaxInGroupsParticipantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup").parseParticipantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup(a);return d("WAResultOrError").makeResult({jid:b.value,phoneNumberMixin:c.success?c.value:null,participantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup:a.success?a.value:null})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"remove");if(!c.success)return c;var e=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",e.value);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!e.success)return e;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!b.success)return b;b=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,c.value,"linked_groups","true");if(!b.success)return b;a=d("WASmaxInGroupsGroupAddressingModeMixin").parseGroupAddressingModeMixin(a);c=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"participant",1,1024,h);return!c.success?c:d("WAResultOrError").makeResult({type:e.value,removeLinkedGroups:b.value,groupAddressingModeMixin:a.success?a.value:null,removeParticipant:c.value})}g.parseRemoveParticipantsResponseSuccessRemoveParticipant=h;g.parseRemoveParticipantsResponseSuccess=a}),98);
__d("WASmaxOutGroupsRemoveParticipantsRequest",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxOutGroupsBaseSetGroupMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.participantJid;a=d("WASmaxJsx").smax("participant",{jid:d("WAWap").USER_JID(a)});return a}function a(a){var b=a.participantArgs,c=a.hasRemoveLinkedGroupsTrue;c=d("WASmaxOutGroupsBaseSetGroupMixin").mergeBaseSetGroupMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("remove",{linked_groups:d("WASmaxAttrs").OPTIONAL_LITERAL("true",c)},d("WASmaxChildren").REPEATED_CHILD(h,b,1,1024))),a);return c}g.makeRemoveParticipantsRequestRemoveParticipant=h;g.makeRemoveParticipantsRequest=a}),98);
__d("WASmaxGroupsRemoveParticipantsRPC",["WAComms","WASmaxInGroupsRemoveParticipantsResponseClientError","WASmaxInGroupsRemoveParticipantsResponseServerError","WASmaxInGroupsRemoveParticipantsResponseSuccess","WASmaxOutGroupsRemoveParticipantsRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsRemoveParticipantsRequest").makeRemoveParticipantsRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsRemoveParticipantsResponseSuccess").parseRemoveParticipantsResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"RemoveParticipantsResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsRemoveParticipantsResponseClientError").parseRemoveParticipantsResponseClientError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"RemoveParticipantsResponseClientError",value:h.value});case 10:i=d("WASmaxInGroupsRemoveParticipantsResponseServerError").parseRemoveParticipantsResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"RemoveParticipantsResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("RemoveParticipants",{Success:g,ClientError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendRemoveParticipantsRPC=a}),98);
__d("MAWRemoveGroupParticipants",["MAWJobManager","MAWODSProxy","MAWRemoveGroupParticipantsApi","WAJids","WALogger","WAOdsEnums","WAPREList","WAPREMetrics","WAResultOrError","WASmaxGroupsRemoveParticipantsRPC","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to remove a participant: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to remove participants: ",""]);i=function(){return a};return a}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("sendIq",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=a.group;c=a.users;var e=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.REMOVE_PARTICIPANTS,{"int":{removedParticipants:c.length}});a=c.map(function(a){return d("WAJids").toMsgrUserJid(a)});var f=[];if(a.length>0){c=function(a){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_REMOVE_PARTICIPANT,key:"fail"}),d("WALogger").ERROR(i(),g.name),e.endFail("send_iq_fail "+a)};var g=(yield d("WASmaxGroupsRemoveParticipantsRPC").sendRemoveParticipantsRPC({hasRemoveLinkedGroupsTrue:!1,iqTo:b,participantArgs:a.map(function(a){return{participantJid:a}})}));e.addPoint("finish_send_iq");switch(g.name){case"RemoveParticipantsResponseClientError":a=g.value.errorRemoveParticipantsClientErrors.name;c(a);return d("WAResultOrError").makeError(a);case"RemoveParticipantsResponseServerError":a=g.value.errorServerErrors.name;c(a);return d("WAResultOrError").makeError(a);case"RemoveParticipantsResponseSuccess":d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_REMOVE_PARTICIPANT,key:"success"}),g.value.removeParticipant.forEach(function(a){var b=a.jid;a=a.participantNotInGroupOrParticipantNotAllowedOrParticipantNotAcceptableOrRemoveParticipantsLinkedGroupsServerErrorMixinGroup;a==null?f.push({addressable:!0,type:"nonparticipant",user:b}):d("WALogger").ERROR(h(),a.name)})}}e.addPoint("start_remove_participant_txn");yield d("MAWRemoveGroupParticipantsApi").removeGroupParticipants(null,b,d("WAJids").AUTHOR_ME,f,!0);e.addPoint("finish_remove_participant_txn");return d("WAResultOrError").makeResult({groupJid:b,participants:f})});return function(b,c,d){return a.apply(this,arguments)}}()).end();g.removeGroupParticipants=a}),98);
__d("createInstamadilloAddMessagePayload",["I64","InstamadilloMessageIdUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return a!=null?{ephemeralityParams:{ephemeralDurationSec:(h||(h=d("I64"))).to_int32(a)}}:{}}function j(a){return a.isForwarded===!0?{forwardingParams:{forwardedThreadId:(h||(h=d("I64"))).to_string(a.threadKey)}}:{}}function k(a){if(a.replySourceId==null&&a.replySourceTimestampMs==null)return{};function b(){return a.replySourceId!=null?{repliedToMessageOtid:d("InstamadilloMessageIdUtils").fromInstamadilloMessageId(a.replySourceId).stanzaId}:{}}function c(){return a.replySourceTimestampMs!=null?{repliedToMessageWaServerTimeSec:(h||(h=d("I64"))).to_string(a.replySourceTimestampMs)}:{}}return{repliedToMessage:babelHelpers["extends"]({},b(),c())}}function a(a,b){b={content:{text:{text:b?void 0:a.text}},metadata:babelHelpers["extends"]({},i(a.ephemeralDurationInSec),j(a),k(a))};return b}function b(a,b){b={content:{media:b},metadata:babelHelpers["extends"]({},i(a.ephemeralDurationInSec),j(a),k(a))};return b}function c(a,b){b={content:{receiverFetchXma:JSON.parse(b)},metadata:babelHelpers["extends"]({},i(a.ephemeralDurationInSec),j(a),k(a))};return b}g.createInstamadilloAddMessageTextPayload=a;g.createInstamadilloAddMessageMediaPayload=b;g.createInstamadilloAddMessageReceiverFetchXmaPayload=c}),98);
__d("createInstamadilloTransportPayload",[],(function(a,b,c,d,e,f){"use strict";function a(a){a={add:a};return a}function b(a){a={supplement:a};return a}function c(a){a={"delete":a};return a}function d(a){a={franking:a};return a}f.createInstamadilloAddMessageTransportPayload=a;f.createInstamadilloSupplementMessageTransportPayload=b;f.createInstamadilloDeleteMessageTransportPayload=c;f.createInstamadilloFrankingTransportPayload=d}),66);
__d("MAWSpamReportUtils",["I64","InstamadilloTransportPayload.pb","LSIntEnum","MAWAsMessageApplication","MAWMediaTypeAttribute","MAWMediaUtils","MAWMsgType","WAGlobals","WAJids","WAMsgApplication.pb","WAWap","createInstamadilloAddMessagePayload","createInstamadilloTransportPayload","encodeProtobuf","err","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c,e,f,g){var j;g===void 0&&(g=!1);g=g?d("WAWap").CUSTOM_STRING("1"):d("WAWap").CUSTOM_STRING("0");var k=(h||(h=d("I64"))).to_string(a.timestampMs),l=a.isUnsent?d("WAWap").CUSTOM_STRING("1"):d("WAWap").CUSTOM_STRING("0"),m=d("WAWap").DROP_ATTR,n,o,p=d("WAWap").CUSTOM_STRING("2"),q=d("WAWap").DROP_ATTR;j=(j=a==null?void 0:a.text)!=null?j:null;if((h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(131072))&&j!==null)j=new TextEncoder().encode(j),n=d("WAWap").DROP_ATTR,o=d("WAWap").CUSTOM_STRING("3");else if((h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(65536)))j=null,n=d("WAWap").DROP_ATTR,o=d("WAWap").DROP_ATTR;else if((h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(256))||a.isUnsent){var r=d("MAWAsMessageApplication").asMessageApplicationLSDb(a);j=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,r).readByteArray();n="text";o=d("WAWap").CUSTOM_STRING("3");q=a.isUnsent?d("WAWap").CUSTOM_STRING("7"):d("WAWap").DROP_ATTR}else if(a.transportKey==="Instamadillo"){r=f!=null?d("createInstamadilloAddMessagePayload").createInstamadilloAddMessageMediaPayload(a,f):d("createInstamadilloAddMessagePayload").createInstamadilloAddMessageTextPayload(a);r=d("createInstamadilloTransportPayload").createInstamadilloAddMessageTransportPayload(r);j=d("encodeProtobuf").encodeProtobuf(d("InstamadilloTransportPayload.pb").TransportPayloadSpec,r).readByteArray();n=f!=null?"media":"text";o=d("WAWap").CUSTOM_STRING("3");p=d("WAWap").CUSTOM_STRING("3")}else{r=d("MAWAsMessageApplication").asMessageApplicationLSDb(a);j=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,r).readByteArray();n="text";o=d("WAWap").CUSTOM_STRING("3")}return d("WAWap").wap("message",{edit:q,from:c!=null?d("WAWap").GROUP_JID(c):e!=null?d("WAWap").USER_JID(e):d("WAWap").DROP_ATTR,id:d("WAWap").CUSTOM_STRING(a.messageId),participant:e!=null?d("WAWap").USER_JID(e):d("WAWap").DROP_ATTR,selected:g,t:d("WAWap").CUSTOM_STRING(k),to:b!=null?d("WAWap").USER_JID(b):d("WAWap").DROP_ATTR,type:n,unsent:l},d("WAWap").wap("raw",{mediatype:m,protocol_v:p,v:o},j))}function j(a){var b;if(((b=a.reportingMeta)==null?void 0:b.reportingContent)!=null){return{content:(b=a.reportingMeta)==null?void 0:b.reportingContent,shouldIgnoreFranking:!1}}b=(b=a.serverTs)!=null?b:a.ts;return b<=1708459984?{content:null,shouldIgnoreFranking:!0}:{content:null,shouldIgnoreFranking:!1}}function b(a,b,c,d,e,f,g,h){var i=[];i.push(k(a,b,d,e,f,g,h));if(c!=null)for(var a=c,c=Array.isArray(a),j=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var l;if(c){if(j>=a.length)break;l=a[j++]}else{j=a.next();if(j.done)break;l=j.value}l=l;i.push(k(l,b,d,e,f,g,h))}return i}function k(a,b,e,f,g,h,i){i=i?d("WAWap").CUSTOM_STRING("1"):d("WAWap").CUSTOM_STRING("0");var k=a.type===d("MAWMsgType").MSG_TYPE.REVOKED?d("WAWap").CUSTOM_STRING("1"):d("WAWap").CUSTOM_STRING("0"),l=d("WAWap").DROP_ATTR,m,n,o,p,q=d("WAWap").DROP_ATTR,r=!1;if(a.editMsgHistoryId!=null){if(a.editExternalId==null)return null;p=a.editExternalId;o=(a.editTs*1e3).toString();var s=d("MAWAsMessageApplication").asEditMessageApplication(a);m=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,s).readByteArray();s="text";n=d("WAWap").CUSTOM_STRING("3")}else if(a.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF){var t;m=new Uint8Array(a.msgContent.protobuf);o=(((t=a.serverTs)!=null?t:a.ts)*1e3).toString();s=d("WAWap").DROP_ATTR;n=d("WAWap").CUSTOM_STRING("3");p=a.externalId}else if(a.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT){o=(((t=a.serverTs)!=null?t:a.ts)*1e3).toString();m=null;s=d("WAWap").DROP_ATTR;n=d("WAWap").DROP_ATTR;p=a.externalId}else if(a.type===d("MAWMsgType").MSG_TYPE.REVOKED||a.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME){t=d("MAWAsMessageApplication").deletedMsgAsMessageApplicationForSpamReporting(a);if(t==null)return null;m=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,t).readByteArray();s="text";n=d("WAWap").CUSTOM_STRING("3");p=a.externalId;q=a.type===d("MAWMsgType").MSG_TYPE.REVOKED?d("WAWap").CUSTOM_STRING("7"):d("WAWap").DROP_ATTR;b!=null&&(l=d("MAWMediaUtils").getServerMediaTypeFromMediaType(b.mediaType));if(!h){t=j(a);t.content!=null&&(m=t.content);r=t.shouldIgnoreFranking}o=a.originalTs!=null?(a.originalTs*1e3).toString():(((t=a.serverTs)!=null?t:a.ts)*1e3).toString()}else{if(!h){t=j(a);t.content!=null&&(m=t.content);r=t.shouldIgnoreFranking}if(h||m==null){t=d("MAWAsMessageApplication").asMessageApplication(a,b);m=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,t).readByteArray()}a.type==="Image"||a.type==="Ptt"||a.type==="Video"||a.type==="Gif"?s="media":s="text";n=d("WAWap").CUSTOM_STRING("3");l=d("MAWMediaTypeAttribute").getMediaTypeAttribute(a);o=(((h=a.serverTs)!=null?h:a.ts)*1e3).toString();p=a.externalId}b=null;if(d("WAGlobals").getConfig().isFrankingEnabled()&&((t=a.reportingMeta)==null?void 0:t.frankingTag)!=null&&((h=a.reportingMeta)==null?void 0:h.reportingTag)!=null&&!r){b=d("WAWap").wap("franking",null,d("WAWap").wap("franking_tag",null,(t=a.reportingMeta)==null?void 0:t.frankingTag),d("WAWap").wap("reporting_tag",null,(h=a.reportingMeta)==null?void 0:h.reportingTag))}(a.type===d("MAWMsgType").MSG_TYPE.REVOKED||a.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)&&c("justknobx")._("1753")&&(b=null);return d("WAWap").wap("message",{edit:q,from:f!=null?d("WAWap").GROUP_JID(f):g!=null?d("WAWap").USER_JID(g):d("WAWap").DROP_ATTR,id:d("WAWap").CUSTOM_STRING(p),participant:g!=null?d("WAWap").USER_JID(g):d("WAWap").DROP_ATTR,selected:i,t:d("WAWap").CUSTOM_STRING(o),to:e!=null?d("WAWap").USER_JID(e):d("WAWap").DROP_ATTR,type:s,unsent:k},d("WAWap").wap("raw",{mediatype:l,v:n},m),b)}function e(a){var b;a.author===d("WAJids").AUTHOR_ME?b=d("WAGlobals").getMyUserJid():b=d("WAJids").authorAsUserJid(a.author);if(b==null)throw c("err")("Impossible message author");return b}function f(a,b){a.author===d("WAJids").AUTHOR_ME?a=b:a=d("WAGlobals").getMyUserJid();if(a==null)throw c("err")("Impossible message recipient");return a}g.formatLSDbMsgForSpamReport=a;g.getformattedMsgsForSpamReport=b;g.getAuthorAsJidForSpam=e;g.getRecipientAsJidForSpam=f}),98);
__d("MWBUtil",[],(function(a,b,c,d,e,f){"use strict";a=30;b=["impersonation"];c=["ig_user_impersonation"];d=Array.of.apply(Array,b.concat(c));f.SPAM_REPORT_MESSAGE_COUNT=a;f.MSGR_IMPERSONATION_TAGS=b;f.IG_IMPERSONATION_TAGS=c;f.ALL_IMPERSONATION_TAGS=d}),66);
__d("MAWReportUserSpam",["I64","MAWGetGroupInfoApi","MAWGetLastMsgsInChatForSpamReportApi","MAWJids","MAWJobManager","MAWSpamReportUtils","MWBUtil","WADeprecatedSendIq","WAGlobals","WAJids","WAResultOrError","WAWap","asyncToGeneratorRuntime","err","isStringNullOrEmpty"],(function(a,b,c,d,e,f,g){"use strict";var h;a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("reportUserSpam",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.chatJid,f=a.context,g=a.frxParams,h=a.frxTags,i=a.isIgd,m=a.openMsgs,n=a.reportedMessageId,o=a.spamFlow,p=a.userJid;a=(h==null?void 0:h.some(function(a){return d("MWBUtil").ALL_IMPERSONATION_TAGS.includes(a)}))===!0;var q=a?[]:yield d("MAWGetLastMsgsInChatForSpamReportApi").getLastMsgsInChatForSpamReport(e,d("MWBUtil").SPAM_REPORT_MESSAGE_COUNT);a=null;if(h!=null){if(h.length===0)throw c("err")("spam reasons should not be an empty array");a=d("WAWap").wap("tagset",null,h.map(function(a){return d("WAWap").wap("tag",{value:d("WAWap").CUSTOM_STRING(a)})}))}h=null;c("isStringNullOrEmpty")(g)||(h=d("WAWap").wap("parameters",null,g));g=null;f!=null&&(g=d("WAWap").wap("context",null,f));var r=null;(a!=null||g!=null||h!=null)&&(r=d("WAWap").wap("frx",null,a,g,h));var s=j(m,e,p);f=(yield d("WAJids").switchOnMsgrChatJidType(e,{group:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWap").DROP_ATTR,c=d("WAWap").DROP_ATTR,e=(yield d("MAWGetGroupInfoApi").getGroupInfo(a));e!=null&&e.subject!=null&&e.subject.content!=null&&(b=d("WAWap").CUSTOM_STRING(e.subject.content));e!=null&&e.inviter!=null&&(c=d("WAWap").USER_JID(e.inviter));return k(q,a,p,c,b,o,r,s,i,n)});function c(b){return a.apply(this,arguments)}return c}(),user:function(){return l(q,p,o,r,s,i,n)}}));d("WADeprecatedSendIq").deprecatedCastStanza(f);return d("WAResultOrError").makeResult()});return function(b){return a.apply(this,arguments)}}()).end();function i(a,b){var c=a.flat();if(a.length<d("MWBUtil").SPAM_REPORT_MESSAGE_COUNT){var e;a=d("MWBUtil").SPAM_REPORT_MESSAGE_COUNT-a.length;if(a<((e=b==null?void 0:b.length)!=null?e:0)){c=[].concat(((e=b)!=null?e:[]).slice(0,a),c)}else{c=[].concat((e=b)!=null?e:[],c)}}return c}function j(a,b,c){return((a=a)!=null?a:[]).map(function(a){var e=d("MAWJids").toUserJid((h||(h=d("I64"))).to_string(a.senderId));if(d("WAJids").interpretAsGroupJid(b)!=null)return d("MAWSpamReportUtils").formatLSDbMsgForSpamReport(a,null,d("WAJids").toGroupJid(b),e);else{var f=(h||(h=d("I64"))).equal(a.senderId,(h||(h=d("I64"))).of_string(d("WAJids").userIdFromJid(d("WAGlobals").getMyUserJid())))?c:d("WAGlobals").getMyUserJid();return d("MAWSpamReportUtils").formatLSDbMsgForSpamReport(a,f,null,e)}})}function k(a,b,c,e,f,g,h,j,k,l){a=a.map(function(a){return d("MAWSpamReportUtils").getformattedMsgsForSpamReport(a.msg,a.mediaInfo,a.editHistory,null,b,d("MAWSpamReportUtils").getAuthorAsJidForSpam(a.msg),k,l!=null&&((a=a.msg)==null?void 0:a.msgId)===l)});a=i(a,j);return(j=d("WAWap")).wap("iq",{id:j.generateId(),to:j.S_WHATSAPP_NET,type:"set",xmlns:"spam"},j.wap("spam_list",{jid:j.GROUP_JID(b),reportee:j.USER_JID(c),source:e,spam_flow:j.CUSTOM_STRING(g),subject:f},a),h)}function l(a,b,c,e,f,g,h){a=a.map(function(a){return d("MAWSpamReportUtils").getformattedMsgsForSpamReport(a.msg,a.mediaInfo,a.editHistory,d("MAWSpamReportUtils").getRecipientAsJidForSpam(a.msg,b),null,d("MAWSpamReportUtils").getAuthorAsJidForSpam(a.msg),g,h!=null&&((a=a.msg)==null?void 0:a.msgId)===h)}).filter(function(a){return a!=null});a=i(a,f);return(f=d("WAWap")).wap("iq",{id:f.generateId(),to:f.S_WHATSAPP_NET,type:"set",xmlns:"spam"},f.wap("spam_list",{jid:f.USER_JID(b),reportee:f.USER_JID(b),spam_flow:f.CUSTOM_STRING(c)},a),e)}g.reportUserSpam=a}),98);
__d("MAWRerevokePendingStanzas",["MAWBuildIncomingMsgs","MAWDbMsg","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWJobManager","MAWMsgType","MAWRemoveExpiredUnsendMsgsContent","MAWTransactionMode","MAWWriteRevokeMessageTxns","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("echoSerialization",function(){return h()}).end();var h=d("MAWIndexedDb").makeMsgrTransactor({chunk:(b=d("MAWTransactionMode")).READWRITE,deletedMessages:b.READWRITE,editMsgHistory:b.READWRITE,ftsPurgeBacklog:b.READWRITE,groupInfo:b.READWRITE,media:b.READWRITE,mediaBackup:b.READWRITE,messages:b.READWRITE,pendingStanzas:b.READWRITE,reactions:b.READWRITE,threads:b.READWRITE,xma:b.READWRITE},"reRevokeMsgs",function(a){return function(){return a.pendingStanzas.toArray().then(function(b){b=b.map(function(b){var c;if(((c=b.pendingContent)==null?void 0:c.type)==="Revoked"){var e=b==null?void 0:(c=b.pendingContent)==null?void 0:c.content;c=d("MAWJidUtils").maybeToProtocolMsgId(e.author,e.threadJid,e.revokedExternalId);return c==null||e==null?d("MAWDexieTable").dexieResolve():d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c),a.threads.get({jid:c.chat})]).then(function(c){var f=c[0];c=c[1];if(f==null||c==null)return d("MAWDexieTable").dexieResolve();var g=e.ts+d("WATimeUtils").castToUnixTime(d("MAWBuildIncomingMsgs").REVOKE_CONTENT_EXPIRATION_IN_SEC);g=babelHelpers["extends"]({},f,{externalId:e.externalId,msgContent:d("MAWDbMsg").getMsgContent(f),originalTs:f.ts,revokedExternalId:e.revokedExternalId,ts:e.ts,type:d("MAWMsgType").MSG_TYPE.REVOKED,unsendMsgContentDeleteTs:d("WATimeUtils").castToUnixTime(g)});return d("MAWDexieTable").dexieAll([d("MAWWriteRevokeMessageTxns").markExistingMsgRevoked(a,f,g,c,!0),a.pendingStanzas["delete"](b.rowId)])})}return d("MAWDexieTable").dexieResolve()});return d("MAWDexieTable").dexieAll(b).then(function(){return d("MAWRemoveExpiredUnsendMsgsContent").removeExpiredUnsendMsgsContentTxn(a)})})}});g.rerevokeMsgs=a;g.reRevokeMsgs=h}),98);
__d("MAWWriteOutgoingAppDataApi",["MAWAckLevel","MAWDexieTable","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE},"writeOutgoingAppData",function(a){return function(b){var c=b.args,e=b.externalId,f=b.permittedIdentitiesPerDevice,g=b.ts;return a.appData.get({externalId:e}).then(function(b){if(b!=null)if(b.ack>=d("MAWAckLevel").ACK.sent)return d("MAWDexieTable").dexieResolve({appDataExternalId:e,devices:Array.from(b.recipientDevices),type:"already_sent"});else return d("MAWDexieTable").dexieResolve({appDataExternalId:e,devices:Array.from(b.recipientDevices),type:"not_sent"});b=c.contents;return f.size===0?{type:"no_devices"}:a.appData.add({ack:d("MAWAckLevel").ACK.clock,contents:b,externalId:e,permittedIdentitiesPerDevice:f,recipientDevices:new Set(f.keys()),sendPartial:c.deviceJids!=null,ts:g}).then(function(){return{appDataExternalId:e,devices:Array.from(f.keys()),type:"not_sent"}})})}});g.writeOutgoingAppData=a}),98);
__d("MAWSendAppData",["MAWHandleMetaSyncAction","MAWJobDefinitions","MAWJobManager","MAWWriteOutgoingAppDataApi","WAGlobals","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["no other devices"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendAppData already sent message"]);i=function(){return a};return a}function j(a){var b=a.recipients;return d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.loadIdentities(d("WAGlobals").getMyUserJid()).then(function(a){var c=new Map(),e=b==="all"?new Set(a.keys()):new Set(b);for(a of a){var f=a[0],g=a[1];if(f===d("WAGlobals").getMyDeviceJid())continue;else if(!e.has(f))continue;c.set(f,{pubKey:g})}return c})},{flush:!1,operationType:"maw_load_identities"})}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e;b=a.args;a=a.externalId;e=(yield j({recipients:(e=b.deviceJids)!=null?e:"all"}));a=(yield d("MAWWriteOutgoingAppDataApi").writeOutgoingAppData({args:b,externalId:a,permittedIdentitiesPerDevice:e,ts:c.jobStartTime}));b.contents.type==="meta_sync"&&(yield d("MAWHandleMetaSyncAction").handleMetaSyncActions(b.contents));if(a.type==="already_sent"){d("WALogger").LOG(i());return a}else if(a.type==="no_devices"){d("WALogger").LOG(h());return a}else{a.type;yield d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.sendWrittenAppData(a.appDataExternalId));return a}});return function(b,c,d){return a.apply(this,arguments)}}()).end();g.calculateAppDataPermittedIdentities=j;g.sendAppData=a}),98);
__d("MAWResendWrittenAppData",["MAWGetAppDataForResendApi","MAWJobManager","MAWMarkAppDataDroppedApi","MAWMarkAppDataSendFailedApi","MAWSendAppData","WAAPI","WAGlobals","WALogger","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenAppData(","): too old, dropping"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["resendWrittenAppData not sending message: ",""]);i=function(){return a};return a}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("resendWrittenAppData",{code:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.appDataExternalId;yield c("WAAPI").getDevices({ignoreDhash:!1,reason:"resend-written-app-data",users:new Set([d("WAGlobals").getMyUserJid()])});var b=(yield d("MAWSendAppData").calculateAppDataPermittedIdentities({recipients:"all"}));b=(yield d("MAWGetAppDataForResendApi").getAppDataForResend(a,b));if(b.type!=="not_sent"){d("WALogger").LOG(i(),b.type);return}b=(yield c("WAAPI").sendAppData({checkPhash:"dontCheckPhash",contents:b.appData,externalId:a,permittedIdentitiesPerDevice:b.permittedIdentitiesPerDevice}));b.success===!1&&(yield d("MAWMarkAppDataSendFailedApi").markAppDataSendFailed(a))});function e(b){return a.apply(this,arguments)}return e}(),stopRetryIf:{onStopRetry:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.appDataExternalId;d("WALogger").LOG(h(),a);yield d("MAWMarkAppDataDroppedApi").markAppDataDropped(a)});function c(b){return a.apply(this,arguments)}return c}(),timePassedSeconds:d("WATimeUtils").DAY_SECONDS}}).end();g.resendWrittenAppData=a}),98);
__d("MAWRestoreMessagesFromEncryptedBackups",["MAWEBRestoreTrackingUtils","MAWEbRestoreQueue","MAWJobManager","MAWRestoreMessagesFromEchoDocuments","Promise","WAGlobals","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Enqueueing echo restore item for thread: "," startSortKey: "," messages: "," isPointRestore: ",""]);i=function(){return a};return a}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("decodeAndRestoreMessages",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.deanonApiPayload,f=a.hasMoreAfter,g=a.hasMoreBefore,j=a.instanceKey,k=a.isPointQuery,l=a.messages,m=a.minMsgId,n=a.optimisticMsgs,o=a.skipMediaDownload,p=a.startSortKey,q=a.taskSource,r=a.threadId;a=a.traceId;a!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"worker_start",traceId:a});var s={messageIds:[],pendingRestoreSortKeys:[]};s=d("WAResultOrError").makeResult(s);if(!c("gkx")("23935"))return d("MAWRestoreMessagesFromEchoDocuments").restoreEchoMsgs({deanonApiPayload:e,hasMoreAfter:f,hasMoreBefore:g,instanceKey:j,isPointQuery:k,messages:l,minMsgId:m,optimisticMsgs:n,skipMediaDownload:o,startSortKey:p,taskSource:q,threadId:r,traceId:a,uploadedFromEBQueue:!1});else{e={currentUserJid:d("WAGlobals").getMyUserJid(),deanonApiPayload:e,echoMessages:l,hasMoreAfter:f,hasMoreBefore:g,instanceKey:j,isPointRestore:k,minMsgId:m,optimisticMsgs:n,protobufMsgs:void 0,skipMediaDownload:o,startSortKey:p,taskSource:q,threadJidPrimaryId:r,traceId:a};d("WATagsLogger").TAGS(["labyrinth_web","ebRestoreQueue"]).LOG(i(),r,p,l.length,k);yield d("MAWEbRestoreQueue").putMsgsToEbRestore([e])}return(h||(h=b("Promise"))).resolve(s)});return function(b){return a.apply(this,arguments)}}()).end();g.restoreMessagesFromEncryptedBackups=a}),98);
__d("MAWRestoreProtobufsFromEncryptedBackups",["LSIntEnum","LSMEBTaskCreationSource","MAWEbRestoreQueue","MAWJobManager","MAWRestoreMessagesFromProtobufs","WAGlobals","WATagsLogger","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Enqueueing protobuf restore item for thread: "," startSortKey: "," messages: "," isPointRestore: ",""]);i=function(){return a};return a}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("decodeAndRestoreMessages",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.deanonApiPayload,e=a.echoMessages,f=a.hasMoreAfter,g=a.hasMoreBefore,j=a.instanceKey,k=a.isPointQuery,l=a.messages,m=a.minMsgId,n=a.referenceTimestamp,o=a.requestId,p=a.skipMediaDownload,q=a.taskSource,r=a.threadId;a=a.transportKey;q=q==null?c("LSMEBTaskCreationSource").UNKNOWN:(h||(h=d("LSIntEnum"))).unwrapIntEnum(q);a={currentUserJid:d("WAGlobals").getMyUserJid(),deanonApiPayload:b,decryptedMessagesProtobufs:l,echoMessages:e,hasMoreAfter:f,hasMoreBefore:g,instanceKey:j,isPointRestore:k,minMsgId:m,referenceTimestamp:n,requestId:o,skipMediaDownload:p,taskSource:q,threadJidPrimaryId:r,transportKey:a,uploadedFromEbQueue:!1};if(!c("gkx")("23935"))return d("MAWRestoreMessagesFromProtobufs").restoreFromProtobufs(a);else{a={currentUserJid:d("WAGlobals").getMyUserJid(),deanonApiPayload:b,echoMessages:e,hasMoreAfter:f,hasMoreBefore:g,instanceKey:j,isPointRestore:k,minMsgId:m,optimisticMsgs:void 0,protobufMsgs:l,skipMediaDownload:p,startSortKey:n,taskSource:q,threadJidPrimaryId:r,traceId:o};d("WATagsLogger").TAGS(["labyrinth_web","ebRestoreQueue"]).LOG(i(),r,n,l.length,k);yield d("MAWEbRestoreQueue").putMsgsToEbRestore([a])}});return function(b){return a.apply(this,arguments)}}()).end();g.restoreProtobufsFromEncryptedBackups=a}),98);
__d("MAWRevokeMsgsApi",["MAWAckLevel","MAWBuildIncomingMsgs","MAWDbMsg","MAWDbMsgTxns","MAWDexieTable","MAWExternalId","MAWIndexedDb","MAWTransactionMode","MAWWriteRevokeMessageTxns","WAJids","WATimeUtils","justknobx"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({deletedMessages:(a=d("MAWTransactionMode")).READWRITE,ftsPurgeBacklog:a.READWRITE,groupInfo:a.READWRITE,messages:a.READWRITE,participants:a.READWRITE,reactions:a.READWRITE,threads:a.READWRITE,xma:a.READONLY},"revokeMsgs",function(a){return function(b,e){return d("MAWDexieTable").dexieAll(b.filter(function(a){return a.author===d("WAJids").AUTHOR_ME}).map(function(b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(c){return c==null?d("MAWDbMsgTxns").maybeGetRevokedMsgByProtocolMsgId(a,b):c}),d("MAWDexieTable").dexieResolve(b)])})).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){var f=b[0];b=b[1];if(f==null)return;if(f.type==="Revoked"){b={author:d("WAJids").AUTHOR_ME,chat:b.chat,externalId:f.externalId};return b}var g=d("MAWExternalId").generateExternalId();return a.threads.get({jid:f.threadJid}).then(function(b){var h;if(b==null)return;h={ack:d("MAWAckLevel").ACK.clock,altIndex:void 0,author:d("WAJids").AUTHOR_ME,externalId:g,mediaId:f.mediaId,msgContent:d("MAWDbMsg").getMsgContent(f),msgId:f.msgId,originalTs:c("justknobx")._("1753")?f.ts:(h=f.serverTs)!=null?h:f.ts,quote:f.quote,reportingMeta:f.reportingMeta,revokedExternalId:f.externalId,rowId:f.rowId,sortOrderMs:f.sortOrderMs,threadJid:b.jid,ts:e,type:"Revoked",unsendMsgContentDeleteTs:d("WATimeUtils").castToUnixTime(e+d("MAWBuildIncomingMsgs").REVOKE_CONTENT_EXPIRATION_IN_SEC),xmaMessageType:f.xmaMessageType};return d("MAWDexieTable").dexieAll([d("MAWWriteRevokeMessageTxns").markExistingMsgRevoked(a,f,h,b)]).then(function(){var a={author:d("WAJids").AUTHOR_ME,chat:b.jid,externalId:g};return a})})}).filter(Boolean))})}});g.revokeMsgs=b}),98);
__d("MAWRevokeMsg",["MAWJobDefinitions","MAWJobManager","MAWMessageSendScheduler","MAWRevokeMsgsApi","MAWSendWrittenMsg","Promise","WAJids","WAJobOrchestratorTypes","WALogger","WorkerScheduler","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["revokeMsg: ",""]);i=function(){return a};return a}function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=a.msgIds,g=a.s2sInstanceKey;d("WALogger").DEV(i(),JSON.stringify(f));a=(yield d("MAWRevokeMsgsApi").revokeMsgs(f,e.jobStartTime));var j=[];a=a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=f[b];a!=null&&!d("WAJids").isAuthorSystem(a.author)&&(j.push({deleting:a,original:b}),c("gkx")("5800")?yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:a,referencedOriginalExternalId:b.externalId,s2sInstanceKey:g,type:"revoke"},e.afterCrash):yield d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:a,referencedOriginalExternalId:b.externalId,s2sInstanceKey:g,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"revoke"})))});return function(b,c){return a.apply(this,arguments)}}());yield (h||(h=b("Promise"))).all(a);return j});return k.apply(this,arguments)}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("revokeMsg",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){if(c("gkx")("5801")){e=[];yield d("MAWMessageSendScheduler").messageSendScheduler().run({fn:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){e=(yield j(a,f))});function d(){return c.apply(this,arguments)}return d}(),name:"revoke",priority:d("WorkerScheduler").BLOCKING_PRIORITY}).promise;return e}else return j(a,f)});return function(b,c,d){return a.apply(this,arguments)}}()).end();g.revokeMsgs=a}),98);
__d("MAWWriteEditMsgApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteEditTxns"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READWRITE,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"writeEditMsg",function(a){return function(b,c,e){c={args:c,externalId:b,ts:e};return d("MAWWriteEditTxns").writeEdit(a,c).then(function(a){return a})}});g.writeEditMsg=b}),98);
__d("MAWSendEditMsg",["MAWJobDefinitions","MAWJobManager","MAWMessageSendScheduler","MAWSendWrittenMsg","MAWWriteEditMsgApi","WAJobOrchestratorTypes","WALogger","WAResultOrError","WorkerScheduler","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendEditMsg already sent a message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendEditMsg cannot edit to a non-existent message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendEditMsg cannot send to a non-existent thread"]);j=function(){return a};return a}function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=(yield d("MAWWriteEditMsgApi").writeEditMsg(a.externalId,a.args,b.jobStartTime));if(!e.success){e.error==="missing_thread"?d("WALogger").ERROR(j()):e.error==="missing_msg"?d("WALogger").ERROR(i()):e.error==="already_sent"&&d("WALogger").ERROR(h());return d("WAResultOrError").makeError(e.error)}c("gkx")("5800")?yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:e.value.protocolMsgId,referencedOriginalExternalId:e.value.originalMsgExternalId,s2sInstanceKey:a.args.s2sInstanceKey,type:"edit"},b.afterCrash):yield d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:e.value.protocolMsgId,referencedOriginalExternalId:e.value.originalMsgExternalId,s2sInstanceKey:a.args.s2sInstanceKey,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"edit"}));return d("WAResultOrError").makeResult()});return l.apply(this,arguments)}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("sendEditMsg",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){if(c("gkx")("5801")){e=d("WAResultOrError").makeResult();yield d("MAWMessageSendScheduler").messageSendScheduler().run({fn:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){e=(yield k(a,f))});function d(){return c.apply(this,arguments)}return d}(),name:"edit",priority:d("WorkerScheduler").BLOCKING_PRIORITY}).promise;return e}else return k(a,f)});return function(b,c,d){return a.apply(this,arguments)}}()).end();g.sendEditMsg=a}),98);
__d("MAWSendEphemeralSettingMsg",["MAWGetSyncResponseBackoffInfoByJidApi","MAWJobDefinitions","MAWJobManager","MAWLoggerUtils","MAWMessageSendScheduler","MAWMsgType","MAWSendWrittenMsg","MAWWriteOutgoingMsgApi","WAAPI","WAJids","WAJobOrchestratorTypes","WATagsLogger","WATimeUtils","WorkerScheduler","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg cannot send to a non-existent thread"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg already sent message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["send ephemeral setting message: chatJid ",", type ",", externalId ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["ephemeral sync response backed off"]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.SettingSync]);function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.args,f=a.chatJid;a=a.externalId;if(e.isForSyncResponse){var g=(yield d("WAJids").switchOnMsgrChatJidType(f,{group:function(){throw c("err")("ChatJid is not supposed to be a group")},user:function(a){return d("MAWGetSyncResponseBackoffInfoByJidApi").getSyncResponseBackoffInfoByJid(a)}}));if(o(b.jobStartTime,g)){l.LOG(k());return}}g=e.isForSyncResponse?d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE;yield c("WAAPI").getDevicesBeforeSend({chatJid:f,reason:"SendEphemeralSettings"});var m=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(a,f,b.jobStartTime,e,g));l.LOG(j(),f,g,a);if(m.type==="already_sent"){l.LOG(i());return}else if(m.type==="missing_thread"){l.LOG(h());return}c("gkx")("5800")?yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:m.protocolMsgId,s2sInstanceKey:e.s2sInstanceKey,type:"message"},b.afterCrash):yield d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:m.protocolMsgId,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"}))});return n.apply(this,arguments)}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("sendEphemeralSettingMsg",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){c("gkx")("5801")?yield d("MAWMessageSendScheduler").messageSendScheduler().run({fn:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield m(a,f)});function d(){return c.apply(this,arguments)}return d}(),name:"ephemeral",priority:d("WorkerScheduler").BLOCKING_PRIORITY}).promise:yield m(a,f)});return function(b,c,d){return a.apply(this,arguments)}}()).end();function o(a,b){if(b==null)return!1;var c=b.syncResponseRetries;b=b.syncResponseSentTs;switch(c){case 1:return d("WATimeUtils").happenedWithinAt(a,b,3*60);case 2:return d("WATimeUtils").happenedWithinAt(a,b,15*60);default:return!0}}g.sendEphemeralSettingMsg=a}),98);
__d("MAWWriteGroupInviteApi",["MAWDbGroupInfoTxns","MAWDbParticipant","MAWDexieTable","MAWIndexedDb","MAWLowLevelApiTypes","MAWThreadFetchAndEmitTxns","MAWTransactionMode","MAWWriteGroupInviteTxns","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READONLY,groupInfo:a.READWRITE,groupInvites:a.READWRITE,media:a.READONLY,messages:a.READWRITE,participants:a.READWRITE,reactions:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"writeGroupInvite",function(a){return function(b,c){var e=d("MAWDbGroupInfoTxns").getGroupInfo(a,b);return d("MAWDexieTable").dexieAll([d("MAWThreadFetchAndEmitTxns").fetchAndEmitThread(a,b,void 0,void 0,"writeGroupInvite"),e]).then(function(e){var f=e[0],g=e[1];if(f==null||!g.success)return d("WAResultOrError").makeError(d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.MISSING_GROUP);e=d("MAWDbParticipant").craftParticipantId(f.thread.jid,c.invitedParticipantUserJid);e={inviteCode:c.inviteCode,invitedParticipantId:e,inviteeJid:c.invitedParticipantUserJid,inviteExpirationTs:c.expiration,inviterJid:c.inviterUserJid,threadJid:f.thread.jid};return d("MAWWriteGroupInviteTxns").writeGroupInvite(a,e,b).then(function(a){if(a===d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.MISSING_GROUP)return d("WAResultOrError").makeError(d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.MISSING_GROUP);else if(a===d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.EXISTING_GROUP_INVITE)return d("WAResultOrError").makeError(d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.EXISTING_GROUP_INVITE);return d("WAResultOrError").makeResult(g==null?void 0:(a=g.value)==null?void 0:a.name)})})}});g.writeGroupInvite=b}),98);
__d("MAWSendGroupInviteMsg",["MAWJobDefinitions","MAWJobManager","MAWMessageSendScheduler","MAWMsgType","MAWSendWrittenMsg","MAWWriteGroupInviteApi","MAWWriteOutgoingMsgApi","WAJobOrchestratorTypes","WALogger","WorkerScheduler","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendGroupInviteMsg cannot send to a non-existent thread"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendGroupInviteMsg already sent message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendGroupInviteMsg for group "," to invited user ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendGroupInviteMsg failed to store a new group invite"]);k=function(){return a};return a}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.args;a=a.externalId;var f=(yield d("MAWWriteGroupInviteApi").writeGroupInvite(e.groupJid,{expiration:e.expiration,inviteCode:e.inviteCode,invitedParticipantUserJid:e.invitedParticipantUserJid,inviterUserJid:e.inviterUserJid}));if(!f.success){d("WALogger").LOG(k());return}f=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(a,e.groupJid,b.jobStartTime,babelHelpers["extends"]({},e,{groupName:(a=f.value)!=null?a:void 0}),d("MAWMsgType").MSG_TYPE.GROUP_INVITE));d("WALogger").DEV(j(),e.groupJid,e.invitedParticipantUserJid);if(f.type==="already_sent"){d("WALogger").LOG(i());return}else if(f.type==="missing_thread"){d("WALogger").LOG(h());return}c("gkx")("5800")?yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:f.protocolMsgId,type:"message"},b.afterCrash):yield d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:f.protocolMsgId,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"}))});return m.apply(this,arguments)}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){c("gkx")("5801")?yield d("MAWMessageSendScheduler").messageSendScheduler().run({fn:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield l(a,f)});function d(){return c.apply(this,arguments)}return d}(),name:"group-invite",priority:d("WorkerScheduler").BLOCKING_PRIORITY}).promise:yield l(a,f)});return function(b,c,d){return a.apply(this,arguments)}}()).end();g.sendGroupInviteMsg=a}),98);
__d("MAWSendMediaMsg",["FBLogger","MAWAckLevel","MAWAsConsumerApplication","MAWBridgeTypesCreators","MAWBridgeUpload","MAWCastToMsgrServerMediaType","MAWConfig","MAWDbChunkTxns","MAWDbMedia","MAWDbMediaTxns","MAWDbThreadTxns","MAWDexieTable","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWGetMediaPlaintextApi","MAWGetMsgIdByProtocolMsgId","MAWGetOrCreateMediaKnownEntriesApi","MAWIndexedDb","MAWJobDefinitions","MAWJobManager","MAWMediaAfterTxns","MAWMediaBackupTxns","MAWMediaDownloadStatus","MAWMediaDownloadStatusForUI","MAWMediaManagementTxns","MAWMediaUtils","MAWMessageSendScheduler","MAWMsgType","MAWMsgUtil","MAWOptimisticUploadManager","MAWQplProxy","MAWSendWrittenMsg","MAWStartMediaUploadQplFlow","MAWTransactionMode","MAWUpdateMediaEntryForMsgApi","MAWUpdateMediaEntryForOptimisticUploadApi","MAWWriteOutgoingMsgApi","Promise","WAAPI","WAJids","WAJobOrchestratorTypes","WALogger","WAMediaUtils","WASortedLists","WorkerScheduler","asyncToGeneratorRuntime","err","gkx","isInstamadilloEB","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to upload media: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MAWSendMediaMsg] - msgId mismatch between put msg and got msg"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send media: "," - missing thread"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendMediaMsg - begin writing "," media msg"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Chat ",": "," is received in job"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing required args for media backup in send media"]);n=function(){return a};return a}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.args,f=a.attachmentType,g=a.chatJid,h=a.externalId;a=a.file;d("WALogger").LOG(m(),g,a.name);f=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(a.type,void 0,f);var i=f.mediaType;f=f.serverMediaType;var j;switch(i){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:j=d("MAWMsgType").MSG_TYPE.IMAGE;break;case d("MAWDbMedia").MEDIA_TYPE.VIDEO:j=d("MAWMsgType").MSG_TYPE.VIDEO;break;case d("MAWDbMedia").MEDIA_TYPE.PTT:j=d("MAWMsgType").MSG_TYPE.PTT;break;case d("MAWDbMedia").MEDIA_TYPE.GIF:j=d("MAWMsgType").MSG_TYPE.GIF;break;case d("MAWDbMedia").MEDIA_TYPE.STICKER:j=d("MAWMsgType").MSG_TYPE.STICKER;break;case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:j=d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE;break;default:c("FBLogger")("labyrinth_web","unsupported_media").mustfix("unsupported media type");throw c("err")("Expected media msg type")}d("WALogger").LOG(l(),j);yield c("WAAPI").getDevicesBeforeSend({chatJid:g,reason:"SendMediaMsg"});h=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(h,g,b,e,j));if(h.type==="missing_thread"){d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"writing_media_to_db_failed",{instanceKey:e.s2sInstanceKey});d("WALogger").LOG(k(),a.name);throw c("err")("Failed to write msg to DB")}return[h,{mediaType:i,serverMediaType:f}]});return p.apply(this,arguments)}function q(a,b,c,d,e,f){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h){f=b.mediaType;b=b.serverMediaType;var k=g.args;g.attachmentType;var l=g.chatJid;g.externalId;g=g.file;var m=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(b);if(!m){c("FBLogger")("labyrinth_web","unsupported_media").mustfix("unsupported media type");d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"failed_media_unsupported_type",{instanceKey:k.s2sInstanceKey});throw c("err")("Media type unsupported: "+((m=b)!=null?m:""))}m=(yield d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId(a.protocolMsgId));if(!m.success){d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"failed_media_msgid_missing_in_db",{instanceKey:k.s2sInstanceKey});throw c("err")("Message missing in db")}m.value!==a.msgId&&d("WALogger").ERROR(j());m=a.msgId;var n=s(f,k);yield v(l,a.protocolMsgId,g,e,void 0,void 0,f,n,k.offlineAttachmentId);f=d("MAWOptimisticUploadManager").getOptimisticUploadManager();n=f.get(e);var o=n==null?void 0:n.optimisticUploadPromise,p=o!=null;d("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(c("qpl")._(25313175,"1551"),"isOptimisticUpload",p,k.s2sInstanceKey);d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"uploading_media_to_backend",{instanceKey:k.s2sInstanceKey});var q;o!=null&&(q=(yield o),q.success||d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"optimistic_upload_failure",{annotations:{string:{optimisticUploadError:q.error}},instanceKey:k.s2sInstanceKey}));if(q==null||!q.success){q==null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"upload_media_when_no_existing_optimistic_upload",{instanceKey:k.s2sInstanceKey});p=(yield d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:l,fileSize:g.size,serverMediaType:b,uploadEntry:"sendMediaMsg"}));q=(yield c("WAAPI").uploadMedia({chatJid:l,filename:b==="document"?g.name:void 0,getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("MAWGetOrCreateMediaKnownEntriesApi").getOrCreateMediaKnownEntries,getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,hash:e,mediaTypeDetails:{mediaType:b,type:"regular"},protocolMsgId:a.protocolMsgId,size:g.size,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload,uploadMediaMetric:p}))}if(!q.success){d("WALogger").LOG(i(),g.name);d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"failed_upload_media_to_backend",{instanceKey:k.s2sInstanceKey});d("MAWQplProxy").sendQPLStringAnnotationThroughBridge(c("qpl")._(25313175,"1551"),"errorDescription",q.error,k.s2sInstanceKey);return d("MAWMsgUtil").updateSystemAckWithTxn(m,d("MAWAckLevel").ACK.failed)}d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"successful_upload_media_to_backend",{instanceKey:k.s2sInstanceKey});yield x(e,m,l,a.protocolMsgId.externalId,(o=q.value)==null?void 0:o.objectId,b);c("gkx")("5800")?yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:a.protocolMsgId,s2sInstanceKey:k.s2sInstanceKey,type:"message"},h):yield d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:a.protocolMsgId,s2sInstanceKey:k.s2sInstanceKey,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"}));f["delete"](e);(n==null?void 0:n.previewPlaintextHash)!=null&&f["delete"](n.previewPlaintextHash)});return r.apply(this,arguments)}function s(a,b){a={validatedAudioInfo:a==="Ptt"&&b.duration!=null?{duration:b.duration,mimetype:d("MAWAsConsumerApplication").AUDIO_MIME_TYPE,played:!1}:null,validatedDocumentFileInfo:a==="DocumentFile"&&b.filename!=null?{filename:b.filename,mimetype:d("MAWAsConsumerApplication").FILE_MIME_TYPE}:null,validatedImageInfo:a==="Image"?{height:b.height,jpegThumbnail:b.jpegThumbnail,jpegThumbnailHeight:b.jpegThumbnailHeight,jpegThumbnailWidth:b.jpegThumbnailWidth,width:b.width}:a==="Gif"||a==="Sticker"?{height:b.height,jpegThumbnailHeight:b.height,jpegThumbnailWidth:b.width,width:b.width}:null,validatedVideoInfo:a==="Video"?{duration:b.duration,height:b.height,jpegThumbnail:b.jpegThumbnail,jpegThumbnailHeight:b.jpegThumbnailHeight,jpegThumbnailWidth:b.jpegThumbnailWidth,mimetype:d("MAWAsConsumerApplication").VIDEO_MIME_TYPE,width:b.width}:null};return a}function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"received_media_in_wajob",{instanceKey:a.args.s2sInstanceKey});var e=(yield o(a,b.jobStartTime)),f=e[0];e=e[1];var g=(yield d("MAWMediaUtils").genBlobHashes(a.file)),h=g[0];g=g[1];yield q(f,e,h,g,a,b.afterCrash)});return u.apply(this,arguments)}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("sendMediaMsg",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){c("gkx")("5801")?yield d("MAWMessageSendScheduler").messageSendScheduler().run({fn:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield t(a,f)});function d(){return c.apply(this,arguments)}return d}(),name:"media",priority:d("WorkerScheduler").BLOCKING_PRIORITY}).promise:yield t(a,f)});return function(b,c,d){return a.apply(this,arguments)}}()).end();function v(a,b,c,d,e,f,g,h,i){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h,i,j,k){var l;d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:f,status:c("MAWMediaDownloadStatus").DOWNLOADING,type:"main"});var m=(yield d("WAMediaUtils").blobToArrayBuffer(e));return d("MAWIndexedDb").makeMsgrTransactor({chunk:(l=d("MAWTransactionMode")).READWRITE,media:l.READWRITE,mediaBackup:l.READWRITE,messages:l.READWRITE,unrenderedMessages:l.READWRITE},"attachHashAndSaveMedia",function(l){return function(){return d("MAWDexieTable").dexieAll([d("MAWMediaManagementTxns").attachHashToMediaMsg(l,b,f,g,h,i,e.size,j,!1),d("MAWDbChunkTxns").getOrCreateMediaChunk(l,f,m,e.type)]).then(function(b){var e=b[0];return l.messages.where("msgId").anyOf(e.msgIds).toArray().then(function(b){d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({hash:f,mediaId:e.mediaId,status:c("MAWMediaDownloadStatus").SUCCESS,type:"main"});b=d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:a,filteredMsgIds:d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(b,a),hasMediaForUI:!0,media:e,offlineAttachmentId:k});c("gkx")("2616")===!0?d("MAWMediaAfterTxns").handleNewMediaAfterTxnWithBridgeMedia(l,b):d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:b})})})}})()});return w.apply(this,arguments)}function x(a,e,f,g,i,j){var k=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),l=k.get(a),m=l==null?void 0:l.mediaEntry;if(l==null)return(h||(h=b("Promise"))).resolve();k.set(a,babelHelpers["extends"]({},l,{msgId:e}));return m==null?(h||(h=b("Promise"))).resolve():d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READONLY},"maybePersistMediaEntry",function(b){return function(){return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(b,a).then(function(a){if(a){var h=babelHelpers["extends"]({},a,{mediaEntries:a.mediaEntries.set(e,m),msgIds:d("WASortedLists").addToSet(a.msgIds,e)});i!=null&&(h=babelHelpers["extends"]({},h,{objectId:d("WAMediaUtils").stringToDeliveryObjectId(i)}));var k=d("WAMediaUtils").decodeMediaEntryData(m);return b.media.update(a.mediaId,h).then(function(c){return i!=null?d("MAWMediaBackupTxns").linkMediaBackup(b,a.mediaId,e,d("WAMediaUtils").stringToDeliveryObjectId(i)):d("MAWDexieTable").dexieResolve()}).then(function(){var a=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(j),e=k.mediaKeyTimestamp;if(i!=null&&a!=null&&e!=null&&!c("isInstamadilloEB")())return d("MAWDbThreadTxns").getThread(b,f).then(function(b){b.success&&(a!=="document"||d("MAWConfig").getConfig().enableDocumentBackupAndRestore())&&d("MAWIndexedDb").afterTransaction({tag:"UploadAttachment",value:d("MAWBridgeUpload").createBridgeUploadAttachment(i,a,g,d("MAWConfig").getConfig().productTypeForEBAttachments,d("WAJids").threadIdForChatJid(f),f,e)})});else d("WALogger").WARN(n())})}else throw c("err")("media should already exist upon this point")})}})()}g.writeToDb=o;g.saveAndPassOff=q;g.sendMediaMsg=a;g.maybePersistMediaEntry=x}),98);
__d("MAWSendRavenActionMsg",["MAWJobDefinitions","MAWJobManager","MAWMessageSendScheduler","MAWModifyRavenMsgApi","MAWMsgType","MAWSendWrittenMsg","MAWWriteOutgoingMsgApi","WAAPI","WAJobOrchestratorTypes","WALogger","WorkerScheduler","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendRavenActionMsg cannot send to a non-existent thread"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendRavenActionMsg already sent message"]);i=function(){return a};return a}function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.args,f=a.chatJid;a=a.externalId;yield d("MAWModifyRavenMsgApi").modifyRavenMsg(e.ravenProtocolMsgId);yield c("WAAPI").getDevicesBeforeSend({chatJid:f,reason:"sendRavenActionMsg"});a=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(a,f,b.jobStartTime,e,d("MAWMsgType").MSG_TYPE.RAVEN_ACTION));if(a.type==="already_sent"){d("WALogger").LOG(i());return}else if(a.type==="missing_thread"){d("WALogger").LOG(h());return}c("gkx")("5800")?yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:a.protocolMsgId,type:"message"},b.afterCrash):yield d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:a.protocolMsgId,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"}))});return k.apply(this,arguments)}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("sendRavenActionMsg",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){c("gkx")("5801")?yield d("MAWMessageSendScheduler").messageSendScheduler().run({fn:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield j(a,f)});function d(){return c.apply(this,arguments)}return d}(),name:"raven",priority:d("WorkerScheduler").BLOCKING_PRIORITY}).promise:yield j(a,f)});return function(b,c,d){return a.apply(this,arguments)}}()).end();g.sendRavenActionMsg=a}),98);
__d("MAWSendReactionMsg",["MAWIndexedDb","MAWJobDefinitions","MAWJobManager","MAWMessageSendScheduler","MAWSendWrittenMsg","MAWTransactionMode","MAWWriteReactionMsgApi","WAAPI","WAJids","WALogger","WALongInt","WATimeUtils","WorkerScheduler","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendReactionMsg cannot react to a non-existent message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendReactionMsg cannot send to a non-existent thread"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendReactionMsg already sent message"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendReactionMsg: ",""]);k=function(){return a};return a}function l(a){return a==="\u2764\ufe0f"?"\u2764":a}function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.args,f=a.chatJid;a=a.externalId;d("WALogger").DEV(k(),f);var g=e.reaction,m=e.reactToProtocolMsgId;g=l(g);e=d("WAJids").toMsgrUserJid(e.reactToAuthor);var n=(yield o(m.externalId));yield c("WAAPI").getDevicesBeforeSend({chatJid:f,reason:"sendReactionMsg"});a=(yield d("MAWWriteReactionMsgApi").writeReactionMsg(a,f,{groupingKey:g,reaction:g,reactToAuthor:e,reactToExternalId:m.externalId,senderTimestampMs:n},b.jobStartTime));if(a.type==="already_sent"){d("WALogger").LOG(j());return}else if(a.type==="missing_thread"){d("WALogger").LOG(i());return}else if(a.type==="missing_msg"){d("WALogger").LOG(h());return}c("gkx")("5800")?yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:a.protocolMsgId,type:"reaction"},b.afterCrash):yield d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:a.protocolMsgId,type:"reaction"}))});return n.apply(this,arguments)}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("saveAndPassOff",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){c("gkx")("5801")?yield d("MAWMessageSendScheduler").messageSendScheduler().run({fn:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield m(a,f)});function d(){return c.apply(this,arguments)}return d}(),name:"reaction",priority:d("WorkerScheduler").BLOCKING_PRIORITY}).promise:yield m(a,f)});return function(b,c,d){return a.apply(this,arguments)}}()).end();function o(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield q(a));a=a.map(function(a){return d("WALongInt").maybeNumberOrThrowIfTooLarge(a.senderTimestampMs)}).filter(Boolean).reduce(function(a,b){return Math.max(a,b)},0);return Math.max(((a=a)!=null?a:0)+1,d("WATimeUtils").unixTimeMs())});return p.apply(this,arguments)}var q=d("MAWIndexedDb").makeMsgrTransactor({reactions:d("MAWTransactionMode").READONLY},"findMatchingReactionBeforeSendReactionMsg",function(a){return function(b){return a.reactions.where("reactToExternalId").equals(b).toArray()}});g.sendReactionMsg=a}),98);
__d("MAWSendWrittenAppData",["MAWGetAppDataApi","MAWJobDefinitions","MAWJobManager","MAWMarkAppDataDroppedApi","MAWMarkAppDataSendFailedApi","MAWMarkAppDataSentApi","WAAPI","WALogger","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenAppData(","): too old, dropping"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenAppData not sending message: ",""]);i=function(){return a};return a}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("encryptAndSend",{code:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.appDataExternalId;var b=(yield d("MAWGetAppDataApi").getAppData(a));if(b.type!=="not_sent"){d("WALogger").LOG(i(),b.type);return{type:"error"}}b=(yield c("WAAPI").sendAppData({checkPhash:b.sendPartial?"dontCheckPhash":"checkPhash",contents:b.appData,externalId:a,permittedIdentitiesPerDevice:b.permittedIdentitiesPerDevice}));if(b.success===!0){b.value.phashMismatch===!0&&(yield d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").jobSerializers.resendWrittenAppData(a)));yield d("MAWMarkAppDataSentApi").markAppDataSent(a);return{type:"success"}}else{yield d("MAWMarkAppDataSendFailedApi").markAppDataSendFailed(a);return{type:"error"}}});function e(b){return a.apply(this,arguments)}return e}(),stopRetryIf:{onStopRetry:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.appDataExternalId;d("WALogger").LOG(h(),a);yield d("MAWMarkAppDataDroppedApi").markAppDataDropped(a);return{type:"error"}});function c(b){return a.apply(this,arguments)}return c}(),timePassedSeconds:d("WATimeUtils").DAY_SECONDS}}).end();g.sendWrittenAppData=a}),98);
__d("MAWSendXMAShareMsg",["MAWAckLevel","MAWBridgeMsg","MAWBridgeXMA","MAWDbMsgTxns","MAWDexieTable","MAWExpiredXMACleaner","MAWFetchAndEmitThreadApi","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWGetMediaPlaintextApi","MAWGetMsgIdByProtocolMsgId","MAWGetOrCreateMediaKnownEntriesApi","MAWGetParticipantsInThreadApi","MAWHandleXmaTransactionUtil","MAWIndexedDb","MAWJobDefinitions","MAWJobManager","MAWMediaManagementTxns","MAWMediaUtils","MAWMessageSendScheduler","MAWMsgType","MAWMsgUtil","MAWOptimisticUploadManager","MAWQplProxy","MAWSendMediaMsg","MAWSendWrittenMsg","MAWStartMediaUploadQplFlow","MAWTransactionMode","MAWUpdateMediaEntryForMsgApi","MAWUpdateMediaEntryForOptimisticUploadApi","MAWVault","MAWWriteOutgoingMsgApi","MAWXMAManagementTxns","MAWXMAUtils","Promise","WAAPI","WAArmadilloXMA.pb","WAJids","WAJobOrchestratorTypes","WALogger","WAMediaUtils","WorkerScheduler","asyncToGeneratorRuntime","err","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to upload media xma"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendXMAShareMsg - Message missing in db"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send xma - missing thread"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendXMAShareMsg - Associated Message missing in db"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send xma associated msg - missing thread"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendXMAShareMsg - XMAMessageType is null"]);n=function(){return a};return a}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f,g=function(b,c){c===void 0&&(c={}),a.args.s2sUserFlowQPLEvent!=null&&d("MAWQplProxy").sendQplPointThroughBridge(a.args.s2sUserFlowQPLEvent,b,{annotations:c,instanceKey:a.args.s2sInstanceKey})},o=function(b,c){c===void 0&&(c={}),a.args.s2sUserFlowQPLEvent!=null&&d("MAWQplProxy").sendQPLFailThroughBridge(a.args.s2sUserFlowQPLEvent,b,c,a.args.s2sInstanceKey)};g("received_message_in_wajob");var p=Boolean(a.associatedMsgContent)&&a.associatedMsgContent!=null?d("MAWVault").vault(a.associatedMsgContent):void 0,q=void 0,t=a.associatedMsgContentExternalId,u=a.args.xmaMessageType;if(u==null){d("WALogger").ERROR(n());return}yield d("MAWFetchAndEmitThreadApi").fetchAndEmitThreadInTxn(a.chatJid,"sendXMAShareMsg");if(c("gkx")("23945")){var v=(yield d("MAWGetParticipantsInThreadApi").getParticipantsInThreadInTxn(a.chatJid));v=v.map(function(a){return a.userJid});c("promiseDone")(c("WAAPI").getDevices({ignoreDhash:!0,reason:"send-xma-share-msg",users:new Set(v)}))}g("writing_xma_to_db");var w=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(a.xmaMsgExternalId,a.chatJid,e.jobStartTime,a.args,d("MAWMsgType").MSG_TYPE.XMA));if(p!=null&&t!=null){v=babelHelpers["extends"]({},a.args,{content:p});g("writing_message_to_db");p=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(t,a.chatJid,e.jobStartTime,v,d("MAWMsgType").MSG_TYPE.TEXT));if(p.type==="missing_thread"){o("failed_message_missing_thread");d("WALogger").ERROR(m());return}t=(yield d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId(p.protocolMsgId));if(!t.success){o("failed_missing_associated_message_in_db");d("WALogger").ERROR(l());return}q=t.value}if(w.type==="missing_thread"){d("WALogger").ERROR(k());o("failed_missing_thread_in_writing_xma");return}v=(yield d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId(w.protocolMsgId));if(!v.success){o("failed_missing_xma_message_in_db");d("WALogger").ERROR(j());return}var x=v.value;p=a.previewFile;t=a.headerFile;v=a.faviconFile;f=babelHelpers["extends"]({},a.xmaArgs,{overlayIconGlyph:(f=a.xmaArgs.overlayIconGlyph)!=null?f:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE,xmaLayoutType:(f=a.xmaArgs.xmaLayoutType)!=null?f:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.SINGLE});p=(yield s(p,t,v,x,u,q,w.protocolMsgId,f,a.chatJid,a.args.offlineAttachmentId));g("saved_xma_content_in_db");t=f.targetExpiringAtSec;v=d("MAWXMAUtils").isXMAExpired(!1,t);if(!v&&t!=null)d("MAWExpiredXMACleaner").addNewExpiredXMACleanerTimestamp(t);else if(v){if(c("gkx")("5800")){u=(yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:w.protocolMsgId,s2sInstanceKey:a.args.s2sInstanceKey,type:"message"},e.afterCrash));u.success===!0?g("sending_message_end"):g("sending_message_fail",{string:{errorType:u.error.type}})}else yield d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:w.protocolMsgId,s2sInstanceKey:a.args.s2sInstanceKey,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"}));g("successful_message_sent_to_backend",{bool:{isExpired:v}})}var y=d("MAWOptimisticUploadManager").getOptimisticUploadManager();g("start_upload_media_to_backend");q=(yield r(p,a.chatJid,w.protocolMsgId,y));g("successful_upload_media_to_backend");f=q.filter(function(a){return!a.uploadResult.success}).length;if(f>0){d("WALogger").ERROR(i());o("failed_upload_media_to_backend");return d("MAWMsgUtil").updateSystemAckWithTxn(x,d("MAWAckLevel").ACK.failed)}t=q.map(function(b){var c=b.uploadResult;b=b.media;return d("MAWSendMediaMsg").maybePersistMediaEntry(b.plaintextHash,x,a.chatJid,w.protocolMsgId.externalId,c==null?void 0:(c=c.value)==null?void 0:c.objectId,d("MAWMediaUtils").getServerMediaTypeFromMediaType(b.mediaType,"xma-media"))});yield (h||(h=b("Promise"))).all(t);g("saving_xma_upload_result_in_db");if(c("gkx")("5800")){g("sending_message_start");u=(yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:w.protocolMsgId,s2sInstanceKey:a.args.s2sInstanceKey,type:"message"},e.afterCrash));u.success===!0?g("sending_message_end"):g("sending_message_fail",{string:{errorType:u.error.type}})}else yield d("MAWJobManager").getJobManager().waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("sendWrittenMsg",{protocolMsgId:w.protocolMsgId,s2sInstanceKey:a.args.s2sInstanceKey,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},type:"message"})),g("successful_message_sent_to_backend");q.forEach(function(a){y["delete"](a.media.plaintextHash)})});return p.apply(this,arguments)}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("sendXMAShareMsg",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){c("gkx")("5801")?yield d("MAWMessageSendScheduler").messageSendScheduler().run({fn:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield o(a,f)});function d(){return c.apply(this,arguments)}return d}(),name:"xma",priority:d("WorkerScheduler").BLOCKING_PRIORITY}).promise:yield o(a,f)});return function(b,c,d){return a.apply(this,arguments)}}()).end();function q(a,b,e,f,g,h){h=h.get(a);h=h==null?void 0:h.optimisticUploadPromise;if(h!=null)return h;var i=d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:b,fileSize:g,serverMediaType:f,uploadEntry:"sendXMAShareMsg"});return c("WAAPI").uploadMedia({chatJid:b,getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("MAWGetOrCreateMediaKnownEntriesApi").getOrCreateMediaKnownEntries,getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,hash:a,mediaTypeDetails:{mediaType:f,type:"regular"},protocolMsgId:e,size:g,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload,uploadMediaMetric:i})["catch"](function(a){i.endFail("xma_upload_unknown_failure",{string:{errorDescription:a.toString()}});throw a})}function r(a,c,e,f){a=[a.previewDbMedia,a.faviconDbMedia,a.headerDbMedia].filter(Boolean);a=a.reduce(function(a,b){a.includes(b.plaintextHash)||a.push(b);return a},[]);a=a.map(function(a){var b=d("MAWMediaUtils").getServerMediaTypeFromMediaType(a.mediaType,"xma-media");return q(a.plaintextHash,c,e,b,a.size,f).then(function(b){return{media:a,uploadResult:b}})});return(h||(h=b("Promise"))).all(a)}function s(a,b,c,d,e,f,g,h,i,j){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,d,e,f,g,i,j,k,l){a=(yield (h||(h=b("Promise"))).all([u(a),u(c),u(d)]));c=a[0];d=a[1];a=a[2];return w(e,c,d,a,f,g,i,j,k,l)});return t.apply(this,arguments)}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a==null)return a;var b=a.file,e=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(b.type,!0),f=e.mediaType;e=e.serverMediaType;var g=(yield d("MAWMediaUtils").genBlobHashes(b)),h=g[0];g=g[1];if(f!=="Image")throw c("err")("Expected Image when sending XMA share");var i=(yield d("WAMediaUtils").blobToArrayBuffer(b));return{blobArrayBuffer:i,file:b,hashedPlaintextHash:g,mediaInfo:{validatedAudioInfo:null,validatedDocumentFileInfo:null,validatedImageInfo:{height:a.height,width:a.width},validatedVideoInfo:null},mediaType:f,plaintextHash:h,serverMediaType:e}});return v.apply(this,arguments)}function w(a,b,e,f,g,h,i,j,k,l){var m;return d("MAWIndexedDb").makeMsgrTransactor({chunk:(m=d("MAWTransactionMode")).READWRITE,media:m.READWRITE,mediaBackup:m.READWRITE,messages:m.READWRITE,unrenderedMessages:m.READWRITE,xma:m.READWRITE},"saveXMAMediaAndMetadata",function(m){return function(){var n=new Map();b!=null&&n.set(b.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(m,i,b.blobArrayBuffer,b.plaintextHash,void 0,void 0,b.mediaType,b.mediaInfo,b.file,!0));if(e!=null){var o=n.get(e.plaintextHash);o==null&&n.set(e.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(m,i,e.blobArrayBuffer,e.plaintextHash,void 0,void 0,e.mediaType,e.mediaInfo,e.file,!0))}if(f!=null){o=n.get(f.plaintextHash);o==null&&n.set(f.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(m,i,f.blobArrayBuffer,f.plaintextHash,void 0,void 0,f.mediaType,f.mediaInfo,f.file,!0))}o=Array.from(n.values());return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsg(m,h),d("MAWDexieTable").dexieAll(o)]).then(function(n){var o=n[0];n=n[1];n=n.reduce(function(a,b){return a.set(b.plaintextHash,b)},new Map());var p=b!=null?n.get(b.plaintextHash):void 0,q=e!=null?n.get(e.plaintextHash):void 0,r=f!=null?n.get(f.plaintextHash):void 0,s=d("MAWDexieTable").dexieResolve();return d("MAWXMAManagementTxns").saveXMA(m,p==null?void 0:p.mediaId,q==null?void 0:q.mediaId,r==null?void 0:r.mediaId,g,a,h,i,j,l).then(function(a){d("MAWXMAUtils").isXMAStoryReply(g)&&o!=null?s=x(m,k,a,p,o):c("gkx")("821")?c("promiseDone")(d("MAWHandleXmaTransactionUtil").checkMediaChunkAndHandleXmaAfterTransaction(p,a,m)):d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:d("MAWBridgeXMA").createBridgeXMA(p,a,!1)});return s.then(function(){return{faviconDbMedia:r,headerDbMedia:q,previewDbMedia:p}})})})}})()}function x(a,b,e,f,g){var h=d("WAJids").interpretAsUserJid(b);if(h==null)throw c("err")("this is a flow check, participant jid can not be null");var i=e.defaultCTA;i=i==null?void 0:i.nativeUrl;h={author:h,externalId:e.externalId,mediaId:f==null?void 0:f.mediaId,sourceId:i,ts:void 0,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:e.targetType};f={content:h,remoteJid:b};if(g.type!==d("MAWMsgType").MSG_TYPE.TEXT)throw c("err")("flow check, this message type is only in text type");var j=babelHelpers["extends"]({},g,{quote:f});return a.messages.put(j).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(j)})})}g.sendXMAShareMsg=a}),98);
__d("WASmaxInGroupsSetSubjectClientErrors",["WAResultOrError","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxInGroupsIQErrorForbiddenMixin","WASmaxInGroupsIQErrorItemNotFoundMixin","WASmaxInGroupsIQErrorLockedMixin","WASmaxInGroupsIQErrorNotAcceptableMixin","WASmaxInGroupsIQErrorNotAuthorizedMixin","WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInGroupsIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:c.value});var e=d("WASmaxInGroupsIQErrorNotAuthorizedMixin").parseIQErrorNotAuthorizedMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAuthorized",value:e.value});var f=d("WASmaxInGroupsIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:f.value});var g=d("WASmaxInGroupsIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:g.value});var h=d("WASmaxInGroupsIQErrorLockedMixin").parseIQErrorLockedMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"IQErrorLocked",value:h.value});var i=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:i.value});var j=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return j.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:j.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorItemNotFound","IQErrorNotAuthorized","IQErrorForbidden","IQErrorNotAcceptable","IQErrorLocked","IQErrorRateOverlimit","IQErrorFallbackClient"],[b,c,e,f,g,h,i,j])}g.parseSetSubjectClientErrors=a}),98);
__d("WASmaxInGroupsSetSubjectResponseClientError",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsSetSubjectClientErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsSetSubjectClientErrors").parseSetSubjectClientErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorSetSubjectClientErrors:b.value}))}g.parseSetSubjectResponseClientError=a}),98);
__d("WASmaxInGroupsSetSubjectResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseSetSubjectResponseServerError=a}),98);
__d("WASmaxInGroupsSetSubjectResponseSuccess",["WASmaxInGroupsIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseSetSubjectResponseSuccess=a}),98);
__d("WASmaxOutGroupsSetSubjectChangeSubjectMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.subjectElementValue;a=d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("subject",null,a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSetSubjectChangeSubjectMixin=a}),98);
__d("WASmaxOutGroupsSetSubjectRequest",["WASmaxJsx","WASmaxOutGroupsBaseSetGroupMixin","WASmaxOutGroupsSetSubjectChangeSubjectMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutGroupsSetSubjectChangeSubjectMixin").mergeSetSubjectChangeSubjectMixin(d("WASmaxOutGroupsBaseSetGroupMixin").mergeBaseSetGroupMixin(d("WASmaxJsx").smax("iq",null),a),a);return a}g.makeSetSubjectRequest=a}),98);
__d("WASmaxGroupsSetSubjectRPC",["WAComms","WASmaxInGroupsSetSubjectResponseClientError","WASmaxInGroupsSetSubjectResponseServerError","WASmaxInGroupsSetSubjectResponseSuccess","WASmaxOutGroupsSetSubjectRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsSetSubjectRequest").makeSetSubjectRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsSetSubjectResponseSuccess").parseSetSubjectResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"SetSubjectResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsSetSubjectResponseClientError").parseSetSubjectResponseClientError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"SetSubjectResponseClientError",value:h.value});case 10:i=d("WASmaxInGroupsSetSubjectResponseServerError").parseSetSubjectResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"SetSubjectResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("SetSubject",{Success:g,ClientError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendSetSubjectRPC=a}),98);
__d("MAWSetGroupSubject",["MAWJobManager","WALogger","WAResultOrError","WASmaxGroupsSetSubjectRPC","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to change subject: ",""]);h=function(){return a};return a}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("sendSetSubjectRPC",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.group;a=a.subject;b=(yield d("WASmaxGroupsSetSubjectRPC").sendSetSubjectRPC({iqTo:b,subjectElementValue:a}));if(b.name==="SetSubjectResponseSuccess")return d("WAResultOrError").makeResult();b.name;d("WALogger").ERROR(h(),b.name);return d("WAResultOrError").makeError(b.name)});return function(b){return a.apply(this,arguments)}}()).end();g.setGroupSubject=a}),98);
__d("MAWUpdateBackupEntFbidForMedia",["LSDataTraceCheckPoint","LSIntEnum","MAWDbMediaTxns","MAWIndexedDb","MAWJobManager","MAWMediaBackupTxns","MAWMediaManagementTxns","MAWTraceUtils","MAWTransactionMode","Promise","WALogger","WAMediaUtils","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] backupEntFbid is empty"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] deliveryObjectId is empty"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Caught Error in updateBackupEntForFbid job for objectId ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mediaBackup is null for deliveryObjectId provided"]);m=function(){return a};return a}var n=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE},"updateBackupEntFbidInMediaBackup",function(a){return function(b,c,d){return o(a,b,c,d)}});function o(a,b,e,f){return d("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId(a,b).then(function(g){if(g==null){d("WALogger").ERROR(m());throw c("err")("mediaBackup is null for deliveryObjectId provided")}return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,g.mediaId).then(function(c){if(c!=null){var f=d("MAWMediaManagementTxns").updateBackupFbidInMediaEntries(c,b,e);f=babelHelpers["extends"]({},c,{fbid:e,mediaEntries:f});return a.media.update(f.mediaId,f).then(function(){if(c.msgIds.length>0)return d("MAWMediaBackupTxns").linkMediaBackup(a,c.mediaId,g.msgId,b,e)})}})["catch"](function(a){d("WALogger").ERROR(l(),a),d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_BACKUP_FAILURE),[],"Caught Error in updateBackupEntForFbid job")}).then(function(){})})}function p(a,e,f){if(a==null||a.length===0){d("WALogger").ERROR(k());d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_BACKUP_FAILURE),[],"deliveryObjectId is empty");return(h||(h=b("Promise"))).reject(c("err")("deliveryObjectId is empty"))}if(e==null||e.length===0){d("WALogger").ERROR(j());d("MAWTraceUtils").recordFailureAndFlushForTraceId(f,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_BACKUP_FAILURE),[],"backupEntFbid is empty");return(h||(h=b("Promise"))).reject(c("err")("backupEntFbid is empty"))}if(a!=null&&e!=null)return n(a,e,f);else return(h||(h=b("Promise"))).resolve()}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("writeToDb",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.backupEntFbid,e=a.deliveryObjectId;a=a.traceId;c("gkx")("4663")===!1&&(yield p(d("WAMediaUtils").stringToDeliveryObjectId(e),d("WAMediaUtils").stringToBackupEntFbid(b)));d("MAWTraceUtils").recordCheckpointForTrace(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_MEDIA_BACKUP_SUCCESS),[],!1);d("MAWTraceUtils").recordCheckpointForTrace(a,i.ofNumber(c("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH),[],!0)});return function(b){return a.apply(this,arguments)}}()).end();g.updateBackupEntFbidInMediaBackupTxn=o;g.updateBackupEntFbid=p;g.updateBackupEntFbidForMedia=a}),98);
__d("MAWUploadRetroactiveThreadsAndMessages",["MAWEBSwitch","MAWEbUploadQueue","MAWJobManager","Promise","WALogger","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] The user is not eligible for EB"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Initiating job: upload retroactive backups"]);j=function(){return a};return a}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("uploadAllThreadsAndMessages",function(){d("WALogger").LOG(j());if(c("gkx")("23914")){c("MAWEBSwitch").set(!0);c("promiseDone")(d("MAWEbUploadQueue").scheduleNextRun());return(h||(h=b("Promise"))).resolve()}else{d("WALogger").WARN(i());return(h||(h=b("Promise"))).resolve()}}).end();g.uploadRetroactiveThreadsAndMessages=a}),98);
__d("WorkerBootstrap",["HasteSupportData","ServerJSDefine"],(function(a,b,c,d,e,f,g){"use strict";function h(a){Object.keys(a).forEach(function(b){c("ServerJSDefine").handleDefine(b,[],a[b],-1,null)})}function a(a,c){var f,g;a.hsdp&&d("HasteSupportData").handle(a.hsdp);var i=(f=(g=a.jsmods)!=null?g:a.dynamicModules)!=null?f:{};h(i);var j=b.call(null,c);a.rds!=null&&a.rds.length>0&&e.call(null,a.rds,function(){});if(typeof j==="function"||j!==null)try{for(var k=arguments.length,l=new Array(k>2?k-2:0),m=2;m<k;m++)l[m-2]=arguments[m];j.apply(void 0,l)}catch(a){}}function f(a){a=a;if(typeof a==="function"||a!==null)try{a()}catch(a){}}g.initDynamicModules=h;g.start=a;g.startServerJS=f}),98);
__d("getBroadcastChannelForExecutionContext",["CometTaskFrameworkTypes","MWBroadcastChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("MWBroadcastChannel").MWBroadcastChannel(d("CometTaskFrameworkTypes").TASK_FRAMEWORK_PREFIX+"_"+String(a))}g["default"]=a}),98);
__d("loadTaskHandlerResource",["asyncToGeneratorRuntime","cr:3760"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=b("cr:3760").TASK_HANDLERS_RESOURCES[a];return a==null?null:a.getModuleIfRequired()||a.load()});return h.apply(this,arguments)}g["default"]=a}),98);