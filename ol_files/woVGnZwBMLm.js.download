;/*FB_PKG_DELIM*/

__d("EBLSUploadMessagesMutation_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="8132489556772764"}),null);
__d("EBLSUploadMessagesMutation.graphql",["EBLSUploadMessagesMutation_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"input"}],concreteType:"XFBTUploadMessageGQLResponse",kind:"LinkedField",name:"xfb_upload_encrypted_msg_to_backup",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"device_epoch_status",storageKey:null},{alias:null,args:null,concreteType:"XFBTUploadMessageHandlerResponse",kind:"LinkedField",name:"backup_write_result_response",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"is_success",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"delete_mailbox",storageKey:null},{alias:null,args:null,concreteType:"XFBTProtobufParams",kind:"LinkedField",name:"protobuf_params",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"delete_on_success",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"EBLSUploadMessagesMutation",selections:c,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"EBLSUploadMessagesMutation",selections:c},params:{id:b("EBLSUploadMessagesMutation_facebookRelayOperation"),metadata:{},name:"EBLSUploadMessagesMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("LSHandleBackupWriteCompletion",["ExecutionEnvironment","LSVec","MAWBridgeFireAndForget","MAWEBFrontendQPLLogger","MAWEbUploadQueue","Promise","WALogger","asyncToGeneratorRuntime","cr:847"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["ackWithInstanceKey failed with error ",""]);j=function(){return a};return a}function a(a,b,c,d){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){g!=null&&c("LSVec").toArray(g).forEach(function(a){d("MAWEBFrontendQPLLogger").endFlowUploadMessageBackup(a,f);d("MAWEBFrontendQPLLogger").endFlowUploadAttachmentBackup(a,f);a=parseInt(a,10);Number.isNaN(a)||((i||(i=c("ExecutionEnvironment"))).isInWorker?d("MAWEbUploadQueue").ackWithInstanceKey(a,f)["catch"](function(a){d("WALogger").ERROR(j(),a)}):d("MAWBridgeFireAndForget").fireAndForget("backend","ackWithInstanceKey",{instanceKey:a,success:f}))});if(b("cr:847")!=null){e=g!=null?c("LSVec").toArray(g):[];e.length>0&&(yield b("cr:847")(a,e))}return(h||(h=b("Promise"))).resolve()});return k.apply(this,arguments)}g.call=a}),98);
__d("LSHandleBackupWriteCompletion.nop",["LSHandleBackupWriteCompletion"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c,e){return d("LSHandleBackupWriteCompletion").call(a,b,c,e)};g["default"]=a}),98);
__d("LSMarkBackupAsCompleted.nop",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;a=function(a,c,d,e,f,h,i){return(g||(g=b("Promise"))).resolve()};f["default"]=a}),66);
__d("LSHandleProtobufWriteResult",["LSArrayGetObjectAt","LSMarkBackupAsCompleted.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return a[3]?d[0]=!1:d[0]=!0,d[0]?c.resolve():(d[1]=a[3].get("delete_on_success"),a[3],d[1]&&a[0]&&!a[1]?(a[2]?d[2]=!1:d[2]=!0,d[2]?c.resolve():c.sequence([function(e){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.of_int32(a[2].length),c.i64.gt(d[4],c.i64.cast([0,0]))?c.loopAsync(d[4],function(e){return d[7]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[2],d[7]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return c.filter(c.db.table(305).fetch(),function(a){return c.i64.eq(a.pendingBackupTaskId,d[8])}).next().then(function(a,d){var e=a.done;a=a.value;return e?0:(d=a.item,c.nativeOperation(b("LSMarkBackupAsCompleted.nop"),d.actThreadId,d.toplevelOfflineThreadingId,d.supplementalKey,d.messageTimestampMs,d.backupAction))})}])}):c.resolve()},function(e){return d[5]=c.i64.of_int32(a[2].length),c.i64.gt(d[5],c.i64.cast([0,0]))?c.loopAsync(d[5],function(e){return d[7]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[2],d[7]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return c.filter(c.db.table(305).fetch(),function(a){return c.i64.eq(a.pendingBackupTaskId,d[8])}).next().then(function(a,b){var e=a.done;a=a.value;return e?0:(b=a.item,d[12]=b.actThreadId,d[13]=b.toplevelOfflineThreadingId,d[11]=b.supplementalKey,d[14]=b.messageTimestampMs,d[11]!==void 0?c.forEach(c.filter(c.db.table(302).fetch(),function(a){return a.threadId===d[12]&&a.toplevelOfflineThreadingId===d[13]&&a.supplementalKey===d[11]&&c.i64.le(a.messageTimestampMs,d[14])}),function(a){return a["delete"]()}):c.forEach(c.filter(c.db.table(301).fetch(),function(a){return a.threadId===d[12]&&a.offlineThreadingId===d[13]&&c.i64.le(a.messageTimestampMs,d[14])}),function(a){return a["delete"]()}))})}])}):c.resolve()},function(e){return d[6]=c.i64.of_int32(a[2].length),c.i64.gt(d[6],c.i64.cast([0,0]))?c.loopAsync(d[6],function(e){return d[7]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[2],d[7]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return c.filter(c.db.table(305).fetch(),function(a){return c.i64.eq(a.pendingBackupTaskId,d[8])}).next().then(function(a,b){var d=a.done;a=a.value;return d?0:(b=a.item,c.forEach(c.db.table(304).fetch([[[b.toplevelOfflineThreadingId,b.actThreadId]],"offlineThreadingId"]),function(a){return a["delete"]()}))})}])}):c.resolve()}])):c.resolve())},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsHandleProtobufWriteResultStoredProcedure";e.exports=a}),null);
__d("LSLogMEBUploadSuccessEvent.nop",["Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("EncryptedBackupUploadFailureFalcoEvent").__setRef("LSLogMEBUploadSuccessEvent.nop"),j=c("requireDeferred")("EncryptedBackupUploadSuccessFalcoEvent").__setRef("LSLogMEBUploadSuccessEvent.nop");a=function(a,c,d,e,f){if(d!=null){a=f?j.load():i.load();void a.then(function(a){return a.log(function(){return{message_id:d,trace_id:e}})})}return(h||(h=b("Promise"))).resolve()};g["default"]=a}),98);
__d("LSHandleBackupWriteResult",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSDeleteBackupOnClient","LSFlushDataTrace.nop","LSHandleBackupWriteCompletion.nop","LSHandleProtobufWriteResult","LSIsMobileClient","LSLogMEBUploadSuccessEvent.nop","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleBackupWriteResultStoredProcedure] Beginning execution."),d[1]=c.createArray(),d[2]=c.createArray(),a[3]?d[3]=!1:d[3]=!0,d[3]?c.resolve():(d[15]=c.i64.of_int32(a[3].length),c.i64.gt(d[15],c.i64.cast([0,0]))?c.loopAsync(d[15],function(e){return d[16]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[3],d[16]).then(function(a){return a=a,d[17]=a[0],d[18]=a[1],a})},function(e){return c.db.table(177).fetch([[[d[17]]],"fk_pending_tasks"]).next().then(function(e,f){var g=e.done;e=e.value;return g?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsHandleBackupWriteResultStoredProcedure] Pending backup task id not found!"),d[20]=c.createArray(),void 0!==void 0?d[21]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleBackupWriteResultStoredProcedure","Pending backup task id not found!",d[20],c.i64.cast([0,3]))):(f=e.item,c.sequence([function(d){return c.i64.eq(f.contentType,c.i64.cast([0,1]))?c.nativeOperation(b("LSLogMEBUploadSuccessEvent.nop"),f.uniqueKey,f.lsTraceId,a[1]):c.resolve()},function(a){return d[20]=(d[2].push(f.persistentId),d[2])}]))})}])}):c.resolve())},function(d){return c.storedProcedure(b("LSHandleProtobufWriteResult"),a[1],a[2],a[3],a[4],!1)},function(e){return d[4]=c.i64.of_float(Date.now()),a[3]?d[5]=!1:d[5]=!0,d[5]?c.resolve():(d[15]=c.i64.of_int32(a[3].length),c.i64.gt(d[15],c.i64.cast([0,0]))?c.loopAsync(d[15],function(e){return d[16]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[3],d[16]).then(function(a){return a=a,d[17]=a[0],d[18]=a[1],a})},function(a){return c.forEach(c.filter(c.db.table(305).fetch(),function(a){return c.i64.eq(a.pendingBackupTaskId,d[17])}),function(a){return a["delete"]()})}])}):c.resolve())},function(e){return d[6]=c.i64.of_int32(a[0].length),c.i64.gt(d[6],c.i64.cast([0,0]))?c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],c.i64.cast([0,0])).then(function(a){return a=a,d[15]=a[0],d[16]=a[1],a})},function(a){return d[7]=d[15]}]):c.resolve(d[7]=void 0)},function(e){return d[8]=c.i64.of_int32(a[0].length),c.i64.gt(d[8],c.i64.cast([0,0]))?c.loopAsync(d[8],function(e){return d[15]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[15]).then(function(a){return a=a,d[16]=a[0],d[17]=a[1],a})},function(e){return a[1]?c.sequence([function(a){return d[16]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[16],c.i64.cast([0,1428]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[19]=!0:d[19]=!1,d[19]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[20]=c.createArray(),void 0!==void 0?d[21]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[20],c.i64.cast([0,3]))):c.resolve()}]):(a[2]?d[18]="Deleting mailbox":d[18]="Unexpected error",c.sequence([function(a){return d[16]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[16],c.i64.cast([0,1450]),c.i64.cast([0,2]),d[18],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[20]=!0:d[20]=!1,d[20]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[21]=c.createArray(),void 0!==void 0?d[22]=(d[21].push(void 0),d[21]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[21],c.i64.cast([0,3]))):c.resolve()}]))},function(e){return d[16]===d[7]&&a[2]?c.resolve():c.sequence([function(e){return a[1]?c.sequence([function(a){return d[16]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[16],c.i64.cast([0,84]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!0:d[21]=!1,d[21]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[22]=c.createArray(),void 0!==void 0?d[23]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[22],c.i64.cast([0,3]))):c.resolve()}]):d[16]!==void 0?c.sequence([function(a){return d[16]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[16],c.i64.cast([0,85]),c.i64.cast([0,2]),"The flow did not succeed",void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!0:d[21]=!1,d[21]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[22]=c.createArray(),void 0!==void 0?d[23]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[22],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[16]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[16]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[19]=!0:d[19]=!1,d[19]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[20]=c.createArray(),void 0!==void 0?d[21]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[20],c.i64.cast([0,3]))):c.resolve()}])}])}):c.resolve()},function(e){return a[2]?c.storedProcedure(b("LSDeleteBackupOnClient"),void 0,void 0,!0,d[7],void 0,!0):c.resolve()},function(e){return c.nativeOperation(b("LSHandleBackupWriteCompletion.nop"),a[1],a[0],d[2])},function(a){return d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleBackupWriteResultStoredProcedure] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleBackupWriteResultStoredProcedure",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsHandleBackupWriteResultStoredProcedure";e.exports=a}),null);
__d("LSHandleBackupWriteResultStoredProcedure",["LSHandleBackupWriteResult","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.traceIds;d[1]=b.isSuccess;d[2]=b.deleteMailbox;d[3]=b.taskIds;d[4]=b.protobufParams;return c("LSHandleBackupWriteResult").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSPrepareOpenEpochV2",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSCreateDataTrace","LSCreateDataTraceID.nop","LSFlushDataTrace.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] Beginning execution."),c.count(c.filter(c.db.table(2).fetch(),function(a){return a.context==="50005"||a.context==="320"})).then(function(a){return d[1]=a})},function(e){return c.i64.neq(d[1],c.i64.cast([0,0]))?c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] Skipping openEpoch start because there is already an openEpoch flow in progress."),d[2]=c.i64.cast([0,1]))):c.sequence([function(e){return c.sequence([function(e){return a[1]!==void 0?c.resolve(d[12]=a[1]):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))&&c.i64.eq(a.backupTenancy,c.i64.cast([0,2]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?d[13]=!1:(a.item,d[13]=!0)})},function(a){return d[13]?d[15]=c.i64.or_(c.i64.cast([0,79]),c.i64.cast([0,128])):d[15]=c.i64.cast([0,79]),c.sequence([function(a){return c.nativeOperation(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return c.sequence([function(a){return d[21]="EncryptedBackups MCD Trace ID",d[22]=c.i64.to_string(d[15]),d[20]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",d[20],d[21],d[20],d[22]].join("")),c.resolve()},function(a){return c.storedProcedure(b("LSCreateDataTrace"),d[17],void 0,void 0,"",d[15])}])},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[19]=!0:d[19]=!1,d[19]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[20]=c.createArray(),void 0!==void 0?d[21]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[20],c.i64.cast([0,3]))):c.resolve()},function(a){return d[16]=d[17]}])},function(a){return d[12]=d[16]}])},function(a){return d[9]=d[12]}])},function(a){return c.sequence([function(a){return d[9]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[9],c.i64.cast([0,1441]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[12]=a[0],a})},function(a){return d[12]?d[13]=!0:d[13]=!1,d[13]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[14],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?c.sequence([function(a){return c.sequence([function(a){return d[9]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[9],c.i64.cast([0,2822]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[15],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[12]="No backup found.",d[12]!==void 0?c.sequence([function(a){return d[14]=["[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] ","",d[12]].join(""),function(a){c.logger(a).mustfix(a)}(d[14]),d[13]=c.createArray(),d[9]!==void 0?d[15]=(d[13].push(d[9]),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure",d[12],d[13],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return d[9]!==void 0?c.sequence([function(a){return d[9]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[9],c.i64.cast([0,85]),c.i64.cast([0,2]),d[14],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[18]=!0:d[18]=!1,d[18]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]=c.createArray(),void 0!==void 0?d[20]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[19],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[9]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[9]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[15]?d[16]=!0:d[16]=!1,d[16]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[17]=c.createArray(),void 0!==void 0?d[18]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[17],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(a){return d[9]!==void 0?c.sequence([function(a){return d[9]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[9],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[15]?d[16]=!0:d[16]=!1,d[16]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[17]=c.createArray(),void 0!==void 0?d[18]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[17],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[9]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[9]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[15],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[10]=c.i64.cast([0,1])}]):(e=a.item,c.sequence([function(a){return d[19]=e.deviceId,d[18]=e.backupTenancy,d[17]=e.encryptionVersion,d[12]=void 0,c.i64.neq(d[12],void 0)?c.resolve(d[13]=d[12]):c.sequence([function(a){return d[20]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[30]=(d[20].push(c.i64.cast([0,0])),d[20]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[30]=(d[20].push(c.i64.cast([0,2])),d[20]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[23]?d[30]=(d[20].push(c.i64.cast([0,3])),d[20]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[30]=(d[20].push(c.i64.cast([0,4])),d[20]):0,d[25]=c.createArray(),d[26]=c.i64.of_int32(d[20].length),c.i64.gt(d[26],c.i64.cast([0,0]))?c.loopAsync(d[26],function(a){return d[30]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[20],d[30]).then(function(a){return a=a,d[31]=a[0],d[32]=a[1],a})},function(a){return d[33]=(d[25].push(d[31]),d[25])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[30]=c.createArray(),d[31]=c.i64.of_int32(d[25].length),c.i64.gt(d[31],c.i64.cast([0,0]))?c.loopAsync(d[31],function(a){return d[33]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[25],d[33]).then(function(a){return a=a,d[34]=a[0],d[35]=a[1],a})},function(a){return d[36]=(d[30].push(c.i64.to_string(d[34])),d[30])}])}):c.resolve()},function(a){return d[32]=d[30].join(","),d[27]=d[32]}])},function(a){return d[25].some(function(a){return c.i64.eq(d[17],a)})?d[28]=d[17]:d[28]=void 0,c.i64.neq(d[28],void 0)?d[29]=d[28]:d[29]=void 0,d[13]=d[29]}])},function(a){return c.i64.neq(d[13],void 0)?d[14]=d[13]:d[14]=c.i64.cast([0,0]),c.i64.neq(d[18],void 0)?d[15]=d[18]:d[15]=c.i64.cast([0,1]),c.i64.neq(d[19],void 0)?c.sequence([function(a){return c.sequence([function(a){return d[9]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[9],c.i64.cast([0,2821]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[29]=!0:d[29]=!1,d[29]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[30]=c.createArray(),void 0!==void 0?d[31]=(d[30].push(void 0),d[30]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[30],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[20]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[28]=(d[20].push(a.epochId),d[20])})},function(a){return d[26]="Queried locally available epochs. Count: ",d[21]=c.i64.of_int32(d[20].length),d[27]=c.i64.to_string(d[21]),d[22]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[22],d[26],d[22],d[27]].join("")),c.resolve()},function(a){return d[23]=new c.Map(),d[23].set("backup_id",e.backupId),d[23].set("locally_available_epochs",d[20]),d[23].set("device_id",d[19]),d[23].set("trace_id",d[9]),d[24]=c.toJSON(d[23]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"messenger_request_for_asssoc_devices",c.i64.cast([0,50005]),d[24],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),d[9],c.i64.cast([0,0])).then(function(a){return a=a,d[25]=a[0],a})},function(a){return c.sequence([function(a){return d[9]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[9],c.i64.cast([0,1442]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[29]=!0:d[29]=!1,d[29]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[30]=c.createArray(),void 0!==void 0?d[31]=(d[30].push(void 0),d[30]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[30],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[16]=c.i64.cast([0,0])}]):c.sequence([function(a){return c.sequence([function(a){return d[9]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[9],c.i64.cast([0,2822]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[22]=!0:d[22]=!1,d[22]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[23]=c.createArray(),void 0!==void 0?d[24]=(d[23].push(void 0),d[23]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[23],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[20]="No backup found.",d[20]!==void 0?c.sequence([function(a){return d[22]=["[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] ","",d[20]].join(""),function(a){c.logger(a).mustfix(a)}(d[22]),d[21]=c.createArray(),d[9]!==void 0?d[23]=(d[21].push(d[9]),d[21]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure",d[20],d[21],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return d[9]!==void 0?c.sequence([function(a){return d[9]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[9],c.i64.cast([0,85]),c.i64.cast([0,2]),d[22],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[25]=a[0],a})},function(a){return d[25]?d[26]=!0:d[26]=!1,d[26]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[27]=c.createArray(),void 0!==void 0?d[28]=(d[27].push(void 0),d[27]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[27],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[9]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[9]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[23]?d[24]=!0:d[24]=!1,d[24]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[25]=c.createArray(),void 0!==void 0?d[26]=(d[25].push(void 0),d[25]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[25],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(a){return d[9]!==void 0?c.sequence([function(a){return d[9]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[9],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[23]?d[24]=!0:d[24]=!1,d[24]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[25]=c.createArray(),void 0!==void 0?d[26]=(d[25].push(void 0),d[25]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[25],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[9]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[9]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[22]=!0:d[22]=!1,d[22]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[23]=c.createArray(),void 0!==void 0?d[24]=(d[23].push(void 0),d[23]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[23],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[16]=c.i64.cast([0,1])}])},function(a){return d[10]=d[16]}]))})},function(a){return d[2]=d[10]}])},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[2]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure";e.exports=a}),null);
__d("LSPrepareOpenEpochV2StoredProcedure",["LSPrepareOpenEpochV2","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){b===void 0&&(b={});var d=[];d[0]=b.backupId;d[1]=b.traceId;return c("LSPrepareOpenEpochV2").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSSyncEpochs",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSCreateDataTrace","LSCreateDataTraceID.nop","LSFlushDataTrace.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] Beginning execution."),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))&&c.i64.eq(a.backupTenancy,c.i64.cast([0,2]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?d[1]=!1:(a.item,d[1]=!0)})},function(a){return d[1]?d[3]=c.i64.or_(c.i64.cast([0,78]),c.i64.cast([0,128])):d[3]=c.i64.cast([0,78]),c.sequence([function(a){return c.nativeOperation(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return c.sequence([function(a){return d[17]="EncryptedBackups MCD Trace ID",d[18]=c.i64.to_string(d[3]),d[16]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",d[16],d[17],d[16],d[18]].join("")),c.resolve()},function(a){return c.storedProcedure(b("LSCreateDataTrace"),d[13],void 0,void 0,"synch_epochs",d[3])}])},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!0:d[15]=!1,d[15]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[16],c.i64.cast([0,3]))):c.resolve()},function(a){return d[4]=d[13]}])},function(a){return c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,1436]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[15],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?c.sequence([function(a){return d[13]=["Failed to load client state: ","","BACKUP_NOT_FOUND"].join(""),d[13]!==void 0?c.sequence([function(a){return d[15]=["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",d[13]].join(""),function(a){c.logger(a).mustfix(a)}(d[15]),d[14]=c.createArray(),d[4]!==void 0?d[16]=(d[14].push(d[4]),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",d[13],d[14],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return d[4]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,85]),c.i64.cast([0,2]),d[15],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[19]=!0:d[19]=!1,d[19]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[20]=c.createArray(),void 0!==void 0?d[21]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[20],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[17]=!0:d[17]=!1,d[17]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[18]=c.createArray(),void 0!==void 0?d[19]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[18],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(a){return d[4]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[17]=!0:d[17]=!1,d[17]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[18]=c.createArray(),void 0!==void 0?d[19]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[18],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!0:d[15]=!1,d[15]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[16],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[5]=!1}]):(e=a.item,c.sequence([function(a){return d[20]=e.deviceId,d[19]=e.backupTenancy,d[18]=e.encryptionVersion,d[13]=void 0,c.i64.neq(d[13],void 0)?c.resolve(d[14]=d[13]):c.sequence([function(a){return d[21]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[31]=(d[21].push(c.i64.cast([0,0])),d[21]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[23]?d[31]=(d[21].push(c.i64.cast([0,2])),d[21]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[31]=(d[21].push(c.i64.cast([0,3])),d[21]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[25]=a[0],a})},function(a){return d[25]?d[31]=(d[21].push(c.i64.cast([0,4])),d[21]):0,d[26]=c.createArray(),d[27]=c.i64.of_int32(d[21].length),c.i64.gt(d[27],c.i64.cast([0,0]))?c.loopAsync(d[27],function(a){return d[31]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[21],d[31]).then(function(a){return a=a,d[32]=a[0],d[33]=a[1],a})},function(a){return d[34]=(d[26].push(d[32]),d[26])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[31]=c.createArray(),d[32]=c.i64.of_int32(d[26].length),c.i64.gt(d[32],c.i64.cast([0,0]))?c.loopAsync(d[32],function(a){return d[34]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[26],d[34]).then(function(a){return a=a,d[35]=a[0],d[36]=a[1],a})},function(a){return d[37]=(d[31].push(c.i64.to_string(d[35])),d[31])}])}):c.resolve()},function(a){return d[33]=d[31].join(","),d[28]=d[33]}])},function(a){return d[26].some(function(a){return c.i64.eq(d[18],a)})?d[29]=d[18]:d[29]=void 0,c.i64.neq(d[29],void 0)?d[30]=d[29]:d[30]=void 0,d[14]=d[30]}])},function(a){return c.i64.neq(d[14],void 0)?d[15]=d[14]:d[15]=c.i64.cast([0,0]),c.i64.neq(d[19],void 0)?d[16]=d[19]:d[16]=c.i64.cast([0,1]),c.i64.neq(d[20],void 0)?c.sequence([function(a){return c.filter(c.db.table(2).fetch(),function(a){return a.context===c.i64.to_string(c.i64.cast([0,50013]))||a.context===c.i64.to_string(c.i64.cast([0,50025]))}).next().then(function(a,b){b=a.done;a=a.value;return b?d[21]=!1:(a.item,d[21]=!0)})},function(a){return d[21]?(d[23]="Another sync job is already in progress. Terminating this.",d[23]!==void 0?c.sequence([function(a){return d[25]=["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",d[23]].join(""),function(a){c.logger(a).mustfix(a)}(d[25]),d[24]=c.createArray(),d[4]!==void 0?d[26]=(d[24].push(d[4]),d[24]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",d[23],d[24],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return d[4]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,85]),c.i64.cast([0,2]),d[25],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]?d[29]=!0:d[29]=!1,d[29]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[30]=c.createArray(),void 0!==void 0?d[31]=(d[30].push(void 0),d[30]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[30],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]?d[27]=!0:d[27]=!1,d[27]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[28]=c.createArray(),void 0!==void 0?d[29]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[28],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(a){return d[4]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]?d[27]=!0:d[27]=!1,d[27]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[28]=c.createArray(),void 0!==void 0?d[29]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[28],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[25]=!0:d[25]=!1,d[25]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[26],c.i64.cast([0,3]))):c.resolve()}])):c.sequence([function(a){return c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,2849]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[31]?d[32]=!0:d[32]=!1,d[32]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[33]=c.createArray(),void 0!==void 0?d[34]=(d[33].push(void 0),d[33]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[33],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[23]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[31]=(d[23].push(a.epochId),d[23])})},function(a){return d[29]="Queried locally available epochs. Count: ",d[24]=c.i64.of_int32(d[23].length),d[30]=c.i64.to_string(d[24]),d[25]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[25],d[29],d[25],d[30]].join("")),c.resolve()},function(a){return d[26]=new c.Map(),d[26].set("backup_id",e.backupId),d[26].set("device_id",d[20]),d[26].set("locally_available_epochs",d[23]),d[26].set("trace_id",d[4]),d[27]=c.toJSON(d[26]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"messenger_encrypted_backups",c.i64.cast([0,50025]),d[27],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),d[4],c.i64.cast([0,0])).then(function(a){return a=a,d[28]=a[0],a})}])},function(a){return d[17]=!0}]):c.sequence([function(a){return d[21]=["Failed to load client state: ","","NULL_DEVICE_ID"].join(""),d[21]!==void 0?c.sequence([function(a){return d[23]=["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",d[21]].join(""),function(a){c.logger(a).mustfix(a)}(d[23]),d[22]=c.createArray(),d[4]!==void 0?d[24]=(d[22].push(d[4]),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",d[21],d[22],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return d[4]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,85]),c.i64.cast([0,2]),d[23],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]?d[27]=!0:d[27]=!1,d[27]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[28]=c.createArray(),void 0!==void 0?d[29]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[28],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[25]=!0:d[25]=!1,d[25]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[26],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(a){return d[4]!==void 0?c.sequence([function(a){return d[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),d[4],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[25]=!0:d[25]=!1,d[25]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[26],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),d[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[23]=!0:d[23]=!1,d[23]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[24]=c.createArray(),void 0!==void 0?d[25]=(d[24].push(void 0),d[24]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[24],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[17]=!1}])},function(a){return d[5]=d[17]}]))})},function(a){return d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsSyncEpochsStoredProcedure";e.exports=a}),null);
__d("LSSyncEpochsStoredProcedure",["LSSyncEpochs","cr:8709"],(function(a,b,c,d,e,f,g){function a(a){return c("LSSyncEpochs")(a)}g["default"]=a}),98);
__d("LSBackupContentType",[],(function(a,b,c,d,e,f){a=Object.freeze({MESSAGE:1,THREAD:2});f["default"]=a}),66);
__d("LSPendingBackupStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({NEEDS_BACKUP:1,BACKUP_IN_PROGRESS:2,BLOCKED:3});f["default"]=a}),66);
__d("LSSerializeAttachmentBackupPayloadStoredProcedure",["LSSerializeAttachmentBackupPayload","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.attachmentInfos;d[1]=b.messageId;d[2]=b.threadId;d[3]=b.productType;d[4]=b.error;d[5]=b.errorMessage;return c("LSSerializeAttachmentBackupPayload").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MAWUploadPayloadGenerator",["I64","LSBackupContentType","LSEncryptedBackupsAttachmentErrorCode","LSFactory","LSIntEnum","LSPendingBackupStatus","LSSerializeAttachmentBackupPayloadStoredProcedure","LSShape","LSTaskSerializerEncryptedBackupsUpload","MAWBridgeUploadMessageHandler","MAWEBUploadMessageUtils","Promise","Random","WALogger","asyncToGeneratorRuntime","gkx","hashString","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web] Duplicate task id found for upload message instance key: ","\n      and traceId: ",""]);k=function(){return a};return a}var l=new Set();function a(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){e=e.map(function(b){var e;e=(e=b.uploadTrackingInstanceKey)!=null?e:c("hashString")(b.traceId);l.has(e)&&(d("WALogger").ERROR(k(),b.uploadTrackingInstanceKey,b.traceId),e=d("Random").uint32());l.add(e);return n(a,b,e)});e=(yield (j||(j=b("Promise"))).all(e));e=(yield j.all(e.map(function(e){return c("LSTaskSerializerEncryptedBackupsUpload")((h||(h=d("I64"))).of_int32(e.task),c("LSFactory")(a)).then(function(c){var d=e.pending_protobuf_backups_context_pk;return(j||(j=b("Promise"))).all([a.pending_backups_context_v2["delete"](e.pending_backups_context_v2_pk),d!=null?a.pending_protobuf_backups_context["delete"](d):(j||(j=b("Promise"))).resolve(null)]).then(function(){l["delete"](e.task);return c})})})));e=(yield j.all(e.map(function(a){return a[0]})));return e});return m.apply(this,arguments)}function n(a,b,c){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=b.sortOrderMs.toString(),g=(h||(h=d("I64"))).of_int32(e),j=(i||(i=d("LSIntEnum"))).ofNumber(b.actionType);b.actionType===2?j=(i||(i=d("LSIntEnum"))).ofNumber(b.actionType):j=(i||(i=d("LSIntEnum"))).ofNumber(b.actionType);var k=(yield q(a,b));j=(yield a.pending_backups_context_v2.add({actionType:j,attachmentErrorCode:h.of_float(((j=b.attachmentBackupContext)==null?void 0:j.error)!=null?c("LSEncryptedBackupsAttachmentErrorCode").UNKNOWN_ERROR:c("LSEncryptedBackupsAttachmentErrorCode").NO_ERROR),attachmentPayload:k,backupStatus:i.ofNumber(c("LSPendingBackupStatus").BACKUP_IN_PROGRESS),contentType:i.ofNumber(c("LSBackupContentType").MESSAGE),echoContent:(j=b.echoDocument)!=null?j:"",listKey:b.threadId,pendingBackupTaskId:h.of_int32(e),persistentId:"",pk:g,sortKey:f,uniqueKey:b.messageId}));if(!(c("qex")._("1527")===!0||c("gkx")("23966")))return{pending_backups_context_v2_pk:j[0],task:e};g=b.protoMsg;if(g==null)return{pending_backups_context_v2_pk:j[0],task:e};b=(yield a.pending_protobuf_backups_context.add({actThreadId:b.threadId,attachmentPayload:k,backupAction:h.of_float(g.backupActionType),messageTimestampMs:h.of_float(d("MAWEBUploadMessageUtils").echoOverrideMessageSortOrder({externalId:g.msgId.externalId,serverTs:g.serverTs,ts:g.serverTs})),pendingBackupTaskId:h.of_float(e),supplementalKey:g.supplementalKey,toplevelOfflineThreadingId:(a=(f=g.originalMsgProtocolId)==null?void 0:f.externalId)!=null?a:g.msgId.externalId}));return{pending_backups_context_v2_pk:j[0],pending_protobuf_backups_context_pk:b[0],task:e}});return o.apply(this,arguments)}function p(a){if(a.attachmentInfos.length!==1)return[];a=a.attachmentInfos[0];return[{attachment_trace_id:a.attachmentTraceId,media_type:a.mediaType,zippy_object_id:a.zippyObjectId}]}function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e,f,g=b.attachmentBackupContext;if(g!=null){f=d("MAWBridgeUploadMessageHandler").getMessageUploadAttachmentBackupContext({bridgeUploadAttachmentBackupContext:g,messageId:b.messageId,serverThreadKey:null,threadId:b.threadId,traceId:b.traceId});if(f!=null){a=(yield c("LSSerializeAttachmentBackupPayloadStoredProcedure")(c("LSFactory")(a),{attachmentInfos:f.attachment_infos,error:f.error,errorMessage:f.error_message,messageId:b.messageId,productType:f.product_type,threadId:b.threadId}));f=a[0];b=a[1];if(f!=null){a=d("LSShape").toRecord(f);e=JSON.stringify({success:a.payload,upload_context:p(g)})}else if(b!=null){f=d("LSShape").toRecord(b);a=f.error_code;e=JSON.stringify({failure:{error_code:(h||(h=d("I64"))).to_float(a),error_message:f.error_message,stored_procedure:f.stored_procedure},upload_context:p(g)})}}}return e});return r.apply(this,arguments)}g.genUploadPayload=a}),98);
__d("EBLSUploadMessages",["EBLS","EBLSUploadMessagesMutation.graphql","I64","LSEncryptedBackupsBackupTenancy","LSFactory","LSHandleBackupWriteResultStoredProcedure","LSIntEnum","LSPrepareOpenEpochV2StoredProcedure","LSShape","LSSyncEpochsStoredProcedure","LSVec","MAWCurrentUser","MAWEBFrontendQPLLogger","MAWEncryptedBackupUtils","MAWSharedWriteToMPSTables","MAWUploadPayloadGenerator","Promise","WADownloadMedia","WALogger","WAPREList","WAPREMetrics","asyncToGeneratorRuntime","createWorkerMutation","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to get upload with EBLS: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] backupWriteResult is null"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] graphqlResponse is null"]);n=function(){return a};return a}function a(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{yield d("WADownloadMedia").onFinishDownloads({maxDelay:1e4,minDelay:100});var e=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WA_JOB_MANAGER,{string:{name:"ebls_upload"}});e.addPoint("ebls_upload_init_start");yield d("EBLS").init();var f=(yield d("EBLS").getLSStorage());e.addPoint("ebls_upload_init_end");e.addPoint("ebls_upload_backup_tenancy_start");var g=(yield f.runInTransaction(function(a){return d("MAWEncryptedBackupUtils").getBackupTenancy(a)},"readonly"));e.addPoint("ebls_upload_backup_tenancy_end");if(g==null||!(j||(j=d("I64"))).equal(g,(k||(k=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION))){for(g of a)if(g.uploadTrackingInstanceKey!=null){var h=g.uploadTrackingInstanceKey;d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(h,"user_device_not_enrolled_invalid_gql_request");d("MAWEBFrontendQPLLogger").endEBUploadTracking(h)}e.endFail("user_device_not_enrolled");return}h=(yield f.runInTransaction(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e){c("gkx")("23966")&&(yield (i||(i=b("Promise"))).all(a.map(function(a){return a.protoMsg?[a.protoMsg,a.threadId]:null}).filter(Boolean).map(function(a){var b=a[0];a=a[1];return d("MAWSharedWriteToMPSTables").writeToMPSTables(e,b,a,!1)})));return d("MAWUploadPayloadGenerator").genUploadPayload(e,a)});return function(a){return e.apply(this,arguments)}}(),"readwrite"));e.addPoint("ebls_upload_serialisation_end");e.addPoint("ebls_upload_graphql_start");g=c("createWorkerMutation")(p);g=g[0];var o=d("MAWCurrentUser").getAppID();g=(yield g({input:{app_id:o!=null?Number(o):void 0,payload:{msg_payloads:h.filter(Boolean)}}}));e.addPoint("ebls_upload_graphql_end");if(g==null){d("WALogger").ERROR(n());return}for(o of a)o.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(o.uploadTrackingInstanceKey,"received_gql_upload_response");e.addPoint("ebls_upload_handle_response_start");o=(h=g.xfb_upload_encrypted_msg_to_backup)==null?void 0:h.backup_write_result_response;if(o==null){d("WALogger").ERROR(m());return}var q=o.is_success,r=o.delete_mailbox,s=(h=o.protobuf_params)==null?void 0:h.delete_on_success;q!=null&&r!=null&&(yield f.runInTransaction(function(b){return c("LSHandleBackupWriteResultStoredProcedure")(c("LSFactory")(b),{deleteMailbox:r,isSuccess:q,protobufParams:s!=null?d("LSShape").ofRecord({delete_on_success:s}):void 0,traceIds:c("LSVec").ofArray(a.map(function(a){return a.traceId}))})},"readwrite"));h=(o=g.xfb_upload_encrypted_msg_to_backup)==null?void 0:o.device_epoch_status;if(h!=null)switch(h){case"NO_OPEN_EPOCH":yield f.runInTransaction(function(a){return c("LSPrepareOpenEpochV2StoredProcedure")(c("LSFactory")(a),{backupId:void 0})},"readwrite");break;case"OUTDATED":yield f.runInTransaction(function(a){return c("LSSyncEpochsStoredProcedure")(c("LSFactory")(a))},"readonly");break;case"OK":break;default:}e.addPoint("ebls_upload_handle_response_end");e.endSuccess()}catch(a){d("WALogger").ERROR(l(),a)}});return o.apply(this,arguments)}var p=h!==void 0?h:h=b("EBLSUploadMessagesMutation.graphql");g.eblsUploadMessages=a}),98);